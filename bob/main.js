! function(e) {
    var t = {};

    function i(n) {
        if (t[n]) return t[n].exports;
        var r = t[n] = {
            i: n,
            l: !1,
            exports: {}
        };
        return e[n].call(r.exports, r, r.exports, i), r.l = !0, r.exports
    }
    i.m = e, i.c = t, i.d = function(e, t, n) {
        i.o(e, t) || Object.defineProperty(e, t, {
            enumerable: !0,
            get: n
        })
    }, i.r = function(e) {
        "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {
            value: "Module"
        }), Object.defineProperty(e, "__esModule", {
            value: !0
        })
    }, i.t = function(e, t) {
        if (1 & t && (e = i(e)), 8 & t) return e;
        if (4 & t && "object" == typeof e && e && e.__esModule) return e;
        var n = Object.create(null);
        if (i.r(n), Object.defineProperty(n, "default", {
                enumerable: !0,
                value: e
            }), 2 & t && "string" != typeof e)
            for (var r in e) i.d(n, r, function(t) {
                return e[t]
            }.bind(null, r));
        return n
    }, i.n = function(e) {
        var t = e && e.__esModule ? function() {
            return e.default
        } : function() {
            return e
        };
        return i.d(t, "a", t), t
    }, i.o = function(e, t) {
        return Object.prototype.hasOwnProperty.call(e, t)
    }, i.p = "", i(i.s = 2)
}([function(e, t, i) {
    (function(i) {
        var n;
        /*!
         *  howler.js v2.1.3
         *  howlerjs.com
         *
         *  (c) 2013-2019, James Simpson of GoldFire Studios
         *  goldfirestudios.com
         *
         *  MIT License
         */
        ! function() {
            "use strict";
            var r = function() {
                this.init()
            };
            r.prototype = {
                init: function() {
                    var e = this || o;
                    return e._counter = 1e3, e._html5AudioPool = [], e.html5PoolSize = 10, e._codecs = {}, e._howls = [], e._muted = !1, e._volume = 1, e._canPlayEvent = "canplaythrough", e._navigator = "undefined" != typeof window && window.navigator ? window.navigator : null, e.masterGain = null, e.noAudio = !1, e.usingWebAudio = !0, e.autoSuspend = !0, e.ctx = null, e.autoUnlock = !0, e._setup(), e
                },
                volume: function(e) {
                    var t = this || o;
                    if (e = parseFloat(e), t.ctx || f(), void 0 !== e && e >= 0 && e <= 1) {
                        if (t._volume = e, t._muted) return t;
                        t.usingWebAudio && t.masterGain.gain.setValueAtTime(e, o.ctx.currentTime);
                        for (var i = 0; i < t._howls.length; i++)
                            if (!t._howls[i]._webAudio)
                                for (var n = t._howls[i]._getSoundIds(), r = 0; r < n.length; r++) {
                                    var s = t._howls[i]._soundById(n[r]);
                                    s && s._node && (s._node.volume = s._volume * e)
                                }
                        return t
                    }
                    return t._volume
                },
                mute: function(e) {
                    var t = this || o;
                    t.ctx || f(), t._muted = e, t.usingWebAudio && t.masterGain.gain.setValueAtTime(e ? 0 : t._volume, o.ctx.currentTime);
                    for (var i = 0; i < t._howls.length; i++)
                        if (!t._howls[i]._webAudio)
                            for (var n = t._howls[i]._getSoundIds(), r = 0; r < n.length; r++) {
                                var s = t._howls[i]._soundById(n[r]);
                                s && s._node && (s._node.muted = !!e || s._muted)
                            }
                    return t
                },
                unload: function() {
                    for (var e = this || o, t = e._howls.length - 1; t >= 0; t--) e._howls[t].unload();
                    return e.usingWebAudio && e.ctx && void 0 !== e.ctx.close && (e.ctx.close(), e.ctx = null, f()), e
                },
                codecs: function(e) {
                    return (this || o)._codecs[e.replace(/^x-/, "")]
                },
                _setup: function() {
                    var e = this || o;
                    if (e.state = e.ctx && e.ctx.state || "suspended", e._autoSuspend(), !e.usingWebAudio)
                        if ("undefined" != typeof Audio) try {
                            void 0 === (new Audio).oncanplaythrough && (e._canPlayEvent = "canplay")
                        } catch (t) {
                            e.noAudio = !0
                        } else e.noAudio = !0;
                    try {
                        (new Audio).muted && (e.noAudio = !0)
                    } catch (e) {}
                    return e.noAudio || e._setupCodecs(), e
                },
                _setupCodecs: function() {
                    var e = this || o,
                        t = null;
                    try {
                        t = "undefined" != typeof Audio ? new Audio : null
                    } catch (t) {
                        return e
                    }
                    if (!t || "function" != typeof t.canPlayType) return e;
                    var i = t.canPlayType("audio/mpeg;").replace(/^no$/, ""),
                        n = e._navigator && e._navigator.userAgent.match(/OPR\/([0-6].)/g),
                        r = n && parseInt(n[0].split("/")[1], 10) < 33;
                    return e._codecs = {
                        mp3: !(r || !i && !t.canPlayType("audio/mp3;").replace(/^no$/, "")),
                        mpeg: !!i,
                        opus: !!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/, ""),
                        ogg: !!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ""),
                        oga: !!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ""),
                        wav: !!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/, ""),
                        aac: !!t.canPlayType("audio/aac;").replace(/^no$/, ""),
                        caf: !!t.canPlayType("audio/x-caf;").replace(/^no$/, ""),
                        m4a: !!(t.canPlayType("audio/x-m4a;") || t.canPlayType("audio/m4a;") || t.canPlayType("audio/aac;")).replace(/^no$/, ""),
                        mp4: !!(t.canPlayType("audio/x-mp4;") || t.canPlayType("audio/mp4;") || t.canPlayType("audio/aac;")).replace(/^no$/, ""),
                        weba: !!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, ""),
                        webm: !!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, ""),
                        dolby: !!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/, ""),
                        flac: !!(t.canPlayType("audio/x-flac;") || t.canPlayType("audio/flac;")).replace(/^no$/, "")
                    }, e
                },
                _unlockAudio: function() {
                    var e = this || o;
                    if (!e._audioUnlocked && e.ctx) {
                        e._audioUnlocked = !1, e.autoUnlock = !1, e._mobileUnloaded || 44100 === e.ctx.sampleRate || (e._mobileUnloaded = !0, e.unload()), e._scratchBuffer = e.ctx.createBuffer(1, 1, 22050);
                        var t = function(i) {
                            for (var n = 0; n < e.html5PoolSize; n++) try {
                                var r = new Audio;
                                r._unlocked = !0, e._releaseHtml5Audio(r)
                            } catch (i) {
                                e.noAudio = !0
                            }
                            for (n = 0; n < e._howls.length; n++)
                                if (!e._howls[n]._webAudio)
                                    for (var o = e._howls[n]._getSoundIds(), s = 0; s < o.length; s++) {
                                        var a = e._howls[n]._soundById(o[s]);
                                        a && a._node && !a._node._unlocked && (a._node._unlocked = !0, a._node.load())
                                    }
                            e._autoResume();
                            var u = e.ctx.createBufferSource();
                            u.buffer = e._scratchBuffer, u.connect(e.ctx.destination), void 0 === u.start ? u.noteOn(0) : u.start(0), "function" == typeof e.ctx.resume && e.ctx.resume(), u.onended = function() {
                                u.disconnect(0), e._audioUnlocked = !0, document.removeEventListener("touchstart", t, !0), document.removeEventListener("touchend", t, !0), document.removeEventListener("click", t, !0);
                                for (var i = 0; i < e._howls.length; i++) e._howls[i]._emit("unlock")
                            }
                        };
                        return document.addEventListener("touchstart", t, !0), document.addEventListener("touchend", t, !0), document.addEventListener("click", t, !0), e
                    }
                },
                _obtainHtml5Audio: function() {
                    var e = this || o;
                    if (e._html5AudioPool.length) return e._html5AudioPool.pop();
                    var t = (new Audio).play();
                    return t && "undefined" != typeof Promise && (t instanceof Promise || "function" == typeof t.then) && t.catch((function() {
                        console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")
                    })), new Audio
                },
                _releaseHtml5Audio: function(e) {
                    var t = this || o;
                    return e._unlocked && t._html5AudioPool.push(e), t
                },
                _autoSuspend: function() {
                    var e = this;
                    if (e.autoSuspend && e.ctx && void 0 !== e.ctx.suspend && o.usingWebAudio) {
                        for (var t = 0; t < e._howls.length; t++)
                            if (e._howls[t]._webAudio)
                                for (var i = 0; i < e._howls[t]._sounds.length; i++)
                                    if (!e._howls[t]._sounds[i]._paused) return e;
                        return e._suspendTimer && clearTimeout(e._suspendTimer), e._suspendTimer = setTimeout((function() {
                            e.autoSuspend && (e._suspendTimer = null, e.state = "suspending", e.ctx.suspend().then((function() {
                                e.state = "suspended", e._resumeAfterSuspend && (delete e._resumeAfterSuspend, e._autoResume())
                            })))
                        }), 3e4), e
                    }
                },
                _autoResume: function() {
                    var e = this;
                    if (e.ctx && void 0 !== e.ctx.resume && o.usingWebAudio) return "running" === e.state && e._suspendTimer ? (clearTimeout(e._suspendTimer), e._suspendTimer = null) : "suspended" === e.state ? (e.ctx.resume().then((function() {
                        e.state = "running";
                        for (var t = 0; t < e._howls.length; t++) e._howls[t]._emit("resume")
                    })), e._suspendTimer && (clearTimeout(e._suspendTimer), e._suspendTimer = null)) : "suspending" === e.state && (e._resumeAfterSuspend = !0), e
                }
            };
            var o = new r,
                s = function(e) {
                    e.src && 0 !== e.src.length ? this.init(e) : console.error("An array of source files must be passed with any new Howl.")
                };
            s.prototype = {
                init: function(e) {
                    var t = this;
                    return o.ctx || f(), t._autoplay = e.autoplay || !1, t._format = "string" != typeof e.format ? e.format : [e.format], t._html5 = e.html5 || !1, t._muted = e.mute || !1, t._loop = e.loop || !1, t._pool = e.pool || 5, t._preload = "boolean" != typeof e.preload || e.preload, t._rate = e.rate || 1, t._sprite = e.sprite || {}, t._src = "string" != typeof e.src ? e.src : [e.src], t._volume = void 0 !== e.volume ? e.volume : 1, t._xhrWithCredentials = e.xhrWithCredentials || !1, t._duration = 0, t._state = "unloaded", t._sounds = [], t._endTimers = {}, t._queue = [], t._playLock = !1, t._onend = e.onend ? [{
                        fn: e.onend
                    }] : [], t._onfade = e.onfade ? [{
                        fn: e.onfade
                    }] : [], t._onload = e.onload ? [{
                        fn: e.onload
                    }] : [], t._onloaderror = e.onloaderror ? [{
                        fn: e.onloaderror
                    }] : [], t._onplayerror = e.onplayerror ? [{
                        fn: e.onplayerror
                    }] : [], t._onpause = e.onpause ? [{
                        fn: e.onpause
                    }] : [], t._onplay = e.onplay ? [{
                        fn: e.onplay
                    }] : [], t._onstop = e.onstop ? [{
                        fn: e.onstop
                    }] : [], t._onmute = e.onmute ? [{
                        fn: e.onmute
                    }] : [], t._onvolume = e.onvolume ? [{
                        fn: e.onvolume
                    }] : [], t._onrate = e.onrate ? [{
                        fn: e.onrate
                    }] : [], t._onseek = e.onseek ? [{
                        fn: e.onseek
                    }] : [], t._onunlock = e.onunlock ? [{
                        fn: e.onunlock
                    }] : [], t._onresume = [], t._webAudio = o.usingWebAudio && !t._html5, void 0 !== o.ctx && o.ctx && o.autoUnlock && o._unlockAudio(), o._howls.push(t), t._autoplay && t._queue.push({
                        event: "play",
                        action: function() {
                            t.play()
                        }
                    }), t._preload && t.load(), t
                },
                load: function() {
                    var e = null;
                    if (o.noAudio) this._emit("loaderror", null, "No audio support.");
                    else {
                        "string" == typeof this._src && (this._src = [this._src]);
                        for (var t = 0; t < this._src.length; t++) {
                            var i, n;
                            if (this._format && this._format[t]) i = this._format[t];
                            else {
                                if ("string" != typeof(n = this._src[t])) {
                                    this._emit("loaderror", null, "Non-string found in selected audio sources - ignoring.");
                                    continue
                                }(i = /^data:audio\/([^;,]+);/i.exec(n)) || (i = /\.([^.]+)$/.exec(n.split("?", 1)[0])), i && (i = i[1].toLowerCase())
                            }
                            if (i || console.warn('No file extension was found. Consider using the "format" property or specify an extension.'), i && o.codecs(i)) {
                                e = this._src[t];
                                break
                            }
                        }
                        if (e) return this._src = e, this._state = "loading", "https:" === window.location.protocol && "http:" === e.slice(0, 5) && (this._html5 = !0, this._webAudio = !1), new a(this), this._webAudio && h(this), this;
                        this._emit("loaderror", null, "No codec support for selected audio sources.")
                    }
                },
                play: function(e, t) {
                    var i = this,
                        n = null;
                    if ("number" == typeof e) n = e, e = null;
                    else {
                        if ("string" == typeof e && "loaded" === i._state && !i._sprite[e]) return null;
                        if (void 0 === e && (e = "__default", !i._playLock)) {
                            for (var r = 0, s = 0; s < i._sounds.length; s++) i._sounds[s]._paused && !i._sounds[s]._ended && (r++, n = i._sounds[s]._id);
                            1 === r ? e = null : n = null
                        }
                    }
                    var a = n ? i._soundById(n) : i._inactiveSound();
                    if (!a) return null;
                    if (n && !e && (e = a._sprite || "__default"), "loaded" !== i._state) {
                        a._sprite = e, a._ended = !1;
                        var u = a._id;
                        return i._queue.push({
                            event: "play",
                            action: function() {
                                i.play(u)
                            }
                        }), u
                    }
                    if (n && !a._paused) return t || i._loadQueue("play"), a._id;
                    i._webAudio && o._autoResume();
                    var h = Math.max(0, a._seek > 0 ? a._seek : i._sprite[e][0] / 1e3),
                        l = Math.max(0, (i._sprite[e][0] + i._sprite[e][1]) / 1e3 - h),
                        c = 1e3 * l / Math.abs(a._rate),
                        d = i._sprite[e][0] / 1e3,
                        f = (i._sprite[e][0] + i._sprite[e][1]) / 1e3;
                    a._sprite = e, a._ended = !1;
                    var p = function() {
                        a._paused = !1, a._seek = h, a._start = d, a._stop = f, a._loop = !(!a._loop && !i._sprite[e][2])
                    };
                    if (!(h >= f)) {
                        var _ = a._node;
                        if (i._webAudio) {
                            var g = function() {
                                i._playLock = !1, p(), i._refreshBuffer(a);
                                var e = a._muted || i._muted ? 0 : a._volume;
                                _.gain.setValueAtTime(e, o.ctx.currentTime), a._playStart = o.ctx.currentTime, void 0 === _.bufferSource.start ? a._loop ? _.bufferSource.noteGrainOn(0, h, 86400) : _.bufferSource.noteGrainOn(0, h, l) : a._loop ? _.bufferSource.start(0, h, 86400) : _.bufferSource.start(0, h, l), c !== 1 / 0 && (i._endTimers[a._id] = setTimeout(i._ended.bind(i, a), c)), t || setTimeout((function() {
                                    i._emit("play", a._id), i._loadQueue()
                                }), 0)
                            };
                            "running" === o.state ? g() : (i._playLock = !0, i.once("resume", g), i._clearTimer(a._id))
                        } else {
                            var m = function() {
                                _.currentTime = h, _.muted = a._muted || i._muted || o._muted || _.muted, _.volume = a._volume * o.volume(), _.playbackRate = a._rate;
                                try {
                                    var n = _.play();
                                    if (n && "undefined" != typeof Promise && (n instanceof Promise || "function" == typeof n.then) ? (i._playLock = !0, p(), n.then((function() {
                                            i._playLock = !1, _._unlocked = !0, t || (i._emit("play", a._id), i._loadQueue())
                                        })).catch((function() {
                                            i._playLock = !1, i._emit("playerror", a._id, "Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."), a._ended = !0, a._paused = !0
                                        }))) : t || (i._playLock = !1, p(), i._emit("play", a._id), i._loadQueue()), _.playbackRate = a._rate, _.paused) return void i._emit("playerror", a._id, "Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");
                                    "__default" !== e || a._loop ? i._endTimers[a._id] = setTimeout(i._ended.bind(i, a), c) : (i._endTimers[a._id] = function() {
                                        i._ended(a), _.removeEventListener("ended", i._endTimers[a._id], !1)
                                    }, _.addEventListener("ended", i._endTimers[a._id], !1))
                                } catch (e) {
                                    i._emit("playerror", a._id, e)
                                }
                            };
                            "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA" === _.src && (_.src = i._src, _.load());
                            var v = window && window.ejecta || !_.readyState && o._navigator.isCocoonJS;
                            if (_.readyState >= 3 || v) m();
                            else {
                                i._playLock = !0;
                                var y = function() {
                                    m(), _.removeEventListener(o._canPlayEvent, y, !1)
                                };
                                _.addEventListener(o._canPlayEvent, y, !1), i._clearTimer(a._id)
                            }
                        }
                        return a._id
                    }
                    i._ended(a)
                },
                pause: function(e) {
                    var t = this;
                    if ("loaded" !== t._state || t._playLock) return t._queue.push({
                        event: "pause",
                        action: function() {
                            t.pause(e)
                        }
                    }), t;
                    for (var i = t._getSoundIds(e), n = 0; n < i.length; n++) {
                        t._clearTimer(i[n]);
                        var r = t._soundById(i[n]);
                        if (r && !r._paused && (r._seek = t.seek(i[n]), r._rateSeek = 0, r._paused = !0, t._stopFade(i[n]), r._node))
                            if (t._webAudio) {
                                if (!r._node.bufferSource) continue;
                                void 0 === r._node.bufferSource.stop ? r._node.bufferSource.noteOff(0) : r._node.bufferSource.stop(0), t._cleanBuffer(r._node)
                            } else isNaN(r._node.duration) && r._node.duration !== 1 / 0 || r._node.pause();
                        arguments[1] || t._emit("pause", r ? r._id : null)
                    }
                    return t
                },
                stop: function(e, t) {
                    var i = this;
                    if ("loaded" !== i._state || i._playLock) return i._queue.push({
                        event: "stop",
                        action: function() {
                            i.stop(e)
                        }
                    }), i;
                    for (var n = i._getSoundIds(e), r = 0; r < n.length; r++) {
                        i._clearTimer(n[r]);
                        var o = i._soundById(n[r]);
                        o && (o._seek = o._start || 0, o._rateSeek = 0, o._paused = !0, o._ended = !0, i._stopFade(n[r]), o._node && (i._webAudio ? o._node.bufferSource && (void 0 === o._node.bufferSource.stop ? o._node.bufferSource.noteOff(0) : o._node.bufferSource.stop(0), i._cleanBuffer(o._node)) : isNaN(o._node.duration) && o._node.duration !== 1 / 0 || (o._node.currentTime = o._start || 0, o._node.pause(), o._node.duration === 1 / 0 && i._clearSound(o._node))), t || i._emit("stop", o._id))
                    }
                    return i
                },
                mute: function(e, t) {
                    var i = this;
                    if ("loaded" !== i._state || i._playLock) return i._queue.push({
                        event: "mute",
                        action: function() {
                            i.mute(e, t)
                        }
                    }), i;
                    if (void 0 === t) {
                        if ("boolean" != typeof e) return i._muted;
                        i._muted = e
                    }
                    for (var n = i._getSoundIds(t), r = 0; r < n.length; r++) {
                        var s = i._soundById(n[r]);
                        s && (s._muted = e, s._interval && i._stopFade(s._id), i._webAudio && s._node ? s._node.gain.setValueAtTime(e ? 0 : s._volume, o.ctx.currentTime) : s._node && (s._node.muted = !!o._muted || e), i._emit("mute", s._id))
                    }
                    return i
                },
                volume: function() {
                    var e, t, i, n = this,
                        r = arguments;
                    if (0 === r.length) return n._volume;
                    if (1 === r.length || 2 === r.length && void 0 === r[1]) {
                        var s = n._getSoundIds(),
                            a = s.indexOf(r[0]);
                        a >= 0 ? t = parseInt(r[0], 10) : e = parseFloat(r[0])
                    } else r.length >= 2 && (e = parseFloat(r[0]), t = parseInt(r[1], 10));
                    if (!(void 0 !== e && e >= 0 && e <= 1)) return (i = t ? n._soundById(t) : n._sounds[0]) ? i._volume : 0;
                    if ("loaded" !== n._state || n._playLock) return n._queue.push({
                        event: "volume",
                        action: function() {
                            n.volume.apply(n, r)
                        }
                    }), n;
                    void 0 === t && (n._volume = e), t = n._getSoundIds(t);
                    for (var u = 0; u < t.length; u++)(i = n._soundById(t[u])) && (i._volume = e, r[2] || n._stopFade(t[u]), n._webAudio && i._node && !i._muted ? i._node.gain.setValueAtTime(e, o.ctx.currentTime) : i._node && !i._muted && (i._node.volume = e * o.volume()), n._emit("volume", i._id));
                    return n
                },
                fade: function(e, t, i, n) {
                    var r = this;
                    if ("loaded" !== r._state || r._playLock) return r._queue.push({
                        event: "fade",
                        action: function() {
                            r.fade(e, t, i, n)
                        }
                    }), r;
                    e = parseFloat(e), t = parseFloat(t), i = parseFloat(i), r.volume(e, n);
                    for (var s = r._getSoundIds(n), a = 0; a < s.length; a++) {
                        var u = r._soundById(s[a]);
                        if (u) {
                            if (n || r._stopFade(s[a]), r._webAudio && !u._muted) {
                                var h = o.ctx.currentTime,
                                    l = h + i / 1e3;
                                u._volume = e, u._node.gain.setValueAtTime(e, h), u._node.gain.linearRampToValueAtTime(t, l)
                            }
                            r._startFadeInterval(u, e, t, i, s[a], void 0 === n)
                        }
                    }
                    return r
                },
                _startFadeInterval: function(e, t, i, n, r, o) {
                    var s = this,
                        a = t,
                        u = i - t,
                        h = Math.abs(u / .01),
                        l = Math.max(4, h > 0 ? n / h : n),
                        c = Date.now();
                    e._fadeTo = i, e._interval = setInterval((function() {
                        var r = (Date.now() - c) / n;
                        c = Date.now(), a += u * r, a = Math.max(0, a), a = Math.min(1, a), a = Math.round(100 * a) / 100, s._webAudio ? e._volume = a : s.volume(a, e._id, !0), o && (s._volume = a), (i < t && a <= i || i > t && a >= i) && (clearInterval(e._interval), e._interval = null, e._fadeTo = null, s.volume(i, e._id), s._emit("fade", e._id))
                    }), l)
                },
                _stopFade: function(e) {
                    var t = this._soundById(e);
                    return t && t._interval && (this._webAudio && t._node.gain.cancelScheduledValues(o.ctx.currentTime), clearInterval(t._interval), t._interval = null, this.volume(t._fadeTo, e), t._fadeTo = null, this._emit("fade", e)), this
                },
                loop: function() {
                    var e, t, i, n = this,
                        r = arguments;
                    if (0 === r.length) return n._loop;
                    if (1 === r.length) {
                        if ("boolean" != typeof r[0]) return !!(i = n._soundById(parseInt(r[0], 10))) && i._loop;
                        e = r[0], n._loop = e
                    } else 2 === r.length && (e = r[0], t = parseInt(r[1], 10));
                    for (var o = n._getSoundIds(t), s = 0; s < o.length; s++)(i = n._soundById(o[s])) && (i._loop = e, n._webAudio && i._node && i._node.bufferSource && (i._node.bufferSource.loop = e, e && (i._node.bufferSource.loopStart = i._start || 0, i._node.bufferSource.loopEnd = i._stop)));
                    return n
                },
                rate: function() {
                    var e, t, i, n = this,
                        r = arguments;
                    if (0 === r.length) t = n._sounds[0]._id;
                    else if (1 === r.length) {
                        var s = n._getSoundIds(),
                            a = s.indexOf(r[0]);
                        a >= 0 ? t = parseInt(r[0], 10) : e = parseFloat(r[0])
                    } else 2 === r.length && (e = parseFloat(r[0]), t = parseInt(r[1], 10));
                    if ("number" != typeof e) return (i = n._soundById(t)) ? i._rate : n._rate;
                    if ("loaded" !== n._state || n._playLock) return n._queue.push({
                        event: "rate",
                        action: function() {
                            n.rate.apply(n, r)
                        }
                    }), n;
                    void 0 === t && (n._rate = e), t = n._getSoundIds(t);
                    for (var u = 0; u < t.length; u++)
                        if (i = n._soundById(t[u])) {
                            n.playing(t[u]) && (i._rateSeek = n.seek(t[u]), i._playStart = n._webAudio ? o.ctx.currentTime : i._playStart), i._rate = e, n._webAudio && i._node && i._node.bufferSource ? i._node.bufferSource.playbackRate.setValueAtTime(e, o.ctx.currentTime) : i._node && (i._node.playbackRate = e);
                            var h = n.seek(t[u]),
                                l = (n._sprite[i._sprite][0] + n._sprite[i._sprite][1]) / 1e3 - h,
                                c = 1e3 * l / Math.abs(i._rate);
                            !n._endTimers[t[u]] && i._paused || (n._clearTimer(t[u]), n._endTimers[t[u]] = setTimeout(n._ended.bind(n, i), c)), n._emit("rate", i._id)
                        }
                    return n
                },
                seek: function() {
                    var e, t, i = this,
                        n = arguments;
                    if (0 === n.length) t = i._sounds[0]._id;
                    else if (1 === n.length) {
                        var r = i._getSoundIds(),
                            s = r.indexOf(n[0]);
                        s >= 0 ? t = parseInt(n[0], 10) : i._sounds.length && (t = i._sounds[0]._id, e = parseFloat(n[0]))
                    } else 2 === n.length && (e = parseFloat(n[0]), t = parseInt(n[1], 10));
                    if (void 0 === t) return i;
                    if ("loaded" !== i._state || i._playLock) return i._queue.push({
                        event: "seek",
                        action: function() {
                            i.seek.apply(i, n)
                        }
                    }), i;
                    var a = i._soundById(t);
                    if (a) {
                        if (!("number" == typeof e && e >= 0)) {
                            if (i._webAudio) {
                                var u = i.playing(t) ? o.ctx.currentTime - a._playStart : 0,
                                    h = a._rateSeek ? a._rateSeek - a._seek : 0;
                                return a._seek + (h + u * Math.abs(a._rate))
                            }
                            return a._node.currentTime
                        }
                        var l = i.playing(t);
                        l && i.pause(t, !0), a._seek = e, a._ended = !1, i._clearTimer(t), i._webAudio || !a._node || isNaN(a._node.duration) || (a._node.currentTime = e);
                        var c = function() {
                            i._emit("seek", t), l && i.play(t, !0)
                        };
                        if (l && !i._webAudio) {
                            var d = function() {
                                i._playLock ? setTimeout(d, 0) : c()
                            };
                            setTimeout(d, 0)
                        } else c()
                    }
                    return i
                },
                playing: function(e) {
                    if ("number" == typeof e) {
                        var t = this._soundById(e);
                        return !!t && !t._paused
                    }
                    for (var i = 0; i < this._sounds.length; i++)
                        if (!this._sounds[i]._paused) return !0;
                    return !1
                },
                duration: function(e) {
                    var t = this._duration,
                        i = this._soundById(e);
                    return i && (t = this._sprite[i._sprite][1] / 1e3), t
                },
                state: function() {
                    return this._state
                },
                unload: function() {
                    for (var e = this, t = e._sounds, i = 0; i < t.length; i++) t[i]._paused || e.stop(t[i]._id), e._webAudio || (e._clearSound(t[i]._node), t[i]._node.removeEventListener("error", t[i]._errorFn, !1), t[i]._node.removeEventListener(o._canPlayEvent, t[i]._loadFn, !1), o._releaseHtml5Audio(t[i]._node)), delete t[i]._node, e._clearTimer(t[i]._id);
                    var n = o._howls.indexOf(e);
                    n >= 0 && o._howls.splice(n, 1);
                    var r = !0;
                    for (i = 0; i < o._howls.length; i++)
                        if (o._howls[i]._src === e._src || e._src.indexOf(o._howls[i]._src) >= 0) {
                            r = !1;
                            break
                        }
                    return u && r && delete u[e._src], o.noAudio = !1, e._state = "unloaded", e._sounds = [], e = null, null
                },
                on: function(e, t, i, n) {
                    var r = this["_on" + e];
                    return "function" == typeof t && r.push(n ? {
                        id: i,
                        fn: t,
                        once: n
                    } : {
                        id: i,
                        fn: t
                    }), this
                },
                off: function(e, t, i) {
                    var n = this["_on" + e],
                        r = 0;
                    if ("number" == typeof t && (i = t, t = null), t || i)
                        for (r = 0; r < n.length; r++) {
                            var o = i === n[r].id;
                            if (t === n[r].fn && o || !t && o) {
                                n.splice(r, 1);
                                break
                            }
                        } else if (e) this["_on" + e] = [];
                        else {
                            var s = Object.keys(this);
                            for (r = 0; r < s.length; r++) 0 === s[r].indexOf("_on") && Array.isArray(this[s[r]]) && (this[s[r]] = [])
                        }
                    return this
                },
                once: function(e, t, i) {
                    return this.on(e, t, i, 1), this
                },
                _emit: function(e, t, i) {
                    for (var n = this["_on" + e], r = n.length - 1; r >= 0; r--) n[r].id && n[r].id !== t && "load" !== e || (setTimeout(function(e) {
                        e.call(this, t, i)
                    }.bind(this, n[r].fn), 0), n[r].once && this.off(e, n[r].fn, n[r].id));
                    return this._loadQueue(e), this
                },
                _loadQueue: function(e) {
                    if (this._queue.length > 0) {
                        var t = this._queue[0];
                        t.event === e && (this._queue.shift(), this._loadQueue()), e || t.action()
                    }
                    return this
                },
                _ended: function(e) {
                    var t = e._sprite;
                    if (!this._webAudio && e._node && !e._node.paused && !e._node.ended && e._node.currentTime < e._stop) return setTimeout(this._ended.bind(this, e), 100), this;
                    var i = !(!e._loop && !this._sprite[t][2]);
                    if (this._emit("end", e._id), !this._webAudio && i && this.stop(e._id, !0).play(e._id), this._webAudio && i) {
                        this._emit("play", e._id), e._seek = e._start || 0, e._rateSeek = 0, e._playStart = o.ctx.currentTime;
                        var n = 1e3 * (e._stop - e._start) / Math.abs(e._rate);
                        this._endTimers[e._id] = setTimeout(this._ended.bind(this, e), n)
                    }
                    return this._webAudio && !i && (e._paused = !0, e._ended = !0, e._seek = e._start || 0, e._rateSeek = 0, this._clearTimer(e._id), this._cleanBuffer(e._node), o._autoSuspend()), this._webAudio || i || this.stop(e._id, !0), this
                },
                _clearTimer: function(e) {
                    if (this._endTimers[e]) {
                        if ("function" != typeof this._endTimers[e]) clearTimeout(this._endTimers[e]);
                        else {
                            var t = this._soundById(e);
                            t && t._node && t._node.removeEventListener("ended", this._endTimers[e], !1)
                        }
                        delete this._endTimers[e]
                    }
                    return this
                },
                _soundById: function(e) {
                    for (var t = 0; t < this._sounds.length; t++)
                        if (e === this._sounds[t]._id) return this._sounds[t];
                    return null
                },
                _inactiveSound: function() {
                    this._drain();
                    for (var e = 0; e < this._sounds.length; e++)
                        if (this._sounds[e]._ended) return this._sounds[e].reset();
                    return new a(this)
                },
                _drain: function() {
                    var e = this._pool,
                        t = 0,
                        i = 0;
                    if (!(this._sounds.length < e)) {
                        for (i = 0; i < this._sounds.length; i++) this._sounds[i]._ended && t++;
                        for (i = this._sounds.length - 1; i >= 0; i--) {
                            if (t <= e) return;
                            this._sounds[i]._ended && (this._webAudio && this._sounds[i]._node && this._sounds[i]._node.disconnect(0), this._sounds.splice(i, 1), t--)
                        }
                    }
                },
                _getSoundIds: function(e) {
                    if (void 0 === e) {
                        for (var t = [], i = 0; i < this._sounds.length; i++) t.push(this._sounds[i]._id);
                        return t
                    }
                    return [e]
                },
                _refreshBuffer: function(e) {
                    return e._node.bufferSource = o.ctx.createBufferSource(), e._node.bufferSource.buffer = u[this._src], e._panner ? e._node.bufferSource.connect(e._panner) : e._node.bufferSource.connect(e._node), e._node.bufferSource.loop = e._loop, e._loop && (e._node.bufferSource.loopStart = e._start || 0, e._node.bufferSource.loopEnd = e._stop || 0), e._node.bufferSource.playbackRate.setValueAtTime(e._rate, o.ctx.currentTime), this
                },
                _cleanBuffer: function(e) {
                    var t = o._navigator && o._navigator.vendor.indexOf("Apple") >= 0;
                    if (o._scratchBuffer && e.bufferSource && (e.bufferSource.onended = null, e.bufferSource.disconnect(0), t)) try {
                        e.bufferSource.buffer = o._scratchBuffer
                    } catch (e) {}
                    return e.bufferSource = null, this
                },
                _clearSound: function(e) {
                    /MSIE |Trident\//.test(o._navigator && o._navigator.userAgent) || (e.src = "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")
                }
            };
            var a = function(e) {
                this._parent = e, this.init()
            };
            a.prototype = {
                init: function() {
                    var e = this._parent;
                    return this._muted = e._muted, this._loop = e._loop, this._volume = e._volume, this._rate = e._rate, this._seek = 0, this._paused = !0, this._ended = !0, this._sprite = "__default", this._id = ++o._counter, e._sounds.push(this), this.create(), this
                },
                create: function() {
                    var e = this._parent,
                        t = o._muted || this._muted || this._parent._muted ? 0 : this._volume;
                    return e._webAudio ? (this._node = void 0 === o.ctx.createGain ? o.ctx.createGainNode() : o.ctx.createGain(), this._node.gain.setValueAtTime(t, o.ctx.currentTime), this._node.paused = !0, this._node.connect(o.masterGain)) : o.noAudio || (this._node = o._obtainHtml5Audio(), this._errorFn = this._errorListener.bind(this), this._node.addEventListener("error", this._errorFn, !1), this._loadFn = this._loadListener.bind(this), this._node.addEventListener(o._canPlayEvent, this._loadFn, !1), this._node.src = e._src, this._node.preload = "auto", this._node.volume = t * o.volume(), this._node.load()), this
                },
                reset: function() {
                    var e = this._parent;
                    return this._muted = e._muted, this._loop = e._loop, this._volume = e._volume, this._rate = e._rate, this._seek = 0, this._rateSeek = 0, this._paused = !0, this._ended = !0, this._sprite = "__default", this._id = ++o._counter, this
                },
                _errorListener: function() {
                    this._parent._emit("loaderror", this._id, this._node.error ? this._node.error.code : 0), this._node.removeEventListener("error", this._errorFn, !1)
                },
                _loadListener: function() {
                    var e = this._parent;
                    e._duration = Math.ceil(10 * this._node.duration) / 10, 0 === Object.keys(e._sprite).length && (e._sprite = {
                        __default: [0, 1e3 * e._duration]
                    }), "loaded" !== e._state && (e._state = "loaded", e._emit("load"), e._loadQueue()), this._node.removeEventListener(o._canPlayEvent, this._loadFn, !1)
                }
            };
            var u = {},
                h = function(e) {
                    var t = e._src;
                    if (u[t]) return e._duration = u[t].duration, void d(e);
                    if (/^data:[^;]+;base64,/.test(t)) {
                        for (var i = atob(t.split(",")[1]), n = new Uint8Array(i.length), r = 0; r < i.length; ++r) n[r] = i.charCodeAt(r);
                        c(n.buffer, e)
                    } else {
                        var o = new XMLHttpRequest;
                        o.open("GET", t, !0), o.withCredentials = e._xhrWithCredentials, o.responseType = "arraybuffer", o.onload = function() {
                            var t = (o.status + "")[0];
                            "0" === t || "2" === t || "3" === t ? c(o.response, e) : e._emit("loaderror", null, "Failed loading audio file with status: " + o.status + ".")
                        }, o.onerror = function() {
                            e._webAudio && (e._html5 = !0, e._webAudio = !1, e._sounds = [], delete u[t], e.load())
                        }, l(o)
                    }
                },
                l = function(e) {
                    try {
                        e.send()
                    } catch (t) {
                        e.onerror()
                    }
                },
                c = function(e, t) {
                    var i = function() {
                            t._emit("loaderror", null, "Decoding audio data failed.")
                        },
                        n = function(e) {
                            e && t._sounds.length > 0 ? (u[t._src] = e, d(t, e)) : i()
                        };
                    "undefined" != typeof Promise && 1 === o.ctx.decodeAudioData.length ? o.ctx.decodeAudioData(e).then(n).catch(i) : o.ctx.decodeAudioData(e, n, i)
                },
                d = function(e, t) {
                    t && !e._duration && (e._duration = t.duration), 0 === Object.keys(e._sprite).length && (e._sprite = {
                        __default: [0, 1e3 * e._duration]
                    }), "loaded" !== e._state && (e._state = "loaded", e._emit("load"), e._loadQueue())
                },
                f = function() {
                    if (o.usingWebAudio) {
                        try {
                            "undefined" != typeof AudioContext ? o.ctx = new AudioContext : "undefined" != typeof webkitAudioContext ? o.ctx = new webkitAudioContext : o.usingWebAudio = !1
                        } catch (e) {
                            o.usingWebAudio = !1
                        }
                        o.ctx || (o.usingWebAudio = !1);
                        var e = /iP(hone|od|ad)/.test(o._navigator && o._navigator.platform),
                            t = o._navigator && o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),
                            i = t ? parseInt(t[1], 10) : null;
                        if (e && i && i < 9) {
                            var n = /safari/.test(o._navigator && o._navigator.userAgent.toLowerCase());
                            (o._navigator && o._navigator.standalone && !n || o._navigator && !o._navigator.standalone && !n) && (o.usingWebAudio = !1)
                        }
                        o.usingWebAudio && (o.masterGain = void 0 === o.ctx.createGain ? o.ctx.createGainNode() : o.ctx.createGain(), o.masterGain.gain.setValueAtTime(o._muted ? 0 : o._volume, o.ctx.currentTime), o.masterGain.connect(o.ctx.destination)), o._setup()
                    }
                };
            void 0 === (n = function() {
                return {
                    Howler: o,
                    Howl: s
                }
            }.apply(t, [])) || (e.exports = n), t.Howler = o, t.Howl = s, "undefined" != typeof window ? (window.HowlerGlobal = r, window.Howler = o, window.Howl = s, window.Sound = a) : void 0 !== i && (i.HowlerGlobal = r, i.Howler = o, i.Howl = s, i.Sound = a)
        }(),
        /*!
         *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
         *  
         *  howler.js v2.1.3
         *  howlerjs.com
         *
         *  (c) 2013-2019, James Simpson of GoldFire Studios
         *  goldfirestudios.com
         *
         *  MIT License
         */
        function() {
            "use strict";
            var e;
            HowlerGlobal.prototype._pos = [0, 0, 0], HowlerGlobal.prototype._orientation = [0, 0, -1, 0, 1, 0], HowlerGlobal.prototype.stereo = function(e) {
                if (!this.ctx || !this.ctx.listener) return this;
                for (var t = this._howls.length - 1; t >= 0; t--) this._howls[t].stereo(e);
                return this
            }, HowlerGlobal.prototype.pos = function(e, t, i) {
                return this.ctx && this.ctx.listener ? (t = "number" != typeof t ? this._pos[1] : t, i = "number" != typeof i ? this._pos[2] : i, "number" != typeof e ? this._pos : (this._pos = [e, t, i], void 0 !== this.ctx.listener.positionX ? (this.ctx.listener.positionX.setTargetAtTime(this._pos[0], Howler.ctx.currentTime, .1), this.ctx.listener.positionY.setTargetAtTime(this._pos[1], Howler.ctx.currentTime, .1), this.ctx.listener.positionZ.setTargetAtTime(this._pos[2], Howler.ctx.currentTime, .1)) : this.ctx.listener.setPosition(this._pos[0], this._pos[1], this._pos[2]), this)) : this
            }, HowlerGlobal.prototype.orientation = function(e, t, i, n, r, o) {
                if (!this.ctx || !this.ctx.listener) return this;
                var s = this._orientation;
                return t = "number" != typeof t ? s[1] : t, i = "number" != typeof i ? s[2] : i, n = "number" != typeof n ? s[3] : n, r = "number" != typeof r ? s[4] : r, o = "number" != typeof o ? s[5] : o, "number" != typeof e ? s : (this._orientation = [e, t, i, n, r, o], void 0 !== this.ctx.listener.forwardX ? (this.ctx.listener.forwardX.setTargetAtTime(e, Howler.ctx.currentTime, .1), this.ctx.listener.forwardY.setTargetAtTime(t, Howler.ctx.currentTime, .1), this.ctx.listener.forwardZ.setTargetAtTime(i, Howler.ctx.currentTime, .1), this.ctx.listener.upX.setTargetAtTime(n, Howler.ctx.currentTime, .1), this.ctx.listener.upY.setTargetAtTime(r, Howler.ctx.currentTime, .1), this.ctx.listener.upZ.setTargetAtTime(o, Howler.ctx.currentTime, .1)) : this.ctx.listener.setOrientation(e, t, i, n, r, o), this)
            }, Howl.prototype.init = (e = Howl.prototype.init, function(t) {
                return this._orientation = t.orientation || [1, 0, 0], this._stereo = t.stereo || null, this._pos = t.pos || null, this._pannerAttr = {
                    coneInnerAngle: void 0 !== t.coneInnerAngle ? t.coneInnerAngle : 360,
                    coneOuterAngle: void 0 !== t.coneOuterAngle ? t.coneOuterAngle : 360,
                    coneOuterGain: void 0 !== t.coneOuterGain ? t.coneOuterGain : 0,
                    distanceModel: void 0 !== t.distanceModel ? t.distanceModel : "inverse",
                    maxDistance: void 0 !== t.maxDistance ? t.maxDistance : 1e4,
                    panningModel: void 0 !== t.panningModel ? t.panningModel : "HRTF",
                    refDistance: void 0 !== t.refDistance ? t.refDistance : 1,
                    rolloffFactor: void 0 !== t.rolloffFactor ? t.rolloffFactor : 1
                }, this._onstereo = t.onstereo ? [{
                    fn: t.onstereo
                }] : [], this._onpos = t.onpos ? [{
                    fn: t.onpos
                }] : [], this._onorientation = t.onorientation ? [{
                    fn: t.onorientation
                }] : [], e.call(this, t)
            }), Howl.prototype.stereo = function(e, i) {
                var n = this;
                if (!n._webAudio) return n;
                if ("loaded" !== n._state) return n._queue.push({
                    event: "stereo",
                    action: function() {
                        n.stereo(e, i)
                    }
                }), n;
                var r = void 0 === Howler.ctx.createStereoPanner ? "spatial" : "stereo";
                if (void 0 === i) {
                    if ("number" != typeof e) return n._stereo;
                    n._stereo = e, n._pos = [e, 0, 0]
                }
                for (var o = n._getSoundIds(i), s = 0; s < o.length; s++) {
                    var a = n._soundById(o[s]);
                    if (a) {
                        if ("number" != typeof e) return a._stereo;
                        a._stereo = e, a._pos = [e, 0, 0], a._node && (a._pannerAttr.panningModel = "equalpower", a._panner && a._panner.pan || t(a, r), "spatial" === r ? void 0 !== a._panner.positionX ? (a._panner.positionX.setValueAtTime(e, Howler.ctx.currentTime), a._panner.positionY.setValueAtTime(0, Howler.ctx.currentTime), a._panner.positionZ.setValueAtTime(0, Howler.ctx.currentTime)) : a._panner.setPosition(e, 0, 0) : a._panner.pan.setValueAtTime(e, Howler.ctx.currentTime)), n._emit("stereo", a._id)
                    }
                }
                return n
            }, Howl.prototype.pos = function(e, i, n, r) {
                var o = this;
                if (!o._webAudio) return o;
                if ("loaded" !== o._state) return o._queue.push({
                    event: "pos",
                    action: function() {
                        o.pos(e, i, n, r)
                    }
                }), o;
                if (i = "number" != typeof i ? 0 : i, n = "number" != typeof n ? -.5 : n, void 0 === r) {
                    if ("number" != typeof e) return o._pos;
                    o._pos = [e, i, n]
                }
                for (var s = o._getSoundIds(r), a = 0; a < s.length; a++) {
                    var u = o._soundById(s[a]);
                    if (u) {
                        if ("number" != typeof e) return u._pos;
                        u._pos = [e, i, n], u._node && (u._panner && !u._panner.pan || t(u, "spatial"), void 0 !== u._panner.positionX ? (u._panner.positionX.setValueAtTime(e, Howler.ctx.currentTime), u._panner.positionY.setValueAtTime(i, Howler.ctx.currentTime), u._panner.positionZ.setValueAtTime(n, Howler.ctx.currentTime)) : u._panner.setPosition(e, i, n)), o._emit("pos", u._id)
                    }
                }
                return o
            }, Howl.prototype.orientation = function(e, i, n, r) {
                var o = this;
                if (!o._webAudio) return o;
                if ("loaded" !== o._state) return o._queue.push({
                    event: "orientation",
                    action: function() {
                        o.orientation(e, i, n, r)
                    }
                }), o;
                if (i = "number" != typeof i ? o._orientation[1] : i, n = "number" != typeof n ? o._orientation[2] : n, void 0 === r) {
                    if ("number" != typeof e) return o._orientation;
                    o._orientation = [e, i, n]
                }
                for (var s = o._getSoundIds(r), a = 0; a < s.length; a++) {
                    var u = o._soundById(s[a]);
                    if (u) {
                        if ("number" != typeof e) return u._orientation;
                        u._orientation = [e, i, n], u._node && (u._panner || (u._pos || (u._pos = o._pos || [0, 0, -.5]), t(u, "spatial")), void 0 !== u._panner.orientationX ? (u._panner.orientationX.setValueAtTime(e, Howler.ctx.currentTime), u._panner.orientationY.setValueAtTime(i, Howler.ctx.currentTime), u._panner.orientationZ.setValueAtTime(n, Howler.ctx.currentTime)) : u._panner.setOrientation(e, i, n)), o._emit("orientation", u._id)
                    }
                }
                return o
            }, Howl.prototype.pannerAttr = function() {
                var e, i, n, r = this,
                    o = arguments;
                if (!r._webAudio) return r;
                if (0 === o.length) return r._pannerAttr;
                if (1 === o.length) {
                    if ("object" != typeof o[0]) return (n = r._soundById(parseInt(o[0], 10))) ? n._pannerAttr : r._pannerAttr;
                    e = o[0], void 0 === i && (e.pannerAttr || (e.pannerAttr = {
                        coneInnerAngle: e.coneInnerAngle,
                        coneOuterAngle: e.coneOuterAngle,
                        coneOuterGain: e.coneOuterGain,
                        distanceModel: e.distanceModel,
                        maxDistance: e.maxDistance,
                        refDistance: e.refDistance,
                        rolloffFactor: e.rolloffFactor,
                        panningModel: e.panningModel
                    }), r._pannerAttr = {
                        coneInnerAngle: void 0 !== e.pannerAttr.coneInnerAngle ? e.pannerAttr.coneInnerAngle : r._coneInnerAngle,
                        coneOuterAngle: void 0 !== e.pannerAttr.coneOuterAngle ? e.pannerAttr.coneOuterAngle : r._coneOuterAngle,
                        coneOuterGain: void 0 !== e.pannerAttr.coneOuterGain ? e.pannerAttr.coneOuterGain : r._coneOuterGain,
                        distanceModel: void 0 !== e.pannerAttr.distanceModel ? e.pannerAttr.distanceModel : r._distanceModel,
                        maxDistance: void 0 !== e.pannerAttr.maxDistance ? e.pannerAttr.maxDistance : r._maxDistance,
                        refDistance: void 0 !== e.pannerAttr.refDistance ? e.pannerAttr.refDistance : r._refDistance,
                        rolloffFactor: void 0 !== e.pannerAttr.rolloffFactor ? e.pannerAttr.rolloffFactor : r._rolloffFactor,
                        panningModel: void 0 !== e.pannerAttr.panningModel ? e.pannerAttr.panningModel : r._panningModel
                    })
                } else 2 === o.length && (e = o[0], i = parseInt(o[1], 10));
                for (var s = r._getSoundIds(i), a = 0; a < s.length; a++)
                    if (n = r._soundById(s[a])) {
                        var u = n._pannerAttr;
                        u = {
                            coneInnerAngle: void 0 !== e.coneInnerAngle ? e.coneInnerAngle : u.coneInnerAngle,
                            coneOuterAngle: void 0 !== e.coneOuterAngle ? e.coneOuterAngle : u.coneOuterAngle,
                            coneOuterGain: void 0 !== e.coneOuterGain ? e.coneOuterGain : u.coneOuterGain,
                            distanceModel: void 0 !== e.distanceModel ? e.distanceModel : u.distanceModel,
                            maxDistance: void 0 !== e.maxDistance ? e.maxDistance : u.maxDistance,
                            refDistance: void 0 !== e.refDistance ? e.refDistance : u.refDistance,
                            rolloffFactor: void 0 !== e.rolloffFactor ? e.rolloffFactor : u.rolloffFactor,
                            panningModel: void 0 !== e.panningModel ? e.panningModel : u.panningModel
                        };
                        var h = n._panner;
                        h ? (h.coneInnerAngle = u.coneInnerAngle, h.coneOuterAngle = u.coneOuterAngle, h.coneOuterGain = u.coneOuterGain, h.distanceModel = u.distanceModel, h.maxDistance = u.maxDistance, h.refDistance = u.refDistance, h.rolloffFactor = u.rolloffFactor, h.panningModel = u.panningModel) : (n._pos || (n._pos = r._pos || [0, 0, -.5]), t(n, "spatial"))
                    }
                return r
            }, Sound.prototype.init = function(e) {
                return function() {
                    var t = this._parent;
                    this._orientation = t._orientation, this._stereo = t._stereo, this._pos = t._pos, this._pannerAttr = t._pannerAttr, e.call(this), this._stereo ? t.stereo(this._stereo) : this._pos && t.pos(this._pos[0], this._pos[1], this._pos[2], this._id)
                }
            }(Sound.prototype.init), Sound.prototype.reset = function(e) {
                return function() {
                    var t = this._parent;
                    return this._orientation = t._orientation, this._stereo = t._stereo, this._pos = t._pos, this._pannerAttr = t._pannerAttr, this._stereo ? t.stereo(this._stereo) : this._pos ? t.pos(this._pos[0], this._pos[1], this._pos[2], this._id) : this._panner && (this._panner.disconnect(0), this._panner = void 0, t._refreshBuffer(this)), e.call(this)
                }
            }(Sound.prototype.reset);
            var t = function(e, t) {
                "spatial" === (t = t || "spatial") ? (e._panner = Howler.ctx.createPanner(), e._panner.coneInnerAngle = e._pannerAttr.coneInnerAngle, e._panner.coneOuterAngle = e._pannerAttr.coneOuterAngle, e._panner.coneOuterGain = e._pannerAttr.coneOuterGain, e._panner.distanceModel = e._pannerAttr.distanceModel, e._panner.maxDistance = e._pannerAttr.maxDistance, e._panner.refDistance = e._pannerAttr.refDistance, e._panner.rolloffFactor = e._pannerAttr.rolloffFactor, e._panner.panningModel = e._pannerAttr.panningModel, void 0 !== e._panner.positionX ? (e._panner.positionX.setValueAtTime(e._pos[0], Howler.ctx.currentTime), e._panner.positionY.setValueAtTime(e._pos[1], Howler.ctx.currentTime), e._panner.positionZ.setValueAtTime(e._pos[2], Howler.ctx.currentTime)) : e._panner.setPosition(e._pos[0], e._pos[1], e._pos[2]), void 0 !== e._panner.orientationX ? (e._panner.orientationX.setValueAtTime(e._orientation[0], Howler.ctx.currentTime), e._panner.orientationY.setValueAtTime(e._orientation[1], Howler.ctx.currentTime), e._panner.orientationZ.setValueAtTime(e._orientation[2], Howler.ctx.currentTime)) : e._panner.setOrientation(e._orientation[0], e._orientation[1], e._orientation[2])) : (e._panner = Howler.ctx.createStereoPanner(), e._panner.pan.setValueAtTime(e._stereo, Howler.ctx.currentTime)), e._panner.connect(e._node), e._paused || e._parent.pause(e._id, !0).play(e._id, !0)
            }
        }()
    }).call(this, i(1))
}, function(e, t) {
    var i;
    i = function() {
        return this
    }();
    try {
        i = i || new Function("return this")()
    } catch (e) {
        "object" == typeof window && (i = window)
    }
    e.exports = i
}, function(e, t, i) {
    "use strict";
    i.r(t);
    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
    var n = function(e, t) {
        return (n = Object.setPrototypeOf || {
                __proto__: []
            }
            instanceof Array && function(e, t) {
                e.__proto__ = t
            } || function(e, t) {
                for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
            })(e, t)
    };

    function r(e, t) {
        function i() {
            this.constructor = e
        }
        n(e, t), e.prototype = null === t ? Object.create(t) : (i.prototype = t.prototype, new i)
    }
    var o = function() {
        return (o = Object.assign || function(e) {
            for (var t, i = 1, n = arguments.length; i < n; i++)
                for (var r in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
            return e
        }).apply(this, arguments)
    };

    function s(e, t, i, n) {
        var r, o = arguments.length,
            s = o < 3 ? t : null === n ? n = Object.getOwnPropertyDescriptor(t, i) : n;
        if ("object" == typeof Reflect && "function" == typeof Reflect.decorate) s = Reflect.decorate(e, t, i, n);
        else
            for (var a = e.length - 1; a >= 0; a--)(r = e[a]) && (s = (o < 3 ? r(s) : o > 3 ? r(t, i, s) : r(t, i)) || s);
        return o > 3 && s && Object.defineProperty(t, i, s), s
    }
    var a, u = function() {
            function e(e, t, i, n) {
                void 0 === t && (t = !1), this.initalize(e, t, i, n)
            }
            return e.prototype.initalize = function(e, t, i, n) {
                return void 0 === t && (t = !1), this.mask = e, this.skipNextObservers = t, this.target = i, this.currentTarget = n, this
            }, e
        }(),
        h = function(e, t, i) {
            void 0 === i && (i = null), this.callback = e, this.mask = t, this.scope = i, this._willBeUnregistered = !1, this.unregisterOnNextCall = !1
        },
        l = (function() {
            function e() {}
            e.prototype.dispose = function() {
                if (this._observers && this._observables)
                    for (var e = 0; e < this._observers.length; e++) this._observables[e].remove(this._observers[e]);
                this._observers = null, this._observables = null
            }, e.Watch = function(t, i, n, r) {
                void 0 === n && (n = -1), void 0 === r && (r = null);
                var o = new e;
                o._observers = new Array, o._observables = t;
                for (var s = 0, a = t; s < a.length; s++) {
                    var u = a[s].add(i, n, !1, r);
                    u && o._observers.push(u)
                }
                return o
            }
        }(), function() {
            function e(e) {
                this._observers = new Array, this._eventState = new u(0), e && (this._onObserverAdded = e)
            }
            return e.prototype.add = function(e, t, i, n, r) {
                if (void 0 === t && (t = -1), void 0 === i && (i = !1), void 0 === n && (n = null), void 0 === r && (r = !1), !e) return null;
                var o = new h(e, t, n);
                return o.unregisterOnNextCall = r, i ? this._observers.unshift(o) : this._observers.push(o), this._onObserverAdded && this._onObserverAdded(o), o
            }, e.prototype.addOnce = function(e) {
                return this.add(e, void 0, void 0, void 0, !0)
            }, e.prototype.remove = function(e) {
                return !!e && (-1 !== this._observers.indexOf(e) && (this._deferUnregister(e), !0))
            }, e.prototype.removeCallback = function(e, t) {
                for (var i = 0; i < this._observers.length; i++)
                    if (this._observers[i].callback === e && (!t || t === this._observers[i].scope)) return this._deferUnregister(this._observers[i]), !0;
                return !1
            }, e.prototype._deferUnregister = function(e) {
                var t = this;
                e.unregisterOnNextCall = !1, e._willBeUnregistered = !0, setTimeout((function() {
                    t._remove(e)
                }), 0)
            }, e.prototype._remove = function(e) {
                if (!e) return !1;
                var t = this._observers.indexOf(e);
                return -1 !== t && (this._observers.splice(t, 1), !0)
            }, e.prototype.makeObserverTopPriority = function(e) {
                this._remove(e), this._observers.unshift(e)
            }, e.prototype.makeObserverBottomPriority = function(e) {
                this._remove(e), this._observers.push(e)
            }, e.prototype.notifyObservers = function(e, t, i, n) {
                if (void 0 === t && (t = -1), !this._observers.length) return !0;
                var r = this._eventState;
                r.mask = t, r.target = i, r.currentTarget = n, r.skipNextObservers = !1, r.lastReturnValue = e;
                for (var o = 0, s = this._observers; o < s.length; o++) {
                    var a = s[o];
                    if (!a._willBeUnregistered && (a.mask & t && (a.scope ? r.lastReturnValue = a.callback.apply(a.scope, [e, r]) : r.lastReturnValue = a.callback(e, r), a.unregisterOnNextCall && this._deferUnregister(a)), r.skipNextObservers)) return !1
                }
                return !0
            }, e.prototype.notifyObserversWithPromise = function(e, t, i, n) {
                var r = this;
                void 0 === t && (t = -1);
                var o = Promise.resolve(e);
                if (!this._observers.length) return o;
                var s = this._eventState;
                return s.mask = t, s.target = i, s.currentTarget = n, s.skipNextObservers = !1, this._observers.forEach((function(i) {
                    s.skipNextObservers || i._willBeUnregistered || i.mask & t && (o = i.scope ? o.then((function(t) {
                        return s.lastReturnValue = t, i.callback.apply(i.scope, [e, s])
                    })) : o.then((function(t) {
                        return s.lastReturnValue = t, i.callback(e, s)
                    })), i.unregisterOnNextCall && r._deferUnregister(i))
                })), o.then((function() {
                    return e
                }))
            }, e.prototype.notifyObserver = function(e, t, i) {
                void 0 === i && (i = -1);
                var n = this._eventState;
                n.mask = i, n.skipNextObservers = !1, e.callback(t, n)
            }, e.prototype.hasObservers = function() {
                return this._observers.length > 0
            }, e.prototype.clear = function() {
                this._observers = new Array, this._onObserverAdded = null
            }, e.prototype.clone = function() {
                var t = new e;
                return t._observers = this._observers.slice(0), t
            }, e.prototype.hasSpecificMask = function(e) {
                void 0 === e && (e = -1);
                for (var t = 0, i = this._observers; t < i.length; t++) {
                    var n = i[t];
                    if (n.mask & e || n.mask === e) return !0
                }
                return !1
            }, e
        }()),
        c = function() {
            function e() {}
            return e.IsWindowObjectExist = function() {
                return "undefined" != typeof window
            }, e.GetDOMTextContent = function(e) {
                for (var t = "", i = e.firstChild; i;) 3 === i.nodeType && (t += i.textContent), i = i.nextSibling;
                return t
            }, e
        }(),
        d = function() {
            function e() {}
            return Object.defineProperty(e, "Now", {
                get: function() {
                    return c.IsWindowObjectExist() && window.performance && window.performance.now ? window.performance.now() : Date.now()
                },
                enumerable: !0,
                configurable: !0
            }), e
        }(),
        f = function() {
            function e(e) {
                void 0 === e && (e = 30), this._enabled = !0, this._rollingFrameTime = new p(e)
            }
            return e.prototype.sampleFrame = function(e) {
                if (void 0 === e && (e = d.Now), this._enabled) {
                    if (null != this._lastFrameTimeMs) {
                        var t = e - this._lastFrameTimeMs;
                        this._rollingFrameTime.add(t)
                    }
                    this._lastFrameTimeMs = e
                }
            }, Object.defineProperty(e.prototype, "averageFrameTime", {
                get: function() {
                    return this._rollingFrameTime.average
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "averageFrameTimeVariance", {
                get: function() {
                    return this._rollingFrameTime.variance
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "instantaneousFrameTime", {
                get: function() {
                    return this._rollingFrameTime.history(0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "averageFPS", {
                get: function() {
                    return 1e3 / this._rollingFrameTime.average
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "instantaneousFPS", {
                get: function() {
                    var e = this._rollingFrameTime.history(0);
                    return 0 === e ? 0 : 1e3 / e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isSaturated", {
                get: function() {
                    return this._rollingFrameTime.isSaturated()
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.enable = function() {
                this._enabled = !0
            }, e.prototype.disable = function() {
                this._enabled = !1, this._lastFrameTimeMs = null
            }, Object.defineProperty(e.prototype, "isEnabled", {
                get: function() {
                    return this._enabled
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.reset = function() {
                this._lastFrameTimeMs = null, this._rollingFrameTime.reset()
            }, e
        }(),
        p = function() {
            function e(e) {
                this._samples = new Array(e), this.reset()
            }
            return e.prototype.add = function(e) {
                var t;
                if (this.isSaturated()) {
                    var i = this._samples[this._pos];
                    t = i - this.average, this.average -= t / (this._sampleCount - 1), this._m2 -= t * (i - this.average)
                } else this._sampleCount++;
                t = e - this.average, this.average += t / this._sampleCount, this._m2 += t * (e - this.average), this.variance = this._m2 / (this._sampleCount - 1), this._samples[this._pos] = e, this._pos++, this._pos %= this._samples.length
            }, e.prototype.history = function(e) {
                if (e >= this._sampleCount || e >= this._samples.length) return 0;
                var t = this._wrapPosition(this._pos - 1);
                return this._samples[this._wrapPosition(t - e)]
            }, e.prototype.isSaturated = function() {
                return this._sampleCount >= this._samples.length
            }, e.prototype.reset = function() {
                this.average = 0, this.variance = 0, this._sampleCount = 0, this._pos = 0, this._m2 = 0
            }, e.prototype._wrapPosition = function(e) {
                var t = this._samples.length;
                return (e % t + t) % t
            }, e
        }(),
        _ = function() {
            function e() {
                this._count = 0, this._data = {}
            }
            return e.prototype.copyFrom = function(e) {
                var t = this;
                this.clear(), e.forEach((function(e, i) {
                    return t.add(e, i)
                }))
            }, e.prototype.get = function(e) {
                var t = this._data[e];
                if (void 0 !== t) return t
            }, e.prototype.getOrAddWithFactory = function(e, t) {
                var i = this.get(e);
                return void 0 !== i ? i : ((i = t(e)) && this.add(e, i), i)
            }, e.prototype.getOrAdd = function(e, t) {
                var i = this.get(e);
                return void 0 !== i ? i : (this.add(e, t), t)
            }, e.prototype.contains = function(e) {
                return void 0 !== this._data[e]
            }, e.prototype.add = function(e, t) {
                return void 0 === this._data[e] && (this._data[e] = t, ++this._count, !0)
            }, e.prototype.set = function(e, t) {
                return void 0 !== this._data[e] && (this._data[e] = t, !0)
            }, e.prototype.getAndRemove = function(e) {
                var t = this.get(e);
                return void 0 !== t ? (delete this._data[e], --this._count, t) : null
            }, e.prototype.remove = function(e) {
                return !!this.contains(e) && (delete this._data[e], --this._count, !0)
            }, e.prototype.clear = function() {
                this._data = {}, this._count = 0
            }, Object.defineProperty(e.prototype, "count", {
                get: function() {
                    return this._count
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.forEach = function(e) {
                for (var t in this._data) {
                    e(t, this._data[t])
                }
            }, e.prototype.first = function(e) {
                for (var t in this._data) {
                    var i = e(t, this._data[t]);
                    if (i) return i
                }
                return null
            }, e
        }(),
        g = function() {
            function e() {}
            return e.BuildArray = function(e, t) {
                for (var i = [], n = 0; n < e; ++n) i.push(t());
                return i
            }, e
        }(),
        m = function() {
            function e() {}
            return e.WithinEpsilon = function(e, t, i) {
                void 0 === i && (i = 1401298e-51);
                var n = e - t;
                return -i <= n && n <= i
            }, e.ToHex = function(e) {
                var t = e.toString(16);
                return e <= 15 ? ("0" + t).toUpperCase() : t.toUpperCase()
            }, e.Sign = function(e) {
                return 0 === (e = +e) || isNaN(e) ? e : e > 0 ? 1 : -1
            }, e.Clamp = function(e, t, i) {
                return void 0 === t && (t = 0), void 0 === i && (i = 1), Math.min(i, Math.max(t, e))
            }, e.Log2 = function(e) {
                return Math.log(e) * Math.LOG2E
            }, e.Repeat = function(e, t) {
                return e - Math.floor(e / t) * t
            }, e.Normalize = function(e, t, i) {
                return (e - t) / (i - t)
            }, e.Denormalize = function(e, t, i) {
                return e * (i - t) + t
            }, e.DeltaAngle = function(t, i) {
                var n = e.Repeat(i - t, 360);
                return n > 180 && (n -= 360), n
            }, e.PingPong = function(t, i) {
                var n = e.Repeat(t, 2 * i);
                return i - Math.abs(n - i)
            }, e.SmoothStep = function(t, i, n) {
                var r = e.Clamp(n);
                return i * (r = -2 * r * r * r + 3 * r * r) + t * (1 - r)
            }, e.MoveTowards = function(t, i, n) {
                return Math.abs(i - t) <= n ? i : t + e.Sign(i - t) * n
            }, e.MoveTowardsAngle = function(t, i, n) {
                var r = e.DeltaAngle(t, i),
                    o = 0;
                return -n < r && r < n ? o = i : (i = t + r, o = e.MoveTowards(t, i, n)), o
            }, e.Lerp = function(e, t, i) {
                return e + (t - e) * i
            }, e.LerpAngle = function(t, i, n) {
                var r = e.Repeat(i - t, 360);
                return r > 180 && (r -= 360), t + r * e.Clamp(n)
            }, e.InverseLerp = function(t, i, n) {
                return t != i ? e.Clamp((n - t) / (i - t)) : 0
            }, e.Hermite = function(e, t, i, n, r) {
                var o = r * r,
                    s = r * o;
                return e * (2 * s - 3 * o + 1) + i * (-2 * s + 3 * o) + t * (s - 2 * o + r) + n * (s - o)
            }, e.RandomRange = function(e, t) {
                return e === t ? e : Math.random() * (t - e) + e
            }, e.RangeToPercent = function(e, t, i) {
                return (e - t) / (i - t)
            }, e.PercentToRange = function(e, t, i) {
                return (i - t) * e + t
            }, e.NormalizeRadians = function(t) {
                return t -= e.TwoPi * Math.floor((t + Math.PI) / e.TwoPi)
            }, e.TwoPi = 2 * Math.PI, e
        }(),
        v = function() {
            function e(e, t, i) {
                void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), this.r = e, this.g = t, this.b = i
            }
            return e.prototype.toString = function() {
                return "{R: " + this.r + " G:" + this.g + " B:" + this.b + "}"
            }, e.prototype.getClassName = function() {
                return "Color3"
            }, e.prototype.getHashCode = function() {
                var e = this.r || 0;
                return e = 397 * (e = 397 * e ^ (this.g || 0)) ^ (this.b || 0)
            }, e.prototype.toArray = function(e, t) {
                return void 0 === t && (t = 0), e[t] = this.r, e[t + 1] = this.g, e[t + 2] = this.b, this
            }, e.prototype.toColor4 = function(e) {
                return void 0 === e && (e = 1), new y(this.r, this.g, this.b, e)
            }, e.prototype.asArray = function() {
                var e = new Array;
                return this.toArray(e, 0), e
            }, e.prototype.toLuminance = function() {
                return .3 * this.r + .59 * this.g + .11 * this.b
            }, e.prototype.multiply = function(t) {
                return new e(this.r * t.r, this.g * t.g, this.b * t.b)
            }, e.prototype.multiplyToRef = function(e, t) {
                return t.r = this.r * e.r, t.g = this.g * e.g, t.b = this.b * e.b, this
            }, e.prototype.equals = function(e) {
                return e && this.r === e.r && this.g === e.g && this.b === e.b
            }, e.prototype.equalsFloats = function(e, t, i) {
                return this.r === e && this.g === t && this.b === i
            }, e.prototype.scale = function(t) {
                return new e(this.r * t, this.g * t, this.b * t)
            }, e.prototype.scaleToRef = function(e, t) {
                return t.r = this.r * e, t.g = this.g * e, t.b = this.b * e, this
            }, e.prototype.scaleAndAddToRef = function(e, t) {
                return t.r += this.r * e, t.g += this.g * e, t.b += this.b * e, this
            }, e.prototype.clampToRef = function(e, t, i) {
                return void 0 === e && (e = 0), void 0 === t && (t = 1), i.r = m.Clamp(this.r, e, t), i.g = m.Clamp(this.g, e, t), i.b = m.Clamp(this.b, e, t), this
            }, e.prototype.add = function(t) {
                return new e(this.r + t.r, this.g + t.g, this.b + t.b)
            }, e.prototype.addToRef = function(e, t) {
                return t.r = this.r + e.r, t.g = this.g + e.g, t.b = this.b + e.b, this
            }, e.prototype.subtract = function(t) {
                return new e(this.r - t.r, this.g - t.g, this.b - t.b)
            }, e.prototype.subtractToRef = function(e, t) {
                return t.r = this.r - e.r, t.g = this.g - e.g, t.b = this.b - e.b, this
            }, e.prototype.clone = function() {
                return new e(this.r, this.g, this.b)
            }, e.prototype.copyFrom = function(e) {
                return this.r = e.r, this.g = e.g, this.b = e.b, this
            }, e.prototype.copyFromFloats = function(e, t, i) {
                return this.r = e, this.g = t, this.b = i, this
            }, e.prototype.set = function(e, t, i) {
                return this.copyFromFloats(e, t, i)
            }, e.prototype.toHexString = function() {
                var e = 255 * this.r | 0,
                    t = 255 * this.g | 0,
                    i = 255 * this.b | 0;
                return "#" + m.ToHex(e) + m.ToHex(t) + m.ToHex(i)
            }, e.prototype.toLinearSpace = function() {
                var t = new e;
                return this.toLinearSpaceToRef(t), t
            }, e.prototype.toLinearSpaceToRef = function(e) {
                return e.r = Math.pow(this.r, 2.2), e.g = Math.pow(this.g, 2.2), e.b = Math.pow(this.b, 2.2), this
            }, e.prototype.toGammaSpace = function() {
                var t = new e;
                return this.toGammaSpaceToRef(t), t
            }, e.prototype.toGammaSpaceToRef = function(e) {
                return e.r = Math.pow(this.r, 1 / 2.2), e.g = Math.pow(this.g, 1 / 2.2), e.b = Math.pow(this.b, 1 / 2.2), this
            }, e.FromHexString = function(t) {
                if ("#" !== t.substring(0, 1) || 7 !== t.length) return new e(0, 0, 0);
                var i = parseInt(t.substring(1, 3), 16),
                    n = parseInt(t.substring(3, 5), 16),
                    r = parseInt(t.substring(5, 7), 16);
                return e.FromInts(i, n, r)
            }, e.FromArray = function(t, i) {
                return void 0 === i && (i = 0), new e(t[i], t[i + 1], t[i + 2])
            }, e.FromInts = function(t, i, n) {
                return new e(t / 255, i / 255, n / 255)
            }, e.Lerp = function(t, i, n) {
                var r = new e(0, 0, 0);
                return e.LerpToRef(t, i, n, r), r
            }, e.LerpToRef = function(e, t, i, n) {
                n.r = e.r + (t.r - e.r) * i, n.g = e.g + (t.g - e.g) * i, n.b = e.b + (t.b - e.b) * i
            }, e.Red = function() {
                return new e(1, 0, 0)
            }, e.Green = function() {
                return new e(0, 1, 0)
            }, e.Blue = function() {
                return new e(0, 0, 1)
            }, e.Black = function() {
                return new e(0, 0, 0)
            }, Object.defineProperty(e, "BlackReadOnly", {
                get: function() {
                    return e._BlackReadOnly
                },
                enumerable: !0,
                configurable: !0
            }), e.White = function() {
                return new e(1, 1, 1)
            }, e.Purple = function() {
                return new e(.5, 0, .5)
            }, e.Magenta = function() {
                return new e(1, 0, 1)
            }, e.Yellow = function() {
                return new e(1, 1, 0)
            }, e.Gray = function() {
                return new e(.5, .5, .5)
            }, e.Teal = function() {
                return new e(0, 1, 1)
            }, e.Random = function() {
                return new e(Math.random(), Math.random(), Math.random())
            }, e._BlackReadOnly = e.Black(), e
        }(),
        y = function() {
            function e(e, t, i, n) {
                void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), void 0 === n && (n = 1), this.r = e, this.g = t, this.b = i, this.a = n
            }
            return e.prototype.addInPlace = function(e) {
                return this.r += e.r, this.g += e.g, this.b += e.b, this.a += e.a, this
            }, e.prototype.asArray = function() {
                var e = new Array;
                return this.toArray(e, 0), e
            }, e.prototype.toArray = function(e, t) {
                return void 0 === t && (t = 0), e[t] = this.r, e[t + 1] = this.g, e[t + 2] = this.b, e[t + 3] = this.a, this
            }, e.prototype.equals = function(e) {
                return e && this.r === e.r && this.g === e.g && this.b === e.b && this.a === e.a
            }, e.prototype.add = function(t) {
                return new e(this.r + t.r, this.g + t.g, this.b + t.b, this.a + t.a)
            }, e.prototype.subtract = function(t) {
                return new e(this.r - t.r, this.g - t.g, this.b - t.b, this.a - t.a)
            }, e.prototype.subtractToRef = function(e, t) {
                return t.r = this.r - e.r, t.g = this.g - e.g, t.b = this.b - e.b, t.a = this.a - e.a, this
            }, e.prototype.scale = function(t) {
                return new e(this.r * t, this.g * t, this.b * t, this.a * t)
            }, e.prototype.scaleToRef = function(e, t) {
                return t.r = this.r * e, t.g = this.g * e, t.b = this.b * e, t.a = this.a * e, this
            }, e.prototype.scaleAndAddToRef = function(e, t) {
                return t.r += this.r * e, t.g += this.g * e, t.b += this.b * e, t.a += this.a * e, this
            }, e.prototype.clampToRef = function(e, t, i) {
                return void 0 === e && (e = 0), void 0 === t && (t = 1), i.r = m.Clamp(this.r, e, t), i.g = m.Clamp(this.g, e, t), i.b = m.Clamp(this.b, e, t), i.a = m.Clamp(this.a, e, t), this
            }, e.prototype.multiply = function(t) {
                return new e(this.r * t.r, this.g * t.g, this.b * t.b, this.a * t.a)
            }, e.prototype.multiplyToRef = function(e, t) {
                return t.r = this.r * e.r, t.g = this.g * e.g, t.b = this.b * e.b, t.a = this.a * e.a, t
            }, e.prototype.toString = function() {
                return "{R: " + this.r + " G:" + this.g + " B:" + this.b + " A:" + this.a + "}"
            }, e.prototype.getClassName = function() {
                return "Color4"
            }, e.prototype.getHashCode = function() {
                var e = this.r || 0;
                return e = 397 * (e = 397 * (e = 397 * e ^ (this.g || 0)) ^ (this.b || 0)) ^ (this.a || 0)
            }, e.prototype.clone = function() {
                return new e(this.r, this.g, this.b, this.a)
            }, e.prototype.copyFrom = function(e) {
                return this.r = e.r, this.g = e.g, this.b = e.b, this.a = e.a, this
            }, e.prototype.copyFromFloats = function(e, t, i, n) {
                return this.r = e, this.g = t, this.b = i, this.a = n, this
            }, e.prototype.set = function(e, t, i, n) {
                return this.copyFromFloats(e, t, i, n)
            }, e.prototype.toHexString = function() {
                var e = 255 * this.r | 0,
                    t = 255 * this.g | 0,
                    i = 255 * this.b | 0,
                    n = 255 * this.a | 0;
                return "#" + m.ToHex(e) + m.ToHex(t) + m.ToHex(i) + m.ToHex(n)
            }, e.prototype.toLinearSpace = function() {
                var t = new e;
                return this.toLinearSpaceToRef(t), t
            }, e.prototype.toLinearSpaceToRef = function(e) {
                return e.r = Math.pow(this.r, 2.2), e.g = Math.pow(this.g, 2.2), e.b = Math.pow(this.b, 2.2), e.a = this.a, this
            }, e.prototype.toGammaSpace = function() {
                var t = new e;
                return this.toGammaSpaceToRef(t), t
            }, e.prototype.toGammaSpaceToRef = function(e) {
                return e.r = Math.pow(this.r, 1 / 2.2), e.g = Math.pow(this.g, 1 / 2.2), e.b = Math.pow(this.b, 1 / 2.2), e.a = this.a, this
            }, e.FromHexString = function(t) {
                if ("#" !== t.substring(0, 1) || 9 !== t.length) return new e(0, 0, 0, 0);
                var i = parseInt(t.substring(1, 3), 16),
                    n = parseInt(t.substring(3, 5), 16),
                    r = parseInt(t.substring(5, 7), 16),
                    o = parseInt(t.substring(7, 9), 16);
                return e.FromInts(i, n, r, o)
            }, e.Lerp = function(t, i, n) {
                var r = new e(0, 0, 0, 0);
                return e.LerpToRef(t, i, n, r), r
            }, e.LerpToRef = function(e, t, i, n) {
                n.r = e.r + (t.r - e.r) * i, n.g = e.g + (t.g - e.g) * i, n.b = e.b + (t.b - e.b) * i, n.a = e.a + (t.a - e.a) * i
            }, e.FromColor3 = function(t, i) {
                return void 0 === i && (i = 1), new e(t.r, t.g, t.b, i)
            }, e.FromArray = function(t, i) {
                return void 0 === i && (i = 0), new e(t[i], t[i + 1], t[i + 2], t[i + 3])
            }, e.FromInts = function(t, i, n, r) {
                return new e(t / 255, i / 255, n / 255, r / 255)
            }, e.CheckColors4 = function(e, t) {
                if (e.length === 3 * t) {
                    for (var i = [], n = 0; n < e.length; n += 3) {
                        var r = n / 3 * 4;
                        i[r] = e[n], i[r + 1] = e[n + 1], i[r + 2] = e[n + 2], i[r + 3] = 1
                    }
                    return i
                }
                return e
            }, e
        }(),
        T = function() {
            function e(e, t) {
                void 0 === e && (e = 0), void 0 === t && (t = 0), this.x = e, this.y = t
            }
            return e.prototype.toString = function() {
                return "{X: " + this.x + " Y:" + this.y + "}"
            }, e.prototype.getClassName = function() {
                return "Vector2"
            }, e.prototype.getHashCode = function() {
                var e = this.x || 0;
                return e = 397 * e ^ (this.y || 0)
            }, e.prototype.toArray = function(e, t) {
                return void 0 === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, this
            }, e.prototype.asArray = function() {
                var e = new Array;
                return this.toArray(e, 0), e
            }, e.prototype.copyFrom = function(e) {
                return this.x = e.x, this.y = e.y, this
            }, e.prototype.copyFromFloats = function(e, t) {
                return this.x = e, this.y = t, this
            }, e.prototype.set = function(e, t) {
                return this.copyFromFloats(e, t)
            }, e.prototype.add = function(t) {
                return new e(this.x + t.x, this.y + t.y)
            }, e.prototype.addToRef = function(e, t) {
                return t.x = this.x + e.x, t.y = this.y + e.y, this
            }, e.prototype.addInPlace = function(e) {
                return this.x += e.x, this.y += e.y, this
            }, e.prototype.addVector3 = function(t) {
                return new e(this.x + t.x, this.y + t.y)
            }, e.prototype.subtract = function(t) {
                return new e(this.x - t.x, this.y - t.y)
            }, e.prototype.subtractToRef = function(e, t) {
                return t.x = this.x - e.x, t.y = this.y - e.y, this
            }, e.prototype.subtractInPlace = function(e) {
                return this.x -= e.x, this.y -= e.y, this
            }, e.prototype.multiplyInPlace = function(e) {
                return this.x *= e.x, this.y *= e.y, this
            }, e.prototype.multiply = function(t) {
                return new e(this.x * t.x, this.y * t.y)
            }, e.prototype.multiplyToRef = function(e, t) {
                return t.x = this.x * e.x, t.y = this.y * e.y, this
            }, e.prototype.multiplyByFloats = function(t, i) {
                return new e(this.x * t, this.y * i)
            }, e.prototype.divide = function(t) {
                return new e(this.x / t.x, this.y / t.y)
            }, e.prototype.divideToRef = function(e, t) {
                return t.x = this.x / e.x, t.y = this.y / e.y, this
            }, e.prototype.divideInPlace = function(e) {
                return this.divideToRef(e, this)
            }, e.prototype.negate = function() {
                return new e(-this.x, -this.y)
            }, e.prototype.scaleInPlace = function(e) {
                return this.x *= e, this.y *= e, this
            }, e.prototype.scale = function(t) {
                var i = new e(0, 0);
                return this.scaleToRef(t, i), i
            }, e.prototype.scaleToRef = function(e, t) {
                return t.x = this.x * e, t.y = this.y * e, this
            }, e.prototype.scaleAndAddToRef = function(e, t) {
                return t.x += this.x * e, t.y += this.y * e, this
            }, e.prototype.equals = function(e) {
                return e && this.x === e.x && this.y === e.y
            }, e.prototype.equalsWithEpsilon = function(e, t) {
                return void 0 === t && (t = .001), e && m.WithinEpsilon(this.x, e.x, t) && m.WithinEpsilon(this.y, e.y, t)
            }, e.prototype.floor = function() {
                return new e(Math.floor(this.x), Math.floor(this.y))
            }, e.prototype.fract = function() {
                return new e(this.x - Math.floor(this.x), this.y - Math.floor(this.y))
            }, e.prototype.length = function() {
                return Math.sqrt(this.x * this.x + this.y * this.y)
            }, e.prototype.lengthSquared = function() {
                return this.x * this.x + this.y * this.y
            }, e.prototype.normalize = function() {
                var e = this.length();
                if (0 === e) return this;
                var t = 1 / e;
                return this.x *= t, this.y *= t, this
            }, e.prototype.clone = function() {
                return new e(this.x, this.y)
            }, e.Zero = function() {
                return new e(0, 0)
            }, e.One = function() {
                return new e(1, 1)
            }, e.FromArray = function(t, i) {
                return void 0 === i && (i = 0), new e(t[i], t[i + 1])
            }, e.FromArrayToRef = function(e, t, i) {
                i.x = e[t], i.y = e[t + 1]
            }, e.CatmullRom = function(t, i, n, r, o) {
                var s = o * o,
                    a = o * s;
                return new e(.5 * (2 * i.x + (-t.x + n.x) * o + (2 * t.x - 5 * i.x + 4 * n.x - r.x) * s + (-t.x + 3 * i.x - 3 * n.x + r.x) * a), .5 * (2 * i.y + (-t.y + n.y) * o + (2 * t.y - 5 * i.y + 4 * n.y - r.y) * s + (-t.y + 3 * i.y - 3 * n.y + r.y) * a))
            }, e.Clamp = function(t, i, n) {
                var r = t.x;
                r = (r = r > n.x ? n.x : r) < i.x ? i.x : r;
                var o = t.y;
                return new e(r, o = (o = o > n.y ? n.y : o) < i.y ? i.y : o)
            }, e.Hermite = function(t, i, n, r, o) {
                var s = o * o,
                    a = o * s,
                    u = 2 * a - 3 * s + 1,
                    h = -2 * a + 3 * s,
                    l = a - 2 * s + o,
                    c = a - s;
                return new e(t.x * u + n.x * h + i.x * l + r.x * c, t.y * u + n.y * h + i.y * l + r.y * c)
            }, e.Lerp = function(t, i, n) {
                return new e(t.x + (i.x - t.x) * n, t.y + (i.y - t.y) * n)
            }, e.Dot = function(e, t) {
                return e.x * t.x + e.y * t.y
            }, e.Normalize = function(e) {
                var t = e.clone();
                return t.normalize(), t
            }, e.Minimize = function(t, i) {
                return new e(t.x < i.x ? t.x : i.x, t.y < i.y ? t.y : i.y)
            }, e.Maximize = function(t, i) {
                return new e(t.x > i.x ? t.x : i.x, t.y > i.y ? t.y : i.y)
            }, e.Transform = function(t, i) {
                var n = e.Zero();
                return e.TransformToRef(t, i, n), n
            }, e.TransformToRef = function(e, t, i) {
                var n = t.m,
                    r = e.x * n[0] + e.y * n[4] + n[12],
                    o = e.x * n[1] + e.y * n[5] + n[13];
                i.x = r, i.y = o
            }, e.PointInTriangle = function(e, t, i, n) {
                var r = .5 * (-i.y * n.x + t.y * (-i.x + n.x) + t.x * (i.y - n.y) + i.x * n.y),
                    o = r < 0 ? -1 : 1,
                    s = (t.y * n.x - t.x * n.y + (n.y - t.y) * e.x + (t.x - n.x) * e.y) * o,
                    a = (t.x * i.y - t.y * i.x + (t.y - i.y) * e.x + (i.x - t.x) * e.y) * o;
                return s > 0 && a > 0 && s + a < 2 * r * o
            }, e.Distance = function(t, i) {
                return Math.sqrt(e.DistanceSquared(t, i))
            }, e.DistanceSquared = function(e, t) {
                var i = e.x - t.x,
                    n = e.y - t.y;
                return i * i + n * n
            }, e.Center = function(e, t) {
                var i = e.add(t);
                return i.scaleInPlace(.5), i
            }, e.DistanceOfPointFromSegment = function(t, i, n) {
                var r = e.DistanceSquared(i, n);
                if (0 === r) return e.Distance(t, i);
                var o = n.subtract(i),
                    s = Math.max(0, Math.min(1, e.Dot(t.subtract(i), o) / r)),
                    a = i.add(o.multiplyByFloats(s, s));
                return e.Distance(t, a)
            }, e
        }(),
        b = function() {
            function e(e, t, i) {
                void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), this.x = e, this.y = t, this.z = i
            }
            return e.prototype.toString = function() {
                return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + "}"
            }, e.prototype.getClassName = function() {
                return "Vector3"
            }, e.prototype.getHashCode = function() {
                var e = this.x || 0;
                return e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)
            }, e.prototype.asArray = function() {
                var e = [];
                return this.toArray(e, 0), e
            }, e.prototype.toArray = function(e, t) {
                return void 0 === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, e[t + 2] = this.z, this
            }, e.prototype.toQuaternion = function() {
                return M.RotationYawPitchRoll(this.y, this.x, this.z)
            }, e.prototype.addInPlace = function(e) {
                return this.addInPlaceFromFloats(e.x, e.y, e.z)
            }, e.prototype.addInPlaceFromFloats = function(e, t, i) {
                return this.x += e, this.y += t, this.z += i, this
            }, e.prototype.add = function(t) {
                return new e(this.x + t.x, this.y + t.y, this.z + t.z)
            }, e.prototype.addToRef = function(e, t) {
                return t.copyFromFloats(this.x + e.x, this.y + e.y, this.z + e.z)
            }, e.prototype.subtractInPlace = function(e) {
                return this.x -= e.x, this.y -= e.y, this.z -= e.z, this
            }, e.prototype.subtract = function(t) {
                return new e(this.x - t.x, this.y - t.y, this.z - t.z)
            }, e.prototype.subtractToRef = function(e, t) {
                return this.subtractFromFloatsToRef(e.x, e.y, e.z, t)
            }, e.prototype.subtractFromFloats = function(t, i, n) {
                return new e(this.x - t, this.y - i, this.z - n)
            }, e.prototype.subtractFromFloatsToRef = function(e, t, i, n) {
                return n.copyFromFloats(this.x - e, this.y - t, this.z - i)
            }, e.prototype.negate = function() {
                return new e(-this.x, -this.y, -this.z)
            }, e.prototype.scaleInPlace = function(e) {
                return this.x *= e, this.y *= e, this.z *= e, this
            }, e.prototype.scale = function(t) {
                return new e(this.x * t, this.y * t, this.z * t)
            }, e.prototype.scaleToRef = function(e, t) {
                return t.copyFromFloats(this.x * e, this.y * e, this.z * e)
            }, e.prototype.scaleAndAddToRef = function(e, t) {
                return t.addInPlaceFromFloats(this.x * e, this.y * e, this.z * e)
            }, e.prototype.equals = function(e) {
                return e && this.x === e.x && this.y === e.y && this.z === e.z
            }, e.prototype.equalsWithEpsilon = function(e, t) {
                return void 0 === t && (t = .001), e && m.WithinEpsilon(this.x, e.x, t) && m.WithinEpsilon(this.y, e.y, t) && m.WithinEpsilon(this.z, e.z, t)
            }, e.prototype.equalsToFloats = function(e, t, i) {
                return this.x === e && this.y === t && this.z === i
            }, e.prototype.multiplyInPlace = function(e) {
                return this.x *= e.x, this.y *= e.y, this.z *= e.z, this
            }, e.prototype.multiply = function(e) {
                return this.multiplyByFloats(e.x, e.y, e.z)
            }, e.prototype.multiplyToRef = function(e, t) {
                return t.copyFromFloats(this.x * e.x, this.y * e.y, this.z * e.z)
            }, e.prototype.multiplyByFloats = function(t, i, n) {
                return new e(this.x * t, this.y * i, this.z * n)
            }, e.prototype.divide = function(t) {
                return new e(this.x / t.x, this.y / t.y, this.z / t.z)
            }, e.prototype.divideToRef = function(e, t) {
                return t.copyFromFloats(this.x / e.x, this.y / e.y, this.z / e.z)
            }, e.prototype.divideInPlace = function(e) {
                return this.divideToRef(e, this)
            }, e.prototype.minimizeInPlace = function(e) {
                return this.minimizeInPlaceFromFloats(e.x, e.y, e.z)
            }, e.prototype.maximizeInPlace = function(e) {
                return this.maximizeInPlaceFromFloats(e.x, e.y, e.z)
            }, e.prototype.minimizeInPlaceFromFloats = function(e, t, i) {
                return e < this.x && (this.x = e), t < this.y && (this.y = t), i < this.z && (this.z = i), this
            }, e.prototype.maximizeInPlaceFromFloats = function(e, t, i) {
                return e > this.x && (this.x = e), t > this.y && (this.y = t), i > this.z && (this.z = i), this
            }, e.prototype.isNonUniformWithinEpsilon = function(e) {
                var t = Math.abs(this.x),
                    i = Math.abs(this.y);
                if (!m.WithinEpsilon(t, i, e)) return !0;
                var n = Math.abs(this.z);
                return !m.WithinEpsilon(t, n, e) || !m.WithinEpsilon(i, n, e)
            }, Object.defineProperty(e.prototype, "isNonUniform", {
                get: function() {
                    var e = Math.abs(this.x),
                        t = Math.abs(this.y);
                    if (e !== t) return !0;
                    var i = Math.abs(this.z);
                    return e !== i || t !== i
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.floor = function() {
                return new e(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z))
            }, e.prototype.fract = function() {
                return new e(this.x - Math.floor(this.x), this.y - Math.floor(this.y), this.z - Math.floor(this.z))
            }, e.prototype.length = function() {
                return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z)
            }, e.prototype.lengthSquared = function() {
                return this.x * this.x + this.y * this.y + this.z * this.z
            }, e.prototype.normalize = function() {
                return this.normalizeFromLength(this.length())
            }, e.prototype.reorderInPlace = function(e) {
                var t = this;
                return "xyz" === (e = e.toLowerCase()) ? this : (U.Vector3[0].copyFrom(this), ["x", "y", "z"].forEach((function(i, n) {
                    t[i] = U.Vector3[0][e[n]]
                })), this)
            }, e.prototype.rotateByQuaternionToRef = function(t, i) {
                return t.toRotationMatrix(U.Matrix[0]), e.TransformCoordinatesToRef(this, U.Matrix[0], i), i
            }, e.prototype.rotateByQuaternionAroundPointToRef = function(e, t, i) {
                return this.subtractToRef(t, U.Vector3[0]), U.Vector3[0].rotateByQuaternionToRef(e, U.Vector3[0]), t.addToRef(U.Vector3[0], i), i
            }, e.prototype.normalizeFromLength = function(e) {
                return 0 === e || 1 === e ? this : this.scaleInPlace(1 / e)
            }, e.prototype.normalizeToNew = function() {
                var t = new e(0, 0, 0);
                return this.normalizeToRef(t), t
            }, e.prototype.normalizeToRef = function(e) {
                var t = this.length();
                return 0 === t || 1 === t ? e.copyFromFloats(this.x, this.y, this.z) : this.scaleToRef(1 / t, e)
            }, e.prototype.clone = function() {
                return new e(this.x, this.y, this.z)
            }, e.prototype.copyFrom = function(e) {
                return this.copyFromFloats(e.x, e.y, e.z)
            }, e.prototype.copyFromFloats = function(e, t, i) {
                return this.x = e, this.y = t, this.z = i, this
            }, e.prototype.set = function(e, t, i) {
                return this.copyFromFloats(e, t, i)
            }, e.prototype.setAll = function(e) {
                return this.x = this.y = this.z = e, this
            }, e.GetClipFactor = function(t, i, n, r) {
                var o = e.Dot(t, n) - r;
                return o / (o - (e.Dot(i, n) - r))
            }, e.GetAngleBetweenVectors = function(t, i, n) {
                var r = t.normalizeToRef(U.Vector3[1]),
                    o = i.normalizeToRef(U.Vector3[2]),
                    s = e.Dot(r, o),
                    a = U.Vector3[3];
                return e.CrossToRef(r, o, a), e.Dot(a, n) > 0 ? Math.acos(s) : -Math.acos(s)
            }, e.FromArray = function(t, i) {
                return void 0 === i && (i = 0), new e(t[i], t[i + 1], t[i + 2])
            }, e.FromFloatArray = function(t, i) {
                return e.FromArray(t, i)
            }, e.FromArrayToRef = function(e, t, i) {
                i.x = e[t], i.y = e[t + 1], i.z = e[t + 2]
            }, e.FromFloatArrayToRef = function(t, i, n) {
                return e.FromArrayToRef(t, i, n)
            }, e.FromFloatsToRef = function(e, t, i, n) {
                n.copyFromFloats(e, t, i)
            }, e.Zero = function() {
                return new e(0, 0, 0)
            }, e.One = function() {
                return new e(1, 1, 1)
            }, e.Up = function() {
                return new e(0, 1, 0)
            }, Object.defineProperty(e, "UpReadOnly", {
                get: function() {
                    return e._UpReadOnly
                },
                enumerable: !0,
                configurable: !0
            }), e.Down = function() {
                return new e(0, -1, 0)
            }, e.Forward = function() {
                return new e(0, 0, 1)
            }, e.Backward = function() {
                return new e(0, 0, -1)
            }, e.Right = function() {
                return new e(1, 0, 0)
            }, e.Left = function() {
                return new e(-1, 0, 0)
            }, e.TransformCoordinates = function(t, i) {
                var n = e.Zero();
                return e.TransformCoordinatesToRef(t, i, n), n
            }, e.TransformCoordinatesToRef = function(t, i, n) {
                e.TransformCoordinatesFromFloatsToRef(t.x, t.y, t.z, i, n)
            }, e.TransformCoordinatesFromFloatsToRef = function(e, t, i, n, r) {
                var o = n.m,
                    s = e * o[0] + t * o[4] + i * o[8] + o[12],
                    a = e * o[1] + t * o[5] + i * o[9] + o[13],
                    u = e * o[2] + t * o[6] + i * o[10] + o[14],
                    h = 1 / (e * o[3] + t * o[7] + i * o[11] + o[15]);
                r.x = s * h, r.y = a * h, r.z = u * h
            }, e.TransformNormal = function(t, i) {
                var n = e.Zero();
                return e.TransformNormalToRef(t, i, n), n
            }, e.TransformNormalToRef = function(e, t, i) {
                this.TransformNormalFromFloatsToRef(e.x, e.y, e.z, t, i)
            }, e.TransformNormalFromFloatsToRef = function(e, t, i, n, r) {
                var o = n.m;
                r.x = e * o[0] + t * o[4] + i * o[8], r.y = e * o[1] + t * o[5] + i * o[9], r.z = e * o[2] + t * o[6] + i * o[10]
            }, e.CatmullRom = function(t, i, n, r, o) {
                var s = o * o,
                    a = o * s;
                return new e(.5 * (2 * i.x + (-t.x + n.x) * o + (2 * t.x - 5 * i.x + 4 * n.x - r.x) * s + (-t.x + 3 * i.x - 3 * n.x + r.x) * a), .5 * (2 * i.y + (-t.y + n.y) * o + (2 * t.y - 5 * i.y + 4 * n.y - r.y) * s + (-t.y + 3 * i.y - 3 * n.y + r.y) * a), .5 * (2 * i.z + (-t.z + n.z) * o + (2 * t.z - 5 * i.z + 4 * n.z - r.z) * s + (-t.z + 3 * i.z - 3 * n.z + r.z) * a))
            }, e.Clamp = function(t, i, n) {
                var r = new e;
                return e.ClampToRef(t, i, n, r), r
            }, e.ClampToRef = function(e, t, i, n) {
                var r = e.x;
                r = (r = r > i.x ? i.x : r) < t.x ? t.x : r;
                var o = e.y;
                o = (o = o > i.y ? i.y : o) < t.y ? t.y : o;
                var s = e.z;
                s = (s = s > i.z ? i.z : s) < t.z ? t.z : s, n.copyFromFloats(r, o, s)
            }, e.Hermite = function(t, i, n, r, o) {
                var s = o * o,
                    a = o * s,
                    u = 2 * a - 3 * s + 1,
                    h = -2 * a + 3 * s,
                    l = a - 2 * s + o,
                    c = a - s;
                return new e(t.x * u + n.x * h + i.x * l + r.x * c, t.y * u + n.y * h + i.y * l + r.y * c, t.z * u + n.z * h + i.z * l + r.z * c)
            }, e.Lerp = function(t, i, n) {
                var r = new e(0, 0, 0);
                return e.LerpToRef(t, i, n, r), r
            }, e.LerpToRef = function(e, t, i, n) {
                n.x = e.x + (t.x - e.x) * i, n.y = e.y + (t.y - e.y) * i, n.z = e.z + (t.z - e.z) * i
            }, e.Dot = function(e, t) {
                return e.x * t.x + e.y * t.y + e.z * t.z
            }, e.Cross = function(t, i) {
                var n = e.Zero();
                return e.CrossToRef(t, i, n), n
            }, e.CrossToRef = function(e, t, i) {
                var n = e.y * t.z - e.z * t.y,
                    r = e.z * t.x - e.x * t.z,
                    o = e.x * t.y - e.y * t.x;
                i.copyFromFloats(n, r, o)
            }, e.Normalize = function(t) {
                var i = e.Zero();
                return e.NormalizeToRef(t, i), i
            }, e.NormalizeToRef = function(e, t) {
                e.normalizeToRef(t)
            }, e.Project = function(t, i, n, r) {
                var o = r.width,
                    s = r.height,
                    a = r.x,
                    u = r.y,
                    h = U.Matrix[1];
                R.FromValuesToRef(o / 2, 0, 0, 0, 0, -s / 2, 0, 0, 0, 0, .5, 0, a + o / 2, s / 2 + u, .5, 1, h);
                var l = U.Matrix[0];
                return i.multiplyToRef(n, l), l.multiplyToRef(h, l), e.TransformCoordinates(t, l)
            }, e._UnprojectFromInvertedMatrixToRef = function(t, i, n) {
                e.TransformCoordinatesToRef(t, i, n);
                var r = i.m,
                    o = t.x * r[3] + t.y * r[7] + t.z * r[11] + r[15];
                m.WithinEpsilon(o, 1) && n.scaleInPlace(1 / o)
            }, e.UnprojectFromTransform = function(t, i, n, r, o) {
                var s = U.Matrix[0];
                r.multiplyToRef(o, s), s.invert(), t.x = t.x / i * 2 - 1, t.y = -(t.y / n * 2 - 1);
                var a = new e;
                return e._UnprojectFromInvertedMatrixToRef(t, s, a), a
            }, e.Unproject = function(t, i, n, r, o, s) {
                var a = e.Zero();
                return e.UnprojectToRef(t, i, n, r, o, s, a), a
            }, e.UnprojectToRef = function(t, i, n, r, o, s, a) {
                e.UnprojectFloatsToRef(t.x, t.y, t.z, i, n, r, o, s, a)
            }, e.UnprojectFloatsToRef = function(t, i, n, r, o, s, a, u, h) {
                var l = U.Matrix[0];
                s.multiplyToRef(a, l), l.multiplyToRef(u, l), l.invert();
                var c = U.Vector3[0];
                c.x = t / r * 2 - 1, c.y = -(i / o * 2 - 1), c.z = 2 * n - 1, e._UnprojectFromInvertedMatrixToRef(c, l, h)
            }, e.Minimize = function(e, t) {
                var i = e.clone();
                return i.minimizeInPlace(t), i
            }, e.Maximize = function(e, t) {
                var i = e.clone();
                return i.maximizeInPlace(t), i
            }, e.Distance = function(t, i) {
                return Math.sqrt(e.DistanceSquared(t, i))
            }, e.DistanceSquared = function(e, t) {
                var i = e.x - t.x,
                    n = e.y - t.y,
                    r = e.z - t.z;
                return i * i + n * n + r * r
            }, e.Center = function(e, t) {
                var i = e.add(t);
                return i.scaleInPlace(.5), i
            }, e.RotationFromAxis = function(t, i, n) {
                var r = e.Zero();
                return e.RotationFromAxisToRef(t, i, n, r), r
            }, e.RotationFromAxisToRef = function(e, t, i, n) {
                var r = U.Quaternion[0];
                M.RotationQuaternionFromAxisToRef(e, t, i, r), r.toEulerAnglesToRef(n)
            }, e._UpReadOnly = e.Up(), e
        }(),
        E = function() {
            function e(e, t, i, n) {
                this.x = e, this.y = t, this.z = i, this.w = n
            }
            return e.prototype.toString = function() {
                return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + " W:" + this.w + "}"
            }, e.prototype.getClassName = function() {
                return "Vector4"
            }, e.prototype.getHashCode = function() {
                var e = this.x || 0;
                return e = 397 * (e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)) ^ (this.w || 0)
            }, e.prototype.asArray = function() {
                var e = new Array;
                return this.toArray(e, 0), e
            }, e.prototype.toArray = function(e, t) {
                return void 0 === t && (t = 0), e[t] = this.x, e[t + 1] = this.y, e[t + 2] = this.z, e[t + 3] = this.w, this
            }, e.prototype.addInPlace = function(e) {
                return this.x += e.x, this.y += e.y, this.z += e.z, this.w += e.w, this
            }, e.prototype.add = function(t) {
                return new e(this.x + t.x, this.y + t.y, this.z + t.z, this.w + t.w)
            }, e.prototype.addToRef = function(e, t) {
                return t.x = this.x + e.x, t.y = this.y + e.y, t.z = this.z + e.z, t.w = this.w + e.w, this
            }, e.prototype.subtractInPlace = function(e) {
                return this.x -= e.x, this.y -= e.y, this.z -= e.z, this.w -= e.w, this
            }, e.prototype.subtract = function(t) {
                return new e(this.x - t.x, this.y - t.y, this.z - t.z, this.w - t.w)
            }, e.prototype.subtractToRef = function(e, t) {
                return t.x = this.x - e.x, t.y = this.y - e.y, t.z = this.z - e.z, t.w = this.w - e.w, this
            }, e.prototype.subtractFromFloats = function(t, i, n, r) {
                return new e(this.x - t, this.y - i, this.z - n, this.w - r)
            }, e.prototype.subtractFromFloatsToRef = function(e, t, i, n, r) {
                return r.x = this.x - e, r.y = this.y - t, r.z = this.z - i, r.w = this.w - n, this
            }, e.prototype.negate = function() {
                return new e(-this.x, -this.y, -this.z, -this.w)
            }, e.prototype.scaleInPlace = function(e) {
                return this.x *= e, this.y *= e, this.z *= e, this.w *= e, this
            }, e.prototype.scale = function(t) {
                return new e(this.x * t, this.y * t, this.z * t, this.w * t)
            }, e.prototype.scaleToRef = function(e, t) {
                return t.x = this.x * e, t.y = this.y * e, t.z = this.z * e, t.w = this.w * e, this
            }, e.prototype.scaleAndAddToRef = function(e, t) {
                return t.x += this.x * e, t.y += this.y * e, t.z += this.z * e, t.w += this.w * e, this
            }, e.prototype.equals = function(e) {
                return e && this.x === e.x && this.y === e.y && this.z === e.z && this.w === e.w
            }, e.prototype.equalsWithEpsilon = function(e, t) {
                return void 0 === t && (t = .001), e && m.WithinEpsilon(this.x, e.x, t) && m.WithinEpsilon(this.y, e.y, t) && m.WithinEpsilon(this.z, e.z, t) && m.WithinEpsilon(this.w, e.w, t)
            }, e.prototype.equalsToFloats = function(e, t, i, n) {
                return this.x === e && this.y === t && this.z === i && this.w === n
            }, e.prototype.multiplyInPlace = function(e) {
                return this.x *= e.x, this.y *= e.y, this.z *= e.z, this.w *= e.w, this
            }, e.prototype.multiply = function(t) {
                return new e(this.x * t.x, this.y * t.y, this.z * t.z, this.w * t.w)
            }, e.prototype.multiplyToRef = function(e, t) {
                return t.x = this.x * e.x, t.y = this.y * e.y, t.z = this.z * e.z, t.w = this.w * e.w, this
            }, e.prototype.multiplyByFloats = function(t, i, n, r) {
                return new e(this.x * t, this.y * i, this.z * n, this.w * r)
            }, e.prototype.divide = function(t) {
                return new e(this.x / t.x, this.y / t.y, this.z / t.z, this.w / t.w)
            }, e.prototype.divideToRef = function(e, t) {
                return t.x = this.x / e.x, t.y = this.y / e.y, t.z = this.z / e.z, t.w = this.w / e.w, this
            }, e.prototype.divideInPlace = function(e) {
                return this.divideToRef(e, this)
            }, e.prototype.minimizeInPlace = function(e) {
                return e.x < this.x && (this.x = e.x), e.y < this.y && (this.y = e.y), e.z < this.z && (this.z = e.z), e.w < this.w && (this.w = e.w), this
            }, e.prototype.maximizeInPlace = function(e) {
                return e.x > this.x && (this.x = e.x), e.y > this.y && (this.y = e.y), e.z > this.z && (this.z = e.z), e.w > this.w && (this.w = e.w), this
            }, e.prototype.floor = function() {
                return new e(Math.floor(this.x), Math.floor(this.y), Math.floor(this.z), Math.floor(this.w))
            }, e.prototype.fract = function() {
                return new e(this.x - Math.floor(this.x), this.y - Math.floor(this.y), this.z - Math.floor(this.z), this.w - Math.floor(this.w))
            }, e.prototype.length = function() {
                return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
            }, e.prototype.lengthSquared = function() {
                return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w
            }, e.prototype.normalize = function() {
                var e = this.length();
                return 0 === e ? this : this.scaleInPlace(1 / e)
            }, e.prototype.toVector3 = function() {
                return new b(this.x, this.y, this.z)
            }, e.prototype.clone = function() {
                return new e(this.x, this.y, this.z, this.w)
            }, e.prototype.copyFrom = function(e) {
                return this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w, this
            }, e.prototype.copyFromFloats = function(e, t, i, n) {
                return this.x = e, this.y = t, this.z = i, this.w = n, this
            }, e.prototype.set = function(e, t, i, n) {
                return this.copyFromFloats(e, t, i, n)
            }, e.prototype.setAll = function(e) {
                return this.x = this.y = this.z = this.w = e, this
            }, e.FromArray = function(t, i) {
                return i || (i = 0), new e(t[i], t[i + 1], t[i + 2], t[i + 3])
            }, e.FromArrayToRef = function(e, t, i) {
                i.x = e[t], i.y = e[t + 1], i.z = e[t + 2], i.w = e[t + 3]
            }, e.FromFloatArrayToRef = function(t, i, n) {
                e.FromArrayToRef(t, i, n)
            }, e.FromFloatsToRef = function(e, t, i, n, r) {
                r.x = e, r.y = t, r.z = i, r.w = n
            }, e.Zero = function() {
                return new e(0, 0, 0, 0)
            }, e.One = function() {
                return new e(1, 1, 1, 1)
            }, e.Normalize = function(t) {
                var i = e.Zero();
                return e.NormalizeToRef(t, i), i
            }, e.NormalizeToRef = function(e, t) {
                t.copyFrom(e), t.normalize()
            }, e.Minimize = function(e, t) {
                var i = e.clone();
                return i.minimizeInPlace(t), i
            }, e.Maximize = function(e, t) {
                var i = e.clone();
                return i.maximizeInPlace(t), i
            }, e.Distance = function(t, i) {
                return Math.sqrt(e.DistanceSquared(t, i))
            }, e.DistanceSquared = function(e, t) {
                var i = e.x - t.x,
                    n = e.y - t.y,
                    r = e.z - t.z,
                    o = e.w - t.w;
                return i * i + n * n + r * r + o * o
            }, e.Center = function(e, t) {
                var i = e.add(t);
                return i.scaleInPlace(.5), i
            }, e.TransformNormal = function(t, i) {
                var n = e.Zero();
                return e.TransformNormalToRef(t, i, n), n
            }, e.TransformNormalToRef = function(e, t, i) {
                var n = t.m,
                    r = e.x * n[0] + e.y * n[4] + e.z * n[8],
                    o = e.x * n[1] + e.y * n[5] + e.z * n[9],
                    s = e.x * n[2] + e.y * n[6] + e.z * n[10];
                i.x = r, i.y = o, i.z = s, i.w = e.w
            }, e.TransformNormalFromFloatsToRef = function(e, t, i, n, r, o) {
                var s = r.m;
                o.x = e * s[0] + t * s[4] + i * s[8], o.y = e * s[1] + t * s[5] + i * s[9], o.z = e * s[2] + t * s[6] + i * s[10], o.w = n
            }, e.FromVector3 = function(t, i) {
                return void 0 === i && (i = 0), new e(t.x, t.y, t.z, i)
            }, e
        }(),
        A = function() {
            function e(e, t) {
                this.width = e, this.height = t
            }
            return e.prototype.toString = function() {
                return "{W: " + this.width + ", H: " + this.height + "}"
            }, e.prototype.getClassName = function() {
                return "Size"
            }, e.prototype.getHashCode = function() {
                var e = this.width || 0;
                return e = 397 * e ^ (this.height || 0)
            }, e.prototype.copyFrom = function(e) {
                this.width = e.width, this.height = e.height
            }, e.prototype.copyFromFloats = function(e, t) {
                return this.width = e, this.height = t, this
            }, e.prototype.set = function(e, t) {
                return this.copyFromFloats(e, t)
            }, e.prototype.multiplyByFloats = function(t, i) {
                return new e(this.width * t, this.height * i)
            }, e.prototype.clone = function() {
                return new e(this.width, this.height)
            }, e.prototype.equals = function(e) {
                return !!e && (this.width === e.width && this.height === e.height)
            }, Object.defineProperty(e.prototype, "surface", {
                get: function() {
                    return this.width * this.height
                },
                enumerable: !0,
                configurable: !0
            }), e.Zero = function() {
                return new e(0, 0)
            }, e.prototype.add = function(t) {
                return new e(this.width + t.width, this.height + t.height)
            }, e.prototype.subtract = function(t) {
                return new e(this.width - t.width, this.height - t.height)
            }, e.Lerp = function(t, i, n) {
                return new e(t.width + (i.width - t.width) * n, t.height + (i.height - t.height) * n)
            }, e
        }(),
        M = function() {
            function e(e, t, i, n) {
                void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = 0), void 0 === n && (n = 1), this.x = e, this.y = t, this.z = i, this.w = n
            }
            return e.prototype.toString = function() {
                return "{X: " + this.x + " Y:" + this.y + " Z:" + this.z + " W:" + this.w + "}"
            }, e.prototype.getClassName = function() {
                return "Quaternion"
            }, e.prototype.getHashCode = function() {
                var e = this.x || 0;
                return e = 397 * (e = 397 * (e = 397 * e ^ (this.y || 0)) ^ (this.z || 0)) ^ (this.w || 0)
            }, e.prototype.asArray = function() {
                return [this.x, this.y, this.z, this.w]
            }, e.prototype.equals = function(e) {
                return e && this.x === e.x && this.y === e.y && this.z === e.z && this.w === e.w
            }, e.prototype.clone = function() {
                return new e(this.x, this.y, this.z, this.w)
            }, e.prototype.copyFrom = function(e) {
                return this.x = e.x, this.y = e.y, this.z = e.z, this.w = e.w, this
            }, e.prototype.copyFromFloats = function(e, t, i, n) {
                return this.x = e, this.y = t, this.z = i, this.w = n, this
            }, e.prototype.set = function(e, t, i, n) {
                return this.copyFromFloats(e, t, i, n)
            }, e.prototype.add = function(t) {
                return new e(this.x + t.x, this.y + t.y, this.z + t.z, this.w + t.w)
            }, e.prototype.addInPlace = function(e) {
                return this.x += e.x, this.y += e.y, this.z += e.z, this.w += e.w, this
            }, e.prototype.subtract = function(t) {
                return new e(this.x - t.x, this.y - t.y, this.z - t.z, this.w - t.w)
            }, e.prototype.scale = function(t) {
                return new e(this.x * t, this.y * t, this.z * t, this.w * t)
            }, e.prototype.scaleToRef = function(e, t) {
                return t.x = this.x * e, t.y = this.y * e, t.z = this.z * e, t.w = this.w * e, this
            }, e.prototype.scaleInPlace = function(e) {
                return this.x *= e, this.y *= e, this.z *= e, this.w *= e, this
            }, e.prototype.scaleAndAddToRef = function(e, t) {
                return t.x += this.x * e, t.y += this.y * e, t.z += this.z * e, t.w += this.w * e, this
            }, e.prototype.multiply = function(t) {
                var i = new e(0, 0, 0, 1);
                return this.multiplyToRef(t, i), i
            }, e.prototype.multiplyToRef = function(e, t) {
                var i = this.x * e.w + this.y * e.z - this.z * e.y + this.w * e.x,
                    n = -this.x * e.z + this.y * e.w + this.z * e.x + this.w * e.y,
                    r = this.x * e.y - this.y * e.x + this.z * e.w + this.w * e.z,
                    o = -this.x * e.x - this.y * e.y - this.z * e.z + this.w * e.w;
                return t.copyFromFloats(i, n, r, o), this
            }, e.prototype.multiplyInPlace = function(e) {
                return this.multiplyToRef(e, this), this
            }, e.prototype.conjugateToRef = function(e) {
                return e.copyFromFloats(-this.x, -this.y, -this.z, this.w), this
            }, e.prototype.conjugateInPlace = function() {
                return this.x *= -1, this.y *= -1, this.z *= -1, this
            }, e.prototype.conjugate = function() {
                return new e(-this.x, -this.y, -this.z, this.w)
            }, e.prototype.length = function() {
                return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w)
            }, e.prototype.normalize = function() {
                var e = this.length();
                if (0 === e) return this;
                var t = 1 / e;
                return this.x *= t, this.y *= t, this.z *= t, this.w *= t, this
            }, e.prototype.toEulerAngles = function(e) {
                void 0 === e && (e = "YZX");
                var t = b.Zero();
                return this.toEulerAnglesToRef(t), t
            }, e.prototype.toEulerAnglesToRef = function(e) {
                var t = this.z,
                    i = this.x,
                    n = this.y,
                    r = this.w,
                    o = r * r,
                    s = t * t,
                    a = i * i,
                    u = n * n,
                    h = n * t - i * r;
                return h < -.4999999 ? (e.y = 2 * Math.atan2(n, r), e.x = Math.PI / 2, e.z = 0) : h > .4999999 ? (e.y = 2 * Math.atan2(n, r), e.x = -Math.PI / 2, e.z = 0) : (e.z = Math.atan2(2 * (i * n + t * r), -s - a + u + o), e.x = Math.asin(-2 * (t * n - i * r)), e.y = Math.atan2(2 * (t * i + n * r), s - a - u + o)), this
            }, e.prototype.toRotationMatrix = function(e) {
                return R.FromQuaternionToRef(this, e), this
            }, e.prototype.fromRotationMatrix = function(t) {
                return e.FromRotationMatrixToRef(t, this), this
            }, e.FromRotationMatrix = function(t) {
                var i = new e;
                return e.FromRotationMatrixToRef(t, i), i
            }, e.FromRotationMatrixToRef = function(e, t) {
                var i, n = e.m,
                    r = n[0],
                    o = n[4],
                    s = n[8],
                    a = n[1],
                    u = n[5],
                    h = n[9],
                    l = n[2],
                    c = n[6],
                    d = n[10],
                    f = r + u + d;
                f > 0 ? (i = .5 / Math.sqrt(f + 1), t.w = .25 / i, t.x = (c - h) * i, t.y = (s - l) * i, t.z = (a - o) * i) : r > u && r > d ? (i = 2 * Math.sqrt(1 + r - u - d), t.w = (c - h) / i, t.x = .25 * i, t.y = (o + a) / i, t.z = (s + l) / i) : u > d ? (i = 2 * Math.sqrt(1 + u - r - d), t.w = (s - l) / i, t.x = (o + a) / i, t.y = .25 * i, t.z = (h + c) / i) : (i = 2 * Math.sqrt(1 + d - r - u), t.w = (a - o) / i, t.x = (s + l) / i, t.y = (h + c) / i, t.z = .25 * i)
            }, e.Dot = function(e, t) {
                return e.x * t.x + e.y * t.y + e.z * t.z + e.w * t.w
            }, e.AreClose = function(t, i) {
                return e.Dot(t, i) >= 0
            }, e.Zero = function() {
                return new e(0, 0, 0, 0)
            }, e.Inverse = function(t) {
                return new e(-t.x, -t.y, -t.z, t.w)
            }, e.InverseToRef = function(e, t) {
                return t.set(-e.x, -e.y, -e.z, e.w), t
            }, e.Identity = function() {
                return new e(0, 0, 0, 1)
            }, e.IsIdentity = function(e) {
                return e && 0 === e.x && 0 === e.y && 0 === e.z && 1 === e.w
            }, e.RotationAxis = function(t, i) {
                return e.RotationAxisToRef(t, i, new e)
            }, e.RotationAxisToRef = function(e, t, i) {
                var n = Math.sin(t / 2);
                return e.normalize(), i.w = Math.cos(t / 2), i.x = e.x * n, i.y = e.y * n, i.z = e.z * n, i
            }, e.FromArray = function(t, i) {
                return i || (i = 0), new e(t[i], t[i + 1], t[i + 2], t[i + 3])
            }, e.FromEulerAngles = function(t, i, n) {
                var r = new e;
                return e.RotationYawPitchRollToRef(i, t, n, r), r
            }, e.FromEulerAnglesToRef = function(t, i, n, r) {
                return e.RotationYawPitchRollToRef(i, t, n, r), r
            }, e.FromEulerVector = function(t) {
                var i = new e;
                return e.RotationYawPitchRollToRef(t.y, t.x, t.z, i), i
            }, e.FromEulerVectorToRef = function(t, i) {
                return e.RotationYawPitchRollToRef(t.y, t.x, t.z, i), i
            }, e.RotationYawPitchRoll = function(t, i, n) {
                var r = new e;
                return e.RotationYawPitchRollToRef(t, i, n, r), r
            }, e.RotationYawPitchRollToRef = function(e, t, i, n) {
                var r = .5 * i,
                    o = .5 * t,
                    s = .5 * e,
                    a = Math.sin(r),
                    u = Math.cos(r),
                    h = Math.sin(o),
                    l = Math.cos(o),
                    c = Math.sin(s),
                    d = Math.cos(s);
                n.x = d * h * u + c * l * a, n.y = c * l * u - d * h * a, n.z = d * l * a - c * h * u, n.w = d * l * u + c * h * a
            }, e.RotationAlphaBetaGamma = function(t, i, n) {
                var r = new e;
                return e.RotationAlphaBetaGammaToRef(t, i, n, r), r
            }, e.RotationAlphaBetaGammaToRef = function(e, t, i, n) {
                var r = .5 * (i + e),
                    o = .5 * (i - e),
                    s = .5 * t;
                n.x = Math.cos(o) * Math.sin(s), n.y = Math.sin(o) * Math.sin(s), n.z = Math.sin(r) * Math.cos(s), n.w = Math.cos(r) * Math.cos(s)
            }, e.RotationQuaternionFromAxis = function(t, i, n) {
                var r = new e(0, 0, 0, 0);
                return e.RotationQuaternionFromAxisToRef(t, i, n, r), r
            }, e.RotationQuaternionFromAxisToRef = function(t, i, n, r) {
                var o = U.Matrix[0];
                R.FromXYZAxesToRef(t.normalize(), i.normalize(), n.normalize(), o), e.FromRotationMatrixToRef(o, r)
            }, e.Slerp = function(t, i, n) {
                var r = e.Identity();
                return e.SlerpToRef(t, i, n, r), r
            }, e.SlerpToRef = function(e, t, i, n) {
                var r, o, s = e.x * t.x + e.y * t.y + e.z * t.z + e.w * t.w,
                    a = !1;
                if (s < 0 && (a = !0, s = -s), s > .999999) o = 1 - i, r = a ? -i : i;
                else {
                    var u = Math.acos(s),
                        h = 1 / Math.sin(u);
                    o = Math.sin((1 - i) * u) * h, r = a ? -Math.sin(i * u) * h : Math.sin(i * u) * h
                }
                n.x = o * e.x + r * t.x, n.y = o * e.y + r * t.y, n.z = o * e.z + r * t.z, n.w = o * e.w + r * t.w
            }, e.Hermite = function(t, i, n, r, o) {
                var s = o * o,
                    a = o * s,
                    u = 2 * a - 3 * s + 1,
                    h = -2 * a + 3 * s,
                    l = a - 2 * s + o,
                    c = a - s;
                return new e(t.x * u + n.x * h + i.x * l + r.x * c, t.y * u + n.y * h + i.y * l + r.y * c, t.z * u + n.z * h + i.z * l + r.z * c, t.w * u + n.w * h + i.w * l + r.w * c)
            }, e
        }(),
        R = function() {
            function e() {
                this._isIdentity = !1, this._isIdentityDirty = !0, this._isIdentity3x2 = !0, this._isIdentity3x2Dirty = !0, this.updateFlag = -1, this._m = new Float32Array(16), this._updateIdentityStatus(!1)
            }
            return Object.defineProperty(e.prototype, "m", {
                get: function() {
                    return this._m
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._markAsUpdated = function() {
                this.updateFlag = e._updateFlagSeed++, this._isIdentity = !1, this._isIdentity3x2 = !1, this._isIdentityDirty = !0, this._isIdentity3x2Dirty = !0
            }, e.prototype._updateIdentityStatus = function(t, i, n, r) {
                void 0 === i && (i = !1), void 0 === n && (n = !1), void 0 === r && (r = !0), this.updateFlag = e._updateFlagSeed++, this._isIdentity = t, this._isIdentity3x2 = t || n, this._isIdentityDirty = !this._isIdentity && i, this._isIdentity3x2Dirty = !this._isIdentity3x2 && r
            }, e.prototype.isIdentity = function() {
                if (this._isIdentityDirty) {
                    this._isIdentityDirty = !1;
                    var e = this._m;
                    this._isIdentity = 1 === e[0] && 0 === e[1] && 0 === e[2] && 0 === e[3] && 0 === e[4] && 1 === e[5] && 0 === e[6] && 0 === e[7] && 0 === e[8] && 0 === e[9] && 1 === e[10] && 0 === e[11] && 0 === e[12] && 0 === e[13] && 0 === e[14] && 1 === e[15]
                }
                return this._isIdentity
            }, e.prototype.isIdentityAs3x2 = function() {
                return this._isIdentity3x2Dirty && (this._isIdentity3x2Dirty = !1, 1 !== this._m[0] || 1 !== this._m[5] || 1 !== this._m[15] ? this._isIdentity3x2 = !1 : 0 !== this._m[1] || 0 !== this._m[2] || 0 !== this._m[3] || 0 !== this._m[4] || 0 !== this._m[6] || 0 !== this._m[7] || 0 !== this._m[8] || 0 !== this._m[9] || 0 !== this._m[10] || 0 !== this._m[11] || 0 !== this._m[12] || 0 !== this._m[13] || 0 !== this._m[14] ? this._isIdentity3x2 = !1 : this._isIdentity3x2 = !0), this._isIdentity3x2
            }, e.prototype.determinant = function() {
                if (!0 === this._isIdentity) return 1;
                var e = this._m,
                    t = e[0],
                    i = e[1],
                    n = e[2],
                    r = e[3],
                    o = e[4],
                    s = e[5],
                    a = e[6],
                    u = e[7],
                    h = e[8],
                    l = e[9],
                    c = e[10],
                    d = e[11],
                    f = e[12],
                    p = e[13],
                    _ = e[14],
                    g = e[15],
                    m = c * g - _ * d,
                    v = l * g - p * d,
                    y = l * _ - p * c,
                    T = h * g - f * d,
                    b = h * _ - c * f,
                    E = h * p - f * l;
                return t * +(s * m - a * v + u * y) + i * -(o * m - a * T + u * b) + n * +(o * v - s * T + u * E) + r * -(o * y - s * b + a * E)
            }, e.prototype.toArray = function() {
                return this._m
            }, e.prototype.asArray = function() {
                return this._m
            }, e.prototype.invert = function() {
                return this.invertToRef(this), this
            }, e.prototype.reset = function() {
                return e.FromValuesToRef(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, this), this._updateIdentityStatus(!1), this
            }, e.prototype.add = function(t) {
                var i = new e;
                return this.addToRef(t, i), i
            }, e.prototype.addToRef = function(e, t) {
                for (var i = this._m, n = t._m, r = e.m, o = 0; o < 16; o++) n[o] = i[o] + r[o];
                return t._markAsUpdated(), this
            }, e.prototype.addToSelf = function(e) {
                for (var t = this._m, i = e.m, n = 0; n < 16; n++) t[n] += i[n];
                return this._markAsUpdated(), this
            }, e.prototype.invertToRef = function(t) {
                if (!0 === this._isIdentity) return e.IdentityToRef(t), this;
                var i = this._m,
                    n = i[0],
                    r = i[1],
                    o = i[2],
                    s = i[3],
                    a = i[4],
                    u = i[5],
                    h = i[6],
                    l = i[7],
                    c = i[8],
                    d = i[9],
                    f = i[10],
                    p = i[11],
                    _ = i[12],
                    g = i[13],
                    m = i[14],
                    v = i[15],
                    y = f * v - m * p,
                    T = d * v - g * p,
                    b = d * m - g * f,
                    E = c * v - _ * p,
                    A = c * m - f * _,
                    M = c * g - _ * d,
                    R = +(u * y - h * T + l * b),
                    x = -(a * y - h * E + l * A),
                    P = +(a * T - u * E + l * M),
                    I = -(a * b - u * A + h * M),
                    C = n * R + r * x + o * P + s * I;
                if (0 === C) return t.copyFrom(this), this;
                var S = 1 / C,
                    O = h * v - m * l,
                    D = u * v - g * l,
                    w = u * m - g * h,
                    L = a * v - _ * l,
                    F = a * m - _ * h,
                    N = a * g - _ * u,
                    U = h * p - f * l,
                    B = u * p - d * l,
                    k = u * f - d * h,
                    V = a * p - c * l,
                    G = a * f - c * h,
                    z = a * d - c * u,
                    W = -(r * y - o * T + s * b),
                    X = +(n * y - o * E + s * A),
                    H = -(n * T - r * E + s * M),
                    j = +(n * b - r * A + o * M),
                    Y = +(r * O - o * D + s * w),
                    K = -(n * O - o * L + s * F),
                    q = +(n * D - r * L + s * N),
                    Z = -(n * w - r * F + o * N),
                    Q = -(r * U - o * B + s * k),
                    J = +(n * U - o * V + s * G),
                    $ = -(n * B - r * V + s * z),
                    ee = +(n * k - r * G + o * z);
                return e.FromValuesToRef(R * S, W * S, Y * S, Q * S, x * S, X * S, K * S, J * S, P * S, H * S, q * S, $ * S, I * S, j * S, Z * S, ee * S, t), this
            }, e.prototype.addAtIndex = function(e, t) {
                return this._m[e] += t, this._markAsUpdated(), this
            }, e.prototype.multiplyAtIndex = function(e, t) {
                return this._m[e] *= t, this._markAsUpdated(), this
            }, e.prototype.setTranslationFromFloats = function(e, t, i) {
                return this._m[12] = e, this._m[13] = t, this._m[14] = i, this._markAsUpdated(), this
            }, e.prototype.addTranslationFromFloats = function(e, t, i) {
                return this._m[12] += e, this._m[13] += t, this._m[14] += i, this._markAsUpdated(), this
            }, e.prototype.setTranslation = function(e) {
                return this.setTranslationFromFloats(e.x, e.y, e.z)
            }, e.prototype.getTranslation = function() {
                return new b(this._m[12], this._m[13], this._m[14])
            }, e.prototype.getTranslationToRef = function(e) {
                return e.x = this._m[12], e.y = this._m[13], e.z = this._m[14], this
            }, e.prototype.removeRotationAndScaling = function() {
                var t = this.m;
                return e.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, t[12], t[13], t[14], t[15], this), this._updateIdentityStatus(0 === t[12] && 0 === t[13] && 0 === t[14] && 1 === t[15]), this
            }, e.prototype.multiply = function(t) {
                var i = new e;
                return this.multiplyToRef(t, i), i
            }, e.prototype.copyFrom = function(e) {
                e.copyToArray(this._m);
                var t = e;
                return this._updateIdentityStatus(t._isIdentity, t._isIdentityDirty, t._isIdentity3x2, t._isIdentity3x2Dirty), this
            }, e.prototype.copyToArray = function(e, t) {
                void 0 === t && (t = 0);
                for (var i = 0; i < 16; i++) e[t + i] = this._m[i];
                return this
            }, e.prototype.multiplyToRef = function(e, t) {
                return this._isIdentity ? (t.copyFrom(e), this) : e._isIdentity ? (t.copyFrom(this), this) : (this.multiplyToArray(e, t._m, 0), t._markAsUpdated(), this)
            }, e.prototype.multiplyToArray = function(e, t, i) {
                var n = this._m,
                    r = e.m,
                    o = n[0],
                    s = n[1],
                    a = n[2],
                    u = n[3],
                    h = n[4],
                    l = n[5],
                    c = n[6],
                    d = n[7],
                    f = n[8],
                    p = n[9],
                    _ = n[10],
                    g = n[11],
                    m = n[12],
                    v = n[13],
                    y = n[14],
                    T = n[15],
                    b = r[0],
                    E = r[1],
                    A = r[2],
                    M = r[3],
                    R = r[4],
                    x = r[5],
                    P = r[6],
                    I = r[7],
                    C = r[8],
                    S = r[9],
                    O = r[10],
                    D = r[11],
                    w = r[12],
                    L = r[13],
                    F = r[14],
                    N = r[15];
                return t[i] = o * b + s * R + a * C + u * w, t[i + 1] = o * E + s * x + a * S + u * L, t[i + 2] = o * A + s * P + a * O + u * F, t[i + 3] = o * M + s * I + a * D + u * N, t[i + 4] = h * b + l * R + c * C + d * w, t[i + 5] = h * E + l * x + c * S + d * L, t[i + 6] = h * A + l * P + c * O + d * F, t[i + 7] = h * M + l * I + c * D + d * N, t[i + 8] = f * b + p * R + _ * C + g * w, t[i + 9] = f * E + p * x + _ * S + g * L, t[i + 10] = f * A + p * P + _ * O + g * F, t[i + 11] = f * M + p * I + _ * D + g * N, t[i + 12] = m * b + v * R + y * C + T * w, t[i + 13] = m * E + v * x + y * S + T * L, t[i + 14] = m * A + v * P + y * O + T * F, t[i + 15] = m * M + v * I + y * D + T * N, this
            }, e.prototype.equals = function(e) {
                var t = e;
                if (!t) return !1;
                if ((this._isIdentity || t._isIdentity) && !this._isIdentityDirty && !t._isIdentityDirty) return this._isIdentity && t._isIdentity;
                var i = this.m,
                    n = t.m;
                return i[0] === n[0] && i[1] === n[1] && i[2] === n[2] && i[3] === n[3] && i[4] === n[4] && i[5] === n[5] && i[6] === n[6] && i[7] === n[7] && i[8] === n[8] && i[9] === n[9] && i[10] === n[10] && i[11] === n[11] && i[12] === n[12] && i[13] === n[13] && i[14] === n[14] && i[15] === n[15]
            }, e.prototype.clone = function() {
                var t = new e;
                return t.copyFrom(this), t
            }, e.prototype.getClassName = function() {
                return "Matrix"
            }, e.prototype.getHashCode = function() {
                for (var e = this._m[0] || 0, t = 1; t < 16; t++) e = 397 * e ^ (this._m[t] || 0);
                return e
            }, e.prototype.decompose = function(t, i, n) {
                if (this._isIdentity) return n && n.setAll(0), t && t.setAll(1), i && i.copyFromFloats(0, 0, 0, 1), !0;
                var r = this._m;
                if (n && n.copyFromFloats(r[12], r[13], r[14]), (t = t || U.Vector3[0]).x = Math.sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]), t.y = Math.sqrt(r[4] * r[4] + r[5] * r[5] + r[6] * r[6]), t.z = Math.sqrt(r[8] * r[8] + r[9] * r[9] + r[10] * r[10]), this.determinant() <= 0 && (t.y *= -1), 0 === t.x || 0 === t.y || 0 === t.z) return i && i.copyFromFloats(0, 0, 0, 1), !1;
                if (i) {
                    var o = 1 / t.x,
                        s = 1 / t.y,
                        a = 1 / t.z;
                    e.FromValuesToRef(r[0] * o, r[1] * o, r[2] * o, 0, r[4] * s, r[5] * s, r[6] * s, 0, r[8] * a, r[9] * a, r[10] * a, 0, 0, 0, 0, 1, U.Matrix[0]), M.FromRotationMatrixToRef(U.Matrix[0], i)
                }
                return !0
            }, e.prototype.getRow = function(e) {
                if (e < 0 || e > 3) return null;
                var t = 4 * e;
                return new E(this._m[t + 0], this._m[t + 1], this._m[t + 2], this._m[t + 3])
            }, e.prototype.setRow = function(e, t) {
                return this.setRowFromFloats(e, t.x, t.y, t.z, t.w)
            }, e.prototype.transpose = function() {
                return e.Transpose(this)
            }, e.prototype.transposeToRef = function(t) {
                return e.TransposeToRef(this, t), this
            }, e.prototype.setRowFromFloats = function(e, t, i, n, r) {
                if (e < 0 || e > 3) return this;
                var o = 4 * e;
                return this._m[o + 0] = t, this._m[o + 1] = i, this._m[o + 2] = n, this._m[o + 3] = r, this._markAsUpdated(), this
            }, e.prototype.scale = function(t) {
                var i = new e;
                return this.scaleToRef(t, i), i
            }, e.prototype.scaleToRef = function(e, t) {
                for (var i = 0; i < 16; i++) t._m[i] = this._m[i] * e;
                return t._markAsUpdated(), this
            }, e.prototype.scaleAndAddToRef = function(e, t) {
                for (var i = 0; i < 16; i++) t._m[i] += this._m[i] * e;
                return t._markAsUpdated(), this
            }, e.prototype.toNormalMatrix = function(t) {
                var i = U.Matrix[0];
                this.invertToRef(i), i.transposeToRef(t);
                var n = t._m;
                e.FromValuesToRef(n[0], n[1], n[2], 0, n[4], n[5], n[6], 0, n[8], n[9], n[10], 0, 0, 0, 0, 1, t)
            }, e.prototype.getRotationMatrix = function() {
                var t = new e;
                return this.getRotationMatrixToRef(t), t
            }, e.prototype.getRotationMatrixToRef = function(t) {
                var i = U.Vector3[0];
                if (!this.decompose(i)) return e.IdentityToRef(t), this;
                var n = this._m,
                    r = 1 / i.x,
                    o = 1 / i.y,
                    s = 1 / i.z;
                return e.FromValuesToRef(n[0] * r, n[1] * r, n[2] * r, 0, n[4] * o, n[5] * o, n[6] * o, 0, n[8] * s, n[9] * s, n[10] * s, 0, 0, 0, 0, 1, t), this
            }, e.prototype.toggleModelMatrixHandInPlace = function() {
                var e = this._m;
                e[2] *= -1, e[6] *= -1, e[8] *= -1, e[9] *= -1, e[14] *= -1, this._markAsUpdated()
            }, e.prototype.toggleProjectionMatrixHandInPlace = function() {
                var e = this._m;
                e[8] *= -1, e[9] *= -1, e[10] *= -1, e[11] *= -1, this._markAsUpdated()
            }, e.FromArray = function(t, i) {
                void 0 === i && (i = 0);
                var n = new e;
                return e.FromArrayToRef(t, i, n), n
            }, e.FromArrayToRef = function(e, t, i) {
                for (var n = 0; n < 16; n++) i._m[n] = e[n + t];
                i._markAsUpdated()
            }, e.FromFloat32ArrayToRefScaled = function(e, t, i, n) {
                for (var r = 0; r < 16; r++) n._m[r] = e[r + t] * i;
                n._markAsUpdated()
            }, Object.defineProperty(e, "IdentityReadOnly", {
                get: function() {
                    return e._identityReadOnly
                },
                enumerable: !0,
                configurable: !0
            }), e.FromValuesToRef = function(e, t, i, n, r, o, s, a, u, h, l, c, d, f, p, _, g) {
                var m = g._m;
                m[0] = e, m[1] = t, m[2] = i, m[3] = n, m[4] = r, m[5] = o, m[6] = s, m[7] = a, m[8] = u, m[9] = h, m[10] = l, m[11] = c, m[12] = d, m[13] = f, m[14] = p, m[15] = _, g._markAsUpdated()
            }, e.FromValues = function(t, i, n, r, o, s, a, u, h, l, c, d, f, p, _, g) {
                var m = new e,
                    v = m._m;
                return v[0] = t, v[1] = i, v[2] = n, v[3] = r, v[4] = o, v[5] = s, v[6] = a, v[7] = u, v[8] = h, v[9] = l, v[10] = c, v[11] = d, v[12] = f, v[13] = p, v[14] = _, v[15] = g, m._markAsUpdated(), m
            }, e.Compose = function(t, i, n) {
                var r = new e;
                return e.ComposeToRef(t, i, n, r), r
            }, e.ComposeToRef = function(e, t, i, n) {
                var r = n._m,
                    o = t.x,
                    s = t.y,
                    a = t.z,
                    u = t.w,
                    h = o + o,
                    l = s + s,
                    c = a + a,
                    d = o * h,
                    f = o * l,
                    p = o * c,
                    _ = s * l,
                    g = s * c,
                    m = a * c,
                    v = u * h,
                    y = u * l,
                    T = u * c,
                    b = e.x,
                    E = e.y,
                    A = e.z;
                r[0] = (1 - (_ + m)) * b, r[1] = (f + T) * b, r[2] = (p - y) * b, r[3] = 0, r[4] = (f - T) * E, r[5] = (1 - (d + m)) * E, r[6] = (g + v) * E, r[7] = 0, r[8] = (p + y) * A, r[9] = (g - v) * A, r[10] = (1 - (d + _)) * A, r[11] = 0, r[12] = i.x, r[13] = i.y, r[14] = i.z, r[15] = 1, n._markAsUpdated()
            }, e.Identity = function() {
                var t = e.FromValues(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
                return t._updateIdentityStatus(!0), t
            }, e.IdentityToRef = function(t) {
                e.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, t), t._updateIdentityStatus(!0)
            }, e.Zero = function() {
                var t = e.FromValues(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
                return t._updateIdentityStatus(!1), t
            }, e.RotationX = function(t) {
                var i = new e;
                return e.RotationXToRef(t, i), i
            }, e.Invert = function(t) {
                var i = new e;
                return t.invertToRef(i), i
            }, e.RotationXToRef = function(t, i) {
                var n = Math.sin(t),
                    r = Math.cos(t);
                e.FromValuesToRef(1, 0, 0, 0, 0, r, n, 0, 0, -n, r, 0, 0, 0, 0, 1, i), i._updateIdentityStatus(1 === r && 0 === n)
            }, e.RotationY = function(t) {
                var i = new e;
                return e.RotationYToRef(t, i), i
            }, e.RotationYToRef = function(t, i) {
                var n = Math.sin(t),
                    r = Math.cos(t);
                e.FromValuesToRef(r, 0, -n, 0, 0, 1, 0, 0, n, 0, r, 0, 0, 0, 0, 1, i), i._updateIdentityStatus(1 === r && 0 === n)
            }, e.RotationZ = function(t) {
                var i = new e;
                return e.RotationZToRef(t, i), i
            }, e.RotationZToRef = function(t, i) {
                var n = Math.sin(t),
                    r = Math.cos(t);
                e.FromValuesToRef(r, n, 0, 0, -n, r, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, i), i._updateIdentityStatus(1 === r && 0 === n)
            }, e.RotationAxis = function(t, i) {
                var n = new e;
                return e.RotationAxisToRef(t, i, n), n
            }, e.RotationAxisToRef = function(e, t, i) {
                var n = Math.sin(-t),
                    r = Math.cos(-t),
                    o = 1 - r;
                e.normalize();
                var s = i._m;
                s[0] = e.x * e.x * o + r, s[1] = e.x * e.y * o - e.z * n, s[2] = e.x * e.z * o + e.y * n, s[3] = 0, s[4] = e.y * e.x * o + e.z * n, s[5] = e.y * e.y * o + r, s[6] = e.y * e.z * o - e.x * n, s[7] = 0, s[8] = e.z * e.x * o - e.y * n, s[9] = e.z * e.y * o + e.x * n, s[10] = e.z * e.z * o + r, s[11] = 0, s[12] = 0, s[13] = 0, s[14] = 0, s[15] = 1, i._markAsUpdated()
            }, e.RotationAlignToRef = function(e, t, i) {
                var n = b.Cross(t, e),
                    r = b.Dot(t, e),
                    o = 1 / (1 + r),
                    s = i._m;
                s[0] = n.x * n.x * o + r, s[1] = n.y * n.x * o - n.z, s[2] = n.z * n.x * o + n.y, s[3] = 0, s[4] = n.x * n.y * o + n.z, s[5] = n.y * n.y * o + r, s[6] = n.z * n.y * o - n.x, s[7] = 0, s[8] = n.x * n.z * o - n.y, s[9] = n.y * n.z * o + n.x, s[10] = n.z * n.z * o + r, s[11] = 0, s[12] = 0, s[13] = 0, s[14] = 0, s[15] = 1, i._markAsUpdated()
            }, e.RotationYawPitchRoll = function(t, i, n) {
                var r = new e;
                return e.RotationYawPitchRollToRef(t, i, n, r), r
            }, e.RotationYawPitchRollToRef = function(e, t, i, n) {
                M.RotationYawPitchRollToRef(e, t, i, U.Quaternion[0]), U.Quaternion[0].toRotationMatrix(n)
            }, e.Scaling = function(t, i, n) {
                var r = new e;
                return e.ScalingToRef(t, i, n, r), r
            }, e.ScalingToRef = function(t, i, n, r) {
                e.FromValuesToRef(t, 0, 0, 0, 0, i, 0, 0, 0, 0, n, 0, 0, 0, 0, 1, r), r._updateIdentityStatus(1 === t && 1 === i && 1 === n)
            }, e.Translation = function(t, i, n) {
                var r = new e;
                return e.TranslationToRef(t, i, n, r), r
            }, e.TranslationToRef = function(t, i, n, r) {
                e.FromValuesToRef(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, t, i, n, 1, r), r._updateIdentityStatus(0 === t && 0 === i && 0 === n)
            }, e.Lerp = function(t, i, n) {
                var r = new e;
                return e.LerpToRef(t, i, n, r), r
            }, e.LerpToRef = function(e, t, i, n) {
                for (var r = n._m, o = e.m, s = t.m, a = 0; a < 16; a++) r[a] = o[a] * (1 - i) + s[a] * i;
                n._markAsUpdated()
            }, e.DecomposeLerp = function(t, i, n) {
                var r = new e;
                return e.DecomposeLerpToRef(t, i, n, r), r
            }, e.DecomposeLerpToRef = function(t, i, n, r) {
                var o = U.Vector3[0],
                    s = U.Quaternion[0],
                    a = U.Vector3[1];
                t.decompose(o, s, a);
                var u = U.Vector3[2],
                    h = U.Quaternion[1],
                    l = U.Vector3[3];
                i.decompose(u, h, l);
                var c = U.Vector3[4];
                b.LerpToRef(o, u, n, c);
                var d = U.Quaternion[2];
                M.SlerpToRef(s, h, n, d);
                var f = U.Vector3[5];
                b.LerpToRef(a, l, n, f), e.ComposeToRef(c, d, f, r)
            }, e.LookAtLH = function(t, i, n) {
                var r = new e;
                return e.LookAtLHToRef(t, i, n, r), r
            }, e.LookAtLHToRef = function(t, i, n, r) {
                var o = U.Vector3[0],
                    s = U.Vector3[1],
                    a = U.Vector3[2];
                i.subtractToRef(t, a), a.normalize(), b.CrossToRef(n, a, o);
                var u = o.lengthSquared();
                0 === u ? o.x = 1 : o.normalizeFromLength(Math.sqrt(u)), b.CrossToRef(a, o, s), s.normalize();
                var h = -b.Dot(o, t),
                    l = -b.Dot(s, t),
                    c = -b.Dot(a, t);
                e.FromValuesToRef(o.x, s.x, a.x, 0, o.y, s.y, a.y, 0, o.z, s.z, a.z, 0, h, l, c, 1, r)
            }, e.LookAtRH = function(t, i, n) {
                var r = new e;
                return e.LookAtRHToRef(t, i, n, r), r
            }, e.LookAtRHToRef = function(t, i, n, r) {
                var o = U.Vector3[0],
                    s = U.Vector3[1],
                    a = U.Vector3[2];
                t.subtractToRef(i, a), a.normalize(), b.CrossToRef(n, a, o);
                var u = o.lengthSquared();
                0 === u ? o.x = 1 : o.normalizeFromLength(Math.sqrt(u)), b.CrossToRef(a, o, s), s.normalize();
                var h = -b.Dot(o, t),
                    l = -b.Dot(s, t),
                    c = -b.Dot(a, t);
                e.FromValuesToRef(o.x, s.x, a.x, 0, o.y, s.y, a.y, 0, o.z, s.z, a.z, 0, h, l, c, 1, r)
            }, e.OrthoLH = function(t, i, n, r) {
                var o = new e;
                return e.OrthoLHToRef(t, i, n, r, o), o
            }, e.OrthoLHToRef = function(t, i, n, r, o) {
                var s = 2 / t,
                    a = 2 / i,
                    u = 2 / (r - n),
                    h = -(r + n) / (r - n);
                e.FromValuesToRef(s, 0, 0, 0, 0, a, 0, 0, 0, 0, u, 0, 0, 0, h, 1, o), o._updateIdentityStatus(1 === s && 1 === a && 1 === u && 0 === h)
            }, e.OrthoOffCenterLH = function(t, i, n, r, o, s) {
                var a = new e;
                return e.OrthoOffCenterLHToRef(t, i, n, r, o, s, a), a
            }, e.OrthoOffCenterLHToRef = function(t, i, n, r, o, s, a) {
                var u = 2 / (i - t),
                    h = 2 / (r - n),
                    l = 2 / (s - o),
                    c = -(s + o) / (s - o),
                    d = (t + i) / (t - i),
                    f = (r + n) / (n - r);
                e.FromValuesToRef(u, 0, 0, 0, 0, h, 0, 0, 0, 0, l, 0, d, f, c, 1, a), a._markAsUpdated()
            }, e.OrthoOffCenterRH = function(t, i, n, r, o, s) {
                var a = new e;
                return e.OrthoOffCenterRHToRef(t, i, n, r, o, s, a), a
            }, e.OrthoOffCenterRHToRef = function(t, i, n, r, o, s, a) {
                e.OrthoOffCenterLHToRef(t, i, n, r, o, s, a), a._m[10] *= -1
            }, e.PerspectiveLH = function(t, i, n, r) {
                var o = new e,
                    s = 2 * n / t,
                    a = 2 * n / i,
                    u = (r + n) / (r - n),
                    h = -2 * r * n / (r - n);
                return e.FromValuesToRef(s, 0, 0, 0, 0, a, 0, 0, 0, 0, u, 1, 0, 0, h, 0, o), o._updateIdentityStatus(!1), o
            }, e.PerspectiveFovLH = function(t, i, n, r) {
                var o = new e;
                return e.PerspectiveFovLHToRef(t, i, n, r, o), o
            }, e.PerspectiveFovLHToRef = function(t, i, n, r, o, s) {
                void 0 === s && (s = !0);
                var a = n,
                    u = r,
                    h = 1 / Math.tan(.5 * t),
                    l = s ? h / i : h,
                    c = s ? h : h * i,
                    d = (u + a) / (u - a),
                    f = -2 * u * a / (u - a);
                e.FromValuesToRef(l, 0, 0, 0, 0, c, 0, 0, 0, 0, d, 1, 0, 0, f, 0, o), o._updateIdentityStatus(!1)
            }, e.PerspectiveFovRH = function(t, i, n, r) {
                var o = new e;
                return e.PerspectiveFovRHToRef(t, i, n, r, o), o
            }, e.PerspectiveFovRHToRef = function(t, i, n, r, o, s) {
                void 0 === s && (s = !0);
                var a = n,
                    u = r,
                    h = 1 / Math.tan(.5 * t),
                    l = s ? h / i : h,
                    c = s ? h : h * i,
                    d = -(u + a) / (u - a),
                    f = -2 * u * a / (u - a);
                e.FromValuesToRef(l, 0, 0, 0, 0, c, 0, 0, 0, 0, d, -1, 0, 0, f, 0, o), o._updateIdentityStatus(!1)
            }, e.PerspectiveFovWebVRToRef = function(e, t, i, n, r) {
                void 0 === r && (r = !1);
                var o = r ? -1 : 1,
                    s = Math.tan(e.upDegrees * Math.PI / 180),
                    a = Math.tan(e.downDegrees * Math.PI / 180),
                    u = Math.tan(e.leftDegrees * Math.PI / 180),
                    h = Math.tan(e.rightDegrees * Math.PI / 180),
                    l = 2 / (u + h),
                    c = 2 / (s + a),
                    d = n._m;
                d[0] = l, d[1] = d[2] = d[3] = d[4] = 0, d[5] = c, d[6] = d[7] = 0, d[8] = (u - h) * l * .5, d[9] = -(s - a) * c * .5, d[10] = -i / (t - i), d[11] = 1 * o, d[12] = d[13] = d[15] = 0, d[14] = -2 * i * t / (i - t), n._markAsUpdated()
            }, e.GetFinalMatrix = function(t, i, n, r, o, s) {
                var a = t.width,
                    u = t.height,
                    h = t.x,
                    l = t.y,
                    c = e.FromValues(a / 2, 0, 0, 0, 0, -u / 2, 0, 0, 0, 0, s - o, 0, h + a / 2, u / 2 + l, o, 1),
                    d = U.Matrix[0];
                return i.multiplyToRef(n, d), d.multiplyToRef(r, d), d.multiply(c)
            }, e.GetAsMatrix2x2 = function(e) {
                var t = e.m;
                return new Float32Array([t[0], t[1], t[4], t[5]])
            }, e.GetAsMatrix3x3 = function(e) {
                var t = e.m;
                return new Float32Array([t[0], t[1], t[2], t[4], t[5], t[6], t[8], t[9], t[10]])
            }, e.Transpose = function(t) {
                var i = new e;
                return e.TransposeToRef(t, i), i
            }, e.TransposeToRef = function(e, t) {
                var i = t._m,
                    n = e.m;
                i[0] = n[0], i[1] = n[4], i[2] = n[8], i[3] = n[12], i[4] = n[1], i[5] = n[5], i[6] = n[9], i[7] = n[13], i[8] = n[2], i[9] = n[6], i[10] = n[10], i[11] = n[14], i[12] = n[3], i[13] = n[7], i[14] = n[11], i[15] = n[15], t._updateIdentityStatus(e._isIdentity, e._isIdentityDirty)
            }, e.Reflection = function(t) {
                var i = new e;
                return e.ReflectionToRef(t, i), i
            }, e.ReflectionToRef = function(t, i) {
                t.normalize();
                var n = t.normal.x,
                    r = t.normal.y,
                    o = t.normal.z,
                    s = -2 * n,
                    a = -2 * r,
                    u = -2 * o;
                e.FromValuesToRef(s * n + 1, a * n, u * n, 0, s * r, a * r + 1, u * r, 0, s * o, a * o, u * o + 1, 0, s * t.d, a * t.d, u * t.d, 1, i)
            }, e.FromXYZAxesToRef = function(t, i, n, r) {
                e.FromValuesToRef(t.x, t.y, t.z, 0, i.x, i.y, i.z, 0, n.x, n.y, n.z, 0, 0, 0, 0, 1, r)
            }, e.FromQuaternionToRef = function(e, t) {
                var i = e.x * e.x,
                    n = e.y * e.y,
                    r = e.z * e.z,
                    o = e.x * e.y,
                    s = e.z * e.w,
                    a = e.z * e.x,
                    u = e.y * e.w,
                    h = e.y * e.z,
                    l = e.x * e.w;
                t._m[0] = 1 - 2 * (n + r), t._m[1] = 2 * (o + s), t._m[2] = 2 * (a - u), t._m[3] = 0, t._m[4] = 2 * (o - s), t._m[5] = 1 - 2 * (r + i), t._m[6] = 2 * (h + l), t._m[7] = 0, t._m[8] = 2 * (a + u), t._m[9] = 2 * (h - l), t._m[10] = 1 - 2 * (n + i), t._m[11] = 0, t._m[12] = 0, t._m[13] = 0, t._m[14] = 0, t._m[15] = 1, t._markAsUpdated()
            }, e._updateFlagSeed = 0, e._identityReadOnly = e.Identity(), e
        }(),
        x = function() {
            function e(e, t, i, n) {
                this.normal = new b(e, t, i), this.d = n
            }
            return e.prototype.asArray = function() {
                return [this.normal.x, this.normal.y, this.normal.z, this.d]
            }, e.prototype.clone = function() {
                return new e(this.normal.x, this.normal.y, this.normal.z, this.d)
            }, e.prototype.getClassName = function() {
                return "Plane"
            }, e.prototype.getHashCode = function() {
                var e = this.normal.getHashCode();
                return e = 397 * e ^ (this.d || 0)
            }, e.prototype.normalize = function() {
                var e = Math.sqrt(this.normal.x * this.normal.x + this.normal.y * this.normal.y + this.normal.z * this.normal.z),
                    t = 0;
                return 0 !== e && (t = 1 / e), this.normal.x *= t, this.normal.y *= t, this.normal.z *= t, this.d *= t, this
            }, e.prototype.transform = function(t) {
                var i = U.Matrix[0];
                R.TransposeToRef(t, i);
                var n = i.m,
                    r = this.normal.x,
                    o = this.normal.y,
                    s = this.normal.z,
                    a = this.d;
                return new e(r * n[0] + o * n[1] + s * n[2] + a * n[3], r * n[4] + o * n[5] + s * n[6] + a * n[7], r * n[8] + o * n[9] + s * n[10] + a * n[11], r * n[12] + o * n[13] + s * n[14] + a * n[15])
            }, e.prototype.dotCoordinate = function(e) {
                return this.normal.x * e.x + this.normal.y * e.y + this.normal.z * e.z + this.d
            }, e.prototype.copyFromPoints = function(e, t, i) {
                var n, r = t.x - e.x,
                    o = t.y - e.y,
                    s = t.z - e.z,
                    a = i.x - e.x,
                    u = i.y - e.y,
                    h = i.z - e.z,
                    l = o * h - s * u,
                    c = s * a - r * h,
                    d = r * u - o * a,
                    f = Math.sqrt(l * l + c * c + d * d);
                return n = 0 !== f ? 1 / f : 0, this.normal.x = l * n, this.normal.y = c * n, this.normal.z = d * n, this.d = -(this.normal.x * e.x + this.normal.y * e.y + this.normal.z * e.z), this
            }, e.prototype.isFrontFacingTo = function(e, t) {
                return b.Dot(this.normal, e) <= t
            }, e.prototype.signedDistanceTo = function(e) {
                return b.Dot(e, this.normal) + this.d
            }, e.FromArray = function(t) {
                return new e(t[0], t[1], t[2], t[3])
            }, e.FromPoints = function(t, i, n) {
                var r = new e(0, 0, 0, 0);
                return r.copyFromPoints(t, i, n), r
            }, e.FromPositionAndNormal = function(t, i) {
                var n = new e(0, 0, 0, 0);
                return i.normalize(), n.normal = i, n.d = -(i.x * t.x + i.y * t.y + i.z * t.z), n
            }, e.SignedDistanceToPlaneFromPositionAndNormal = function(e, t, i) {
                var n = -(t.x * e.x + t.y * e.y + t.z * e.z);
                return b.Dot(i, t) + n
            }, e
        }(),
        P = function() {
            function e(e, t, i, n) {
                this.x = e, this.y = t, this.width = i, this.height = n
            }
            return e.prototype.toGlobal = function(t, i) {
                return new e(this.x * t, this.y * i, this.width * t, this.height * i)
            }, e.prototype.toGlobalToRef = function(e, t, i) {
                return i.x = this.x * e, i.y = this.y * t, i.width = this.width * e, i.height = this.height * t, this
            }, e.prototype.clone = function() {
                return new e(this.x, this.y, this.width, this.height)
            }, e
        }(),
        I = function() {
            function e() {}
            return e.GetPlanes = function(t) {
                for (var i = [], n = 0; n < 6; n++) i.push(new x(0, 0, 0, 0));
                return e.GetPlanesToRef(t, i), i
            }, e.GetNearPlaneToRef = function(e, t) {
                var i = e.m;
                t.normal.x = i[3] + i[2], t.normal.y = i[7] + i[6], t.normal.z = i[11] + i[10], t.d = i[15] + i[14], t.normalize()
            }, e.GetFarPlaneToRef = function(e, t) {
                var i = e.m;
                t.normal.x = i[3] - i[2], t.normal.y = i[7] - i[6], t.normal.z = i[11] - i[10], t.d = i[15] - i[14], t.normalize()
            }, e.GetLeftPlaneToRef = function(e, t) {
                var i = e.m;
                t.normal.x = i[3] + i[0], t.normal.y = i[7] + i[4], t.normal.z = i[11] + i[8], t.d = i[15] + i[12], t.normalize()
            }, e.GetRightPlaneToRef = function(e, t) {
                var i = e.m;
                t.normal.x = i[3] - i[0], t.normal.y = i[7] - i[4], t.normal.z = i[11] - i[8], t.d = i[15] - i[12], t.normalize()
            }, e.GetTopPlaneToRef = function(e, t) {
                var i = e.m;
                t.normal.x = i[3] - i[1], t.normal.y = i[7] - i[5], t.normal.z = i[11] - i[9], t.d = i[15] - i[13], t.normalize()
            }, e.GetBottomPlaneToRef = function(e, t) {
                var i = e.m;
                t.normal.x = i[3] + i[1], t.normal.y = i[7] + i[5], t.normal.z = i[11] + i[9], t.d = i[15] + i[13], t.normalize()
            }, e.GetPlanesToRef = function(t, i) {
                e.GetNearPlaneToRef(t, i[0]), e.GetFarPlaneToRef(t, i[1]), e.GetLeftPlaneToRef(t, i[2]), e.GetRightPlaneToRef(t, i[3]), e.GetTopPlaneToRef(t, i[4]), e.GetBottomPlaneToRef(t, i[5])
            }, e
        }();
    ! function(e) {
        e[e.LOCAL = 0] = "LOCAL", e[e.WORLD = 1] = "WORLD", e[e.BONE = 2] = "BONE"
    }(a || (a = {}));
    var C, S = function() {
            function e() {}
            return e.X = new b(1, 0, 0), e.Y = new b(0, 1, 0), e.Z = new b(0, 0, 1), e
        }(),
        O = function() {
            function e() {}
            return e.Interpolate = function(e, t, i, n, r) {
                for (var o = 1 - 3 * n + 3 * t, s = 3 * n - 6 * t, a = 3 * t, u = e, h = 0; h < 5; h++) {
                    var l = u * u;
                    u -= (o * (l * u) + s * l + a * u - e) * (1 / (3 * o * l + 2 * s * u + a)), u = Math.min(1, Math.max(0, u))
                }
                return 3 * Math.pow(1 - u, 2) * u * i + 3 * (1 - u) * Math.pow(u, 2) * r + Math.pow(u, 3)
            }, e
        }();
    ! function(e) {
        e[e.CW = 0] = "CW", e[e.CCW = 1] = "CCW"
    }(C || (C = {}));
    var D = function() {
            function e(e) {
                this._radians = e, this._radians < 0 && (this._radians += 2 * Math.PI)
            }
            return e.prototype.degrees = function() {
                return 180 * this._radians / Math.PI
            }, e.prototype.radians = function() {
                return this._radians
            }, e.BetweenTwoPoints = function(t, i) {
                var n = i.subtract(t);
                return new e(Math.atan2(n.y, n.x))
            }, e.FromRadians = function(t) {
                return new e(t)
            }, e.FromDegrees = function(t) {
                return new e(t * Math.PI / 180)
            }, e
        }(),
        w = function(e, t, i) {
            this.startPoint = e, this.midPoint = t, this.endPoint = i;
            var n = Math.pow(t.x, 2) + Math.pow(t.y, 2),
                r = (Math.pow(e.x, 2) + Math.pow(e.y, 2) - n) / 2,
                o = (n - Math.pow(i.x, 2) - Math.pow(i.y, 2)) / 2,
                s = (e.x - t.x) * (t.y - i.y) - (t.x - i.x) * (e.y - t.y);
            this.centerPoint = new T((r * (t.y - i.y) - o * (e.y - t.y)) / s, ((e.x - t.x) * o - (t.x - i.x) * r) / s), this.radius = this.centerPoint.subtract(this.startPoint).length(), this.startAngle = D.BetweenTwoPoints(this.centerPoint, this.startPoint);
            var a = this.startAngle.degrees(),
                u = D.BetweenTwoPoints(this.centerPoint, this.midPoint).degrees(),
                h = D.BetweenTwoPoints(this.centerPoint, this.endPoint).degrees();
            u - a > 180 && (u -= 360), u - a < -180 && (u += 360), h - u > 180 && (h -= 360), h - u < -180 && (h += 360), this.orientation = u - a < 0 ? C.CW : C.CCW, this.angle = D.FromDegrees(this.orientation === C.CW ? a - h : h - a)
        },
        L = function() {
            function e(e, t) {
                this._points = new Array, this._length = 0, this.closed = !1, this._points.push(new T(e, t))
            }
            return e.prototype.addLineTo = function(e, t) {
                if (this.closed) return this;
                var i = new T(e, t),
                    n = this._points[this._points.length - 1];
                return this._points.push(i), this._length += i.subtract(n).length(), this
            }, e.prototype.addArcTo = function(e, t, i, n, r) {
                if (void 0 === r && (r = 36), this.closed) return this;
                var o = this._points[this._points.length - 1],
                    s = new T(e, t),
                    a = new T(i, n),
                    u = new w(o, s, a),
                    h = u.angle.radians() / r;
                u.orientation === C.CW && (h *= -1);
                for (var l = u.startAngle.radians() + h, c = 0; c < r; c++) {
                    var d = Math.cos(l) * u.radius + u.centerPoint.x,
                        f = Math.sin(l) * u.radius + u.centerPoint.y;
                    this.addLineTo(d, f), l += h
                }
                return this
            }, e.prototype.close = function() {
                return this.closed = !0, this
            }, e.prototype.length = function() {
                var e = this._length;
                if (!this.closed) {
                    var t = this._points[this._points.length - 1];
                    e += this._points[0].subtract(t).length()
                }
                return e
            }, e.prototype.getPoints = function() {
                return this._points
            }, e.prototype.getPointAtLengthPosition = function(e) {
                if (e < 0 || e > 1) return T.Zero();
                for (var t = e * this.length(), i = 0, n = 0; n < this._points.length; n++) {
                    var r = (n + 1) % this._points.length,
                        o = this._points[n],
                        s = this._points[r].subtract(o),
                        a = s.length() + i;
                    if (t >= i && t <= a) {
                        var u = s.normalize(),
                            h = t - i;
                        return new T(o.x + u.x * h, o.y + u.y * h)
                    }
                    i = a
                }
                return T.Zero()
            }, e.StartingAt = function(t, i) {
                return new e(t, i)
            }, e
        }(),
        F = function() {
            function e(e, t, i) {
                void 0 === t && (t = null), this.path = e, this._curve = new Array, this._distances = new Array, this._tangents = new Array, this._normals = new Array, this._binormals = new Array;
                for (var n = 0; n < e.length; n++) this._curve[n] = e[n].clone();
                this._raw = i || !1, this._compute(t)
            }
            return e.prototype.getCurve = function() {
                return this._curve
            }, e.prototype.getTangents = function() {
                return this._tangents
            }, e.prototype.getNormals = function() {
                return this._normals
            }, e.prototype.getBinormals = function() {
                return this._binormals
            }, e.prototype.getDistances = function() {
                return this._distances
            }, e.prototype.update = function(e, t) {
                void 0 === t && (t = null);
                for (var i = 0; i < e.length; i++) this._curve[i].x = e[i].x, this._curve[i].y = e[i].y, this._curve[i].z = e[i].z;
                return this._compute(t), this
            }, e.prototype._compute = function(e) {
                var t = this._curve.length;
                this._tangents[0] = this._getFirstNonNullVector(0), this._raw || this._tangents[0].normalize(), this._tangents[t - 1] = this._curve[t - 1].subtract(this._curve[t - 2]), this._raw || this._tangents[t - 1].normalize();
                var i, n, r, o, s = this._tangents[0],
                    a = this._normalVector(s, e);
                this._normals[0] = a, this._raw || this._normals[0].normalize(), this._binormals[0] = b.Cross(s, this._normals[0]), this._raw || this._binormals[0].normalize(), this._distances[0] = 0;
                for (var u = 1; u < t; u++) i = this._getLastNonNullVector(u), u < t - 1 && (n = this._getFirstNonNullVector(u), this._tangents[u] = i.add(n), this._tangents[u].normalize()), this._distances[u] = this._distances[u - 1] + i.length(), r = this._tangents[u], o = this._binormals[u - 1], this._normals[u] = b.Cross(o, r), this._raw || this._normals[u].normalize(), this._binormals[u] = b.Cross(r, this._normals[u]), this._raw || this._binormals[u].normalize()
            }, e.prototype._getFirstNonNullVector = function(e) {
                for (var t = 1, i = this._curve[e + t].subtract(this._curve[e]); 0 === i.length() && e + t + 1 < this._curve.length;) t++, i = this._curve[e + t].subtract(this._curve[e]);
                return i
            }, e.prototype._getLastNonNullVector = function(e) {
                for (var t = 1, i = this._curve[e].subtract(this._curve[e - t]); 0 === i.length() && e > t + 1;) t++, i = this._curve[e].subtract(this._curve[e - t]);
                return i
            }, e.prototype._normalVector = function(e, t) {
                var i, n, r = e.length();
                (0 === r && (r = 1), null == t) ? (n = m.WithinEpsilon(Math.abs(e.y) / r, 1, .001) ? m.WithinEpsilon(Math.abs(e.x) / r, 1, .001) ? m.WithinEpsilon(Math.abs(e.z) / r, 1, .001) ? b.Zero() : new b(0, 0, 1) : new b(1, 0, 0) : new b(0, -1, 0), i = b.Cross(e, n)) : (i = b.Cross(e, t), b.CrossToRef(i, e, i));
                return i.normalize(), i
            }, e
        }(),
        N = (function() {
            function e(e) {
                this._length = 0, this._points = e, this._length = this._computeLength(e)
            }
            e.CreateQuadraticBezier = function(t, i, n, r) {
                r = r > 2 ? r : 3;
                for (var o = new Array, s = function(e, t, i, n) {
                        return (1 - e) * (1 - e) * t + 2 * e * (1 - e) * i + e * e * n
                    }, a = 0; a <= r; a++) o.push(new b(s(a / r, t.x, i.x, n.x), s(a / r, t.y, i.y, n.y), s(a / r, t.z, i.z, n.z)));
                return new e(o)
            }, e.CreateCubicBezier = function(t, i, n, r, o) {
                o = o > 3 ? o : 4;
                for (var s = new Array, a = function(e, t, i, n, r) {
                        return (1 - e) * (1 - e) * (1 - e) * t + 3 * e * (1 - e) * (1 - e) * i + 3 * e * e * (1 - e) * n + e * e * e * r
                    }, u = 0; u <= o; u++) s.push(new b(a(u / o, t.x, i.x, n.x, r.x), a(u / o, t.y, i.y, n.y, r.y), a(u / o, t.z, i.z, n.z, r.z)));
                return new e(s)
            }, e.CreateHermiteSpline = function(t, i, n, r, o) {
                for (var s = new Array, a = 1 / o, u = 0; u <= o; u++) s.push(b.Hermite(t, i, n, r, u * a));
                return new e(s)
            }, e.CreateCatmullRomSpline = function(t, i, n) {
                var r = new Array,
                    o = 1 / i,
                    s = 0;
                if (n) {
                    for (var a = t.length, u = 0; u < a; u++) {
                        s = 0;
                        for (var h = 0; h < i; h++) r.push(b.CatmullRom(t[u % a], t[(u + 1) % a], t[(u + 2) % a], t[(u + 3) % a], s)), s += o
                    }
                    r.push(r[0])
                } else {
                    var l = new Array;
                    l.push(t[0].clone()), Array.prototype.push.apply(l, t), l.push(t[t.length - 1].clone());
                    for (u = 0; u < l.length - 3; u++) {
                        s = 0;
                        for (h = 0; h < i; h++) r.push(b.CatmullRom(l[u], l[u + 1], l[u + 2], l[u + 3], s)), s += o
                    }
                    u--, r.push(b.CatmullRom(l[u], l[u + 1], l[u + 2], l[u + 3], s))
                }
                return new e(r)
            }, e.prototype.getPoints = function() {
                return this._points
            }, e.prototype.length = function() {
                return this._length
            }, e.prototype.continue = function(t) {
                for (var i = this._points[this._points.length - 1], n = this._points.slice(), r = t.getPoints(), o = 1; o < r.length; o++) n.push(r[o].subtract(r[0]).add(i));
                return new e(n)
            }, e.prototype._computeLength = function(e) {
                for (var t = 0, i = 1; i < e.length; i++) t += e[i].subtract(e[i - 1]).length();
                return t
            }
        }(), function() {
            function e(e, t) {
                void 0 === e && (e = b.Zero()), void 0 === t && (t = b.Up()), this.position = e, this.normal = t
            }
            e.prototype.clone = function() {
                return new e(this.position.clone(), this.normal.clone())
            }
        }(), function() {
            function e(e, t, i) {
                void 0 === e && (e = b.Zero()), void 0 === t && (t = b.Up()), void 0 === i && (i = T.Zero()), this.position = e, this.normal = t, this.uv = i
            }
            e.prototype.clone = function() {
                return new e(this.position.clone(), this.normal.clone(), this.uv.clone())
            }
        }(), function() {
            function e() {}
            return e.Color3 = g.BuildArray(3, v.Black), e.Color4 = g.BuildArray(3, (function() {
                return new y(0, 0, 0, 0)
            })), e.Vector2 = g.BuildArray(3, T.Zero), e.Vector3 = g.BuildArray(13, b.Zero), e.Vector4 = g.BuildArray(3, E.Zero), e.Quaternion = g.BuildArray(2, M.Zero), e.Matrix = g.BuildArray(8, R.Identity), e
        }()),
        U = function() {
            function e() {}
            return e.Vector3 = g.BuildArray(6, b.Zero), e.Matrix = g.BuildArray(2, R.Identity), e.Quaternion = g.BuildArray(3, M.Zero), e
        }(),
        B = function() {
            function e() {}
            return e.FilesToLoad = {}, e
        }(),
        k = function() {
            function e() {}
            return e.ALPHA_DISABLE = 0, e.ALPHA_ADD = 1, e.ALPHA_COMBINE = 2, e.ALPHA_SUBTRACT = 3, e.ALPHA_MULTIPLY = 4, e.ALPHA_MAXIMIZED = 5, e.ALPHA_ONEONE = 6, e.ALPHA_PREMULTIPLIED = 7, e.ALPHA_PREMULTIPLIED_PORTERDUFF = 8, e.ALPHA_INTERPOLATE = 9, e.ALPHA_SCREENMODE = 10, e.DELAYLOADSTATE_NONE = 0, e.DELAYLOADSTATE_LOADED = 1, e.DELAYLOADSTATE_LOADING = 2, e.DELAYLOADSTATE_NOTLOADED = 4, e.NEVER = 512, e.ALWAYS = 519, e.LESS = 513, e.EQUAL = 514, e.LEQUAL = 515, e.GREATER = 516, e.GEQUAL = 518, e.NOTEQUAL = 517, e.KEEP = 7680, e.REPLACE = 7681, e.INCR = 7682, e.DECR = 7683, e.INVERT = 5386, e.INCR_WRAP = 34055, e.DECR_WRAP = 34056, e.TEXTURE_CLAMP_ADDRESSMODE = 0, e.TEXTURE_WRAP_ADDRESSMODE = 1, e.TEXTURE_MIRROR_ADDRESSMODE = 2, e.TEXTUREFORMAT_ALPHA = 0, e.TEXTUREFORMAT_LUMINANCE = 1, e.TEXTUREFORMAT_LUMINANCE_ALPHA = 2, e.TEXTUREFORMAT_RGB = 4, e.TEXTUREFORMAT_RGBA = 5, e.TEXTUREFORMAT_RED = 6, e.TEXTUREFORMAT_R = 6, e.TEXTUREFORMAT_RG = 7, e.TEXTUREFORMAT_RED_INTEGER = 8, e.TEXTUREFORMAT_R_INTEGER = 8, e.TEXTUREFORMAT_RG_INTEGER = 9, e.TEXTUREFORMAT_RGB_INTEGER = 10, e.TEXTUREFORMAT_RGBA_INTEGER = 11, e.TEXTURETYPE_UNSIGNED_BYTE = 0, e.TEXTURETYPE_UNSIGNED_INT = 0, e.TEXTURETYPE_FLOAT = 1, e.TEXTURETYPE_HALF_FLOAT = 2, e.TEXTURETYPE_BYTE = 3, e.TEXTURETYPE_SHORT = 4, e.TEXTURETYPE_UNSIGNED_SHORT = 5, e.TEXTURETYPE_INT = 6, e.TEXTURETYPE_UNSIGNED_INTEGER = 7, e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 = 8, e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 = 9, e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5 = 10, e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV = 11, e.TEXTURETYPE_UNSIGNED_INT_24_8 = 12, e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV = 13, e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV = 14, e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV = 15, e.TEXTURE_NEAREST_SAMPLINGMODE = 1, e.TEXTURE_BILINEAR_SAMPLINGMODE = 2, e.TEXTURE_TRILINEAR_SAMPLINGMODE = 3, e.TEXTURE_NEAREST_NEAREST_MIPLINEAR = 1, e.TEXTURE_LINEAR_LINEAR_MIPNEAREST = 2, e.TEXTURE_LINEAR_LINEAR_MIPLINEAR = 3, e.TEXTURE_NEAREST_NEAREST_MIPNEAREST = 4, e.TEXTURE_NEAREST_LINEAR_MIPNEAREST = 5, e.TEXTURE_NEAREST_LINEAR_MIPLINEAR = 6, e.TEXTURE_NEAREST_LINEAR = 7, e.TEXTURE_NEAREST_NEAREST = 8, e.TEXTURE_LINEAR_NEAREST_MIPNEAREST = 9, e.TEXTURE_LINEAR_NEAREST_MIPLINEAR = 10, e.TEXTURE_LINEAR_LINEAR = 11, e.TEXTURE_LINEAR_NEAREST = 12, e.TEXTURE_EXPLICIT_MODE = 0, e.TEXTURE_SPHERICAL_MODE = 1, e.TEXTURE_PLANAR_MODE = 2, e.TEXTURE_CUBIC_MODE = 3, e.TEXTURE_PROJECTION_MODE = 4, e.TEXTURE_SKYBOX_MODE = 5, e.TEXTURE_INVCUBIC_MODE = 6, e.TEXTURE_EQUIRECTANGULAR_MODE = 7, e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE = 8, e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE = 9, e.SCALEMODE_FLOOR = 1, e.SCALEMODE_NEAREST = 2, e.SCALEMODE_CEILING = 3, e.MATERIAL_TextureDirtyFlag = 1, e.MATERIAL_LightDirtyFlag = 2, e.MATERIAL_FresnelDirtyFlag = 4, e.MATERIAL_AttributesDirtyFlag = 8, e.MATERIAL_MiscDirtyFlag = 16, e.MATERIAL_AllDirtyFlag = 31, e.MATERIAL_TriangleFillMode = 0, e.MATERIAL_WireFrameFillMode = 1, e.MATERIAL_PointFillMode = 2, e.MATERIAL_PointListDrawMode = 3, e.MATERIAL_LineListDrawMode = 4, e.MATERIAL_LineLoopDrawMode = 5, e.MATERIAL_LineStripDrawMode = 6, e.MATERIAL_TriangleStripDrawMode = 7, e.MATERIAL_TriangleFanDrawMode = 8, e.MATERIAL_ClockWiseSideOrientation = 0, e.MATERIAL_CounterClockWiseSideOrientation = 1, e.ACTION_NothingTrigger = 0, e.ACTION_OnPickTrigger = 1, e.ACTION_OnLeftPickTrigger = 2, e.ACTION_OnRightPickTrigger = 3, e.ACTION_OnCenterPickTrigger = 4, e.ACTION_OnPickDownTrigger = 5, e.ACTION_OnDoublePickTrigger = 6, e.ACTION_OnPickUpTrigger = 7, e.ACTION_OnPickOutTrigger = 16, e.ACTION_OnLongPressTrigger = 8, e.ACTION_OnPointerOverTrigger = 9, e.ACTION_OnPointerOutTrigger = 10, e.ACTION_OnEveryFrameTrigger = 11, e.ACTION_OnIntersectionEnterTrigger = 12, e.ACTION_OnIntersectionExitTrigger = 13, e.ACTION_OnKeyDownTrigger = 14, e.ACTION_OnKeyUpTrigger = 15, e.PARTICLES_BILLBOARDMODE_Y = 2, e.PARTICLES_BILLBOARDMODE_ALL = 7, e.PARTICLES_BILLBOARDMODE_STRETCHED = 8, e.PARTICLES_BaseAssetsUrl = "https://assets.babylonjs.com/particles", e.MESHES_CULLINGSTRATEGY_STANDARD = 0, e.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY = 1, e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION = 2, e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY = 3, e.SCENELOADER_NO_LOGGING = 0, e.SCENELOADER_MINIMAL_LOGGING = 1, e.SCENELOADER_SUMMARY_LOGGING = 2, e.SCENELOADER_DETAILED_LOGGING = 3, e
        }(),
        V = function() {
            function e() {}
            return e._AddLogEntry = function(t) {
                e._LogCache = t + e._LogCache, e.OnNewCacheEntry && e.OnNewCacheEntry(t)
            }, e._FormatMessage = function(e) {
                var t = function(e) {
                        return e < 10 ? "0" + e : "" + e
                    },
                    i = new Date;
                return "[" + t(i.getHours()) + ":" + t(i.getMinutes()) + ":" + t(i.getSeconds()) + "]: " + e
            }, e._LogDisabled = function(e) {}, e._LogEnabled = function(t) {
                var i = e._FormatMessage(t);
                console.log("BJS - " + i);
                var n = "<div style='color:white'>" + i + "</div><br>";
                e._AddLogEntry(n)
            }, e._WarnDisabled = function(e) {}, e._WarnEnabled = function(t) {
                var i = e._FormatMessage(t);
                console.warn("BJS - " + i);
                var n = "<div style='color:orange'>" + i + "</div><br>";
                e._AddLogEntry(n)
            }, e._ErrorDisabled = function(e) {}, e._ErrorEnabled = function(t) {
                e.errorsCount++;
                var i = e._FormatMessage(t);
                console.error("BJS - " + i);
                var n = "<div style='color:red'>" + i + "</div><br>";
                e._AddLogEntry(n)
            }, Object.defineProperty(e, "LogCache", {
                get: function() {
                    return e._LogCache
                },
                enumerable: !0,
                configurable: !0
            }), e.ClearLogCache = function() {
                e._LogCache = "", e.errorsCount = 0
            }, Object.defineProperty(e, "LogLevels", {
                set: function(t) {
                    (t & e.MessageLogLevel) === e.MessageLogLevel ? e.Log = e._LogEnabled : e.Log = e._LogDisabled, (t & e.WarningLogLevel) === e.WarningLogLevel ? e.Warn = e._WarnEnabled : e.Warn = e._WarnDisabled, (t & e.ErrorLogLevel) === e.ErrorLogLevel ? e.Error = e._ErrorEnabled : e.Error = e._ErrorDisabled
                },
                enumerable: !0,
                configurable: !0
            }), e.NoneLogLevel = 0, e.MessageLogLevel = 1, e.WarningLogLevel = 2, e.ErrorLogLevel = 4, e.AllLogLevel = 7, e._LogCache = "", e.errorsCount = 0, e.Log = e._LogEnabled, e.Warn = e._WarnEnabled, e.Error = e._ErrorEnabled, e
        }(),
        G = function() {
            function e() {}
            return e.GetClass = function(e) {
                return this.RegisteredTypes && this.RegisteredTypes[e] ? this.RegisteredTypes[e] : null
            }, e.RegisteredTypes = {}, e
        }(),
        z = function(e, t) {
            return e ? e.getClassName && "Mesh" === e.getClassName() ? null : e.getClassName && "SubMesh" === e.getClassName() ? e.clone(t) : e.clone ? e.clone() : null : null
        },
        W = function() {
            function e() {}
            return e.DeepCopy = function(e, t, i, n) {
                for (var r in e)
                    if (("_" !== r[0] || n && -1 !== n.indexOf(r)) && (!i || -1 === i.indexOf(r))) {
                        var o = e[r],
                            s = typeof o;
                        if ("function" !== s) try {
                            if ("object" === s)
                                if (o instanceof Array) {
                                    if (t[r] = [], o.length > 0)
                                        if ("object" == typeof o[0])
                                            for (var a = 0; a < o.length; a++) {
                                                var u = z(o[a], t); - 1 === t[r].indexOf(u) && t[r].push(u)
                                            } else t[r] = o.slice(0)
                                } else t[r] = z(o, t);
                            else t[r] = o
                        } catch (e) {}
                    }
            }, e
        }(),
        X = function() {
            function e() {}
            return e.WarnImport = function(e) {
                return e + " needs to be imported before as it contains a side-effect required by your code."
            }, e
        }(),
        H = function() {
            function e() {
                this._xhr = new XMLHttpRequest
            }
            return e.prototype._injectCustomRequestHeaders = function() {
                for (var t in e.CustomRequestHeaders) {
                    var i = e.CustomRequestHeaders[t];
                    i && this._xhr.setRequestHeader(t, i)
                }
            }, Object.defineProperty(e.prototype, "onprogress", {
                get: function() {
                    return this._xhr.onprogress
                },
                set: function(e) {
                    this._xhr.onprogress = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "readyState", {
                get: function() {
                    return this._xhr.readyState
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "status", {
                get: function() {
                    return this._xhr.status
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "statusText", {
                get: function() {
                    return this._xhr.statusText
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "response", {
                get: function() {
                    return this._xhr.response
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "responseURL", {
                get: function() {
                    return this._xhr.responseURL
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "responseText", {
                get: function() {
                    return this._xhr.responseText
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "responseType", {
                get: function() {
                    return this._xhr.responseType
                },
                set: function(e) {
                    this._xhr.responseType = e
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.addEventListener = function(e, t, i) {
                this._xhr.addEventListener(e, t, i)
            }, e.prototype.removeEventListener = function(e, t, i) {
                this._xhr.removeEventListener(e, t, i)
            }, e.prototype.abort = function() {
                this._xhr.abort()
            }, e.prototype.send = function(t) {
                e.CustomRequestHeaders && this._injectCustomRequestHeaders(), this._xhr.send(t)
            }, e.prototype.open = function(t, i) {
                for (var n = 0, r = e.CustomRequestModifiers; n < r.length; n++) {
                    (0, r[n])(this._xhr)
                }
                return this._xhr.open(t, i, !0)
            }, e.CustomRequestHeaders = {}, e.CustomRequestModifiers = new Array, e
        }(),
        j = (function() {
            function e() {}
            e.prototype.getColorToRef = function(e) {
                this.color2 ? y.LerpToRef(this.color1, this.color2, Math.random(), e) : e.copyFrom(this.color1)
            }
        }(), function() {
            function e() {}
            e.prototype.getFactor = function() {
                return void 0 === this.factor2 ? this.factor1 : m.Lerp(this.factor1, this.factor2, Math.random())
            }
        }(), function(e) {
            function t(i, n) {
                var r = e.call(this, i) || this;
                return r.request = n, r.name = "LoadFileError", t._setPrototypeOf(r, t.prototype), r
            }
            return r(t, e), t._setPrototypeOf = Object.setPrototypeOf || function(e, t) {
                return e.__proto__ = t, e
            }, t
        }(Error)),
        Y = function() {
            function e() {}
            return e.ExponentialBackoff = function(e, t) {
                return void 0 === e && (e = 3), void 0 === t && (t = 500),
                    function(i, n, r) {
                        return 0 !== n.status || r >= e || -1 !== i.indexOf("file:") ? -1 : Math.pow(2, r) * t
                    }
            }, e
        }(),
        K = function() {
            function e() {}
            return e.FetchToRef = function(e, t, i, n, r, o) {
                var s = 4 * ((Math.abs(e) * i % i | 0) + (Math.abs(t) * n % n | 0) * i);
                o.r = r[s] / 255, o.g = r[s + 1] / 255, o.b = r[s + 2] / 255, o.a = r[s + 3] / 255
            }, e.Mix = function(e, t, i) {
                return e * (1 - i) + t * i
            }, e.Instantiate = function(t) {
                if (e.RegisteredExternalClasses && e.RegisteredExternalClasses[t]) return e.RegisteredExternalClasses[t];
                var i = G.GetClass(t);
                if (i) return i;
                V.Warn(t + " not found, you may have missed an import.");
                for (var n = t.split("."), r = window || this, o = 0, s = n.length; o < s; o++) r = r[n[o]];
                return "function" != typeof r ? null : r
            }, e.Slice = function(e, t, i) {
                return e.slice ? e.slice(t, i) : Array.prototype.slice.call(e, t, i)
            }, e.SetImmediate = function(e) {
                c.IsWindowObjectExist() && window.setImmediate ? window.setImmediate(e) : setTimeout(e, 1)
            }, e.IsExponentOfTwo = function(e) {
                var t = 1;
                do {
                    t *= 2
                } while (t < e);
                return t === e
            }, e.FloatRound = function(t) {
                return Math.fround ? Math.fround(t) : e._tmpFloatArray[0] = t
            }, e.CeilingPOT = function(e) {
                return e--, e |= e >> 1, e |= e >> 2, e |= e >> 4, e |= e >> 8, e |= e >> 16, ++e
            }, e.FloorPOT = function(e) {
                return e |= e >> 1, e |= e >> 2, e |= e >> 4, e |= e >> 8, (e |= e >> 16) - (e >> 1)
            }, e.NearestPOT = function(t) {
                var i = e.CeilingPOT(t),
                    n = e.FloorPOT(t);
                return i - t > t - n ? n : i
            }, e.GetExponentOfTwo = function(t, i, n) {
                var r;
                switch (void 0 === n && (n = k.SCALEMODE_NEAREST), n) {
                    case k.SCALEMODE_FLOOR:
                        r = e.FloorPOT(t);
                        break;
                    case k.SCALEMODE_NEAREST:
                        r = e.NearestPOT(t);
                        break;
                    case k.SCALEMODE_CEILING:
                    default:
                        r = e.CeilingPOT(t)
                }
                return Math.min(r, i)
            }, e.GetFilename = function(e) {
                var t = e.lastIndexOf("/");
                return t < 0 ? e : e.substring(t + 1)
            }, e.GetFolderPath = function(e, t) {
                void 0 === t && (t = !1);
                var i = e.lastIndexOf("/");
                return i < 0 ? t ? e : "" : e.substring(0, i + 1)
            }, e.ToDegrees = function(e) {
                return 180 * e / Math.PI
            }, e.ToRadians = function(e) {
                return e * Math.PI / 180
            }, e.EncodeArrayBufferTobase64 = function(e) {
                for (var t, i, n, r, o, s, a, u = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", h = "", l = 0, c = new Uint8Array(e); l < c.length;) r = (t = c[l++]) >> 2, o = (3 & t) << 4 | (i = l < c.length ? c[l++] : Number.NaN) >> 4, s = (15 & i) << 2 | (n = l < c.length ? c[l++] : Number.NaN) >> 6, a = 63 & n, isNaN(i) ? s = a = 64 : isNaN(n) && (a = 64), h += u.charAt(r) + u.charAt(o) + u.charAt(s) + u.charAt(a);
                return "data:image/png;base64," + h
            }, e.ExtractMinAndMaxIndexed = function(e, t, i, n, r) {
                void 0 === r && (r = null);
                for (var o = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), s = new b(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), a = i; a < i + n; a++) {
                    var u = 3 * t[a],
                        h = e[u],
                        l = e[u + 1],
                        c = e[u + 2];
                    o.minimizeInPlaceFromFloats(h, l, c), s.maximizeInPlaceFromFloats(h, l, c)
                }
                return r && (o.x -= o.x * r.x + r.y, o.y -= o.y * r.x + r.y, o.z -= o.z * r.x + r.y, s.x += s.x * r.x + r.y, s.y += s.y * r.x + r.y, s.z += s.z * r.x + r.y), {
                    minimum: o,
                    maximum: s
                }
            }, e.ExtractMinAndMax = function(e, t, i, n, r) {
                void 0 === n && (n = null);
                var o = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE),
                    s = new b(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);
                r || (r = 3);
                for (var a = t, u = t * r; a < t + i; a++, u += r) {
                    var h = e[u],
                        l = e[u + 1],
                        c = e[u + 2];
                    o.minimizeInPlaceFromFloats(h, l, c), s.maximizeInPlaceFromFloats(h, l, c)
                }
                return n && (o.x -= o.x * n.x + n.y, o.y -= o.y * n.x + n.y, o.z -= o.z * n.x + n.y, s.x += s.x * n.x + n.y, s.y += s.y * n.x + n.y, s.z += s.z * n.x + n.y), {
                    minimum: o,
                    maximum: s
                }
            }, e.MakeArray = function(e, t) {
                return !0 === t || void 0 !== e && null != e ? Array.isArray(e) ? e : [e] : null
            }, e.GetPointerPrefix = function() {
                var e = "pointer";
                return !c.IsWindowObjectExist() || window.PointerEvent || navigator.pointerEnabled || (e = "mouse"), e
            }, e.QueueNewFrame = function(e, t) {
                return c.IsWindowObjectExist() ? (t || (t = window), t.requestAnimationFrame ? t.requestAnimationFrame(e) : t.msRequestAnimationFrame ? t.msRequestAnimationFrame(e) : t.webkitRequestAnimationFrame ? t.webkitRequestAnimationFrame(e) : t.mozRequestAnimationFrame ? t.mozRequestAnimationFrame(e) : t.oRequestAnimationFrame ? t.oRequestAnimationFrame(e) : window.setTimeout(e, 16)) : setTimeout(e, 16)
            }, e.RequestFullscreen = function(e) {
                var t = e.requestFullscreen || e.msRequestFullscreen || e.webkitRequestFullscreen || e.mozRequestFullScreen;
                t && t.call(e)
            }, e.ExitFullscreen = function() {
                var e = document;
                document.exitFullscreen ? document.exitFullscreen() : e.mozCancelFullScreen ? e.mozCancelFullScreen() : e.webkitCancelFullScreen ? e.webkitCancelFullScreen() : e.msCancelFullScreen && e.msCancelFullScreen()
            }, e.SetCorsBehavior = function(t, i) {
                if ((!t || 0 !== t.indexOf("data:")) && e.CorsBehavior)
                    if ("string" == typeof e.CorsBehavior || e.CorsBehavior instanceof String) i.crossOrigin = e.CorsBehavior;
                    else {
                        var n = e.CorsBehavior(t);
                        n && (i.crossOrigin = n)
                    }
            }, e.CleanUrl = function(e) {
                return e = e.replace(/#/gm, "%23")
            }, e.LoadImage = function(t, i, n, r) {
                var o, s = !1;
                t instanceof ArrayBuffer ? (o = URL.createObjectURL(new Blob([t])), s = !0) : t instanceof Blob ? (o = URL.createObjectURL(t), s = !0) : (o = e.CleanUrl(t), o = e.PreprocessUrl(t));
                var a = new Image;
                e.SetCorsBehavior(o, a);
                var u = function() {
                        a.removeEventListener("load", u), a.removeEventListener("error", h), i(a), s && a.src && URL.revokeObjectURL(a.src)
                    },
                    h = function(e) {
                        a.removeEventListener("load", u), a.removeEventListener("error", h), V.Error("Error while trying to load image: " + t), n && n("Error while trying to load image: " + t, e), s && a.src && URL.revokeObjectURL(a.src)
                    };
                a.addEventListener("load", u), a.addEventListener("error", h);
                var l = function() {
                    a.src = o
                };
                if ("data:" !== o.substr(0, 5) && r && r.enableTexturesOffline) r.open((function() {
                    r && r.loadImage(o, a)
                }), l);
                else {
                    if (-1 !== o.indexOf("file:")) {
                        var c = decodeURIComponent(o.substring(5).toLowerCase());
                        if (B.FilesToLoad[c]) {
                            try {
                                var d;
                                try {
                                    d = URL.createObjectURL(B.FilesToLoad[c])
                                } catch (e) {
                                    d = URL.createObjectURL(B.FilesToLoad[c])
                                }
                                a.src = d, s = !0
                            } catch (e) {
                                a.src = ""
                            }
                            return a
                        }
                    }
                    l()
                }
                return a
            }, e.LoadFile = function(t, i, n, r, o, s) {
                if (t = e.CleanUrl(t), -1 !== (t = e.PreprocessUrl(t)).indexOf("file:")) {
                    var a = decodeURIComponent(t.substring(5).toLowerCase());
                    if (B.FilesToLoad[a]) return e.ReadFile(B.FilesToLoad[a], i, n, o)
                }
                var u = e.BaseUrl + t,
                    h = !1,
                    d = {
                        onCompleteObservable: new l,
                        abort: function() {
                            return h = !0
                        }
                    },
                    f = function() {
                        var t = new H,
                            r = null;
                        d.abort = function() {
                            h = !0, t.readyState !== (XMLHttpRequest.DONE || 4) && t.abort(), null !== r && (clearTimeout(r), r = null)
                        };
                        var a = function(l) {
                            t.open("GET", u), o && (t.responseType = "arraybuffer"), n && t.addEventListener("progress", n);
                            var f = function() {
                                t.removeEventListener("loadend", f), d.onCompleteObservable.notifyObservers(d), d.onCompleteObservable.clear()
                            };
                            t.addEventListener("loadend", f);
                            var p = function() {
                                if (!h && t.readyState === (XMLHttpRequest.DONE || 4)) {
                                    if (t.removeEventListener("readystatechange", p), t.status >= 200 && t.status < 300 || 0 === t.status && (!c.IsWindowObjectExist() || e.IsFileURL())) return void i(o ? t.response : t.responseText, t.responseURL);
                                    var n = e.DefaultRetryStrategy;
                                    if (n) {
                                        var d = n(u, t, l);
                                        if (-1 !== d) return t.removeEventListener("loadend", f), t = new H, void(r = setTimeout((function() {
                                            return a(l + 1)
                                        }), d))
                                    }
                                    var _ = new j("Error status: " + t.status + " " + t.statusText + " - Unable to load " + u, t);
                                    if (!s) throw _;
                                    s(t, _)
                                }
                            };
                            t.addEventListener("readystatechange", p), t.send()
                        };
                        a(0)
                    };
                if (r && r.enableSceneOffline) {
                    var p = function(e) {
                        e && e.status > 400 ? s && s(e) : h || f()
                    };
                    r.open((function() {
                        h || r && r.loadFile(t, (function(e) {
                            h || i(e), d.onCompleteObservable.notifyObservers(d)
                        }), n ? function(e) {
                            h || n(e)
                        } : void 0, p, o)
                    }), p)
                } else f();
                return d
            }, e.LoadScript = function(e, t, i, n) {
                if (c.IsWindowObjectExist()) {
                    var r = document.getElementsByTagName("head")[0],
                        o = document.createElement("script");
                    o.setAttribute("type", "text/javascript"), o.setAttribute("src", e), n && (o.id = n), o.onload = function() {
                        t && t()
                    }, o.onerror = function(t) {
                        i && i("Unable to load script '" + e + "'", t)
                    }, r.appendChild(o)
                }
            }, e.LoadScriptAsync = function(e, t) {
                return new Promise((function(i, n) {
                    if (c.IsWindowObjectExist()) {
                        var r = document.getElementsByTagName("head")[0],
                            o = document.createElement("script");
                        o.setAttribute("type", "text/javascript"), o.setAttribute("src", e), t && (o.id = t), o.onload = function() {
                            i(!0)
                        }, o.onerror = function(e) {
                            i(!1)
                        }, r.appendChild(o)
                    } else i(!1)
                }))
            }, e.ReadFileAsDataURL = function(e, t, i) {
                var n = new FileReader,
                    r = {
                        onCompleteObservable: new l,
                        abort: function() {
                            return n.abort()
                        }
                    };
                return n.onloadend = function(e) {
                    r.onCompleteObservable.notifyObservers(r)
                }, n.onload = function(e) {
                    t(e.target.result)
                }, n.onprogress = i, n.readAsDataURL(e), r
            }, e.ReadFile = function(e, t, i, n) {
                var r = new FileReader,
                    o = {
                        onCompleteObservable: new l,
                        abort: function() {
                            return r.abort()
                        }
                    };
                return r.onloadend = function(e) {
                    return o.onCompleteObservable.notifyObservers(o)
                }, r.onerror = function(i) {
                    V.Log("Error while reading file: " + e.name), t(JSON.stringify({
                        autoClear: !0,
                        clearColor: [1, 0, 0],
                        ambientColor: [0, 0, 0],
                        gravity: [0, -9.807, 0],
                        meshes: [],
                        cameras: [],
                        lights: []
                    }))
                }, r.onload = function(e) {
                    t(e.target.result)
                }, i && (r.onprogress = i), n ? r.readAsArrayBuffer(e) : r.readAsText(e), o
            }, e.FileAsURL = function(e) {
                var t = new Blob([e]);
                return (window.URL || window.webkitURL).createObjectURL(t)
            }, e.Format = function(e, t) {
                return void 0 === t && (t = 2), e.toFixed(t)
            }, e.CheckExtends = function(e, t, i) {
                t.minimizeInPlace(e), i.maximizeInPlace(e)
            }, e.DeepCopy = function(e, t, i, n) {
                W.DeepCopy(e, t, i, n)
            }, e.IsEmpty = function(e) {
                for (var t in e)
                    if (e.hasOwnProperty(t)) return !1;
                return !0
            }, e.EndsWith = function(e, t) {
                return -1 !== e.indexOf(t, e.length - t.length)
            }, e.RegisterTopRootEvents = function(e) {
                for (var t = 0; t < e.length; t++) {
                    var i = e[t];
                    window.addEventListener(i.name, i.handler, !1);
                    try {
                        window.parent && window.parent.addEventListener(i.name, i.handler, !1)
                    } catch (e) {}
                }
            }, e.UnregisterTopRootEvents = function(e) {
                for (var t = 0; t < e.length; t++) {
                    var i = e[t];
                    window.removeEventListener(i.name, i.handler);
                    try {
                        window.parent && window.parent.removeEventListener(i.name, i.handler)
                    } catch (e) {}
                }
            }, e.DumpFramebuffer = function(t, i, n, r, o, s) {
                void 0 === o && (o = "image/png");
                for (var a = 4 * t, u = i / 2, h = n.readPixels(0, 0, t, i), l = 0; l < u; l++)
                    for (var c = 0; c < a; c++) {
                        var d = c + l * a,
                            f = c + (i - l - 1) * a,
                            p = h[d];
                        h[d] = h[f], h[f] = p
                    }
                e._ScreenshotCanvas || (e._ScreenshotCanvas = document.createElement("canvas")), e._ScreenshotCanvas.width = t, e._ScreenshotCanvas.height = i;
                var _ = e._ScreenshotCanvas.getContext("2d");
                if (_) {
                    var g = _.createImageData(t, i);
                    g.data.set(h), _.putImageData(g, 0, 0), e.EncodeScreenshotCanvasData(r, o, s)
                }
            }, e.ToBlob = function(e, t, i) {
                void 0 === i && (i = "image/png"), e.toBlob || (e.toBlob = function(e, t, i) {
                    var n = this;
                    setTimeout((function() {
                        for (var r = atob(n.toDataURL(t, i).split(",")[1]), o = r.length, s = new Uint8Array(o), a = 0; a < o; a++) s[a] = r.charCodeAt(a);
                        e(new Blob([s]))
                    }))
                }), e.toBlob((function(e) {
                    t(e)
                }), i)
            }, e.EncodeScreenshotCanvasData = function(t, i, n) {
                (void 0 === i && (i = "image/png"), t) ? t(e._ScreenshotCanvas.toDataURL(i)): this.ToBlob(e._ScreenshotCanvas, (function(t) {
                    if ("download" in document.createElement("a")) {
                        if (!n) {
                            var i = new Date,
                                r = (i.getFullYear() + "-" + (i.getMonth() + 1)).slice(2) + "-" + i.getDate() + "_" + i.getHours() + "-" + ("0" + i.getMinutes()).slice(-2);
                            n = "screenshot_" + r + ".png"
                        }
                        e.Download(t, n)
                    } else {
                        var o = URL.createObjectURL(t),
                            s = window.open("");
                        if (!s) return;
                        var a = s.document.createElement("img");
                        a.onload = function() {
                            URL.revokeObjectURL(o)
                        }, a.src = o, s.document.body.appendChild(a)
                    }
                }), i)
            }, e.Download = function(e, t) {
                if (navigator && navigator.msSaveBlob) navigator.msSaveBlob(e, t);
                else {
                    var i = window.URL.createObjectURL(e),
                        n = document.createElement("a");
                    document.body.appendChild(n), n.style.display = "none", n.href = i, n.download = t, n.addEventListener("click", (function() {
                        n.parentElement && n.parentElement.removeChild(n)
                    })), n.click(), window.URL.revokeObjectURL(i)
                }
            }, e.CreateScreenshot = function(e, t, i, n, r) {
                throw void 0 === r && (r = "image/png"), X.WarnImport("ScreenshotTools")
            }, e.CreateScreenshotUsingRenderTarget = function(e, t, i, n, r, o, s, a) {
                throw void 0 === r && (r = "image/png"), void 0 === o && (o = 1), void 0 === s && (s = !1), X.WarnImport("ScreenshotTools")
            }, e.RandomId = function() {
                return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (function(e) {
                    var t = 16 * Math.random() | 0;
                    return ("x" === e ? t : 3 & t | 8).toString(16)
                }))
            }, e.IsBase64 = function(e) {
                return !(e.length < 5) && "data:" === e.substr(0, 5)
            }, e.DecodeBase64 = function(e) {
                for (var t = atob(e.split(",")[1]), i = t.length, n = new Uint8Array(new ArrayBuffer(i)), r = 0; r < i; r++) n[r] = t.charCodeAt(r);
                return n.buffer
            }, e.GetAbsoluteUrl = function(e) {
                var t = document.createElement("a");
                return t.href = e, t.href
            }, Object.defineProperty(e, "errorsCount", {
                get: function() {
                    return V.errorsCount
                },
                enumerable: !0,
                configurable: !0
            }), e.Log = function(e) {
                V.Log(e)
            }, e.Warn = function(e) {
                V.Warn(e)
            }, e.Error = function(e) {
                V.Error(e)
            }, Object.defineProperty(e, "LogCache", {
                get: function() {
                    return V.LogCache
                },
                enumerable: !0,
                configurable: !0
            }), e.ClearLogCache = function() {
                V.ClearLogCache()
            }, Object.defineProperty(e, "LogLevels", {
                set: function(e) {
                    V.LogLevels = e
                },
                enumerable: !0,
                configurable: !0
            }), e.IsFileURL = function() {
                return "file:" === location.protocol
            }, Object.defineProperty(e, "PerformanceLogLevel", {
                set: function(t) {
                    return (t & e.PerformanceUserMarkLogLevel) === e.PerformanceUserMarkLogLevel ? (e.StartPerformanceCounter = e._StartUserMark, void(e.EndPerformanceCounter = e._EndUserMark)) : (t & e.PerformanceConsoleLogLevel) === e.PerformanceConsoleLogLevel ? (e.StartPerformanceCounter = e._StartPerformanceConsole, void(e.EndPerformanceCounter = e._EndPerformanceConsole)) : (e.StartPerformanceCounter = e._StartPerformanceCounterDisabled, void(e.EndPerformanceCounter = e._EndPerformanceCounterDisabled))
                },
                enumerable: !0,
                configurable: !0
            }), e._StartPerformanceCounterDisabled = function(e, t) {}, e._EndPerformanceCounterDisabled = function(e, t) {}, e._StartUserMark = function(t, i) {
                if (void 0 === i && (i = !0), !e._performance) {
                    if (!c.IsWindowObjectExist()) return;
                    e._performance = window.performance
                }
                i && e._performance.mark && e._performance.mark(t + "-Begin")
            }, e._EndUserMark = function(t, i) {
                void 0 === i && (i = !0), i && e._performance.mark && (e._performance.mark(t + "-End"), e._performance.measure(t, t + "-Begin", t + "-End"))
            }, e._StartPerformanceConsole = function(t, i) {
                void 0 === i && (i = !0), i && (e._StartUserMark(t, i), console.time && console.time(t))
            }, e._EndPerformanceConsole = function(t, i) {
                void 0 === i && (i = !0), i && (e._EndUserMark(t, i), console.time && console.timeEnd(t))
            }, Object.defineProperty(e, "Now", {
                get: function() {
                    return d.Now
                },
                enumerable: !0,
                configurable: !0
            }), e.GetClassName = function(e, t) {
                void 0 === t && (t = !1);
                var i = null;
                if (!t && e.getClassName) i = e.getClassName();
                else {
                    if (e instanceof Object) i = (t ? e : Object.getPrototypeOf(e)).constructor.__bjsclassName__;
                    i || (i = typeof e)
                }
                return i
            }, e.First = function(e, t) {
                for (var i = 0, n = e; i < n.length; i++) {
                    var r = n[i];
                    if (t(r)) return r
                }
                return null
            }, e.getFullClassName = function(e, t) {
                void 0 === t && (t = !1);
                var i = null,
                    n = null;
                if (!t && e.getClassName) i = e.getClassName();
                else {
                    if (e instanceof Object) {
                        var r = t ? e : Object.getPrototypeOf(e);
                        i = r.constructor.__bjsclassName__, n = r.constructor.__bjsmoduleName__
                    }
                    i || (i = typeof e)
                }
                return i ? (null != n ? n + "." : "") + i : null
            }, e.DelayAsync = function(e) {
                return new Promise((function(t) {
                    setTimeout((function() {
                        t()
                    }), e)
                }))
            }, e.GetCurrentGradient = function(e, t, i) {
                for (var n = 0; n < t.length - 1; n++) {
                    var r = t[n],
                        o = t[n + 1];
                    if (e >= r.gradient && e <= o.gradient) return void i(r, o, (e - r.gradient) / (o.gradient - r.gradient))
                }
                var s = t.length - 1;
                i(t[s], t[s], 1)
            }, e.BaseUrl = "", e.UseCustomRequestHeaders = !1, e.CustomRequestHeaders = H.CustomRequestHeaders, e.DefaultRetryStrategy = Y.ExponentialBackoff(), e.CorsBehavior = "anonymous", e.UseFallbackTexture = !0, e.RegisteredExternalClasses = {}, e.fallbackTexture = "data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z", e._tmpFloatArray = new Float32Array(1), e.GetDOMTextContent = c.GetDOMTextContent, e.PreprocessUrl = function(e) {
                return e
            }, e.NoneLogLevel = V.NoneLogLevel, e.MessageLogLevel = V.MessageLogLevel, e.WarningLogLevel = V.WarningLogLevel, e.ErrorLogLevel = V.ErrorLogLevel, e.AllLogLevel = V.AllLogLevel, e.IsWindowObjectExist = c.IsWindowObjectExist, e.PerformanceNoneLogLevel = 0, e.PerformanceUserMarkLogLevel = 1, e.PerformanceConsoleLogLevel = 2, e.StartPerformanceCounter = e._StartPerformanceCounterDisabled, e.EndPerformanceCounter = e._EndPerformanceCounterDisabled, e
        }(),
        q = function() {
            function e() {
                this._startMonitoringTime = 0, this._min = 0, this._max = 0, this._average = 0, this._lastSecAverage = 0, this._current = 0, this._totalValueCount = 0, this._totalAccumulated = 0, this._lastSecAccumulated = 0, this._lastSecTime = 0, this._lastSecValueCount = 0
            }
            return Object.defineProperty(e.prototype, "min", {
                get: function() {
                    return this._min
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "max", {
                get: function() {
                    return this._max
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "average", {
                get: function() {
                    return this._average
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "lastSecAverage", {
                get: function() {
                    return this._lastSecAverage
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "current", {
                get: function() {
                    return this._current
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "total", {
                get: function() {
                    return this._totalAccumulated
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "count", {
                get: function() {
                    return this._totalValueCount
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.fetchNewFrame = function() {
                this._totalValueCount++, this._current = 0, this._lastSecValueCount++
            }, e.prototype.addCount = function(t, i) {
                e.Enabled && (this._current += t, i && this._fetchResult())
            }, e.prototype.beginMonitoring = function() {
                e.Enabled && (this._startMonitoringTime = d.Now)
            }, e.prototype.endMonitoring = function(t) {
                if (void 0 === t && (t = !0), e.Enabled) {
                    t && this.fetchNewFrame();
                    var i = d.Now;
                    this._current = i - this._startMonitoringTime, t && this._fetchResult()
                }
            }, e.prototype._fetchResult = function() {
                this._totalAccumulated += this._current, this._lastSecAccumulated += this._current, this._min = Math.min(this._min, this._current), this._max = Math.max(this._max, this._current), this._average = this._totalAccumulated / this._totalValueCount;
                var e = d.Now;
                e - this._lastSecTime > 1e3 && (this._lastSecAverage = this._lastSecAccumulated / this._lastSecValueCount, this._lastSecTime = e, this._lastSecAccumulated = 0, this._lastSecValueCount = 0)
            }, e.Enabled = !0, e
        }();
    var Z, Q = function() {
        function e(e, t, i, n) {
            void 0 === n && (n = 0), this.iterations = e, this.index = n - 1, this._done = !1, this._fn = t, this._successCallback = i
        }
        return e.prototype.executeNext = function() {
            this._done || (this.index + 1 < this.iterations ? (++this.index, this._fn(this)) : this.breakLoop())
        }, e.prototype.breakLoop = function() {
            this._done = !0, this._successCallback()
        }, e.Run = function(t, i, n, r) {
            void 0 === r && (r = 0);
            var o = new e(t, i, n, r);
            return o.executeNext(), o
        }, e.SyncAsyncForLoop = function(t, i, n, r, o, s) {
            return void 0 === s && (s = 0), e.Run(Math.ceil(t / i), (function(e) {
                o && o() ? e.breakLoop() : setTimeout((function() {
                    for (var r = 0; r < i; ++r) {
                        var s = e.index * i + r;
                        if (s >= t) break;
                        if (n(s), o && o()) {
                            e.breakLoop();
                            break
                        }
                    }
                    e.executeNext()
                }), s)
            }), r)
        }, e
    }();
    ! function(e) {
        e[e.Pending = 0] = "Pending", e[e.Fulfilled = 1] = "Fulfilled", e[e.Rejected = 2] = "Rejected"
    }(Z || (Z = {}));
    var J = function() {
            this.count = 0, this.target = 0, this.results = []
        },
        $ = function() {
            function e(e) {
                var t = this;
                if (this._state = Z.Pending, this._children = new Array, this._rejectWasConsumed = !1, e) try {
                    e((function(e) {
                        t._resolve(e)
                    }), (function(e) {
                        t._reject(e)
                    }))
                } catch (e) {
                    this._reject(e)
                }
            }
            return Object.defineProperty(e.prototype, "_result", {
                get: function() {
                    return this._resultValue
                },
                set: function(e) {
                    this._resultValue = e, this._parent && void 0 === this._parent._result && (this._parent._result = e)
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.catch = function(e) {
                return this.then(void 0, e)
            }, e.prototype.then = function(t, i) {
                var n = this,
                    r = new e;
                return r._onFulfilled = t, r._onRejected = i, this._children.push(r), r._parent = this, this._state !== Z.Pending && K.SetImmediate((function() {
                    if (n._state === Z.Fulfilled || n._rejectWasConsumed) {
                        var e = r._resolve(n._result);
                        if (null != e)
                            if (void 0 !== e._state) {
                                var t = e;
                                r._children.push(t), t._parent = r, r = t
                            } else r._result = e
                    } else r._reject(n._reason)
                })), r
            }, e.prototype._moveChildren = function(e) {
                var t, i = this;
                if ((t = this._children).push.apply(t, e.splice(0, e.length)), this._children.forEach((function(e) {
                        e._parent = i
                    })), this._state === Z.Fulfilled)
                    for (var n = 0, r = this._children; n < r.length; n++) {
                        r[n]._resolve(this._result)
                    } else if (this._state === Z.Rejected)
                        for (var o = 0, s = this._children; o < s.length; o++) {
                            s[o]._reject(this._reason)
                        }
            }, e.prototype._resolve = function(e) {
                try {
                    this._state = Z.Fulfilled;
                    var t = null;
                    if (this._onFulfilled && (t = this._onFulfilled(e)), null != t)
                        if (void 0 !== t._state) {
                            var i = t;
                            i._parent = this, i._moveChildren(this._children), e = i._result
                        } else e = t;
                    this._result = e;
                    for (var n = 0, r = this._children; n < r.length; n++) {
                        r[n]._resolve(e)
                    }
                    this._children.length = 0, delete this._onFulfilled, delete this._onRejected
                } catch (e) {
                    this._reject(e, !0)
                }
            }, e.prototype._reject = function(e, t) {
                if (void 0 === t && (t = !1), this._state = Z.Rejected, this._reason = e, this._onRejected && !t) try {
                    this._onRejected(e), this._rejectWasConsumed = !0
                } catch (t) {
                    e = t
                }
                for (var i = 0, n = this._children; i < n.length; i++) {
                    var r = n[i];
                    this._rejectWasConsumed ? r._resolve(null) : r._reject(e)
                }
                this._children.length = 0, delete this._onFulfilled, delete this._onRejected
            }, e.resolve = function(t) {
                var i = new e;
                return i._resolve(t), i
            }, e._RegisterForFulfillment = function(e, t, i) {
                e.then((function(e) {
                    return t.results[i] = e, t.count++, t.count === t.target && t.rootPromise._resolve(t.results), null
                }), (function(e) {
                    t.rootPromise._state !== Z.Rejected && t.rootPromise._reject(e)
                }))
            }, e.all = function(t) {
                var i = new e,
                    n = new J;
                if (n.target = t.length, n.rootPromise = i, t.length)
                    for (var r = 0; r < t.length; r++) e._RegisterForFulfillment(t[r], n, r);
                else i._resolve([]);
                return i
            }, e.race = function(t) {
                var i = new e;
                if (t.length)
                    for (var n = 0, r = t; n < r.length; n++) {
                        r[n].then((function(e) {
                            return i && (i._resolve(e), i = null), null
                        }), (function(e) {
                            i && (i._reject(e), i = null)
                        }))
                    }
                return i
            }, e
        }(),
        ee = function() {
            function e() {}
            return e.Apply = function(e) {
                (void 0 === e && (e = !1), e || "undefined" == typeof Promise) && (window.Promise = $)
            }, e
        }(),
        te = function() {
            function e() {
                this._defines = {}, this._currentRank = 32, this._maxRank = -1, this._mesh = null
            }
            return e.prototype.unBindMesh = function() {
                this._mesh = null
            }, e.prototype.addFallback = function(e, t) {
                this._defines[e] || (e < this._currentRank && (this._currentRank = e), e > this._maxRank && (this._maxRank = e), this._defines[e] = new Array), this._defines[e].push(t)
            }, e.prototype.addCPUSkinningFallback = function(e, t) {
                this._mesh = t, e < this._currentRank && (this._currentRank = e), e > this._maxRank && (this._maxRank = e)
            }, Object.defineProperty(e.prototype, "isMoreFallbacks", {
                get: function() {
                    return this._currentRank <= this._maxRank
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.reduce = function(e, t) {
                if (this._mesh && this._mesh.computeBonesUsingShaders && this._mesh.numBoneInfluencers > 0 && this._mesh.material) {
                    this._mesh.computeBonesUsingShaders = !1, e = e.replace("#define NUM_BONE_INFLUENCERS " + this._mesh.numBoneInfluencers, "#define NUM_BONE_INFLUENCERS 0"), t._bonesComputationForcedToCPU = !0;
                    for (var i = this._mesh.getScene(), n = 0; n < i.meshes.length; n++) {
                        var r = i.meshes[n];
                        if (r.material && (r.computeBonesUsingShaders && 0 !== r.numBoneInfluencers))
                            if (r.material.getEffect() === t) r.computeBonesUsingShaders = !1;
                            else if (r.subMeshes)
                            for (var o = 0, s = r.subMeshes; o < s.length; o++) {
                                if (s[o].effect === t) {
                                    r.computeBonesUsingShaders = !1;
                                    break
                                }
                            }
                    }
                } else {
                    var a = this._defines[this._currentRank];
                    if (a)
                        for (n = 0; n < a.length; n++) e = e.replace("#define " + a[n], "");
                    this._currentRank++
                }
                return e
            }, e
        }(),
        ie = function() {
            function e(t, i, n, r, o, s, a, u, h, c) {
                var d, f, p = this;
                if (void 0 === r && (r = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === u && (u = null), void 0 === h && (h = null), this.name = null, this.defines = "", this.onCompiled = null, this.onError = null, this.onBind = null, this.uniqueId = 0, this.onCompileObservable = new l, this.onErrorObservable = new l, this._onBindObservable = null, this._bonesComputationForcedToCPU = !1, this._uniformBuffersNames = {}, this._samplers = {}, this._isReady = !1, this._compilationError = "", this._uniforms = {}, this._key = "", this._fallbacks = null, this._vertexSourceCode = "", this._fragmentSourceCode = "", this._vertexSourceCodeOverride = "", this._fragmentSourceCodeOverride = "", this._transformFeedbackVaryings = null, this._pipelineContext = null, this._valueCache = {}, this.name = t, i.attributes) {
                    var _ = i;
                    if (this._engine = n, this._attributesNames = _.attributes, this._uniformsNames = _.uniformsNames.concat(_.samplers), this._samplerList = _.samplers.slice(), this.defines = _.defines, this.onError = _.onError, this.onCompiled = _.onCompiled, this._fallbacks = _.fallbacks, this._indexParameters = _.indexParameters, this._transformFeedbackVaryings = _.transformFeedbackVaryings, _.uniformBuffersNames)
                        for (var g = 0; g < _.uniformBuffersNames.length; g++) this._uniformBuffersNames[_.uniformBuffersNames[g]] = g
                } else this._engine = o, this.defines = null == s ? "" : s, this._uniformsNames = n.concat(r), this._samplerList = r ? r.slice() : [], this._attributesNames = i, this.onError = h, this.onCompiled = u, this._indexParameters = c, this._fallbacks = a;
                this.uniqueId = e._uniqueIdSeed++, t.vertexElement ? (d = document.getElementById(t.vertexElement)) || (d = t.vertexElement) : d = t.vertex || t, t.fragmentElement ? (f = document.getElementById(t.fragmentElement)) || (f = t.fragmentElement) : f = t.fragment || t, this._loadVertexShader(d, (function(e) {
                    p._processIncludes(e, (function(e) {
                        p._processShaderConversion(e, !1, (function(e) {
                            p._loadFragmentShader(f, (function(i) {
                                p._processIncludes(i, (function(i) {
                                    p._processShaderConversion(i, !0, (function(i) {
                                        if (t) {
                                            var n = t.vertexElement || t.vertex || t,
                                                r = t.fragmentElement || t.fragment || t;
                                            p._vertexSourceCode = "#define SHADER_NAME vertex:" + n + "\n" + e, p._fragmentSourceCode = "#define SHADER_NAME fragment:" + r + "\n" + i
                                        } else p._vertexSourceCode = e, p._fragmentSourceCode = i;
                                        p._prepareEffect()
                                    }))
                                }))
                            }))
                        }))
                    }))
                }))
            }
            return Object.defineProperty(e.prototype, "onBindObservable", {
                get: function() {
                    return this._onBindObservable || (this._onBindObservable = new l), this._onBindObservable
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "key", {
                get: function() {
                    return this._key
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.isReady = function() {
                return !!this._isReady || !!this._pipelineContext && this._pipelineContext.isReady
            }, e.prototype.getEngine = function() {
                return this._engine
            }, e.prototype.getPipelineContext = function() {
                return this._pipelineContext
            }, e.prototype.getAttributesNames = function() {
                return this._attributesNames
            }, e.prototype.getAttributeLocation = function(e) {
                return this._attributes[e]
            }, e.prototype.getAttributeLocationByName = function(e) {
                var t = this._attributesNames.indexOf(e);
                return this._attributes[t]
            }, e.prototype.getAttributesCount = function() {
                return this._attributes.length
            }, e.prototype.getUniformIndex = function(e) {
                return this._uniformsNames.indexOf(e)
            }, e.prototype.getUniform = function(e) {
                return this._uniforms[e]
            }, e.prototype.getSamplers = function() {
                return this._samplerList
            }, e.prototype.getCompilationError = function() {
                return this._compilationError
            }, e.prototype.executeWhenCompiled = function(e) {
                var t = this;
                this.isReady() ? e(this) : (this.onCompileObservable.add((function(t) {
                    e(t)
                })), this._pipelineContext && !this._pipelineContext.isAsync || setTimeout((function() {
                    t._checkIsReady()
                }), 16))
            }, e.prototype._checkIsReady = function() {
                var e = this;
                this.isReady() || setTimeout((function() {
                    e._checkIsReady()
                }), 16)
            }, e.prototype._loadVertexShader = function(t, i) {
                var n;
                if (c.IsWindowObjectExist() && t instanceof HTMLElement) return void i(c.GetDOMTextContent(t));
                "base64:" !== t.substr(0, 7) ? e.ShadersStore[t + "VertexShader"] ? i(e.ShadersStore[t + "VertexShader"]) : (n = "." === t[0] || "/" === t[0] || t.indexOf("http") > -1 ? t : e.ShadersRepository + t, this._engine._loadFile(n + ".vertex.fx", i)) : i(window.atob(t.substr(7)))
            }, e.prototype._loadFragmentShader = function(t, i) {
                var n;
                if (c.IsWindowObjectExist() && t instanceof HTMLElement) return void i(c.GetDOMTextContent(t));
                "base64:" !== t.substr(0, 7) ? e.ShadersStore[t + "PixelShader"] ? i(e.ShadersStore[t + "PixelShader"]) : e.ShadersStore[t + "FragmentShader"] ? i(e.ShadersStore[t + "FragmentShader"]) : (n = "." === t[0] || "/" === t[0] || t.indexOf("http") > -1 ? t : e.ShadersRepository + t, this._engine._loadFile(n + ".fragment.fx", i)) : i(window.atob(t.substr(7)))
            }, e.prototype._dumpShadersSource = function(e, t, i) {
                var n = (this._engine.webGLVersion > 1 ? "#version 300 es\n#define WEBGL2 \n" : "") + (i ? i + "\n" : "");
                t = n + t;
                var r = 2,
                    o = /\n/gm,
                    s = "\n1\t" + (e = n + e).replace(o, (function() {
                        return "\n" + r++ + "\t"
                    }));
                r = 2;
                var a = "\n1\t" + t.replace(o, (function() {
                    return "\n" + r++ + "\t"
                }));
                this.name.vertexElement ? (V.Error("Vertex shader: " + this.name.vertexElement + s), V.Error("Fragment shader: " + this.name.fragmentElement + a)) : this.name.vertex ? (V.Error("Vertex shader: " + this.name.vertex + s), V.Error("Fragment shader: " + this.name.fragment + a)) : (V.Error("Vertex shader: " + this.name + s), V.Error("Fragment shader: " + this.name + a))
            }, e.prototype._processShaderConversion = function(e, t, i) {
                var n = this._processPrecision(e);
                if (1 != this._engine.webGLVersion)
                    if (-1 === n.indexOf("#version 3")) {
                        var r = -1 !== n.search(/#extension.+GL_EXT_draw_buffers.+require/),
                            o = n.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g, "");
                        o = (o = (o = (o = o.replace(/varying(?![\n\r])\s/g, t ? "in " : "out ")).replace(/attribute[ \t]/g, "in ")).replace(/[ \t]attribute/g, " in")).replace(/texture2D\s*\(/g, "texture("), t && (o = (o = (o = (o = (o = (o = (o = o.replace(/texture2DLodEXT\s*\(/g, "textureLod(")).replace(/textureCubeLodEXT\s*\(/g, "textureLod(")).replace(/textureCube\s*\(/g, "texture(")).replace(/gl_FragDepthEXT/g, "gl_FragDepth")).replace(/gl_FragColor/g, "glFragColor")).replace(/gl_FragData/g, "glFragData")).replace(/void\s+?main\s*\(/g, (r ? "" : "out vec4 glFragColor;\n") + "void main(")), -1 !== this.defines.indexOf("#define MULTIVIEW\n") && !t && (o = "#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n" + o), i(o)
                    } else i(n.replace("#version 300 es", ""));
                else i(n)
            }, e.prototype._processIncludes = function(t, i) {
                for (var n = this, r = /#include<(.+)>(\((.*)\))*(\[(.*)\])*/g, o = r.exec(t), s = new String(t); null != o;) {
                    var a = o[1];
                    if (-1 !== a.indexOf("__decl__") && (a = a.replace(/__decl__/, ""), this._engine.supportsUniformBuffers && (a = (a = a.replace(/Vertex/, "Ubo")).replace(/Fragment/, "Ubo")), a += "Declaration"), !e.IncludesShadersStore[a]) {
                        var u = e.ShadersRepository + "ShadersInclude/" + a + ".fx";
                        return void this._engine._loadFile(u, (function(t) {
                            e.IncludesShadersStore[a] = t, n._processIncludes(s, i)
                        }))
                    }
                    var h = e.IncludesShadersStore[a];
                    if (o[2])
                        for (var l = o[3].split(","), c = 0; c < l.length; c += 2) {
                            var d = new RegExp(l[c], "g"),
                                f = l[c + 1];
                            h = h.replace(d, f)
                        }
                    if (o[4]) {
                        var p = o[5];
                        if (-1 !== p.indexOf("..")) {
                            var _ = p.split(".."),
                                g = parseInt(_[0]),
                                m = parseInt(_[1]),
                                v = h.slice(0);
                            h = "", isNaN(m) && (m = this._indexParameters[_[1]]);
                            for (var y = g; y < m; y++) this._engine.supportsUniformBuffers || (v = v.replace(/light\{X\}.(\w*)/g, (function(e, t) {
                                return t + "{X}"
                            }))), h += v.replace(/\{X\}/g, y.toString()) + "\n"
                        } else this._engine.supportsUniformBuffers || (h = h.replace(/light\{X\}.(\w*)/g, (function(e, t) {
                            return t + "{X}"
                        }))), h = h.replace(/\{X\}/g, p)
                    }
                    s = s.replace(o[0], h), o = r.exec(t)
                }
                i(s)
            }, e.prototype._processPrecision = function(e) {
                var t = this._engine._shouldUseHighPrecisionShader;
                return -1 === e.indexOf("precision highp float") ? e = t ? "precision highp float;\n" + e : "precision mediump float;\n" + e : t || (e = e.replace("precision highp float", "precision mediump float")), e
            }, e.prototype._rebuildProgram = function(e, t, i, n) {
                var r = this;
                this._isReady = !1, this._vertexSourceCodeOverride = e, this._fragmentSourceCodeOverride = t, this.onError = function(e, t) {
                    n && n(t)
                }, this.onCompiled = function() {
                    for (var e = r.getEngine().scenes, t = 0; t < e.length; t++) e[t].markAllMaterialsAsDirty(k.MATERIAL_AllDirtyFlag);
                    r._pipelineContext._handlesSpectorRebuildCallback(i)
                }, this._fallbacks = null, this._prepareEffect()
            }, e.prototype._prepareEffect = function() {
                var e = this,
                    t = this._attributesNames,
                    i = this.defines,
                    n = this._fallbacks;
                this._valueCache = {};
                var r = this._pipelineContext;
                try {
                    var o = this._engine;
                    this._pipelineContext = o.createPipelineContext();
                    var s = this._rebuildProgram.bind(this);
                    this._vertexSourceCodeOverride && this._fragmentSourceCodeOverride ? o._preparePipelineContext(this._pipelineContext, this._vertexSourceCodeOverride, this._fragmentSourceCodeOverride, !0, s, null, this._transformFeedbackVaryings) : o._preparePipelineContext(this._pipelineContext, this._vertexSourceCode, this._fragmentSourceCode, !1, s, i, this._transformFeedbackVaryings), o._executeWhenRenderingStateIsCompiled(this._pipelineContext, (function() {
                        if (o.supportsUniformBuffers)
                            for (var i in e._uniformBuffersNames) e.bindUniformBlock(i, e._uniformBuffersNames[i]);
                        var n;
                        for (o.getUniforms(e._pipelineContext, e._uniformsNames).forEach((function(t, i) {
                                e._uniforms[e._uniformsNames[i]] = t
                            })), e._attributes = o.getAttributes(e._pipelineContext, t), n = 0; n < e._samplerList.length; n++) {
                            null == e.getUniform(e._samplerList[n]) && (e._samplerList.splice(n, 1), n--)
                        }
                        e._samplerList.forEach((function(t, i) {
                            e._samplers[t] = i
                        })), o.bindSamplers(e), e._compilationError = "", e._isReady = !0, e.onCompiled && e.onCompiled(e), e.onCompileObservable.notifyObservers(e), e.onCompileObservable.clear(), e._fallbacks && e._fallbacks.unBindMesh(), r && e.getEngine()._deletePipelineContext(r)
                    })), this._pipelineContext.isAsync && this._checkIsReady()
                } catch (e) {
                    this._compilationError = e.message, V.Error("Unable to compile effect:"), V.Error("Uniforms: " + this._uniformsNames.map((function(e) {
                        return " " + e
                    }))), V.Error("Attributes: " + t.map((function(e) {
                        return " " + e
                    }))), V.Error("Error: " + this._compilationError), r && (this._pipelineContext = r, this._isReady = !0, this.onError && this.onError(this, this._compilationError), this.onErrorObservable.notifyObservers(this)), n && n.isMoreFallbacks ? (V.Error("Trying next fallback."), this.defines = n.reduce(this.defines, this), this._prepareEffect()) : (this.onError && this.onError(this, this._compilationError), this.onErrorObservable.notifyObservers(this), this.onErrorObservable.clear(), this._fallbacks && this._fallbacks.unBindMesh())
                }
            }, Object.defineProperty(e.prototype, "isSupported", {
                get: function() {
                    return "" === this._compilationError
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._bindTexture = function(e, t) {
                this._engine._bindTexture(this._samplers[e], t)
            }, e.prototype.setTexture = function(e, t) {
                this._engine.setTexture(this._samplers[e], this._uniforms[e], t)
            }, e.prototype.setDepthStencilTexture = function(e, t) {
                this._engine.setDepthStencilTexture(this._samplers[e], this._uniforms[e], t)
            }, e.prototype.setTextureArray = function(e, t) {
                var i = e + "Ex";
                if (-1 === this._samplerList.indexOf(i))
                    for (var n = this._samplers[e], r = 1; r < t.length; r++) this._samplerList.splice(n + r, 0, i), this._samplers[i] = n + r;
                this._engine.setTextureArray(this._samplers[e], this._uniforms[e], t)
            }, e.prototype.setTextureFromPostProcess = function(e, t) {
                this._engine.setTextureFromPostProcess(this._samplers[e], t)
            }, e.prototype.setTextureFromPostProcessOutput = function(e, t) {
                this._engine.setTextureFromPostProcessOutput(this._samplers[e], t)
            }, e.prototype._cacheMatrix = function(e, t) {
                var i = this._valueCache[e],
                    n = t.updateFlag;
                return (void 0 === i || i !== n) && (this._valueCache[e] = n, !0)
            }, e.prototype._cacheFloat2 = function(e, t, i) {
                var n = this._valueCache[e];
                if (!n) return n = [t, i], this._valueCache[e] = n, !0;
                var r = !1;
                return n[0] !== t && (n[0] = t, r = !0), n[1] !== i && (n[1] = i, r = !0), r
            }, e.prototype._cacheFloat3 = function(e, t, i, n) {
                var r = this._valueCache[e];
                if (!r) return r = [t, i, n], this._valueCache[e] = r, !0;
                var o = !1;
                return r[0] !== t && (r[0] = t, o = !0), r[1] !== i && (r[1] = i, o = !0), r[2] !== n && (r[2] = n, o = !0), o
            }, e.prototype._cacheFloat4 = function(e, t, i, n, r) {
                var o = this._valueCache[e];
                if (!o) return o = [t, i, n, r], this._valueCache[e] = o, !0;
                var s = !1;
                return o[0] !== t && (o[0] = t, s = !0), o[1] !== i && (o[1] = i, s = !0), o[2] !== n && (o[2] = n, s = !0), o[3] !== r && (o[3] = r, s = !0), s
            }, e.prototype.bindUniformBuffer = function(t, i) {
                var n = this._uniformBuffersNames[i];
                void 0 !== n && e._baseCache[n] !== t && (e._baseCache[n] = t, this._engine.bindUniformBufferBase(t, n))
            }, e.prototype.bindUniformBlock = function(e, t) {
                this._engine.bindUniformBlock(this._pipelineContext, e, t)
            }, e.prototype.setInt = function(e, t) {
                var i = this._valueCache[e];
                return void 0 !== i && i === t ? this : (this._valueCache[e] = t, this._engine.setInt(this._uniforms[e], t), this)
            }, e.prototype.setIntArray = function(e, t) {
                return this._valueCache[e] = null, this._engine.setIntArray(this._uniforms[e], t), this
            }, e.prototype.setIntArray2 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setIntArray2(this._uniforms[e], t), this
            }, e.prototype.setIntArray3 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setIntArray3(this._uniforms[e], t), this
            }, e.prototype.setIntArray4 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setIntArray4(this._uniforms[e], t), this
            }, e.prototype.setFloatArray = function(e, t) {
                return this._valueCache[e] = null, this._engine.setFloatArray(this._uniforms[e], t), this
            }, e.prototype.setFloatArray2 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setFloatArray2(this._uniforms[e], t), this
            }, e.prototype.setFloatArray3 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setFloatArray3(this._uniforms[e], t), this
            }, e.prototype.setFloatArray4 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setFloatArray4(this._uniforms[e], t), this
            }, e.prototype.setArray = function(e, t) {
                return this._valueCache[e] = null, this._engine.setArray(this._uniforms[e], t), this
            }, e.prototype.setArray2 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setArray2(this._uniforms[e], t), this
            }, e.prototype.setArray3 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setArray3(this._uniforms[e], t), this
            }, e.prototype.setArray4 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setArray4(this._uniforms[e], t), this
            }, e.prototype.setMatrices = function(e, t) {
                return t ? (this._valueCache[e] = null, this._engine.setMatrices(this._uniforms[e], t), this) : this
            }, e.prototype.setMatrix = function(e, t) {
                return this._cacheMatrix(e, t) && this._engine.setMatrix(this._uniforms[e], t), this
            }, e.prototype.setMatrix3x3 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setMatrix3x3(this._uniforms[e], t), this
            }, e.prototype.setMatrix2x2 = function(e, t) {
                return this._valueCache[e] = null, this._engine.setMatrix2x2(this._uniforms[e], t), this
            }, e.prototype.setFloat = function(e, t) {
                var i = this._valueCache[e];
                return void 0 !== i && i === t ? this : (this._valueCache[e] = t, this._engine.setFloat(this._uniforms[e], t), this)
            }, e.prototype.setBool = function(e, t) {
                var i = this._valueCache[e];
                return void 0 !== i && i === t ? this : (this._valueCache[e] = t, this._engine.setBool(this._uniforms[e], t ? 1 : 0), this)
            }, e.prototype.setVector2 = function(e, t) {
                return this._cacheFloat2(e, t.x, t.y) && this._engine.setFloat2(this._uniforms[e], t.x, t.y), this
            }, e.prototype.setFloat2 = function(e, t, i) {
                return this._cacheFloat2(e, t, i) && this._engine.setFloat2(this._uniforms[e], t, i), this
            }, e.prototype.setVector3 = function(e, t) {
                return this._cacheFloat3(e, t.x, t.y, t.z) && this._engine.setFloat3(this._uniforms[e], t.x, t.y, t.z), this
            }, e.prototype.setFloat3 = function(e, t, i, n) {
                return this._cacheFloat3(e, t, i, n) && this._engine.setFloat3(this._uniforms[e], t, i, n), this
            }, e.prototype.setVector4 = function(e, t) {
                return this._cacheFloat4(e, t.x, t.y, t.z, t.w) && this._engine.setFloat4(this._uniforms[e], t.x, t.y, t.z, t.w), this
            }, e.prototype.setFloat4 = function(e, t, i, n, r) {
                return this._cacheFloat4(e, t, i, n, r) && this._engine.setFloat4(this._uniforms[e], t, i, n, r), this
            }, e.prototype.setColor3 = function(e, t) {
                return this._cacheFloat3(e, t.r, t.g, t.b) && this._engine.setColor3(this._uniforms[e], t), this
            }, e.prototype.setColor4 = function(e, t, i) {
                return this._cacheFloat4(e, t.r, t.g, t.b, i) && this._engine.setColor4(this._uniforms[e], t, i), this
            }, e.prototype.setDirectColor4 = function(e, t) {
                return this._cacheFloat4(e, t.r, t.g, t.b, t.a) && this._engine.setDirectColor4(this._uniforms[e], t), this
            }, e.prototype.dispose = function() {
                this._engine._releaseEffect(this)
            }, e.RegisterShader = function(t, i, n) {
                i && (e.ShadersStore[t + "PixelShader"] = i), n && (e.ShadersStore[t + "VertexShader"] = n)
            }, e.ResetCache = function() {
                e._baseCache = {}
            }, e.ShadersRepository = "src/Shaders/", e._uniqueIdSeed = 0, e._baseCache = {}, e.ShadersStore = {}, e.IncludesShadersStore = {}, e
        }(),
        ne = function() {
            function e() {}
            return e.Eval = function(t, i) {
                return "true" === (t = t.match(/\([^\(\)]*\)/g) ? t.replace(/\([^\(\)]*\)/g, (function(t) {
                    return t = t.slice(1, t.length - 1), e._HandleParenthesisContent(t, i)
                })) : e._HandleParenthesisContent(t, i)) || "false" !== t && e.Eval(t, i)
            }, e._HandleParenthesisContent = function(t, i) {
                var n;
                i = i || function(e) {
                    return "true" === e
                };
                var r = t.split("||");
                for (var o in r)
                    if (r.hasOwnProperty(o)) {
                        var s = e._SimplifyNegation(r[o].trim()),
                            a = s.split("&&");
                        if (a.length > 1)
                            for (var u = 0; u < a.length; ++u) {
                                var h = e._SimplifyNegation(a[u].trim());
                                if (!(n = "true" !== h && "false" !== h ? "!" === h[0] ? !i(h.substring(1)) : i(h) : "true" === h)) {
                                    s = "false";
                                    break
                                }
                            }
                        if (n || "true" === s) {
                            n = !0;
                            break
                        }
                        n = "true" !== s && "false" !== s ? "!" === s[0] ? !i(s.substring(1)) : i(s) : "true" === s
                    }
                return n ? "true" : "false"
            }, e._SimplifyNegation = function(e) {
                return "!true" === (e = (e = e.replace(/^[\s!]+/, (function(e) {
                    return (e = e.replace(/[\s]/g, (function() {
                        return ""
                    }))).length % 2 ? "!" : ""
                }))).trim()) ? e = "false" : "!false" === e && (e = "true"), e
            }, e
        }(),
        re = function() {
            function e() {}
            return e.EnableFor = function(t) {
                t._tags = t._tags || {}, t.hasTags = function() {
                    return e.HasTags(t)
                }, t.addTags = function(i) {
                    return e.AddTagsTo(t, i)
                }, t.removeTags = function(i) {
                    return e.RemoveTagsFrom(t, i)
                }, t.matchesTagsQuery = function(i) {
                    return e.MatchesQuery(t, i)
                }
            }, e.DisableFor = function(e) {
                delete e._tags, delete e.hasTags, delete e.addTags, delete e.removeTags, delete e.matchesTagsQuery
            }, e.HasTags = function(e) {
                return !!e._tags && !K.IsEmpty(e._tags)
            }, e.GetTags = function(e, t) {
                if (void 0 === t && (t = !0), !e._tags) return null;
                if (t) {
                    var i = [];
                    for (var n in e._tags) e._tags.hasOwnProperty(n) && !0 === e._tags[n] && i.push(n);
                    return i.join(" ")
                }
                return e._tags
            }, e.AddTagsTo = function(t, i) {
                i && ("string" == typeof i && i.split(" ").forEach((function(i, n, r) {
                    e._AddTagTo(t, i)
                })))
            }, e._AddTagTo = function(t, i) {
                "" !== (i = i.trim()) && "true" !== i && "false" !== i && (i.match(/[\s]/) || i.match(/^([!]|([|]|[&]){2})/) || (e.EnableFor(t), t._tags[i] = !0))
            }, e.RemoveTagsFrom = function(t, i) {
                if (e.HasTags(t)) {
                    var n = i.split(" ");
                    for (var r in n) e._RemoveTagFrom(t, n[r])
                }
            }, e._RemoveTagFrom = function(e, t) {
                delete e._tags[t]
            }, e.MatchesQuery = function(t, i) {
                return void 0 === i || ("" === i ? e.HasTags(t) : ne.Eval(i, (function(i) {
                    return e.HasTags(t) && t._tags[i]
                })))
            }, e
        }(),
        oe = {},
        se = {},
        ae = function(e, t, i) {
            var n = e();
            re && re.AddTagsTo(n, t.tags);
            var r = ue(n);
            for (var o in r) {
                var s = r[o],
                    a = t[o],
                    u = s.type;
                if (null != a && "uniqueId" !== o) switch (u) {
                    case 0:
                    case 6:
                    case 11:
                        n[o] = a;
                        break;
                    case 1:
                        n[o] = i || a.isRenderTarget ? a : a.clone();
                        break;
                    case 2:
                    case 3:
                    case 4:
                    case 5:
                    case 7:
                    case 10:
                    case 12:
                        n[o] = i ? a : a.clone()
                }
            }
            return n
        };

    function ue(e) {
        var t = e.getClassName();
        if (se[t]) return se[t];
        se[t] = {};
        for (var i = se[t], n = e, r = t; r;) {
            var o = oe[r];
            for (var s in o) i[s] = o[s];
            var a = void 0,
                u = !1;
            do {
                if (!(a = Object.getPrototypeOf(n)).getClassName) {
                    u = !0;
                    break
                }
                if (a.getClassName() !== r) break;
                n = a
            } while (a);
            if (u) break;
            r = a.getClassName(), n = a
        }
        return i
    }

    function he(e, t) {
        return function(i, n) {
            var r = function(e) {
                var t = e.getClassName();
                return oe[t] || (oe[t] = {}), oe[t]
            }(i);
            r[n] || (r[n] = {
                type: e,
                sourceName: t
            })
        }
    }

    function le(e, t) {
        return void 0 === t && (t = null),
            function(e, t) {
                return void 0 === t && (t = null),
                    function(i, n) {
                        var r = t || "_" + n;
                        Object.defineProperty(i, n, {
                            get: function() {
                                return this[r]
                            },
                            set: function(t) {
                                this[r] !== t && (this[r] = t, i[e].apply(this))
                            },
                            enumerable: !0,
                            configurable: !0
                        })
                    }
            }(e, t)
    }

    function ce(e) {
        return he(0, e)
    }

    function de(e) {
        return he(1, e)
    }

    function fe(e) {
        return he(2, e)
    }

    function pe(e) {
        return he(3, e)
    }

    function _e(e) {
        return he(5, e)
    }

    function ge(e) {
        return he(8, e)
    }
    var me = function() {
            function e() {}
            return e.AppendSerializedAnimations = function(e, t) {
                if (e.animations) {
                    t.animations = [];
                    for (var i = 0; i < e.animations.length; i++) {
                        var n = e.animations[i];
                        t.animations.push(n.serialize())
                    }
                }
            }, e.Serialize = function(e, t) {
                t || (t = {}), re && (t.tags = re.GetTags(e));
                var i = ue(e);
                for (var n in i) {
                    var r = i[n],
                        o = r.sourceName || n,
                        s = r.type,
                        a = e[n];
                    if (null != a) switch (s) {
                        case 0:
                            t[o] = a;
                            break;
                        case 1:
                            t[o] = a.serialize();
                            break;
                        case 2:
                            t[o] = a.asArray();
                            break;
                        case 3:
                            t[o] = a.serialize();
                            break;
                        case 4:
                        case 5:
                            t[o] = a.asArray();
                            break;
                        case 6:
                            t[o] = a.id;
                            break;
                        case 7:
                            t[o] = a.serialize();
                            break;
                        case 8:
                            t[o] = a.asArray();
                            break;
                        case 9:
                            t[o] = a.serialize();
                            break;
                        case 10:
                            t[o] = a.asArray();
                            break;
                        case 11:
                            t[o] = a.id;
                        case 12:
                            t[o] = a.asArray()
                    }
                }
                return t
            }, e.Parse = function(t, i, n, r) {
                void 0 === r && (r = null);
                var o = t();
                r || (r = ""), re && re.AddTagsTo(o, i.tags);
                var s = ue(o);
                for (var a in s) {
                    var u = s[a],
                        h = i[u.sourceName || a],
                        l = u.type;
                    if (null != h) {
                        var c = o;
                        switch (l) {
                            case 0:
                                c[a] = h;
                                break;
                            case 1:
                                n && (c[a] = e._TextureParser(h, n, r));
                                break;
                            case 2:
                                c[a] = v.FromArray(h);
                                break;
                            case 3:
                                c[a] = e._FresnelParametersParser(h);
                                break;
                            case 4:
                                c[a] = T.FromArray(h);
                                break;
                            case 5:
                                c[a] = b.FromArray(h);
                                break;
                            case 6:
                                n && (c[a] = n.getLastMeshByID(h));
                                break;
                            case 7:
                                c[a] = e._ColorCurvesParser(h);
                                break;
                            case 8:
                                c[a] = y.FromArray(h);
                                break;
                            case 9:
                                c[a] = e._ImageProcessingConfigurationParser(h);
                                break;
                            case 10:
                                c[a] = M.FromArray(h);
                                break;
                            case 11:
                                n && (c[a] = n.getCameraByID(h));
                            case 12:
                                c[a] = R.FromArray(h)
                        }
                    }
                }
                return o
            }, e.Clone = function(e, t) {
                return ae(e, t, !1)
            }, e.Instanciate = function(e, t) {
                return ae(e, t, !0)
            }, e._ImageProcessingConfigurationParser = function(e) {
                throw X.WarnImport("ImageProcessingConfiguration")
            }, e._FresnelParametersParser = function(e) {
                throw X.WarnImport("FresnelParameters")
            }, e._ColorCurvesParser = function(e) {
                throw X.WarnImport("ColorCurves")
            }, e._TextureParser = function(e, t, i) {
                throw X.WarnImport("Texture")
            }, e
        }(),
        ve = function() {
            function e() {}
            return Object.defineProperty(e, "LastCreatedEngine", {
                get: function() {
                    return 0 === this.Instances.length ? null : this.Instances[this.Instances.length - 1]
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "LastCreatedScene", {
                get: function() {
                    return this._LastCreatedScene
                },
                enumerable: !0,
                configurable: !0
            }), e.Instances = new Array, e._LastCreatedScene = null, e
        }(),
        ye = function() {
            function e(e, t, i, n, r, o, s) {
                void 0 === n && (n = 0), void 0 === r && (r = !1), void 0 === o && (o = !1), void 0 === s && (s = !1), e.getScene ? this._engine = e.getScene().getEngine() : this._engine = e, this._updatable = i, this._instanced = o, this._data = t, this.byteStride = s ? n : n * Float32Array.BYTES_PER_ELEMENT, r || this.create()
            }
            return e.prototype.createVertexBuffer = function(e, t, i, n, r, o) {
                void 0 === o && (o = !1);
                var s = o ? t : t * Float32Array.BYTES_PER_ELEMENT,
                    a = n ? o ? n : n * Float32Array.BYTES_PER_ELEMENT : this.byteStride;
                return new Te(this._engine, this, e, this._updatable, !0, a, void 0 === r ? this._instanced : r, s, i, void 0, void 0, !0)
            }, e.prototype.isUpdatable = function() {
                return this._updatable
            }, e.prototype.getData = function() {
                return this._data
            }, e.prototype.getBuffer = function() {
                return this._buffer
            }, e.prototype.getStrideSize = function() {
                return this.byteStride / Float32Array.BYTES_PER_ELEMENT
            }, e.prototype.create = function(e) {
                void 0 === e && (e = null), !e && this._buffer || (e = e || this._data) && (this._buffer ? this._updatable && (this._engine.updateDynamicVertexBuffer(this._buffer, e), this._data = e) : this._updatable ? (this._buffer = this._engine.createDynamicVertexBuffer(e), this._data = e) : this._buffer = this._engine.createVertexBuffer(e))
            }, e.prototype._rebuild = function() {
                this._buffer = null, this.create(this._data)
            }, e.prototype.update = function(e) {
                this.create(e)
            }, e.prototype.updateDirectly = function(e, t, i, n) {
                void 0 === n && (n = !1), this._buffer && this._updatable && (this._engine.updateDynamicVertexBuffer(this._buffer, e, n ? t : t * Float32Array.BYTES_PER_ELEMENT, i ? i * this.byteStride : void 0), this._data = null)
            }, e.prototype.dispose = function() {
                this._buffer && this._engine._releaseBuffer(this._buffer) && (this._buffer = null)
            }, e
        }(),
        Te = function() {
            function e(t, i, n, r, o, s, a, u, h, l, c, d) {
                if (void 0 === c && (c = !1), void 0 === d && (d = !1), i instanceof ye ? (this._buffer = i, this._ownsBuffer = !1) : (this._buffer = new ye(t, i, r, s, o, a, d), this._ownsBuffer = !0), this._kind = n, null == l) {
                    var f = this.getData();
                    this.type = e.FLOAT, f instanceof Int8Array ? this.type = e.BYTE : f instanceof Uint8Array ? this.type = e.UNSIGNED_BYTE : f instanceof Int16Array ? this.type = e.SHORT : f instanceof Uint16Array ? this.type = e.UNSIGNED_SHORT : f instanceof Int32Array ? this.type = e.INT : f instanceof Uint32Array && (this.type = e.UNSIGNED_INT)
                } else this.type = l;
                var p = e.GetTypeByteLength(this.type);
                d ? (this._size = h || (s ? s / p : e.DeduceStride(n)), this.byteStride = s || this._buffer.byteStride || this._size * p, this.byteOffset = u || 0) : (this._size = h || s || e.DeduceStride(n), this.byteStride = s ? s * p : this._buffer.byteStride || this._size * p, this.byteOffset = (u || 0) * p), this.normalized = c, this._instanced = void 0 !== a && a, this._instanceDivisor = a ? 1 : 0
            }
            return Object.defineProperty(e.prototype, "instanceDivisor", {
                get: function() {
                    return this._instanceDivisor
                },
                set: function(e) {
                    this._instanceDivisor = e, this._instanced = 0 != e
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._rebuild = function() {
                this._buffer && this._buffer._rebuild()
            }, e.prototype.getKind = function() {
                return this._kind
            }, e.prototype.isUpdatable = function() {
                return this._buffer.isUpdatable()
            }, e.prototype.getData = function() {
                return this._buffer.getData()
            }, e.prototype.getBuffer = function() {
                return this._buffer.getBuffer()
            }, e.prototype.getStrideSize = function() {
                return this.byteStride / e.GetTypeByteLength(this.type)
            }, e.prototype.getOffset = function() {
                return this.byteOffset / e.GetTypeByteLength(this.type)
            }, e.prototype.getSize = function() {
                return this._size
            }, e.prototype.getIsInstanced = function() {
                return this._instanced
            }, e.prototype.getInstanceDivisor = function() {
                return this._instanceDivisor
            }, e.prototype.create = function(e) {
                this._buffer.create(e)
            }, e.prototype.update = function(e) {
                this._buffer.update(e)
            }, e.prototype.updateDirectly = function(e, t, i) {
                void 0 === i && (i = !1), this._buffer.updateDirectly(e, t, void 0, i)
            }, e.prototype.dispose = function() {
                this._ownsBuffer && this._buffer.dispose()
            }, e.prototype.forEach = function(t, i) {
                e.ForEach(this._buffer.getData(), this.byteOffset, this.byteStride, this._size, this.type, t, this.normalized, i)
            }, e.DeduceStride = function(t) {
                switch (t) {
                    case e.UVKind:
                    case e.UV2Kind:
                    case e.UV3Kind:
                    case e.UV4Kind:
                    case e.UV5Kind:
                    case e.UV6Kind:
                        return 2;
                    case e.NormalKind:
                    case e.PositionKind:
                        return 3;
                    case e.ColorKind:
                    case e.MatricesIndicesKind:
                    case e.MatricesIndicesExtraKind:
                    case e.MatricesWeightsKind:
                    case e.MatricesWeightsExtraKind:
                    case e.TangentKind:
                        return 4;
                    default:
                        throw new Error("Invalid kind '" + t + "'")
                }
            }, e.GetTypeByteLength = function(t) {
                switch (t) {
                    case e.BYTE:
                    case e.UNSIGNED_BYTE:
                        return 1;
                    case e.SHORT:
                    case e.UNSIGNED_SHORT:
                        return 2;
                    case e.INT:
                    case e.FLOAT:
                        return 4;
                    default:
                        throw new Error("Invalid type '" + t + "'")
                }
            }, e.ForEach = function(t, i, n, r, o, s, a, u) {
                if (t instanceof Array)
                    for (var h = i / 4, l = n / 4, c = 0; c < s; c += r) {
                        for (var d = 0; d < r; d++) u(t[h + d], c + d);
                        h += l
                    } else {
                        var f = t instanceof ArrayBuffer ? new DataView(t) : new DataView(t.buffer, t.byteOffset, t.byteLength),
                            p = e.GetTypeByteLength(o);
                        for (c = 0; c < s; c += r) {
                            var _ = i;
                            for (d = 0; d < r; d++) {
                                u(e._GetFloatValue(f, o, _, a), c + d), _ += p
                            }
                            i += n
                        }
                    }
            }, e._GetFloatValue = function(t, i, n, r) {
                switch (i) {
                    case e.BYTE:
                        var o = t.getInt8(n);
                        return r && (o = Math.max(o / 127, -1)), o;
                    case e.UNSIGNED_BYTE:
                        o = t.getUint8(n);
                        return r && (o /= 255), o;
                    case e.SHORT:
                        o = t.getInt16(n, !0);
                        return r && (o = Math.max(o / 16383, -1)), o;
                    case e.UNSIGNED_SHORT:
                        o = t.getUint16(n, !0);
                        return r && (o /= 65535), o;
                    case e.FLOAT:
                        return t.getFloat32(n, !0);
                    default:
                        throw new Error("Invalid component type " + i)
                }
            }, e.BYTE = 5120, e.UNSIGNED_BYTE = 5121, e.SHORT = 5122, e.UNSIGNED_SHORT = 5123, e.INT = 5124, e.UNSIGNED_INT = 5125, e.FLOAT = 5126, e.PositionKind = "position", e.NormalKind = "normal", e.TangentKind = "tangent", e.UVKind = "uv", e.UV2Kind = "uv2", e.UV3Kind = "uv3", e.UV4Kind = "uv4", e.UV5Kind = "uv5", e.UV6Kind = "uv6", e.ColorKind = "color", e.MatricesIndicesKind = "matricesIndices", e.MatricesWeightsKind = "matricesWeights", e.MatricesIndicesExtraKind = "matricesIndicesExtra", e.MatricesWeightsExtraKind = "matricesWeightsExtra", e
        }(),
        be = function(e, t, i) {
            this.bu = e, this.bv = t, this.distance = i, this.faceId = 0, this.subMeshId = 0
        },
        Ee = function() {
            function e(e, t, i) {
                this.vectors = g.BuildArray(8, b.Zero), this.center = b.Zero(), this.centerWorld = b.Zero(), this.extendSize = b.Zero(), this.extendSizeWorld = b.Zero(), this.directions = g.BuildArray(3, b.Zero), this.vectorsWorld = g.BuildArray(8, b.Zero), this.minimumWorld = b.Zero(), this.maximumWorld = b.Zero(), this.minimum = b.Zero(), this.maximum = b.Zero(), this.reConstruct(e, t, i)
            }
            return e.prototype.reConstruct = function(e, t, i) {
                var n = e.x,
                    r = e.y,
                    o = e.z,
                    s = t.x,
                    a = t.y,
                    u = t.z,
                    h = this.vectors;
                this.minimum.copyFromFloats(n, r, o), this.maximum.copyFromFloats(s, a, u), h[0].copyFromFloats(n, r, o), h[1].copyFromFloats(s, a, u), h[2].copyFromFloats(s, r, o), h[3].copyFromFloats(n, a, o), h[4].copyFromFloats(n, r, u), h[5].copyFromFloats(s, a, o), h[6].copyFromFloats(n, a, u), h[7].copyFromFloats(s, r, u), t.addToRef(e, this.center).scaleInPlace(.5), t.subtractToRef(e, this.extendSize).scaleInPlace(.5), this._worldMatrix = i || R.IdentityReadOnly, this._update(this._worldMatrix)
            }, e.prototype.scale = function(t) {
                var i = e.TmpVector3,
                    n = this.maximum.subtractToRef(this.minimum, i[0]),
                    r = n.length();
                n.normalizeFromLength(r);
                var o = r * t,
                    s = n.scaleInPlace(.5 * o),
                    a = this.center.subtractToRef(s, i[1]),
                    u = this.center.addToRef(s, i[2]);
                return this.reConstruct(a, u, this._worldMatrix), this
            }, e.prototype.getWorldMatrix = function() {
                return this._worldMatrix
            }, e.prototype._update = function(e) {
                var t = this.minimumWorld,
                    i = this.maximumWorld,
                    n = this.directions,
                    r = this.vectorsWorld,
                    o = this.vectors;
                if (e.isIdentity()) {
                    t.copyFrom(this.minimum), i.copyFrom(this.maximum);
                    for (s = 0; s < 8; ++s) r[s].copyFrom(o[s]);
                    this.extendSizeWorld.copyFrom(this.extendSize), this.centerWorld.copyFrom(this.center)
                } else {
                    t.setAll(Number.MAX_VALUE), i.setAll(-Number.MAX_VALUE);
                    for (var s = 0; s < 8; ++s) {
                        var a = r[s];
                        b.TransformCoordinatesToRef(o[s], e, a), t.minimizeInPlace(a), i.maximizeInPlace(a)
                    }
                    i.subtractToRef(t, this.extendSizeWorld).scaleInPlace(.5), i.addToRef(t, this.centerWorld).scaleInPlace(.5)
                }
                b.FromArrayToRef(e.m, 0, n[0]), b.FromArrayToRef(e.m, 4, n[1]), b.FromArrayToRef(e.m, 8, n[2]), this._worldMatrix = e
            }, e.prototype.isInFrustum = function(t) {
                return e.IsInFrustum(this.vectorsWorld, t)
            }, e.prototype.isCompletelyInFrustum = function(t) {
                return e.IsCompletelyInFrustum(this.vectorsWorld, t)
            }, e.prototype.intersectsPoint = function(e) {
                var t = this.minimumWorld,
                    i = this.maximumWorld,
                    n = t.x,
                    r = t.y,
                    o = t.z,
                    s = i.x,
                    a = i.y,
                    u = i.z,
                    h = e.x,
                    l = e.y,
                    c = e.z;
                return !(s - h < -.001 || -.001 > h - n) && (!(a - l < -.001 || -.001 > l - r) && !(u - c < -.001 || -.001 > c - o))
            }, e.prototype.intersectsSphere = function(t) {
                return e.IntersectsSphere(this.minimumWorld, this.maximumWorld, t.centerWorld, t.radiusWorld)
            }, e.prototype.intersectsMinMax = function(e, t) {
                var i = this.minimumWorld,
                    n = this.maximumWorld,
                    r = i.x,
                    o = i.y,
                    s = i.z,
                    a = n.x,
                    u = n.y,
                    h = n.z,
                    l = e.x,
                    c = e.y,
                    d = e.z,
                    f = t.x,
                    p = t.y,
                    _ = t.z;
                return !(a < l || r > f) && (!(u < c || o > p) && !(h < d || s > _))
            }, e.Intersects = function(e, t) {
                return e.intersectsMinMax(t.minimumWorld, t.maximumWorld)
            }, e.IntersectsSphere = function(t, i, n, r) {
                var o = e.TmpVector3[0];
                return b.ClampToRef(n, t, i, o), b.DistanceSquared(n, o) <= r * r
            }, e.IsCompletelyInFrustum = function(e, t) {
                for (var i = 0; i < 6; ++i)
                    for (var n = t[i], r = 0; r < 8; ++r)
                        if (n.dotCoordinate(e[r]) < 0) return !1;
                return !0
            }, e.IsInFrustum = function(e, t) {
                for (var i = 0; i < 6; ++i) {
                    for (var n = !0, r = t[i], o = 0; o < 8; ++o)
                        if (r.dotCoordinate(e[o]) >= 0) {
                            n = !1;
                            break
                        }
                    if (n) return !1
                }
                return !0
            }, e.TmpVector3 = g.BuildArray(3, b.Zero), e
        }(),
        Ae = function() {
            function e(e, t, i) {
                this.center = b.Zero(), this.centerWorld = b.Zero(), this.minimum = b.Zero(), this.maximum = b.Zero(), this.reConstruct(e, t, i)
            }
            return e.prototype.reConstruct = function(e, t, i) {
                this.minimum.copyFrom(e), this.maximum.copyFrom(t);
                var n = b.Distance(e, t);
                t.addToRef(e, this.center).scaleInPlace(.5), this.radius = .5 * n, this._update(i || R.IdentityReadOnly)
            }, e.prototype.scale = function(t) {
                var i = this.radius * t,
                    n = e.TmpVector3,
                    r = n[0].setAll(i),
                    o = this.center.subtractToRef(r, n[1]),
                    s = this.center.addToRef(r, n[2]);
                return this.reConstruct(o, s, this._worldMatrix), this
            }, e.prototype.getWorldMatrix = function() {
                return this._worldMatrix
            }, e.prototype._update = function(t) {
                if (t.isIdentity()) this.centerWorld.copyFrom(this.center), this.radiusWorld = this.radius;
                else {
                    b.TransformCoordinatesToRef(this.center, t, this.centerWorld);
                    var i = e.TmpVector3[0];
                    b.TransformNormalFromFloatsToRef(1, 1, 1, t, i), this.radiusWorld = Math.max(Math.abs(i.x), Math.abs(i.y), Math.abs(i.z)) * this.radius
                }
            }, e.prototype.isInFrustum = function(e) {
                for (var t = this.centerWorld, i = this.radiusWorld, n = 0; n < 6; n++)
                    if (e[n].dotCoordinate(t) <= -i) return !1;
                return !0
            }, e.prototype.isCenterInFrustum = function(e) {
                for (var t = this.centerWorld, i = 0; i < 6; i++)
                    if (e[i].dotCoordinate(t) < 0) return !1;
                return !0
            }, e.prototype.intersectsPoint = function(e) {
                var t = b.DistanceSquared(this.centerWorld, e);
                return !(this.radiusWorld * this.radiusWorld < t)
            }, e.Intersects = function(e, t) {
                var i = b.DistanceSquared(e.centerWorld, t.centerWorld),
                    n = e.radiusWorld + t.radiusWorld;
                return !(n * n < i)
            }, e.TmpVector3 = g.BuildArray(3, b.Zero), e
        }(),
        Me = {
            min: 0,
            max: 0
        },
        Re = {
            min: 0,
            max: 0
        },
        xe = function(e, t, i) {
            var n = b.Dot(t.centerWorld, e),
                r = Math.abs(b.Dot(t.directions[0], e)) * t.extendSize.x + Math.abs(b.Dot(t.directions[1], e)) * t.extendSize.y + Math.abs(b.Dot(t.directions[2], e)) * t.extendSize.z;
            i.min = n - r, i.max = n + r
        },
        Pe = function(e, t, i) {
            return xe(e, t, Me), xe(e, i, Re), !(Me.min > Re.max || Re.min > Me.max)
        },
        Ie = function() {
            function e(e, t, i) {
                this._isLocked = !1, this.boundingBox = new Ee(e, t, i), this.boundingSphere = new Ae(e, t, i)
            }
            return e.prototype.reConstruct = function(e, t, i) {
                this.boundingBox.reConstruct(e, t, i), this.boundingSphere.reConstruct(e, t, i)
            }, Object.defineProperty(e.prototype, "minimum", {
                get: function() {
                    return this.boundingBox.minimum
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "maximum", {
                get: function() {
                    return this.boundingBox.maximum
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isLocked", {
                get: function() {
                    return this._isLocked
                },
                set: function(e) {
                    this._isLocked = e
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.update = function(e) {
                this._isLocked || (this.boundingBox._update(e), this.boundingSphere._update(e))
            }, e.prototype.centerOn = function(t, i) {
                var n = e.TmpVector3[0].copyFrom(t).subtractInPlace(i),
                    r = e.TmpVector3[1].copyFrom(t).addInPlace(i);
                return this.boundingBox.reConstruct(n, r, this.boundingBox.getWorldMatrix()), this.boundingSphere.reConstruct(n, r, this.boundingBox.getWorldMatrix()), this
            }, e.prototype.scale = function(e) {
                return this.boundingBox.scale(e), this.boundingSphere.scale(e), this
            }, e.prototype.isInFrustum = function(e, t) {
                return void 0 === t && (t = k.MESHES_CULLINGSTRATEGY_STANDARD), !(t !== k.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION && t !== k.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY || !this.boundingSphere.isCenterInFrustum(e)) || !!this.boundingSphere.isInFrustum(e) && (!(t !== k.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY && t !== k.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY) || this.boundingBox.isInFrustum(e))
            }, Object.defineProperty(e.prototype, "diagonalLength", {
                get: function() {
                    var t = this.boundingBox;
                    return t.maximumWorld.subtractToRef(t.minimumWorld, e.TmpVector3[0]).length()
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.isCompletelyInFrustum = function(e) {
                return this.boundingBox.isCompletelyInFrustum(e)
            }, e.prototype._checkCollision = function(e) {
                return e._canDoCollision(this.boundingSphere.centerWorld, this.boundingSphere.radiusWorld, this.boundingBox.minimumWorld, this.boundingBox.maximumWorld)
            }, e.prototype.intersectsPoint = function(e) {
                return !!this.boundingSphere.centerWorld && (!!this.boundingSphere.intersectsPoint(e) && !!this.boundingBox.intersectsPoint(e))
            }, e.prototype.intersects = function(e, t) {
                if (!Ae.Intersects(this.boundingSphere, e.boundingSphere)) return !1;
                if (!Ee.Intersects(this.boundingBox, e.boundingBox)) return !1;
                if (!t) return !0;
                var i = this.boundingBox,
                    n = e.boundingBox;
                return !!Pe(i.directions[0], i, n) && (!!Pe(i.directions[1], i, n) && (!!Pe(i.directions[2], i, n) && (!!Pe(n.directions[0], i, n) && (!!Pe(n.directions[1], i, n) && (!!Pe(n.directions[2], i, n) && (!!Pe(b.Cross(i.directions[0], n.directions[0]), i, n) && (!!Pe(b.Cross(i.directions[0], n.directions[1]), i, n) && (!!Pe(b.Cross(i.directions[0], n.directions[2]), i, n) && (!!Pe(b.Cross(i.directions[1], n.directions[0]), i, n) && (!!Pe(b.Cross(i.directions[1], n.directions[1]), i, n) && (!!Pe(b.Cross(i.directions[1], n.directions[2]), i, n) && (!!Pe(b.Cross(i.directions[2], n.directions[0]), i, n) && (!!Pe(b.Cross(i.directions[2], n.directions[1]), i, n) && !!Pe(b.Cross(i.directions[2], n.directions[2]), i, n))))))))))))))
            }, e.TmpVector3 = g.BuildArray(2, b.Zero), e
        }(),
        Ce = function() {
            function e() {
                this._materialDefines = null, this._materialEffect = null
            }
            return Object.defineProperty(e.prototype, "effect", {
                get: function() {
                    return this._materialEffect
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.setEffect = function(e, t) {
                void 0 === t && (t = null), this._materialEffect !== e ? (this._materialDefines = t, this._materialEffect = e) : e || (this._materialDefines = null)
            }, e
        }(),
        Se = function(e) {
            function t(t, i, n, r, o, s, a, u) {
                void 0 === u && (u = !0);
                var h = e.call(this) || this;
                return h.materialIndex = t, h.verticesStart = i, h.verticesCount = n, h.indexStart = r, h.indexCount = o, h._linesIndexCount = 0, h._linesIndexBuffer = null, h._lastColliderWorldVertices = null, h._lastColliderTransformMatrix = null, h._renderId = 0, h._alphaIndex = 0, h._distanceToCamera = 0, h._currentMaterial = null, h._mesh = s, h._renderingMesh = a || s, s.subMeshes.push(h), h._trianglePlanes = [], h._id = s.subMeshes.length - 1, u && (h.refreshBoundingInfo(), s.computeWorldMatrix(!0)), h
            }
            return r(t, e), t.AddToMesh = function(e, i, n, r, o, s, a, u) {
                return void 0 === u && (u = !0), new t(e, i, n, r, o, s, a, u)
            }, Object.defineProperty(t.prototype, "IsGlobal", {
                get: function() {
                    return 0 === this.verticesStart && this.verticesCount === this._mesh.getTotalVertices()
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getBoundingInfo = function() {
                return this.IsGlobal ? this._mesh.getBoundingInfo() : this._boundingInfo
            }, t.prototype.setBoundingInfo = function(e) {
                return this._boundingInfo = e, this
            }, t.prototype.getMesh = function() {
                return this._mesh
            }, t.prototype.getRenderingMesh = function() {
                return this._renderingMesh
            }, t.prototype.getMaterial = function() {
                var e = this._renderingMesh.material;
                if (null == e) return this._mesh.getScene().defaultMaterial;
                if (e.getSubMaterial) {
                    var t = e.getSubMaterial(this.materialIndex);
                    return this._currentMaterial !== t && (this._currentMaterial = t, this._materialDefines = null), t
                }
                return e
            }, t.prototype.refreshBoundingInfo = function(e) {
                if (void 0 === e && (e = null), this._lastColliderWorldVertices = null, this.IsGlobal || !this._renderingMesh || !this._renderingMesh.geometry) return this;
                if (e || (e = this._renderingMesh.getVerticesData(Te.PositionKind)), !e) return this._boundingInfo = this._mesh.getBoundingInfo(), this;
                var t, i = this._renderingMesh.getIndices();
                if (0 === this.indexStart && this.indexCount === i.length) {
                    var n = this._renderingMesh.getBoundingInfo();
                    t = {
                        minimum: n.minimum.clone(),
                        maximum: n.maximum.clone()
                    }
                } else t = K.ExtractMinAndMaxIndexed(e, i, this.indexStart, this.indexCount, this._renderingMesh.geometry.boundingBias);
                return this._boundingInfo ? this._boundingInfo.reConstruct(t.minimum, t.maximum) : this._boundingInfo = new Ie(t.minimum, t.maximum), this
            }, t.prototype._checkCollision = function(e) {
                return this.getBoundingInfo()._checkCollision(e)
            }, t.prototype.updateBoundingInfo = function(e) {
                var t = this.getBoundingInfo();
                return t || (this.refreshBoundingInfo(), t = this.getBoundingInfo()), t.update(e), this
            }, t.prototype.isInFrustum = function(e) {
                var t = this.getBoundingInfo();
                return !!t && t.isInFrustum(e, this._mesh.cullingStrategy)
            }, t.prototype.isCompletelyInFrustum = function(e) {
                var t = this.getBoundingInfo();
                return !!t && t.isCompletelyInFrustum(e)
            }, t.prototype.render = function(e) {
                return this._renderingMesh.render(this, e), this
            }, t.prototype._getLinesIndexBuffer = function(e, t) {
                if (!this._linesIndexBuffer) {
                    for (var i = [], n = this.indexStart; n < this.indexStart + this.indexCount; n += 3) i.push(e[n], e[n + 1], e[n + 1], e[n + 2], e[n + 2], e[n]);
                    this._linesIndexBuffer = t.createIndexBuffer(i), this._linesIndexCount = i.length
                }
                return this._linesIndexBuffer
            }, t.prototype.canIntersects = function(e) {
                var t = this.getBoundingInfo();
                return !!t && e.intersectsBox(t.boundingBox)
            }, t.prototype.intersects = function(e, t, i, n, r) {
                var o = this.getMaterial();
                if (!o) return null;
                switch (o.fillMode) {
                    case k.MATERIAL_PointListDrawMode:
                    case k.MATERIAL_LineListDrawMode:
                    case k.MATERIAL_LineLoopDrawMode:
                    case k.MATERIAL_LineStripDrawMode:
                    case k.MATERIAL_TriangleFanDrawMode:
                    case k.MATERIAL_TriangleStripDrawMode:
                        return null
                }
                return "InstancedLinesMesh" === this._mesh.getClassName() || "LinesMesh" === this._mesh.getClassName() ? i.length ? this._intersectLines(e, t, i, this._mesh.intersectionThreshold, n) : this._intersectUnIndexedLines(e, t, i, this._mesh.intersectionThreshold, n) : !i.length && this._mesh._unIndexed ? this._intersectUnIndexedTriangles(e, t, i, n, r) : this._intersectTriangles(e, t, i, n, r)
            }, t.prototype._intersectLines = function(e, t, i, n, r) {
                for (var o = null, s = this.indexStart; s < this.indexStart + this.indexCount; s += 2) {
                    var a = t[i[s]],
                        u = t[i[s + 1]],
                        h = e.intersectionSegment(a, u, n);
                    if (!(h < 0) && ((r || !o || h < o.distance) && ((o = new be(null, null, h)).faceId = s / 2, r))) break
                }
                return o
            }, t.prototype._intersectUnIndexedLines = function(e, t, i, n, r) {
                for (var o = null, s = this.verticesStart; s < this.verticesStart + this.verticesCount; s += 2) {
                    var a = t[s],
                        u = t[s + 1],
                        h = e.intersectionSegment(a, u, n);
                    if (!(h < 0) && ((r || !o || h < o.distance) && ((o = new be(null, null, h)).faceId = s / 2, r))) break
                }
                return o
            }, t.prototype._intersectTriangles = function(e, t, i, n, r) {
                for (var o = null, s = this.indexStart; s < this.indexStart + this.indexCount; s += 3) {
                    var a = t[i[s]],
                        u = t[i[s + 1]],
                        h = t[i[s + 2]];
                    if (!r || r(a, u, h, e)) {
                        var l = e.intersectsTriangle(a, u, h);
                        if (l) {
                            if (l.distance < 0) continue;
                            if ((n || !o || l.distance < o.distance) && ((o = l).faceId = s / 3, n)) break
                        }
                    }
                }
                return o
            }, t.prototype._intersectUnIndexedTriangles = function(e, t, i, n, r) {
                for (var o = null, s = this.verticesStart; s < this.verticesStart + this.verticesCount; s += 3) {
                    var a = t[s],
                        u = t[s + 1],
                        h = t[s + 2];
                    if (!r || r(a, u, h, e)) {
                        var l = e.intersectsTriangle(a, u, h);
                        if (l) {
                            if (l.distance < 0) continue;
                            if ((n || !o || l.distance < o.distance) && ((o = l).faceId = s / 3, n)) break
                        }
                    }
                }
                return o
            }, t.prototype._rebuild = function() {
                this._linesIndexBuffer && (this._linesIndexBuffer = null)
            }, t.prototype.clone = function(e, i) {
                var n = new t(this.materialIndex, this.verticesStart, this.verticesCount, this.indexStart, this.indexCount, e, i, !1);
                if (!this.IsGlobal) {
                    var r = this.getBoundingInfo();
                    if (!r) return n;
                    n._boundingInfo = new Ie(r.minimum, r.maximum)
                }
                return n
            }, t.prototype.dispose = function() {
                this._linesIndexBuffer && (this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer), this._linesIndexBuffer = null);
                var e = this._mesh.subMeshes.indexOf(this);
                this._mesh.subMeshes.splice(e, 1)
            }, t.prototype.getClassName = function() {
                return "SubMesh"
            }, t.CreateFromIndices = function(e, i, n, r, o) {
                for (var s = Number.MAX_VALUE, a = -Number.MAX_VALUE, u = (o || r).getIndices(), h = i; h < i + n; h++) {
                    var l = u[h];
                    l < s && (s = l), l > a && (a = l)
                }
                return new t(e, s, a - s + 1, i, n, r, o)
            }, t
        }(Ce),
        Oe = function() {
            function e(e, t, i) {
                this._engine = e, this._noUBO = !e.supportsUniformBuffers, this._dynamic = i, this._data = t || [], this._uniformLocations = {}, this._uniformSizes = {}, this._uniformLocationPointer = 0, this._needSync = !1, this._noUBO ? (this.updateMatrix3x3 = this._updateMatrix3x3ForEffect, this.updateMatrix2x2 = this._updateMatrix2x2ForEffect, this.updateFloat = this._updateFloatForEffect, this.updateFloat2 = this._updateFloat2ForEffect, this.updateFloat3 = this._updateFloat3ForEffect, this.updateFloat4 = this._updateFloat4ForEffect, this.updateMatrix = this._updateMatrixForEffect, this.updateVector3 = this._updateVector3ForEffect, this.updateVector4 = this._updateVector4ForEffect, this.updateColor3 = this._updateColor3ForEffect, this.updateColor4 = this._updateColor4ForEffect) : (this._engine._uniformBuffers.push(this), this.updateMatrix3x3 = this._updateMatrix3x3ForUniform, this.updateMatrix2x2 = this._updateMatrix2x2ForUniform, this.updateFloat = this._updateFloatForUniform, this.updateFloat2 = this._updateFloat2ForUniform, this.updateFloat3 = this._updateFloat3ForUniform, this.updateFloat4 = this._updateFloat4ForUniform, this.updateMatrix = this._updateMatrixForUniform, this.updateVector3 = this._updateVector3ForUniform, this.updateVector4 = this._updateVector4ForUniform, this.updateColor3 = this._updateColor3ForUniform, this.updateColor4 = this._updateColor4ForUniform)
            }
            return Object.defineProperty(e.prototype, "useUbo", {
                get: function() {
                    return !this._noUBO
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isSync", {
                get: function() {
                    return !this._needSync
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.isDynamic = function() {
                return void 0 !== this._dynamic
            }, e.prototype.getData = function() {
                return this._bufferData
            }, e.prototype.getBuffer = function() {
                return this._buffer
            }, e.prototype._fillAlignment = function(e) {
                var t;
                if (t = e <= 2 ? e : 4, this._uniformLocationPointer % t != 0) {
                    var i = this._uniformLocationPointer;
                    this._uniformLocationPointer += t - this._uniformLocationPointer % t;
                    for (var n = this._uniformLocationPointer - i, r = 0; r < n; r++) this._data.push(0)
                }
            }, e.prototype.addUniform = function(e, t) {
                if (!this._noUBO && void 0 === this._uniformLocations[e]) {
                    var i;
                    if (t instanceof Array) t = (i = t).length;
                    else {
                        t = t, i = [];
                        for (var n = 0; n < t; n++) i.push(0)
                    }
                    this._fillAlignment(t), this._uniformSizes[e] = t, this._uniformLocations[e] = this._uniformLocationPointer, this._uniformLocationPointer += t;
                    for (n = 0; n < t; n++) this._data.push(i[n]);
                    this._needSync = !0
                }
            }, e.prototype.addMatrix = function(e, t) {
                this.addUniform(e, Array.prototype.slice.call(t.toArray()))
            }, e.prototype.addFloat2 = function(e, t, i) {
                var n = [t, i];
                this.addUniform(e, n)
            }, e.prototype.addFloat3 = function(e, t, i, n) {
                var r = [t, i, n];
                this.addUniform(e, r)
            }, e.prototype.addColor3 = function(e, t) {
                var i = new Array;
                t.toArray(i), this.addUniform(e, i)
            }, e.prototype.addColor4 = function(e, t, i) {
                var n = new Array;
                t.toArray(n), n.push(i), this.addUniform(e, n)
            }, e.prototype.addVector3 = function(e, t) {
                var i = new Array;
                t.toArray(i), this.addUniform(e, i)
            }, e.prototype.addMatrix3x3 = function(e) {
                this.addUniform(e, 12)
            }, e.prototype.addMatrix2x2 = function(e) {
                this.addUniform(e, 8)
            }, e.prototype.create = function() {
                this._noUBO || this._buffer || (this._fillAlignment(4), this._bufferData = new Float32Array(this._data), this._rebuild(), this._needSync = !0)
            }, e.prototype._rebuild = function() {
                !this._noUBO && this._bufferData && (this._dynamic ? this._buffer = this._engine.createDynamicUniformBuffer(this._bufferData) : this._buffer = this._engine.createUniformBuffer(this._bufferData))
            }, e.prototype.update = function() {
                this._buffer ? (this._dynamic || this._needSync) && (this._engine.updateUniformBuffer(this._buffer, this._bufferData), this._needSync = !1) : this.create()
            }, e.prototype.updateUniform = function(e, t, i) {
                var n = this._uniformLocations[e];
                if (void 0 === n) {
                    if (this._buffer) return void V.Error("Cannot add an uniform after UBO has been created.");
                    this.addUniform(e, i), n = this._uniformLocations[e]
                }
                if (this._buffer || this.create(), this._dynamic)
                    for (o = 0; o < i; o++) this._bufferData[n + o] = t[o];
                else {
                    for (var r = !1, o = 0; o < i; o++) this._bufferData[n + o] !== t[o] && (r = !0, this._bufferData[n + o] = t[o]);
                    this._needSync = this._needSync || r
                }
            }, e.prototype._updateMatrix3x3ForUniform = function(t, i) {
                for (var n = 0; n < 3; n++) e._tempBuffer[4 * n] = i[3 * n], e._tempBuffer[4 * n + 1] = i[3 * n + 1], e._tempBuffer[4 * n + 2] = i[3 * n + 2], e._tempBuffer[4 * n + 3] = 0;
                this.updateUniform(t, e._tempBuffer, 12)
            }, e.prototype._updateMatrix3x3ForEffect = function(e, t) {
                this._currentEffect.setMatrix3x3(e, t)
            }, e.prototype._updateMatrix2x2ForEffect = function(e, t) {
                this._currentEffect.setMatrix2x2(e, t)
            }, e.prototype._updateMatrix2x2ForUniform = function(t, i) {
                for (var n = 0; n < 2; n++) e._tempBuffer[4 * n] = i[2 * n], e._tempBuffer[4 * n + 1] = i[2 * n + 1], e._tempBuffer[4 * n + 2] = 0, e._tempBuffer[4 * n + 3] = 0;
                this.updateUniform(t, e._tempBuffer, 8)
            }, e.prototype._updateFloatForEffect = function(e, t) {
                this._currentEffect.setFloat(e, t)
            }, e.prototype._updateFloatForUniform = function(t, i) {
                e._tempBuffer[0] = i, this.updateUniform(t, e._tempBuffer, 1)
            }, e.prototype._updateFloat2ForEffect = function(e, t, i, n) {
                void 0 === n && (n = ""), this._currentEffect.setFloat2(e + n, t, i)
            }, e.prototype._updateFloat2ForUniform = function(t, i, n) {
                e._tempBuffer[0] = i, e._tempBuffer[1] = n, this.updateUniform(t, e._tempBuffer, 2)
            }, e.prototype._updateFloat3ForEffect = function(e, t, i, n, r) {
                void 0 === r && (r = ""), this._currentEffect.setFloat3(e + r, t, i, n)
            }, e.prototype._updateFloat3ForUniform = function(t, i, n, r) {
                e._tempBuffer[0] = i, e._tempBuffer[1] = n, e._tempBuffer[2] = r, this.updateUniform(t, e._tempBuffer, 3)
            }, e.prototype._updateFloat4ForEffect = function(e, t, i, n, r, o) {
                void 0 === o && (o = ""), this._currentEffect.setFloat4(e + o, t, i, n, r)
            }, e.prototype._updateFloat4ForUniform = function(t, i, n, r, o) {
                e._tempBuffer[0] = i, e._tempBuffer[1] = n, e._tempBuffer[2] = r, e._tempBuffer[3] = o, this.updateUniform(t, e._tempBuffer, 4)
            }, e.prototype._updateMatrixForEffect = function(e, t) {
                this._currentEffect.setMatrix(e, t)
            }, e.prototype._updateMatrixForUniform = function(e, t) {
                this.updateUniform(e, t.toArray(), 16)
            }, e.prototype._updateVector3ForEffect = function(e, t) {
                this._currentEffect.setVector3(e, t)
            }, e.prototype._updateVector3ForUniform = function(t, i) {
                i.toArray(e._tempBuffer), this.updateUniform(t, e._tempBuffer, 3)
            }, e.prototype._updateVector4ForEffect = function(e, t) {
                this._currentEffect.setVector4(e, t)
            }, e.prototype._updateVector4ForUniform = function(t, i) {
                i.toArray(e._tempBuffer), this.updateUniform(t, e._tempBuffer, 4)
            }, e.prototype._updateColor3ForEffect = function(e, t, i) {
                void 0 === i && (i = ""), this._currentEffect.setColor3(e + i, t)
            }, e.prototype._updateColor3ForUniform = function(t, i) {
                i.toArray(e._tempBuffer), this.updateUniform(t, e._tempBuffer, 3)
            }, e.prototype._updateColor4ForEffect = function(e, t, i, n) {
                void 0 === n && (n = ""), this._currentEffect.setColor4(e + n, t, i)
            }, e.prototype._updateColor4ForUniform = function(t, i, n) {
                i.toArray(e._tempBuffer), e._tempBuffer[3] = n, this.updateUniform(t, e._tempBuffer, 4)
            }, e.prototype.setTexture = function(e, t) {
                this._currentEffect.setTexture(e, t)
            }, e.prototype.updateUniformDirectly = function(e, t) {
                this.updateUniform(e, t, t.length), this.update()
            }, e.prototype.bindToEffect = function(e, t) {
                this._currentEffect = e, !this._noUBO && this._buffer && e.bindUniformBuffer(this._buffer, t)
            }, e.prototype.dispose = function() {
                if (!this._noUBO) {
                    var e = this._engine._uniformBuffers,
                        t = e.indexOf(this); - 1 !== t && (e[t] = e[e.length - 1], e.pop()), this._buffer && this._engine._releaseBuffer(this._buffer) && (this._buffer = null)
                }
            }, e._MAX_UNIFORM_SIZE = 256, e._tempBuffer = new Float32Array(e._MAX_UNIFORM_SIZE), e
        }(),
        De = function() {
            function e(t, i, n) {
                this.metadata = null, this.reservedDataStore = null, this.checkReadyOnEveryCall = !1, this.checkReadyOnlyOnce = !1, this.state = "", this._alpha = 1, this._backFaceCulling = !0, this.onCompiled = null, this.onError = null, this.getRenderTargetTextures = null, this.doNotSerialize = !1, this._storeEffectOnSubMeshes = !1, this.animations = null, this.onDisposeObservable = new l, this._onDisposeObserver = null, this._onUnBindObservable = null, this._onBindObserver = null, this._alphaMode = k.ALPHA_COMBINE, this._needDepthPrePass = !1, this.disableDepthWrite = !1, this.forceDepthWrite = !1, this.separateCullingPass = !1, this._fogEnabled = !0, this.pointSize = 1, this.zOffset = 0, this._effect = null, this._wasPreviouslyReady = !1, this._useUBO = !1, this._fillMode = e.TriangleFillMode, this._cachedDepthWriteState = !1, this._indexInSceneMaterialArray = -1, this.meshMap = null, this.name = t, this.id = t || K.RandomId(), this._scene = i || ve.LastCreatedScene, this.uniqueId = this._scene.getUniqueId(), this._scene.useRightHandedSystem ? this.sideOrientation = e.ClockWiseSideOrientation : this.sideOrientation = e.CounterClockWiseSideOrientation, this._uniformBuffer = new Oe(this._scene.getEngine()), this._useUBO = this.getScene().getEngine().supportsUniformBuffers, n || this._scene.addMaterial(this), this._scene.useMaterialMeshMap && (this.meshMap = {})
            }
            return Object.defineProperty(e.prototype, "alpha", {
                get: function() {
                    return this._alpha
                },
                set: function(t) {
                    this._alpha !== t && (this._alpha = t, this.markAsDirty(e.MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "backFaceCulling", {
                get: function() {
                    return this._backFaceCulling
                },
                set: function(t) {
                    this._backFaceCulling !== t && (this._backFaceCulling = t, this.markAsDirty(e.TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "hasRenderTargetTextures", {
                get: function() {
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "onDispose", {
                set: function(e) {
                    this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "onBindObservable", {
                get: function() {
                    return this._onBindObservable || (this._onBindObservable = new l), this._onBindObservable
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "onBind", {
                set: function(e) {
                    this._onBindObserver && this.onBindObservable.remove(this._onBindObserver), this._onBindObserver = this.onBindObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "onUnBindObservable", {
                get: function() {
                    return this._onUnBindObservable || (this._onUnBindObservable = new l), this._onUnBindObservable
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "alphaMode", {
                get: function() {
                    return this._alphaMode
                },
                set: function(t) {
                    this._alphaMode !== t && (this._alphaMode = t, this.markAsDirty(e.TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "needDepthPrePass", {
                get: function() {
                    return this._needDepthPrePass
                },
                set: function(e) {
                    this._needDepthPrePass !== e && (this._needDepthPrePass = e, this._needDepthPrePass && (this.checkReadyOnEveryCall = !0))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fogEnabled", {
                get: function() {
                    return this._fogEnabled
                },
                set: function(t) {
                    this._fogEnabled !== t && (this._fogEnabled = t, this.markAsDirty(e.MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "wireframe", {
                get: function() {
                    switch (this._fillMode) {
                        case e.WireFrameFillMode:
                        case e.LineListDrawMode:
                        case e.LineLoopDrawMode:
                        case e.LineStripDrawMode:
                            return !0
                    }
                    return this._scene.forceWireframe
                },
                set: function(t) {
                    this.fillMode = t ? e.WireFrameFillMode : e.TriangleFillMode
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "pointsCloud", {
                get: function() {
                    switch (this._fillMode) {
                        case e.PointFillMode:
                        case e.PointListDrawMode:
                            return !0
                    }
                    return this._scene.forcePointsCloud
                },
                set: function(t) {
                    this.fillMode = t ? e.PointFillMode : e.TriangleFillMode
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fillMode", {
                get: function() {
                    return this._fillMode
                },
                set: function(t) {
                    this._fillMode !== t && (this._fillMode = t, this.markAsDirty(e.MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.toString = function(e) {
                return "Name: " + this.name
            }, e.prototype.getClassName = function() {
                return "Material"
            }, Object.defineProperty(e.prototype, "isFrozen", {
                get: function() {
                    return this.checkReadyOnlyOnce
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.freeze = function() {
                this.checkReadyOnlyOnce = !0
            }, e.prototype.unfreeze = function() {
                this.checkReadyOnlyOnce = !1
            }, e.prototype.isReady = function(e, t) {
                return !0
            }, e.prototype.isReadyForSubMesh = function(e, t, i) {
                return !1
            }, e.prototype.getEffect = function() {
                return this._effect
            }, e.prototype.getScene = function() {
                return this._scene
            }, e.prototype.needAlphaBlending = function() {
                return this.alpha < 1
            }, e.prototype.needAlphaBlendingForMesh = function(e) {
                return this.needAlphaBlending() || e.visibility < 1 || e.hasVertexAlpha
            }, e.prototype.needAlphaTesting = function() {
                return !1
            }, e.prototype.getAlphaTestTexture = function() {
                return null
            }, e.prototype.markDirty = function() {
                this._wasPreviouslyReady = !1
            }, e.prototype._preBind = function(t, i) {
                void 0 === i && (i = null);
                var n = this._scene.getEngine(),
                    r = (null == i ? this.sideOrientation : i) === e.ClockWiseSideOrientation;
                return n.enableEffect(t || this._effect), n.setState(this.backFaceCulling, this.zOffset, !1, r), r
            }, e.prototype.bind = function(e, t) {}, e.prototype.bindForSubMesh = function(e, t, i) {}, e.prototype.bindOnlyWorldMatrix = function(e) {}, e.prototype.bindSceneUniformBuffer = function(e, t) {
                t.bindToEffect(e, "Scene")
            }, e.prototype.bindView = function(e) {
                this._useUBO ? this.bindSceneUniformBuffer(e, this.getScene().getSceneUniformBuffer()) : e.setMatrix("view", this.getScene().getViewMatrix())
            }, e.prototype.bindViewProjection = function(e) {
                this._useUBO ? this.bindSceneUniformBuffer(e, this.getScene().getSceneUniformBuffer()) : e.setMatrix("viewProjection", this.getScene().getTransformMatrix())
            }, e.prototype._shouldTurnAlphaTestOn = function(e) {
                return !this.needAlphaBlendingForMesh(e) && this.needAlphaTesting()
            }, e.prototype._afterBind = function(e) {
                if (this._scene._cachedMaterial = this, this._scene._cachedVisibility = e ? e.visibility : 1, this._onBindObservable && e && this._onBindObservable.notifyObservers(e), this.disableDepthWrite) {
                    var t = this._scene.getEngine();
                    this._cachedDepthWriteState = t.getDepthWrite(), t.setDepthWrite(!1)
                }
            }, e.prototype.unbind = function() {
                (this._onUnBindObservable && this._onUnBindObservable.notifyObservers(this), this.disableDepthWrite) && this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)
            }, e.prototype.getActiveTextures = function() {
                return []
            }, e.prototype.hasTexture = function(e) {
                return !1
            }, e.prototype.clone = function(e) {
                return null
            }, e.prototype.getBindedMeshes = function() {
                var e = this;
                if (this.meshMap) {
                    var t = new Array;
                    for (var i in this.meshMap) {
                        var n = this.meshMap[i];
                        n && t.push(n)
                    }
                    return t
                }
                return this._scene.meshes.filter((function(t) {
                    return t.material === e
                }))
            }, e.prototype.forceCompilation = function(e, t, i) {
                var n = this,
                    r = o({
                        clipPlane: !1
                    }, i),
                    s = new Ce,
                    a = this.getScene(),
                    u = function() {
                        if (n._scene && n._scene.getEngine()) {
                            s._materialDefines && (s._materialDefines._renderId = -1);
                            var i = a.clipPlane;
                            r.clipPlane && (a.clipPlane = new x(0, 0, 0, 1)), n._storeEffectOnSubMeshes ? n.isReadyForSubMesh(e, s) ? t && t(n) : setTimeout(u, 16) : n.isReady() ? t && t(n) : setTimeout(u, 16), r.clipPlane && (a.clipPlane = i)
                        }
                    };
                u()
            }, e.prototype.forceCompilationAsync = function(e, t) {
                var i = this;
                return new Promise((function(n) {
                    i.forceCompilation(e, (function() {
                        n()
                    }), t)
                }))
            }, e.prototype.markAsDirty = function(t) {
                this.getScene().blockMaterialDirtyMechanism || (e._DirtyCallbackArray.length = 0, t & e.TextureDirtyFlag && e._DirtyCallbackArray.push(e._TextureDirtyCallBack), t & e.LightDirtyFlag && e._DirtyCallbackArray.push(e._LightsDirtyCallBack), t & e.FresnelDirtyFlag && e._DirtyCallbackArray.push(e._FresnelDirtyCallBack), t & e.AttributesDirtyFlag && e._DirtyCallbackArray.push(e._AttributeDirtyCallBack), t & e.MiscDirtyFlag && e._DirtyCallbackArray.push(e._MiscDirtyCallBack), e._DirtyCallbackArray.length && this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks), this.getScene().resetCachedMaterial())
            }, e.prototype._markAllSubMeshesAsDirty = function(e) {
                if (!this.getScene().blockMaterialDirtyMechanism)
                    for (var t = 0, i = this.getScene().meshes; t < i.length; t++) {
                        var n = i[t];
                        if (n.subMeshes)
                            for (var r = 0, o = n.subMeshes; r < o.length; r++) {
                                var s = o[r];
                                s.getMaterial() === this && (s._materialDefines && e(s._materialDefines))
                            }
                    }
            }, e.prototype._markAllSubMeshesAsImageProcessingDirty = function() {
                this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)
            }, e.prototype._markAllSubMeshesAsTexturesDirty = function() {
                this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)
            }, e.prototype._markAllSubMeshesAsFresnelDirty = function() {
                this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)
            }, e.prototype._markAllSubMeshesAsFresnelAndMiscDirty = function() {
                this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)
            }, e.prototype._markAllSubMeshesAsLightsDirty = function() {
                this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)
            }, e.prototype._markAllSubMeshesAsAttributesDirty = function() {
                this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)
            }, e.prototype._markAllSubMeshesAsMiscDirty = function() {
                this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)
            }, e.prototype._markAllSubMeshesAsTexturesAndMiscDirty = function() {
                this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)
            }, e.prototype.dispose = function(e, t, i) {
                var n = this.getScene();
                if (n.stopAnimation(this), n.freeProcessedMaterials(), n.removeMaterial(this), !0 !== i)
                    if (this.meshMap)
                        for (var r in this.meshMap) {
                            (a = this.meshMap[r]) && (a.material = null, this.releaseVertexArrayObject(a, e))
                        } else
                            for (var o = 0, s = n.meshes; o < s.length; o++) {
                                var a;
                                (a = s[o]).material !== this || a.sourceMesh || (a.material = null, this.releaseVertexArrayObject(a, e))
                            }
                this._uniformBuffer.dispose(), e && this._effect && (this._storeEffectOnSubMeshes || this._effect.dispose(), this._effect = null), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this._onBindObservable && this._onBindObservable.clear(), this._onUnBindObservable && this._onUnBindObservable.clear()
            }, e.prototype.releaseVertexArrayObject = function(e, t) {
                if (e.geometry) {
                    var i = e.geometry;
                    if (this._storeEffectOnSubMeshes)
                        for (var n = 0, r = e.subMeshes; n < r.length; n++) {
                            var o = r[n];
                            i._releaseVertexArrayObject(o._materialEffect), t && o._materialEffect && o._materialEffect.dispose()
                        } else i._releaseVertexArrayObject(this._effect)
                }
            }, e.prototype.serialize = function() {
                return me.Serialize(this)
            }, e.Parse = function(e, t, i) {
                if (e.customType) {
                    if ("BABYLON.PBRMaterial" === e.customType && e.overloadedAlbedo && (e.customType = "BABYLON.LegacyPBRMaterial", !BABYLON.LegacyPBRMaterial)) return V.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."), null
                } else e.customType = "BABYLON.StandardMaterial";
                return K.Instantiate(e.customType).Parse(e, t, i)
            }, e.TriangleFillMode = k.MATERIAL_TriangleFillMode, e.WireFrameFillMode = k.MATERIAL_WireFrameFillMode, e.PointFillMode = k.MATERIAL_PointFillMode, e.PointListDrawMode = k.MATERIAL_PointListDrawMode, e.LineListDrawMode = k.MATERIAL_LineListDrawMode, e.LineLoopDrawMode = k.MATERIAL_LineLoopDrawMode, e.LineStripDrawMode = k.MATERIAL_LineStripDrawMode, e.TriangleStripDrawMode = k.MATERIAL_TriangleStripDrawMode, e.TriangleFanDrawMode = k.MATERIAL_TriangleFanDrawMode, e.ClockWiseSideOrientation = k.MATERIAL_ClockWiseSideOrientation, e.CounterClockWiseSideOrientation = k.MATERIAL_CounterClockWiseSideOrientation, e.TextureDirtyFlag = k.MATERIAL_TextureDirtyFlag, e.LightDirtyFlag = k.MATERIAL_LightDirtyFlag, e.FresnelDirtyFlag = k.MATERIAL_FresnelDirtyFlag, e.AttributesDirtyFlag = k.MATERIAL_AttributesDirtyFlag, e.MiscDirtyFlag = k.MATERIAL_MiscDirtyFlag, e.AllDirtyFlag = k.MATERIAL_AllDirtyFlag, e._ImageProcessingDirtyCallBack = function(e) {
                return e.markAsImageProcessingDirty()
            }, e._TextureDirtyCallBack = function(e) {
                return e.markAsTexturesDirty()
            }, e._FresnelDirtyCallBack = function(e) {
                return e.markAsFresnelDirty()
            }, e._MiscDirtyCallBack = function(e) {
                return e.markAsMiscDirty()
            }, e._LightsDirtyCallBack = function(e) {
                return e.markAsLightDirty()
            }, e._AttributeDirtyCallBack = function(e) {
                return e.markAsAttributesDirty()
            }, e._FresnelAndMiscDirtyCallBack = function(t) {
                e._FresnelDirtyCallBack(t), e._MiscDirtyCallBack(t)
            }, e._TextureAndMiscDirtyCallBack = function(t) {
                e._TextureDirtyCallBack(t), e._MiscDirtyCallBack(t)
            }, e._DirtyCallbackArray = [], e._RunDirtyCallBacks = function(t) {
                for (var i = 0, n = e._DirtyCallbackArray; i < n.length; i++) {
                    (0, n[i])(t)
                }
            }, s([ce()], e.prototype, "id", void 0), s([ce()], e.prototype, "uniqueId", void 0), s([ce()], e.prototype, "name", void 0), s([ce()], e.prototype, "checkReadyOnEveryCall", void 0), s([ce()], e.prototype, "checkReadyOnlyOnce", void 0), s([ce()], e.prototype, "state", void 0), s([ce("alpha")], e.prototype, "_alpha", void 0), s([ce("backFaceCulling")], e.prototype, "_backFaceCulling", void 0), s([ce()], e.prototype, "sideOrientation", void 0), s([ce("alphaMode")], e.prototype, "_alphaMode", void 0), s([ce()], e.prototype, "_needDepthPrePass", void 0), s([ce()], e.prototype, "disableDepthWrite", void 0), s([ce()], e.prototype, "forceDepthWrite", void 0), s([ce()], e.prototype, "separateCullingPass", void 0), s([ce("fogEnabled")], e.prototype, "_fogEnabled", void 0), s([ce()], e.prototype, "pointSize", void 0), s([ce()], e.prototype, "zOffset", void 0), s([ce()], e.prototype, "wireframe", null), s([ce()], e.prototype, "pointsCloud", null), s([ce()], e.prototype, "fillMode", null), e
        }(),
        we = function() {},
        Le = function() {
            function e(t, i, n) {
                void 0 === n && (n = !1), this.isReady = !1, this.isCube = !1, this.is3D = !1, this.isMultiview = !1, this.url = "", this.samplingMode = -1, this.generateMipMaps = !1, this.samples = 0, this.type = -1, this.format = -1, this.onLoadedObservable = new l, this.width = 0, this.height = 0, this.depth = 0, this.baseWidth = 0, this.baseHeight = 0, this.baseDepth = 0, this.invertY = !1, this._invertVScale = !1, this._associatedChannel = -1, this._dataSource = e.DATASOURCE_UNKNOWN, this._buffer = null, this._bufferView = null, this._bufferViewArray = null, this._bufferViewArrayArray = null, this._size = 0, this._extension = "", this._files = null, this._workingCanvas = null, this._workingContext = null, this._framebuffer = null, this._depthStencilBuffer = null, this._MSAAFramebuffer = null, this._MSAARenderBuffer = null, this._attachments = null, this._cachedCoordinatesMode = null, this._cachedWrapU = null, this._cachedWrapV = null, this._cachedWrapR = null, this._cachedAnisotropicFilteringLevel = null, this._isDisabled = !1, this._compression = null, this._generateStencilBuffer = !1, this._generateDepthBuffer = !1, this._comparisonFunction = 0, this._sphericalPolynomial = null, this._lodGenerationScale = 0, this._lodGenerationOffset = 0, this._colorTextureArray = null, this._depthStencilTextureArray = null, this._lodTextureHigh = null, this._lodTextureMid = null, this._lodTextureLow = null, this._isRGBD = !1, this._webGLTexture = null, this._references = 1, this._engine = t, this._dataSource = i, n || (this._webGLTexture = t._createTexture())
            }
            return e.prototype.getEngine = function() {
                return this._engine
            }, Object.defineProperty(e.prototype, "dataSource", {
                get: function() {
                    return this._dataSource
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.incrementReferences = function() {
                this._references++
            }, e.prototype.updateSize = function(e, t, i) {
                void 0 === i && (i = 1), this.width = e, this.height = t, this.depth = i, this.baseWidth = e, this.baseHeight = t, this.baseDepth = i, this._size = e * t * i
            }, e.prototype._rebuild = function() {
                var t, i = this;
                switch (this.isReady = !1, this._cachedCoordinatesMode = null, this._cachedWrapU = null, this._cachedWrapV = null, this._cachedAnisotropicFilteringLevel = null, this._dataSource) {
                    case e.DATASOURCE_TEMP:
                        return;
                    case e.DATASOURCE_URL:
                        return void(t = this._engine.createTexture(this.url, !this.generateMipMaps, this.invertY, null, this.samplingMode, (function() {
                            t._swapAndDie(i), i.isReady = !0
                        }), null, this._buffer, void 0, this.format));
                    case e.DATASOURCE_RAW:
                        return (t = this._engine.createRawTexture(this._bufferView, this.baseWidth, this.baseHeight, this.format, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this), void(this.isReady = !0);
                    case e.DATASOURCE_RAW3D:
                        return (t = this._engine.createRawTexture3D(this._bufferView, this.baseWidth, this.baseHeight, this.baseDepth, this.format, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this), void(this.isReady = !0);
                    case e.DATASOURCE_DYNAMIC:
                        return (t = this._engine.createDynamicTexture(this.baseWidth, this.baseHeight, this.generateMipMaps, this.samplingMode))._swapAndDie(this), void this._engine.updateDynamicTexture(this, this._engine.getRenderingCanvas(), this.invertY, void 0, void 0, !0);
                    case e.DATASOURCE_RENDERTARGET:
                        var n = new we;
                        if (n.generateDepthBuffer = this._generateDepthBuffer, n.generateMipMaps = this.generateMipMaps, n.generateStencilBuffer = this._generateStencilBuffer, n.samplingMode = this.samplingMode, n.type = this.type, this.isCube) t = this._engine.createRenderTargetCubeTexture(this.width, n);
                        else {
                            var r = {
                                width: this.width,
                                height: this.height
                            };
                            t = this._engine.createRenderTargetTexture(r, n)
                        }
                        return t._swapAndDie(this), void(this.isReady = !0);
                    case e.DATASOURCE_DEPTHTEXTURE:
                        var o = {
                            bilinearFiltering: this.samplingMode !== k.TEXTURE_BILINEAR_SAMPLINGMODE,
                            comparisonFunction: this._comparisonFunction,
                            generateStencil: this._generateStencilBuffer,
                            isCube: this.isCube
                        };
                        return (t = this._engine.createDepthStencilTexture({
                            width: this.width,
                            height: this.height
                        }, o))._swapAndDie(this), void(this.isReady = !0);
                    case e.DATASOURCE_CUBE:
                        return void(t = this._engine.createCubeTexture(this.url, null, this._files, !this.generateMipMaps, (function() {
                            t._swapAndDie(i), i.isReady = !0
                        }), null, this.format, this._extension));
                    case e.DATASOURCE_CUBERAW:
                        return (t = this._engine.createRawCubeTexture(this._bufferViewArray, this.width, this.format, this.type, this.generateMipMaps, this.invertY, this.samplingMode, this._compression))._swapAndDie(this), void(this.isReady = !0);
                    case e.DATASOURCE_CUBERAW_RGBD:
                        return t = this._engine.createRawCubeTexture(null, this.width, this.format, this.type, this.generateMipMaps, this.invertY, this.samplingMode, this._compression), void e._UpdateRGBDAsync(t, this._bufferViewArrayArray, this._sphericalPolynomial, this._lodGenerationScale, this._lodGenerationOffset).then((function() {
                            t._swapAndDie(i), i.isReady = !0
                        }));
                    case e.DATASOURCE_CUBEPREFILTERED:
                        return void((t = this._engine.createPrefilteredCubeTexture(this.url, null, this._lodGenerationScale, this._lodGenerationOffset, (function(e) {
                            e && e._swapAndDie(i), i.isReady = !0
                        }), null, this.format, this._extension))._sphericalPolynomial = this._sphericalPolynomial)
                }
            }, e.prototype._swapAndDie = function(e) {
                e._webGLTexture = this._webGLTexture, e._isRGBD = this._isRGBD, this._framebuffer && (e._framebuffer = this._framebuffer), this._depthStencilBuffer && (e._depthStencilBuffer = this._depthStencilBuffer), this._lodTextureHigh && (e._lodTextureHigh && e._lodTextureHigh.dispose(), e._lodTextureHigh = this._lodTextureHigh), this._lodTextureMid && (e._lodTextureMid && e._lodTextureMid.dispose(), e._lodTextureMid = this._lodTextureMid), this._lodTextureLow && (e._lodTextureLow && e._lodTextureLow.dispose(), e._lodTextureLow = this._lodTextureLow);
                var t = this._engine.getLoadedTexturesCache(),
                    i = t.indexOf(this); - 1 !== i && t.splice(i, 1)
            }, e.prototype.dispose = function() {
                this._webGLTexture && (this._references--, 0 === this._references && (this._engine._releaseTexture(this), this._webGLTexture = null))
            }, e._UpdateRGBDAsync = function(e, t, i, n, r) {
                throw X.WarnImport("environmentTextureTools")
            }, e.DATASOURCE_UNKNOWN = 0, e.DATASOURCE_URL = 1, e.DATASOURCE_TEMP = 2, e.DATASOURCE_RAW = 3, e.DATASOURCE_DYNAMIC = 4, e.DATASOURCE_RENDERTARGET = 5, e.DATASOURCE_MULTIRENDERTARGET = 6, e.DATASOURCE_CUBE = 7, e.DATASOURCE_CUBERAW = 8, e.DATASOURCE_CUBEPREFILTERED = 9, e.DATASOURCE_RAW3D = 10, e.DATASOURCE_DEPTHTEXTURE = 11, e.DATASOURCE_CUBERAW_RGBD = 12, e
        }(),
        Fe = function() {
            function e() {
                this._isAlphaBlendDirty = !1, this._isBlendFunctionParametersDirty = !1, this._isBlendEquationParametersDirty = !1, this._isBlendConstantsDirty = !1, this._alphaBlend = !1, this._blendFunctionParameters = new Array(4), this._blendEquationParameters = new Array(2), this._blendConstants = new Array(4), this.reset()
            }
            return Object.defineProperty(e.prototype, "isDirty", {
                get: function() {
                    return this._isAlphaBlendDirty || this._isBlendFunctionParametersDirty
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "alphaBlend", {
                get: function() {
                    return this._alphaBlend
                },
                set: function(e) {
                    this._alphaBlend !== e && (this._alphaBlend = e, this._isAlphaBlendDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.setAlphaBlendConstants = function(e, t, i, n) {
                this._blendConstants[0] === e && this._blendConstants[1] === t && this._blendConstants[2] === i && this._blendConstants[3] === n || (this._blendConstants[0] = e, this._blendConstants[1] = t, this._blendConstants[2] = i, this._blendConstants[3] = n, this._isBlendConstantsDirty = !0)
            }, e.prototype.setAlphaBlendFunctionParameters = function(e, t, i, n) {
                this._blendFunctionParameters[0] === e && this._blendFunctionParameters[1] === t && this._blendFunctionParameters[2] === i && this._blendFunctionParameters[3] === n || (this._blendFunctionParameters[0] = e, this._blendFunctionParameters[1] = t, this._blendFunctionParameters[2] = i, this._blendFunctionParameters[3] = n, this._isBlendFunctionParametersDirty = !0)
            }, e.prototype.setAlphaEquationParameters = function(e, t) {
                this._blendEquationParameters[0] === e && this._blendEquationParameters[1] === t || (this._blendEquationParameters[0] = e, this._blendEquationParameters[1] = t, this._isBlendEquationParametersDirty = !0)
            }, e.prototype.reset = function() {
                this._alphaBlend = !1, this._blendFunctionParameters[0] = null, this._blendFunctionParameters[1] = null, this._blendFunctionParameters[2] = null, this._blendFunctionParameters[3] = null, this._blendEquationParameters[0] = null, this._blendEquationParameters[1] = null, this._blendConstants[0] = null, this._blendConstants[1] = null, this._blendConstants[2] = null, this._blendConstants[3] = null, this._isAlphaBlendDirty = !0, this._isBlendFunctionParametersDirty = !1, this._isBlendEquationParametersDirty = !1, this._isBlendConstantsDirty = !1
            }, e.prototype.apply = function(e) {
                this.isDirty && (this._isAlphaBlendDirty && (this._alphaBlend ? e.enable(e.BLEND) : e.disable(e.BLEND), this._isAlphaBlendDirty = !1), this._isBlendFunctionParametersDirty && (e.blendFuncSeparate(this._blendFunctionParameters[0], this._blendFunctionParameters[1], this._blendFunctionParameters[2], this._blendFunctionParameters[3]), this._isBlendFunctionParametersDirty = !1), this._isBlendEquationParametersDirty && (e.blendEquationSeparate(this._blendEquationParameters[0], this._blendEquationParameters[1]), this._isBlendEquationParametersDirty = !1), this._isBlendConstantsDirty && (e.blendColor(this._blendConstants[0], this._blendConstants[1], this._blendConstants[2], this._blendConstants[3]), this._isBlendConstantsDirty = !1))
            }, e
        }(),
        Ne = function() {
            function e() {
                this._isDepthTestDirty = !1, this._isDepthMaskDirty = !1, this._isDepthFuncDirty = !1, this._isCullFaceDirty = !1, this._isCullDirty = !1, this._isZOffsetDirty = !1, this._isFrontFaceDirty = !1, this.reset()
            }
            return Object.defineProperty(e.prototype, "isDirty", {
                get: function() {
                    return this._isDepthFuncDirty || this._isDepthTestDirty || this._isDepthMaskDirty || this._isCullFaceDirty || this._isCullDirty || this._isZOffsetDirty || this._isFrontFaceDirty
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "zOffset", {
                get: function() {
                    return this._zOffset
                },
                set: function(e) {
                    this._zOffset !== e && (this._zOffset = e, this._isZOffsetDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "cullFace", {
                get: function() {
                    return this._cullFace
                },
                set: function(e) {
                    this._cullFace !== e && (this._cullFace = e, this._isCullFaceDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "cull", {
                get: function() {
                    return this._cull
                },
                set: function(e) {
                    this._cull !== e && (this._cull = e, this._isCullDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "depthFunc", {
                get: function() {
                    return this._depthFunc
                },
                set: function(e) {
                    this._depthFunc !== e && (this._depthFunc = e, this._isDepthFuncDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "depthMask", {
                get: function() {
                    return this._depthMask
                },
                set: function(e) {
                    this._depthMask !== e && (this._depthMask = e, this._isDepthMaskDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "depthTest", {
                get: function() {
                    return this._depthTest
                },
                set: function(e) {
                    this._depthTest !== e && (this._depthTest = e, this._isDepthTestDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "frontFace", {
                get: function() {
                    return this._frontFace
                },
                set: function(e) {
                    this._frontFace !== e && (this._frontFace = e, this._isFrontFaceDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.reset = function() {
                this._depthMask = !0, this._depthTest = !0, this._depthFunc = null, this._cullFace = null, this._cull = null, this._zOffset = 0, this._frontFace = null, this._isDepthTestDirty = !0, this._isDepthMaskDirty = !0, this._isDepthFuncDirty = !1, this._isCullFaceDirty = !1, this._isCullDirty = !1, this._isZOffsetDirty = !1, this._isFrontFaceDirty = !1
            }, e.prototype.apply = function(e) {
                this.isDirty && (this._isCullDirty && (this.cull ? e.enable(e.CULL_FACE) : e.disable(e.CULL_FACE), this._isCullDirty = !1), this._isCullFaceDirty && (e.cullFace(this.cullFace), this._isCullFaceDirty = !1), this._isDepthMaskDirty && (e.depthMask(this.depthMask), this._isDepthMaskDirty = !1), this._isDepthTestDirty && (this.depthTest ? e.enable(e.DEPTH_TEST) : e.disable(e.DEPTH_TEST), this._isDepthTestDirty = !1), this._isDepthFuncDirty && (e.depthFunc(this.depthFunc), this._isDepthFuncDirty = !1), this._isZOffsetDirty && (this.zOffset ? (e.enable(e.POLYGON_OFFSET_FILL), e.polygonOffset(this.zOffset, 0)) : e.disable(e.POLYGON_OFFSET_FILL), this._isZOffsetDirty = !1), this._isFrontFaceDirty && (e.frontFace(this.frontFace), this._isFrontFaceDirty = !1))
            }, e
        }(),
        Ue = function() {
            function e() {
                this._isStencilTestDirty = !1, this._isStencilMaskDirty = !1, this._isStencilFuncDirty = !1, this._isStencilOpDirty = !1, this.reset()
            }
            return Object.defineProperty(e.prototype, "isDirty", {
                get: function() {
                    return this._isStencilTestDirty || this._isStencilMaskDirty || this._isStencilFuncDirty || this._isStencilOpDirty
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilFunc", {
                get: function() {
                    return this._stencilFunc
                },
                set: function(e) {
                    this._stencilFunc !== e && (this._stencilFunc = e, this._isStencilFuncDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilFuncRef", {
                get: function() {
                    return this._stencilFuncRef
                },
                set: function(e) {
                    this._stencilFuncRef !== e && (this._stencilFuncRef = e, this._isStencilFuncDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilFuncMask", {
                get: function() {
                    return this._stencilFuncMask
                },
                set: function(e) {
                    this._stencilFuncMask !== e && (this._stencilFuncMask = e, this._isStencilFuncDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilOpStencilFail", {
                get: function() {
                    return this._stencilOpStencilFail
                },
                set: function(e) {
                    this._stencilOpStencilFail !== e && (this._stencilOpStencilFail = e, this._isStencilOpDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilOpDepthFail", {
                get: function() {
                    return this._stencilOpDepthFail
                },
                set: function(e) {
                    this._stencilOpDepthFail !== e && (this._stencilOpDepthFail = e, this._isStencilOpDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilOpStencilDepthPass", {
                get: function() {
                    return this._stencilOpStencilDepthPass
                },
                set: function(e) {
                    this._stencilOpStencilDepthPass !== e && (this._stencilOpStencilDepthPass = e, this._isStencilOpDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilMask", {
                get: function() {
                    return this._stencilMask
                },
                set: function(e) {
                    this._stencilMask !== e && (this._stencilMask = e, this._isStencilMaskDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "stencilTest", {
                get: function() {
                    return this._stencilTest
                },
                set: function(e) {
                    this._stencilTest !== e && (this._stencilTest = e, this._isStencilTestDirty = !0)
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.reset = function() {
                this._stencilTest = !1, this._stencilMask = 255, this._stencilFunc = e.ALWAYS, this._stencilFuncRef = 1, this._stencilFuncMask = 255, this._stencilOpStencilFail = e.KEEP, this._stencilOpDepthFail = e.KEEP, this._stencilOpStencilDepthPass = e.REPLACE, this._isStencilTestDirty = !0, this._isStencilMaskDirty = !0, this._isStencilFuncDirty = !0, this._isStencilOpDirty = !0
            }, e.prototype.apply = function(e) {
                this.isDirty && (this._isStencilTestDirty && (this.stencilTest ? e.enable(e.STENCIL_TEST) : e.disable(e.STENCIL_TEST), this._isStencilTestDirty = !1), this._isStencilMaskDirty && (e.stencilMask(this.stencilMask), this._isStencilMaskDirty = !1), this._isStencilFuncDirty && (e.stencilFunc(this.stencilFunc, this.stencilFuncRef, this.stencilFuncMask), this._isStencilFuncDirty = !1), this._isStencilOpDirty && (e.stencilOp(this.stencilOpStencilFail, this.stencilOpDepthFail, this.stencilOpStencilDepthPass), this._isStencilOpDirty = !1))
            }, e.ALWAYS = k.ALWAYS, e.KEEP = k.KEEP, e.REPLACE = k.REPLACE, e
        }(),
        Be = function() {
            function e() {}
            return Object.defineProperty(e.prototype, "isAsync", {
                get: function() {
                    return this.isParallelCompiled
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isReady", {
                get: function() {
                    return !!this.program && (!this.isParallelCompiled || this.engine._isRenderingStateCompiled(this))
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._handlesSpectorRebuildCallback = function(e) {
                e && this.program && e(this.program)
            }, e
        }(),
        ke = function(e) {
            function t(t) {
                var i = e.call(this) || this;
                return i._buffer = t, i
            }
            return r(t, e), Object.defineProperty(t.prototype, "underlyingResource", {
                get: function() {
                    return this._buffer
                },
                enumerable: !0,
                configurable: !0
            }), t
        }(function() {
            function e() {
                this.references = 0, this.capacity = 0, this.is32Bits = !1
            }
            return Object.defineProperty(e.prototype, "underlyingResource", {
                get: function() {
                    return null
                },
                enumerable: !0,
                configurable: !0
            }), e
        }()),
        Ve = function() {},
        Ge = function() {},
        ze = function() {
            function e(t, i, n, r) {
                var o = this;
                void 0 === r && (r = !1), this.forcePOTTextures = !1, this.isFullscreen = !1, this.isPointerLock = !1, this.cullBackFaces = !0, this.renderEvenInBackground = !0, this.preventCacheWipeBetweenFrames = !1, this.enableOfflineSupport = !1, this.disableManifestCheck = !1, this.scenes = new Array, this.onNewSceneAddedObservable = new l, this.postProcesses = new Array, this.validateShaderPrograms = !1, this.onResizeObservable = new l, this.onCanvasBlurObservable = new l, this.onCanvasFocusObservable = new l, this.onCanvasPointerOutObservable = new l, this.onBeforeTextureInitObservable = new l, this.disableUniformBuffers = !1, this._uniformBuffers = new Array, this.onBeginFrameObservable = new l, this.customAnimationFrameRequester = null, this.onEndFrameObservable = new l, this.onBeforeShaderCompilationObservable = new l, this.onAfterShaderCompilationObservable = new l, this._windowIsBackground = !1, this._webGLVersion = 1, this._highPrecisionShadersAllowed = !0, this._badOS = !1, this._badDesktopOS = !1, this._colorWrite = !0, this._drawCalls = new q, this._renderingQueueLaunched = !1, this._activeRenderLoops = new Array, this._deterministicLockstep = !1, this._lockstepMaxSteps = 4, this.onContextLostObservable = new l, this.onContextRestoredObservable = new l, this._contextWasLost = !1, this._doNotHandleContextLost = !1, this._performanceMonitor = new f, this._fps = 60, this._deltaTime = 0, this.disablePerformanceMonitorInBackground = !1, this.disableVertexArrayObjects = !1, this._depthCullingState = new Ne, this._stencilState = new Ue, this._alphaState = new Fe, this._alphaMode = e.ALPHA_DISABLE, this._internalTexturesCache = new Array, this._activeChannel = 0, this._currentTextureChannel = -1, this._boundTexturesCache = {}, this._compiledEffects = {}, this._vertexAttribArraysEnabled = [], this._uintIndicesCurrentlySet = !1, this._currentBoundBuffer = new Array, this._currentFramebuffer = null, this._currentBufferPointers = new Array, this._currentInstanceLocations = new Array, this._currentInstanceBuffers = new Array, this._vaoRecordInProgress = !1, this._mustWipeVertexAttributes = !1, this._nextFreeTextureSlots = new Array, this._maxSimultaneousTextures = 0, this._activeRequests = new Array, this._texturesSupported = new Array, this.premultipliedAlpha = !0, this._viewportCached = new E(0, 0, 0, 0), this._unpackFlipYCached = null, this.enableUnpackFlipYCached = !0, this._boundUniforms = {}, ee.Apply();
                var s = null;
                if (e.Instances.push(this), t) {
                    if (n = n || {}, t.getContext) {
                        if (s = t, this._renderingCanvas = s, null != i && (n.antialias = i), void 0 === n.deterministicLockstep && (n.deterministicLockstep = !1), void 0 === n.lockstepMaxSteps && (n.lockstepMaxSteps = 4), void 0 === n.preserveDrawingBuffer && (n.preserveDrawingBuffer = !1), void 0 === n.audioEngine && (n.audioEngine = !0), void 0 === n.stencil && (n.stencil = !0), !1 === n.premultipliedAlpha && (this.premultipliedAlpha = !1), this._deterministicLockstep = n.deterministicLockstep, this._lockstepMaxSteps = n.lockstepMaxSteps, this._doNotHandleContextLost = !!n.doNotHandleContextLost, navigator && navigator.userAgent)
                            for (var a = navigator.userAgent, u = 0, h = e.ExceptionList; u < h.length; u++) {
                                var d = h[u],
                                    p = d.key,
                                    _ = d.targets;
                                if (new RegExp(p).test(a)) {
                                    if (d.capture && d.captureConstraint) {
                                        var g = d.capture,
                                            m = d.captureConstraint,
                                            v = new RegExp(g).exec(a);
                                        if (v && v.length > 0)
                                            if (parseInt(v[v.length - 1]) >= m) continue
                                    }
                                    for (var y = 0, T = _; y < T.length; y++) {
                                        switch (T[y]) {
                                            case "uniformBuffer":
                                                this.disableUniformBuffers = !0;
                                                break;
                                            case "vao":
                                                this.disableVertexArrayObjects = !0
                                        }
                                    }
                                }
                            }
                        if (!n.disableWebGL2Support) try {
                            this._gl = s.getContext("webgl2", n) || s.getContext("experimental-webgl2", n), this._gl && (this._webGLVersion = 2, this._gl.deleteQuery || (this._webGLVersion = 1))
                        } catch (e) {}
                        if (!this._gl) {
                            if (!s) throw new Error("The provided canvas is null or undefined.");
                            try {
                                this._gl = s.getContext("webgl", n) || s.getContext("experimental-webgl", n)
                            } catch (e) {
                                throw new Error("WebGL not supported")
                            }
                        }
                        if (!this._gl) throw new Error("WebGL not supported");
                        this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, this._gl.NONE), this._onCanvasFocus = function() {
                            o.onCanvasFocusObservable.notifyObservers(o)
                        }, this._onCanvasBlur = function() {
                            o.onCanvasBlurObservable.notifyObservers(o)
                        }, s.addEventListener("focus", this._onCanvasFocus), s.addEventListener("blur", this._onCanvasBlur), this._onBlur = function() {
                            o.disablePerformanceMonitorInBackground && o._performanceMonitor.disable(), o._windowIsBackground = !0
                        }, this._onFocus = function() {
                            o.disablePerformanceMonitorInBackground && o._performanceMonitor.enable(), o._windowIsBackground = !1
                        }, this._onCanvasPointerOut = function(e) {
                            o.onCanvasPointerOutObservable.notifyObservers(e)
                        }, c.IsWindowObjectExist() && (window.addEventListener("blur", this._onBlur), window.addEventListener("focus", this._onFocus)), s.addEventListener("pointerout", this._onCanvasPointerOut), this._doNotHandleContextLost || (this._onContextLost = function(e) {
                            e.preventDefault(), o._contextWasLost = !0, V.Warn("WebGL context lost."), o.onContextLostObservable.notifyObservers(o)
                        }, this._onContextRestored = function() {
                            setTimeout((function() {
                                o._initGLContext(), o._rebuildEffects(), o._rebuildInternalTextures(), o._rebuildBuffers(), o.wipeCaches(!0), V.Warn("WebGL context successfully restored."), o.onContextRestoredObservable.notifyObservers(o), o._contextWasLost = !1
                            }), 0)
                        }, s.addEventListener("webglcontextlost", this._onContextLost, !1), s.addEventListener("webglcontextrestored", this._onContextRestored, !1)), n.doNotHandleTouchAction || this._disableTouchAction()
                    } else {
                        this._gl = t, this._renderingCanvas = this._gl.canvas, this._gl.renderbufferStorageMultisample && (this._webGLVersion = 2);
                        var b = this._gl.getContextAttributes();
                        b && (n.stencil = b.stencil)
                    }
                    void 0 !== n.useHighPrecisionFloats && (this._highPrecisionShadersAllowed = n.useHighPrecisionFloats);
                    var A = c.IsWindowObjectExist() && window.devicePixelRatio || 1,
                        M = n.limitDeviceRatio || A;
                    if (this._hardwareScalingLevel = r ? 1 / Math.min(M, A) : 1, this.resize(), this._isStencilEnable = !!n.stencil, this._initGLContext(), s) {
                        var R = document;
                        this._onFullscreenChange = function() {
                            void 0 !== R.fullscreen ? o.isFullscreen = R.fullscreen : void 0 !== R.mozFullScreen ? o.isFullscreen = R.mozFullScreen : void 0 !== R.webkitIsFullScreen ? o.isFullscreen = R.webkitIsFullScreen : void 0 !== R.msIsFullScreen && (o.isFullscreen = R.msIsFullScreen), o.isFullscreen && o._pointerLockRequested && s && (s.requestPointerLock = s.requestPointerLock || s.msRequestPointerLock || s.mozRequestPointerLock || s.webkitRequestPointerLock, s.requestPointerLock && s.requestPointerLock())
                        }, document.addEventListener("fullscreenchange", this._onFullscreenChange, !1), document.addEventListener("mozfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("webkitfullscreenchange", this._onFullscreenChange, !1), document.addEventListener("msfullscreenchange", this._onFullscreenChange, !1), this._onPointerLockChange = function() {
                            o.isPointerLock = R.mozPointerLockElement === s || R.webkitPointerLockElement === s || R.msPointerLockElement === s || R.pointerLockElement === s
                        }, document.addEventListener("pointerlockchange", this._onPointerLockChange, !1), document.addEventListener("mspointerlockchange", this._onPointerLockChange, !1), document.addEventListener("mozpointerlockchange", this._onPointerLockChange, !1), document.addEventListener("webkitpointerlockchange", this._onPointerLockChange, !1), this._connectVREvents(s, R)
                    }!e.audioEngine && n.audioEngine && e.AudioEngineFactory && (e.audioEngine = e.AudioEngineFactory(this.getRenderingCanvas()));
                    for (var x = 0; x < this._caps.maxVertexAttribs; x++) this._currentBufferPointers[x] = new Ve;
                    this._prepareVRComponent(), n.autoEnableWebVR && this.initWebVR(), this._badOS = /iPad/i.test(navigator.userAgent) || /iPhone/i.test(navigator.userAgent), this._badDesktopOS = /^((?!chrome|android).)*safari/i.test(navigator.userAgent), console.log("Babylon.js v" + e.Version + " - " + this.description), this.enableOfflineSupport = void 0 !== e.OfflineProviderFactory
                }
            }
            return Object.defineProperty(e, "Instances", {
                get: function() {
                    return ve.Instances
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "LastCreatedEngine", {
                get: function() {
                    return ve.LastCreatedEngine
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "LastCreatedScene", {
                get: function() {
                    return ve.LastCreatedScene
                },
                enumerable: !0,
                configurable: !0
            }), e.MarkAllMaterialsAsDirty = function(t, i) {
                for (var n = 0; n < e.Instances.length; n++)
                    for (var r = e.Instances[n], o = 0; o < r.scenes.length; o++) r.scenes[o].markAllMaterialsAsDirty(t, i)
            }, Object.defineProperty(e, "NpmPackage", {
                get: function() {
                    return "babylonjs@4.0.3"
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "Version", {
                get: function() {
                    return "4.0.3"
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "description", {
                get: function() {
                    var e = "WebGL" + this.webGLVersion;
                    return this._caps.parallelShaderCompile && (e += " - Parallel shader compilation"), e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ShadersRepository", {
                get: function() {
                    return ie.ShadersRepository
                },
                set: function(e) {
                    ie.ShadersRepository = e
                },
                enumerable: !0,
                configurable: !0
            }), e.DefaultLoadingScreenFactory = function(e) {
                throw X.WarnImport("LoadingScreen")
            }, Object.defineProperty(e.prototype, "supportsUniformBuffers", {
                get: function() {
                    return this.webGLVersion > 1 && !this.disableUniformBuffers
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "_shouldUseHighPrecisionShader", {
                get: function() {
                    return this._caps.highPrecisionShaderSupported && this._highPrecisionShadersAllowed
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "needPOTTextures", {
                get: function() {
                    return this._webGLVersion < 2 || this.forcePOTTextures
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "doNotHandleContextLost", {
                get: function() {
                    return this._doNotHandleContextLost
                },
                set: function(e) {
                    this._doNotHandleContextLost = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "performanceMonitor", {
                get: function() {
                    return this._performanceMonitor
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "texturesSupported", {
                get: function() {
                    return this._texturesSupported
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "textureFormatInUse", {
                get: function() {
                    return this._textureFormatInUse
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "currentViewport", {
                get: function() {
                    return this._cachedViewport
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "emptyTexture", {
                get: function() {
                    return this._emptyTexture || (this._emptyTexture = this.createRawTexture(new Uint8Array(4), 1, 1, e.TEXTUREFORMAT_RGBA, !1, !1, e.TEXTURE_NEAREST_SAMPLINGMODE)), this._emptyTexture
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "emptyTexture3D", {
                get: function() {
                    return this._emptyTexture3D || (this._emptyTexture3D = this.createRawTexture3D(new Uint8Array(4), 1, 1, 1, e.TEXTUREFORMAT_RGBA, !1, !1, e.TEXTURE_NEAREST_SAMPLINGMODE)), this._emptyTexture3D
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "emptyCubeTexture", {
                get: function() {
                    if (!this._emptyCubeTexture) {
                        var t = new Uint8Array(4),
                            i = [t, t, t, t, t, t];
                        this._emptyCubeTexture = this.createRawCubeTexture(i, 1, e.TEXTUREFORMAT_RGBA, e.TEXTURETYPE_UNSIGNED_INT, !1, !1, e.TEXTURE_NEAREST_SAMPLINGMODE)
                    }
                    return this._emptyCubeTexture
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.initWebVR = function() {
                throw X.WarnImport("WebVRCamera")
            }, e.prototype._prepareVRComponent = function() {}, e.prototype._connectVREvents = function(e, t) {}, e.prototype._submitVRFrame = function() {}, e.prototype.disableVR = function() {}, e.prototype.isVRPresenting = function() {
                return !1
            }, e.prototype._requestVRFrame = function() {}, e.prototype._disableTouchAction = function() {
                this._renderingCanvas && (this._renderingCanvas.setAttribute("touch-action", "none"), this._renderingCanvas.style.touchAction = "none", this._renderingCanvas.style.msTouchAction = "none")
            }, e.prototype._rebuildInternalTextures = function() {
                for (var e = 0, t = this._internalTexturesCache.slice(); e < t.length; e++) {
                    t[e]._rebuild()
                }
            }, e.prototype._rebuildEffects = function() {
                for (var e in this._compiledEffects) {
                    this._compiledEffects[e]._prepareEffect()
                }
                ie.ResetCache()
            }, e.prototype.areAllEffectsReady = function() {
                for (var e in this._compiledEffects) {
                    if (!this._compiledEffects[e].isReady()) return !1
                }
                return !0
            }, e.prototype._rebuildBuffers = function() {
                for (var e = 0, t = this.scenes; e < t.length; e++) {
                    var i = t[e];
                    i.resetCachedMaterial(), i._rebuildGeometries(), i._rebuildTextures()
                }
                for (var n = 0, r = this._uniformBuffers; n < r.length; n++) {
                    r[n]._rebuild()
                }
            }, e.prototype._initGLContext = function() {
                this._caps = new Ge, this._caps.maxTexturesImageUnits = this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS), this._caps.maxCombinedTexturesImageUnits = this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS), this._caps.maxVertexTextureImageUnits = this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS), this._caps.maxTextureSize = this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE), this._caps.maxCubemapTextureSize = this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE), this._caps.maxRenderTextureSize = this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE), this._caps.maxVertexAttribs = this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS), this._caps.maxVaryingVectors = this._gl.getParameter(this._gl.MAX_VARYING_VECTORS), this._caps.maxFragmentUniformVectors = this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS), this._caps.maxVertexUniformVectors = this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS), this._glVersion = this._gl.getParameter(this._gl.VERSION);
                var e = this._gl.getExtension("WEBGL_debug_renderer_info");
                if (null != e && (this._glRenderer = this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL), this._glVendor = this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)), this._glVendor || (this._glVendor = "Unknown vendor"), this._glRenderer || (this._glRenderer = "Unknown renderer"), this._gl.HALF_FLOAT_OES = 36193, 34842 !== this._gl.RGBA16F && (this._gl.RGBA16F = 34842), 34836 !== this._gl.RGBA32F && (this._gl.RGBA32F = 34836), 35056 !== this._gl.DEPTH24_STENCIL8 && (this._gl.DEPTH24_STENCIL8 = 35056), this._caps.standardDerivatives = this._webGLVersion > 1 || null !== this._gl.getExtension("OES_standard_derivatives"), this._caps.astc = this._gl.getExtension("WEBGL_compressed_texture_astc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"), this._caps.s3tc = this._gl.getExtension("WEBGL_compressed_texture_s3tc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"), this._caps.pvrtc = this._gl.getExtension("WEBGL_compressed_texture_pvrtc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"), this._caps.etc1 = this._gl.getExtension("WEBGL_compressed_texture_etc1") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"), this._caps.etc2 = this._gl.getExtension("WEBGL_compressed_texture_etc") || this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc") || this._gl.getExtension("WEBGL_compressed_texture_es3_0"), this._caps.textureAnisotropicFilterExtension = this._gl.getExtension("EXT_texture_filter_anisotropic") || this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic") || this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"), this._caps.maxAnisotropy = this._caps.textureAnisotropicFilterExtension ? this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0, this._caps.uintIndices = this._webGLVersion > 1 || null !== this._gl.getExtension("OES_element_index_uint"), this._caps.fragmentDepthSupported = this._webGLVersion > 1 || null !== this._gl.getExtension("EXT_frag_depth"), this._caps.highPrecisionShaderSupported = !1, this._caps.timerQuery = this._gl.getExtension("EXT_disjoint_timer_query_webgl2") || this._gl.getExtension("EXT_disjoint_timer_query"), this._caps.timerQuery && (1 === this._webGLVersion && (this._gl.getQuery = this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)), this._caps.canUseTimestampForTimerQuery = this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT, this._caps.timerQuery.QUERY_COUNTER_BITS_EXT) > 0), this._caps.colorBufferFloat = this._webGLVersion > 1 && this._gl.getExtension("EXT_color_buffer_float"), this._caps.textureFloat = !!(this._webGLVersion > 1 || this._gl.getExtension("OES_texture_float")), this._caps.textureFloatLinearFiltering = !(!this._caps.textureFloat || !this._gl.getExtension("OES_texture_float_linear")), this._caps.textureFloatRender = !(!this._caps.textureFloat || !this._canRenderToFloatFramebuffer()), this._caps.textureHalfFloat = !!(this._webGLVersion > 1 || this._gl.getExtension("OES_texture_half_float")), this._caps.textureHalfFloatLinearFiltering = !!(this._webGLVersion > 1 || this._caps.textureHalfFloat && this._gl.getExtension("OES_texture_half_float_linear")), this._webGLVersion > 1 && (this._gl.HALF_FLOAT_OES = 5131), this._caps.textureHalfFloatRender = this._caps.textureHalfFloat && this._canRenderToHalfFloatFramebuffer(), this._caps.textureLOD = !!(this._webGLVersion > 1 || this._gl.getExtension("EXT_shader_texture_lod")), this._caps.multiview = this._gl.getExtension("OVR_multiview2"), this._webGLVersion > 1) this._caps.drawBuffersExtension = !0;
                else {
                    var t = this._gl.getExtension("WEBGL_draw_buffers");
                    if (null !== t) {
                        this._caps.drawBuffersExtension = !0, this._gl.drawBuffers = t.drawBuffersWEBGL.bind(t), this._gl.DRAW_FRAMEBUFFER = this._gl.FRAMEBUFFER;
                        for (var i = 0; i < 16; i++) this._gl["COLOR_ATTACHMENT" + i + "_WEBGL"] = t["COLOR_ATTACHMENT" + i + "_WEBGL"]
                    } else this._caps.drawBuffersExtension = !1
                }
                if (this._caps.parallelShaderCompile = this._gl.getExtension("KHR_parallel_shader_compile"), this._webGLVersion > 1) this._caps.depthTextureExtension = !0;
                else {
                    var n = this._gl.getExtension("WEBGL_depth_texture");
                    null != n && (this._caps.depthTextureExtension = !0, this._gl.UNSIGNED_INT_24_8 = n.UNSIGNED_INT_24_8_WEBGL)
                }
                if (this.disableVertexArrayObjects) this._caps.vertexArrayObject = !1;
                else if (this._webGLVersion > 1) this._caps.vertexArrayObject = !0;
                else {
                    var r = this._gl.getExtension("OES_vertex_array_object");
                    null != r ? (this._caps.vertexArrayObject = !0, this._gl.createVertexArray = r.createVertexArrayOES.bind(r), this._gl.bindVertexArray = r.bindVertexArrayOES.bind(r), this._gl.deleteVertexArray = r.deleteVertexArrayOES.bind(r)) : this._caps.vertexArrayObject = !1
                }
                if (this._webGLVersion > 1) this._caps.instancedArrays = !0;
                else {
                    var o = this._gl.getExtension("ANGLE_instanced_arrays");
                    null != o ? (this._caps.instancedArrays = !0, this._gl.drawArraysInstanced = o.drawArraysInstancedANGLE.bind(o), this._gl.drawElementsInstanced = o.drawElementsInstancedANGLE.bind(o), this._gl.vertexAttribDivisor = o.vertexAttribDivisorANGLE.bind(o)) : this._caps.instancedArrays = !1
                }
                if (this._caps.astc && this.texturesSupported.push("-astc.ktx"), this._caps.s3tc && this.texturesSupported.push("-dxt.ktx"), this._caps.pvrtc && this.texturesSupported.push("-pvrtc.ktx"), this._caps.etc2 && this.texturesSupported.push("-etc2.ktx"), this._caps.etc1 && this.texturesSupported.push("-etc1.ktx"), this._gl.getShaderPrecisionFormat) {
                    var s = this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER, this._gl.HIGH_FLOAT),
                        a = this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER, this._gl.HIGH_FLOAT);
                    s && a && (this._caps.highPrecisionShaderSupported = 0 !== s.precision && 0 !== a.precision)
                }
                this.setDepthBuffer(!0), this.setDepthFunctionToLessOrEqual(), this.setDepthWrite(!0), this._maxSimultaneousTextures = this._caps.maxCombinedTexturesImageUnits;
                for (var u = 0; u < this._maxSimultaneousTextures; u++) this._nextFreeTextureSlots.push(u)
            }, Object.defineProperty(e.prototype, "webGLVersion", {
                get: function() {
                    return this._webGLVersion
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isStencilEnable", {
                get: function() {
                    return this._isStencilEnable
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._prepareWorkingCanvas = function() {
                if (!this._workingCanvas) {
                    this._workingCanvas = document.createElement("canvas");
                    var e = this._workingCanvas.getContext("2d");
                    e && (this._workingContext = e)
                }
            }, e.prototype.resetTextureCache = function() {
                for (var e in this._boundTexturesCache) this._boundTexturesCache.hasOwnProperty(e) && (this._boundTexturesCache[e] = null);
                this._currentTextureChannel = -1
            }, e.prototype.isDeterministicLockStep = function() {
                return this._deterministicLockstep
            }, e.prototype.getLockstepMaxSteps = function() {
                return this._lockstepMaxSteps
            }, e.prototype.getGlInfo = function() {
                return {
                    vendor: this._glVendor,
                    renderer: this._glRenderer,
                    version: this._glVersion
                }
            }, e.prototype.getAspectRatio = function(e, t) {
                void 0 === t && (t = !1);
                var i = e.viewport;
                return this.getRenderWidth(t) * i.width / (this.getRenderHeight(t) * i.height)
            }, e.prototype.getScreenAspectRatio = function() {
                return this.getRenderWidth(!0) / this.getRenderHeight(!0)
            }, e.prototype.getRenderWidth = function(e) {
                return void 0 === e && (e = !1), !e && this._currentRenderTarget ? this._currentRenderTarget.width : this._gl.drawingBufferWidth
            }, e.prototype.getRenderHeight = function(e) {
                return void 0 === e && (e = !1), !e && this._currentRenderTarget ? this._currentRenderTarget.height : this._gl.drawingBufferHeight
            }, e.prototype.getRenderingCanvas = function() {
                return this._renderingCanvas
            }, e.prototype.getRenderingCanvasClientRect = function() {
                return this._renderingCanvas ? this._renderingCanvas.getBoundingClientRect() : null
            }, e.prototype.setHardwareScalingLevel = function(e) {
                this._hardwareScalingLevel = e, this.resize()
            }, e.prototype.getHardwareScalingLevel = function() {
                return this._hardwareScalingLevel
            }, e.prototype.getLoadedTexturesCache = function() {
                return this._internalTexturesCache
            }, e.prototype.getCaps = function() {
                return this._caps
            }, e.prototype.getDepthFunction = function() {
                return this._depthCullingState.depthFunc
            }, e.prototype.setDepthFunction = function(e) {
                this._depthCullingState.depthFunc = e
            }, e.prototype.setDepthFunctionToGreater = function() {
                this._depthCullingState.depthFunc = this._gl.GREATER
            }, e.prototype.setDepthFunctionToGreaterOrEqual = function() {
                this._depthCullingState.depthFunc = this._gl.GEQUAL
            }, e.prototype.setDepthFunctionToLess = function() {
                this._depthCullingState.depthFunc = this._gl.LESS
            }, e.prototype.cacheStencilState = function() {
                this._cachedStencilBuffer = this.getStencilBuffer(), this._cachedStencilFunction = this.getStencilFunction(), this._cachedStencilMask = this.getStencilMask(), this._cachedStencilOperationPass = this.getStencilOperationPass(), this._cachedStencilOperationFail = this.getStencilOperationFail(), this._cachedStencilOperationDepthFail = this.getStencilOperationDepthFail(), this._cachedStencilReference = this.getStencilFunctionReference()
            }, e.prototype.restoreStencilState = function() {
                this.setStencilFunction(this._cachedStencilFunction), this.setStencilMask(this._cachedStencilMask), this.setStencilBuffer(this._cachedStencilBuffer), this.setStencilOperationPass(this._cachedStencilOperationPass), this.setStencilOperationFail(this._cachedStencilOperationFail), this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail), this.setStencilFunctionReference(this._cachedStencilReference)
            }, e.prototype.setDepthFunctionToLessOrEqual = function() {
                this._depthCullingState.depthFunc = this._gl.LEQUAL
            }, e.prototype.getStencilBuffer = function() {
                return this._stencilState.stencilTest
            }, e.prototype.setStencilBuffer = function(e) {
                this._stencilState.stencilTest = e
            }, e.prototype.getStencilMask = function() {
                return this._stencilState.stencilMask
            }, e.prototype.setStencilMask = function(e) {
                this._stencilState.stencilMask = e
            }, e.prototype.getStencilFunction = function() {
                return this._stencilState.stencilFunc
            }, e.prototype.getStencilFunctionReference = function() {
                return this._stencilState.stencilFuncRef
            }, e.prototype.getStencilFunctionMask = function() {
                return this._stencilState.stencilFuncMask
            }, e.prototype.setStencilFunction = function(e) {
                this._stencilState.stencilFunc = e
            }, e.prototype.setStencilFunctionReference = function(e) {
                this._stencilState.stencilFuncRef = e
            }, e.prototype.setStencilFunctionMask = function(e) {
                this._stencilState.stencilFuncMask = e
            }, e.prototype.getStencilOperationFail = function() {
                return this._stencilState.stencilOpStencilFail
            }, e.prototype.getStencilOperationDepthFail = function() {
                return this._stencilState.stencilOpDepthFail
            }, e.prototype.getStencilOperationPass = function() {
                return this._stencilState.stencilOpStencilDepthPass
            }, e.prototype.setStencilOperationFail = function(e) {
                this._stencilState.stencilOpStencilFail = e
            }, e.prototype.setStencilOperationDepthFail = function(e) {
                this._stencilState.stencilOpDepthFail = e
            }, e.prototype.setStencilOperationPass = function(e) {
                this._stencilState.stencilOpStencilDepthPass = e
            }, e.prototype.setDitheringState = function(e) {
                e ? this._gl.enable(this._gl.DITHER) : this._gl.disable(this._gl.DITHER)
            }, e.prototype.setRasterizerState = function(e) {
                e ? this._gl.disable(this._gl.RASTERIZER_DISCARD) : this._gl.enable(this._gl.RASTERIZER_DISCARD)
            }, e.prototype.stopRenderLoop = function(e) {
                if (e) {
                    var t = this._activeRenderLoops.indexOf(e);
                    t >= 0 && this._activeRenderLoops.splice(t, 1)
                } else this._activeRenderLoops = []
            }, e.prototype._renderLoop = function() {
                if (!this._contextWasLost) {
                    var e = !0;
                    if (!this.renderEvenInBackground && this._windowIsBackground && (e = !1), e) {
                        this.beginFrame();
                        for (var t = 0; t < this._activeRenderLoops.length; t++) {
                            (0, this._activeRenderLoops[t])()
                        }
                        this.endFrame()
                    }
                }
                this._activeRenderLoops.length > 0 ? this.customAnimationFrameRequester ? (this.customAnimationFrameRequester.requestID = K.QueueNewFrame(this.customAnimationFrameRequester.renderFunction || this._bindedRenderFunction, this.customAnimationFrameRequester), this._frameHandler = this.customAnimationFrameRequester.requestID) : this.isVRPresenting() ? this._requestVRFrame() : this._frameHandler = K.QueueNewFrame(this._bindedRenderFunction) : this._renderingQueueLaunched = !1
            }, e.prototype.runRenderLoop = function(e) {
                -1 === this._activeRenderLoops.indexOf(e) && (this._activeRenderLoops.push(e), this._renderingQueueLaunched || (this._renderingQueueLaunched = !0, this._bindedRenderFunction = this._renderLoop.bind(this), this._frameHandler = K.QueueNewFrame(this._bindedRenderFunction)))
            }, e.prototype.switchFullscreen = function(e) {
                this.isFullscreen ? this.exitFullscreen() : this.enterFullscreen(e)
            }, e.prototype.enterFullscreen = function(e) {
                this.isFullscreen || (this._pointerLockRequested = e, this._renderingCanvas && K.RequestFullscreen(this._renderingCanvas))
            }, e.prototype.exitFullscreen = function() {
                this.isFullscreen && K.ExitFullscreen()
            }, e.prototype.clear = function(e, t, i, n) {
                void 0 === n && (n = !1), this.applyStates();
                var r = 0;
                t && e && (this._gl.clearColor(e.r, e.g, e.b, void 0 !== e.a ? e.a : 1), r |= this._gl.COLOR_BUFFER_BIT), i && (this._gl.clearDepth(1), r |= this._gl.DEPTH_BUFFER_BIT), n && (this._gl.clearStencil(0), r |= this._gl.STENCIL_BUFFER_BIT), this._gl.clear(r)
            }, e.prototype.scissorClear = function(e, t, i, n, r) {
                this.enableScissor(e, t, i, n), this.clear(r, !0, !0, !0), this.disableScissor()
            }, e.prototype.enableScissor = function(e, t, i, n) {
                var r = this._gl;
                r.enable(r.SCISSOR_TEST), r.scissor(e, t, i, n)
            }, e.prototype.disableScissor = function() {
                var e = this._gl;
                e.disable(e.SCISSOR_TEST)
            }, e.prototype._viewport = function(e, t, i, n) {
                e === this._viewportCached.x && t === this._viewportCached.y && i === this._viewportCached.z && n === this._viewportCached.w || (this._viewportCached.x = e, this._viewportCached.y = t, this._viewportCached.z = i, this._viewportCached.w = n, this._gl.viewport(e, t, i, n))
            }, e.prototype.setViewport = function(e, t, i) {
                var n = t || this.getRenderWidth(),
                    r = i || this.getRenderHeight(),
                    o = e.x || 0,
                    s = e.y || 0;
                this._cachedViewport = e, this._viewport(o * n, s * r, n * e.width, r * e.height)
            }, e.prototype.setDirectViewport = function(e, t, i, n) {
                var r = this._cachedViewport;
                return this._cachedViewport = null, this._viewport(e, t, i, n), r
            }, e.prototype.beginFrame = function() {
                this.onBeginFrameObservable.notifyObservers(this), this._measureFps()
            }, e.prototype.endFrame = function() {
                this._badOS && this.flushFramebuffer(), this._submitVRFrame(), this.onEndFrameObservable.notifyObservers(this)
            }, e.prototype.resize = function() {
                if (!this.isVRPresenting()) {
                    var e = this._renderingCanvas ? this._renderingCanvas.clientWidth : window.innerWidth,
                        t = this._renderingCanvas ? this._renderingCanvas.clientHeight : window.innerHeight;
                    this.setSize(e / this._hardwareScalingLevel, t / this._hardwareScalingLevel)
                }
            }, e.prototype.setSize = function(e, t) {
                if (this._renderingCanvas && (this._renderingCanvas.width !== e || this._renderingCanvas.height !== t)) {
                    this._renderingCanvas.width = e, this._renderingCanvas.height = t;
                    for (var i = 0; i < this.scenes.length; i++)
                        for (var n = this.scenes[i], r = 0; r < n.cameras.length; r++) {
                            n.cameras[r]._currentRenderId = 0
                        }
                    this.onResizeObservable.hasObservers && this.onResizeObservable.notifyObservers(this)
                }
            }, e.prototype.bindFramebuffer = function(e, t, i, n, r, o, s) {
                void 0 === s && (s = 0), this._currentRenderTarget && this.unBindFramebuffer(this._currentRenderTarget), this._currentRenderTarget = e, this._bindUnboundFramebuffer(e._MSAAFramebuffer ? e._MSAAFramebuffer : e._framebuffer);
                var a = this._gl;
                e.isCube && (void 0 === t && (t = 0), a.framebufferTexture2D(a.FRAMEBUFFER, a.COLOR_ATTACHMENT0, a.TEXTURE_CUBE_MAP_POSITIVE_X + t, e._webGLTexture, s), o && (o._generateStencilBuffer ? a.framebufferTexture2D(a.FRAMEBUFFER, a.DEPTH_STENCIL_ATTACHMENT, a.TEXTURE_CUBE_MAP_POSITIVE_X + t, o._webGLTexture, s) : a.framebufferTexture2D(a.FRAMEBUFFER, a.DEPTH_ATTACHMENT, a.TEXTURE_CUBE_MAP_POSITIVE_X + t, o._webGLTexture, s))), this._cachedViewport && !r ? this.setViewport(this._cachedViewport, i, n) : (i || (i = e.width, s && (i /= Math.pow(2, s))), n || (n = e.height, s && (n /= Math.pow(2, s))), this._viewport(0, 0, i, n)), this.wipeCaches()
            }, e.prototype._bindUnboundFramebuffer = function(e) {
                this._currentFramebuffer !== e && (this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, e), this._currentFramebuffer = e)
            }, e.prototype.unBindFramebuffer = function(e, t, i) {
                void 0 === t && (t = !1), this._currentRenderTarget = null;
                var n = this._gl;
                e._MSAAFramebuffer && (n.bindFramebuffer(n.READ_FRAMEBUFFER, e._MSAAFramebuffer), n.bindFramebuffer(n.DRAW_FRAMEBUFFER, e._framebuffer), n.blitFramebuffer(0, 0, e.width, e.height, 0, 0, e.width, e.height, n.COLOR_BUFFER_BIT, n.NEAREST)), !e.generateMipMaps || t || e.isCube || (this._bindTextureDirectly(n.TEXTURE_2D, e, !0), n.generateMipmap(n.TEXTURE_2D), this._bindTextureDirectly(n.TEXTURE_2D, null)), i && (e._MSAAFramebuffer && this._bindUnboundFramebuffer(e._framebuffer), i()), this._bindUnboundFramebuffer(null)
            }, e.prototype.generateMipMapsForCubemap = function(e) {
                if (e.generateMipMaps) {
                    var t = this._gl;
                    this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, e, !0), t.generateMipmap(t.TEXTURE_CUBE_MAP), this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, null)
                }
            }, e.prototype.flushFramebuffer = function() {
                this._gl.flush()
            }, e.prototype.restoreDefaultFramebuffer = function() {
                this._currentRenderTarget ? this.unBindFramebuffer(this._currentRenderTarget) : this._bindUnboundFramebuffer(null), this._cachedViewport && this.setViewport(this._cachedViewport), this.wipeCaches()
            }, e.prototype.createUniformBuffer = function(e) {
                var t = this._gl.createBuffer();
                if (!t) throw new Error("Unable to create uniform buffer");
                var i = new ke(t);
                return this.bindUniformBuffer(i), e instanceof Float32Array ? this._gl.bufferData(this._gl.UNIFORM_BUFFER, e, this._gl.STATIC_DRAW) : this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(e), this._gl.STATIC_DRAW), this.bindUniformBuffer(null), i.references = 1, i
            }, e.prototype.createDynamicUniformBuffer = function(e) {
                var t = this._gl.createBuffer();
                if (!t) throw new Error("Unable to create dynamic uniform buffer");
                var i = new ke(t);
                return this.bindUniformBuffer(i), e instanceof Float32Array ? this._gl.bufferData(this._gl.UNIFORM_BUFFER, e, this._gl.DYNAMIC_DRAW) : this._gl.bufferData(this._gl.UNIFORM_BUFFER, new Float32Array(e), this._gl.DYNAMIC_DRAW), this.bindUniformBuffer(null), i.references = 1, i
            }, e.prototype.updateUniformBuffer = function(e, t, i, n) {
                this.bindUniformBuffer(e), void 0 === i && (i = 0), void 0 === n ? t instanceof Float32Array ? this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, i, t) : this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, i, new Float32Array(t)) : t instanceof Float32Array ? this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, t.subarray(i, i + n)) : this._gl.bufferSubData(this._gl.UNIFORM_BUFFER, 0, new Float32Array(t).subarray(i, i + n)), this.bindUniformBuffer(null)
            }, e.prototype._resetVertexBufferBinding = function() {
                this.bindArrayBuffer(null), this._cachedVertexBuffers = null
            }, e.prototype.createVertexBuffer = function(e) {
                var t = this._gl.createBuffer();
                if (!t) throw new Error("Unable to create vertex buffer");
                var i = new ke(t);
                return this.bindArrayBuffer(i), e instanceof Array ? this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(e), this._gl.STATIC_DRAW) : this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.STATIC_DRAW), this._resetVertexBufferBinding(), i.references = 1, i
            }, e.prototype.createDynamicVertexBuffer = function(e) {
                var t = this._gl.createBuffer();
                if (!t) throw new Error("Unable to create dynamic vertex buffer");
                var i = new ke(t);
                return this.bindArrayBuffer(i), e instanceof Array ? this._gl.bufferData(this._gl.ARRAY_BUFFER, new Float32Array(e), this._gl.DYNAMIC_DRAW) : this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.DYNAMIC_DRAW), this._resetVertexBufferBinding(), i.references = 1, i
            }, e.prototype.updateDynamicIndexBuffer = function(e, t, i) {
                var n;
                void 0 === i && (i = 0), this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER] = null, this.bindIndexBuffer(e), n = t instanceof Uint16Array || t instanceof Uint32Array ? t : e.is32Bits ? new Uint32Array(t) : new Uint16Array(t), this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, n, this._gl.DYNAMIC_DRAW), this._resetIndexBufferBinding()
            }, e.prototype.updateDynamicVertexBuffer = function(e, t, i, n) {
                this.bindArrayBuffer(e), void 0 === i && (i = 0), void 0 === n ? t instanceof Array ? this._gl.bufferSubData(this._gl.ARRAY_BUFFER, i, new Float32Array(t)) : this._gl.bufferSubData(this._gl.ARRAY_BUFFER, i, t) : t instanceof Array ? this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, new Float32Array(t).subarray(i, i + n)) : (t = t instanceof ArrayBuffer ? new Uint8Array(t, i, n) : new Uint8Array(t.buffer, t.byteOffset + i, n), this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, t)), this._resetVertexBufferBinding()
            }, e.prototype._resetIndexBufferBinding = function() {
                this.bindIndexBuffer(null), this._cachedIndexBuffer = null
            }, e.prototype.createIndexBuffer = function(e, t) {
                var i, n = this._gl.createBuffer(),
                    r = new ke(n);
                if (!n) throw new Error("Unable to create index buffer");
                this.bindIndexBuffer(r);
                var o = !1;
                if (e instanceof Uint16Array) i = e;
                else if (this._caps.uintIndices)
                    if (e instanceof Uint32Array) i = e, o = !0;
                    else {
                        for (var s = 0; s < e.length; s++)
                            if (e[s] > 65535) {
                                o = !0;
                                break
                            }
                        i = o ? new Uint32Array(e) : new Uint16Array(e)
                    }
                else i = new Uint16Array(e);
                return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER, i, t ? this._gl.DYNAMIC_DRAW : this._gl.STATIC_DRAW), this._resetIndexBufferBinding(), r.references = 1, r.is32Bits = o, r
            }, e.prototype.bindArrayBuffer = function(e) {
                this._vaoRecordInProgress || this._unbindVertexArrayObject(), this.bindBuffer(e, this._gl.ARRAY_BUFFER)
            }, e.prototype.bindUniformBuffer = function(e) {
                this._gl.bindBuffer(this._gl.UNIFORM_BUFFER, e ? e.underlyingResource : null)
            }, e.prototype.bindUniformBufferBase = function(e, t) {
                this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER, t, e ? e.underlyingResource : null)
            }, e.prototype.bindUniformBlock = function(e, t, i) {
                var n = e.program,
                    r = this._gl.getUniformBlockIndex(n, t);
                this._gl.uniformBlockBinding(n, r, i)
            }, e.prototype.bindIndexBuffer = function(e) {
                this._vaoRecordInProgress || this._unbindVertexArrayObject(), this.bindBuffer(e, this._gl.ELEMENT_ARRAY_BUFFER)
            }, e.prototype.bindBuffer = function(e, t) {
                (this._vaoRecordInProgress || this._currentBoundBuffer[t] !== e) && (this._gl.bindBuffer(t, e ? e.underlyingResource : null), this._currentBoundBuffer[t] = e)
            }, e.prototype.updateArrayBuffer = function(e) {
                this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, e)
            }, e.prototype._vertexAttribPointer = function(e, t, i, n, r, o, s) {
                var a = this._currentBufferPointers[t],
                    u = !1;
                a.active ? (a.buffer !== e && (a.buffer = e, u = !0), a.size !== i && (a.size = i, u = !0), a.type !== n && (a.type = n, u = !0), a.normalized !== r && (a.normalized = r, u = !0), a.stride !== o && (a.stride = o, u = !0), a.offset !== s && (a.offset = s, u = !0)) : (u = !0, a.active = !0, a.index = t, a.size = i, a.type = n, a.normalized = r, a.stride = o, a.offset = s, a.buffer = e), (u || this._vaoRecordInProgress) && (this.bindArrayBuffer(e), this._gl.vertexAttribPointer(t, i, n, r, o, s))
            }, e.prototype._bindIndexBufferWithCache = function(e) {
                null != e && this._cachedIndexBuffer !== e && (this._cachedIndexBuffer = e, this.bindIndexBuffer(e), this._uintIndicesCurrentlySet = e.is32Bits)
            }, e.prototype._bindVertexBuffersAttributes = function(e, t) {
                var i = t.getAttributesNames();
                this._vaoRecordInProgress || this._unbindVertexArrayObject(), this.unbindAllAttributes();
                for (var n = 0; n < i.length; n++) {
                    var r = t.getAttributeLocation(n);
                    if (r >= 0) {
                        var o = e[i[n]];
                        if (!o) continue;
                        this._gl.enableVertexAttribArray(r), this._vaoRecordInProgress || (this._vertexAttribArraysEnabled[r] = !0);
                        var s = o.getBuffer();
                        s && (this._vertexAttribPointer(s, r, o.getSize(), o.type, o.normalized, o.byteStride, o.byteOffset), o.getIsInstanced() && (this._gl.vertexAttribDivisor(r, o.getInstanceDivisor()), this._vaoRecordInProgress || (this._currentInstanceLocations.push(r), this._currentInstanceBuffers.push(s))))
                    }
                }
            }, e.prototype.recordVertexArrayObject = function(e, t, i) {
                var n = this._gl.createVertexArray();
                return this._vaoRecordInProgress = !0, this._gl.bindVertexArray(n), this._mustWipeVertexAttributes = !0, this._bindVertexBuffersAttributes(e, i), this.bindIndexBuffer(t), this._vaoRecordInProgress = !1, this._gl.bindVertexArray(null), n
            }, e.prototype.bindVertexArrayObject = function(e, t) {
                this._cachedVertexArrayObject !== e && (this._cachedVertexArrayObject = e, this._gl.bindVertexArray(e), this._cachedVertexBuffers = null, this._cachedIndexBuffer = null, this._uintIndicesCurrentlySet = null != t && t.is32Bits, this._mustWipeVertexAttributes = !0)
            }, e.prototype.bindBuffersDirectly = function(e, t, i, n, r) {
                if (this._cachedVertexBuffers !== e || this._cachedEffectForVertexBuffers !== r) {
                    this._cachedVertexBuffers = e, this._cachedEffectForVertexBuffers = r;
                    var o = r.getAttributesCount();
                    this._unbindVertexArrayObject(), this.unbindAllAttributes();
                    for (var s = 0, a = 0; a < o; a++)
                        if (a < i.length) {
                            var u = r.getAttributeLocation(a);
                            u >= 0 && (this._gl.enableVertexAttribArray(u), this._vertexAttribArraysEnabled[u] = !0, this._vertexAttribPointer(e, u, i[a], this._gl.FLOAT, !1, n, s)), s += 4 * i[a]
                        }
                }
                this._bindIndexBufferWithCache(t)
            }, e.prototype._unbindVertexArrayObject = function() {
                this._cachedVertexArrayObject && (this._cachedVertexArrayObject = null, this._gl.bindVertexArray(null))
            }, e.prototype.bindBuffers = function(e, t, i) {
                this._cachedVertexBuffers === e && this._cachedEffectForVertexBuffers === i || (this._cachedVertexBuffers = e, this._cachedEffectForVertexBuffers = i, this._bindVertexBuffersAttributes(e, i)), this._bindIndexBufferWithCache(t)
            }, e.prototype.unbindInstanceAttributes = function() {
                for (var e, t = 0, i = this._currentInstanceLocations.length; t < i; t++) {
                    var n = this._currentInstanceBuffers[t];
                    e != n && n.references && (e = n, this.bindArrayBuffer(n));
                    var r = this._currentInstanceLocations[t];
                    this._gl.vertexAttribDivisor(r, 0)
                }
                this._currentInstanceBuffers.length = 0, this._currentInstanceLocations.length = 0
            }, e.prototype.releaseVertexArrayObject = function(e) {
                this._gl.deleteVertexArray(e)
            }, e.prototype._releaseBuffer = function(e) {
                return e.references--, 0 === e.references && (this._gl.deleteBuffer(e.underlyingResource), !0)
            }, e.prototype.createInstancesBuffer = function(e) {
                var t = this._gl.createBuffer();
                if (!t) throw new Error("Unable to create instance buffer");
                var i = new ke(t);
                return i.capacity = e, this.bindArrayBuffer(i), this._gl.bufferData(this._gl.ARRAY_BUFFER, e, this._gl.DYNAMIC_DRAW), i
            }, e.prototype.deleteInstancesBuffer = function(e) {
                this._gl.deleteBuffer(e)
            }, e.prototype.updateAndBindInstancesBuffer = function(e, t, i) {
                if (this.bindArrayBuffer(e), t && this._gl.bufferSubData(this._gl.ARRAY_BUFFER, 0, t), void 0 !== i[0].index) {
                    for (var n = 0, r = 0; r < i.length; r++) {
                        n += 4 * (o = i[r]).attributeSize
                    }
                    for (r = 0; r < i.length; r++) {
                        var o = i[r];
                        this._vertexAttribArraysEnabled[o.index] || (this._gl.enableVertexAttribArray(o.index), this._vertexAttribArraysEnabled[o.index] = !0), this._vertexAttribPointer(e, o.index, o.attributeSize, o.attribyteType || this._gl.FLOAT, o.normalized || !1, n, o.offset), this._gl.vertexAttribDivisor(o.index, 1), this._currentInstanceLocations.push(o.index), this._currentInstanceBuffers.push(e)
                    }
                } else
                    for (var s = 0; s < 4; s++) {
                        var a = i[s];
                        this._vertexAttribArraysEnabled[a] || (this._gl.enableVertexAttribArray(a), this._vertexAttribArraysEnabled[a] = !0), this._vertexAttribPointer(e, a, 4, this._gl.FLOAT, !1, 64, 16 * s), this._gl.vertexAttribDivisor(a, 1), this._currentInstanceLocations.push(a), this._currentInstanceBuffers.push(e)
                    }
            }, e.prototype.applyStates = function() {
                this._depthCullingState.apply(this._gl), this._stencilState.apply(this._gl), this._alphaState.apply(this._gl)
            }, e.prototype.draw = function(e, t, i, n) {
                this.drawElementsType(e ? De.TriangleFillMode : De.WireFrameFillMode, t, i, n)
            }, e.prototype.drawPointClouds = function(e, t, i) {
                this.drawArraysType(De.PointFillMode, e, t, i)
            }, e.prototype.drawUnIndexed = function(e, t, i, n) {
                this.drawArraysType(e ? De.TriangleFillMode : De.WireFrameFillMode, t, i, n)
            }, e.prototype.drawElementsType = function(e, t, i, n) {
                this.applyStates(), this._drawCalls.addCount(1, !1);
                var r = this._drawMode(e),
                    o = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT,
                    s = this._uintIndicesCurrentlySet ? 4 : 2;
                n ? this._gl.drawElementsInstanced(r, i, o, t * s, n) : this._gl.drawElements(r, i, o, t * s)
            }, e.prototype.drawArraysType = function(e, t, i, n) {
                this.applyStates(), this._drawCalls.addCount(1, !1);
                var r = this._drawMode(e);
                n ? this._gl.drawArraysInstanced(r, t, i, n) : this._gl.drawArrays(r, t, i)
            }, e.prototype._drawMode = function(e) {
                switch (e) {
                    case De.TriangleFillMode:
                        return this._gl.TRIANGLES;
                    case De.PointFillMode:
                        return this._gl.POINTS;
                    case De.WireFrameFillMode:
                        return this._gl.LINES;
                    case De.PointListDrawMode:
                        return this._gl.POINTS;
                    case De.LineListDrawMode:
                        return this._gl.LINES;
                    case De.LineLoopDrawMode:
                        return this._gl.LINE_LOOP;
                    case De.LineStripDrawMode:
                        return this._gl.LINE_STRIP;
                    case De.TriangleStripDrawMode:
                        return this._gl.TRIANGLE_STRIP;
                    case De.TriangleFanDrawMode:
                        return this._gl.TRIANGLE_FAN;
                    default:
                        return this._gl.TRIANGLES
                }
            }, e.prototype._releaseEffect = function(e) {
                this._compiledEffects[e._key] && (delete this._compiledEffects[e._key], this._deletePipelineContext(e.getPipelineContext()))
            }, e.prototype._deletePipelineContext = function(e) {
                var t = e;
                t && t.program && (t.program.__SPECTOR_rebuildProgram = null, t.transformFeedback && (this.deleteTransformFeedback(t.transformFeedback), t.transformFeedback = null), this._gl.deleteProgram(t.program))
            }, e.prototype.createEffect = function(e, t, i, n, r, o, s, a, u) {
                var h = (e.vertexElement || e.vertex || e) + "+" + (e.fragmentElement || e.fragment || e) + "@" + (r || t.defines);
                if (this._compiledEffects[h]) {
                    var l = this._compiledEffects[h];
                    return s && l.isReady() && s(l), l
                }
                var c = new ie(e, t, i, n, this, r, o, s, a, u);
                return c._key = h, this._compiledEffects[h] = c, c
            }, e.prototype._compileShader = function(e, t, i, n) {
                return this._compileRawShader(n + (i ? i + "\n" : "") + e, t)
            }, e.prototype._compileRawShader = function(e, t) {
                var i = this._gl,
                    n = i.createShader("vertex" === t ? i.VERTEX_SHADER : i.FRAGMENT_SHADER);
                if (!n) throw new Error("Something went wrong while compile the shader.");
                return i.shaderSource(n, e), i.compileShader(n), n
            }, e.prototype.createRawShaderProgram = function(e, t, i, n, r) {
                void 0 === r && (r = null), n = n || this._gl;
                var o = this._compileRawShader(t, "vertex"),
                    s = this._compileRawShader(i, "fragment");
                return this._createShaderProgram(e, o, s, n, r)
            }, e.prototype.createShaderProgram = function(e, t, i, n, r, o) {
                void 0 === o && (o = null), r = r || this._gl, this.onBeforeShaderCompilationObservable.notifyObservers(this);
                var s = this._webGLVersion > 1 ? "#version 300 es\n#define WEBGL2 \n" : "",
                    a = this._compileShader(t, "vertex", n, s),
                    u = this._compileShader(i, "fragment", n, s),
                    h = this._createShaderProgram(e, a, u, r, o);
                return this.onAfterShaderCompilationObservable.notifyObservers(this), h
            }, e.prototype.createPipelineContext = function() {
                var e = new Be;
                return e.engine = this, this._caps.parallelShaderCompile && (e.isParallelCompiled = !0), e
            }, e.prototype._createShaderProgram = function(e, t, i, n, r) {
                void 0 === r && (r = null);
                var o = n.createProgram();
                if (e.program = o, !o) throw new Error("Unable to create program");
                if (n.attachShader(o, t), n.attachShader(o, i), this.webGLVersion > 1 && r) {
                    var s = this.createTransformFeedback();
                    this.bindTransformFeedback(s), this.setTranformFeedbackVaryings(o, r), e.transformFeedback = s
                }
                return n.linkProgram(o), this.webGLVersion > 1 && r && this.bindTransformFeedback(null), e.context = n, e.vertexShader = t, e.fragmentShader = i, e.isParallelCompiled || this._finalizePipelineContext(e), o
            }, e.prototype._finalizePipelineContext = function(e) {
                var t = e.context,
                    i = e.vertexShader,
                    n = e.fragmentShader,
                    r = e.program;
                if (!t.getProgramParameter(r, t.LINK_STATUS)) {
                    var o, s;
                    if (!this._gl.getShaderParameter(i, this._gl.COMPILE_STATUS))
                        if (o = this._gl.getShaderInfoLog(i)) throw new Error(o);
                    if (!this._gl.getShaderParameter(n, this._gl.COMPILE_STATUS))
                        if (o = this._gl.getShaderInfoLog(n)) throw new Error(o);
                    if (s = t.getProgramInfoLog(r)) throw new Error(s)
                }
                if (this.validateShaderPrograms && (t.validateProgram(r), !t.getProgramParameter(r, t.VALIDATE_STATUS) && (s = t.getProgramInfoLog(r)))) throw new Error(s);
                t.deleteShader(i), t.deleteShader(n), e.vertexShader = void 0, e.fragmentShader = void 0, e.onCompiled && (e.onCompiled(), e.onCompiled = void 0)
            }, e.prototype._preparePipelineContext = function(e, t, i, n, r, o, s) {
                var a = e;
                a.program = n ? this.createRawShaderProgram(a, t, i, void 0, s) : this.createShaderProgram(a, t, i, o, void 0, s), a.program.__SPECTOR_rebuildProgram = r
            }, e.prototype._isRenderingStateCompiled = function(e) {
                var t = e;
                return !!this._gl.getProgramParameter(t.program, this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR) && (this._finalizePipelineContext(t), !0)
            }, e.prototype._executeWhenRenderingStateIsCompiled = function(e, t) {
                var i = e;
                i.isParallelCompiled ? i.onCompiled = t : t()
            }, e.prototype.getUniforms = function(e, t) {
                for (var i = new Array, n = e, r = 0; r < t.length; r++) i.push(this._gl.getUniformLocation(n.program, t[r]));
                return i
            }, e.prototype.getAttributes = function(e, t) {
                for (var i = [], n = e, r = 0; r < t.length; r++) try {
                    i.push(this._gl.getAttribLocation(n.program, t[r]))
                } catch (e) {
                    i.push(-1)
                }
                return i
            }, e.prototype.enableEffect = function(e) {
                e && e !== this._currentEffect && (this.bindSamplers(e), this._currentEffect = e, e.onBind && e.onBind(e), e._onBindObservable && e._onBindObservable.notifyObservers(e))
            }, e.prototype.setIntArray = function(e, t) {
                e && this._gl.uniform1iv(e, t)
            }, e.prototype.setIntArray2 = function(e, t) {
                e && t.length % 2 == 0 && this._gl.uniform2iv(e, t)
            }, e.prototype.setIntArray3 = function(e, t) {
                e && t.length % 3 == 0 && this._gl.uniform3iv(e, t)
            }, e.prototype.setIntArray4 = function(e, t) {
                e && t.length % 4 == 0 && this._gl.uniform4iv(e, t)
            }, e.prototype.setFloatArray = function(e, t) {
                e && this._gl.uniform1fv(e, t)
            }, e.prototype.setFloatArray2 = function(e, t) {
                e && t.length % 2 == 0 && this._gl.uniform2fv(e, t)
            }, e.prototype.setFloatArray3 = function(e, t) {
                e && t.length % 3 == 0 && this._gl.uniform3fv(e, t)
            }, e.prototype.setFloatArray4 = function(e, t) {
                e && t.length % 4 == 0 && this._gl.uniform4fv(e, t)
            }, e.prototype.setArray = function(e, t) {
                e && this._gl.uniform1fv(e, t)
            }, e.prototype.setArray2 = function(e, t) {
                e && t.length % 2 == 0 && this._gl.uniform2fv(e, t)
            }, e.prototype.setArray3 = function(e, t) {
                e && t.length % 3 == 0 && this._gl.uniform3fv(e, t)
            }, e.prototype.setArray4 = function(e, t) {
                e && t.length % 4 == 0 && this._gl.uniform4fv(e, t)
            }, e.prototype.setMatrices = function(e, t) {
                e && this._gl.uniformMatrix4fv(e, !1, t)
            }, e.prototype.setMatrix = function(e, t) {
                e && this._gl.uniformMatrix4fv(e, !1, t.toArray())
            }, e.prototype.setMatrix3x3 = function(e, t) {
                e && this._gl.uniformMatrix3fv(e, !1, t)
            }, e.prototype.setMatrix2x2 = function(e, t) {
                e && this._gl.uniformMatrix2fv(e, !1, t)
            }, e.prototype.setInt = function(e, t) {
                e && this._gl.uniform1i(e, t)
            }, e.prototype.setFloat = function(e, t) {
                e && this._gl.uniform1f(e, t)
            }, e.prototype.setFloat2 = function(e, t, i) {
                e && this._gl.uniform2f(e, t, i)
            }, e.prototype.setFloat3 = function(e, t, i, n) {
                e && this._gl.uniform3f(e, t, i, n)
            }, e.prototype.setBool = function(e, t) {
                e && this._gl.uniform1i(e, t)
            }, e.prototype.setFloat4 = function(e, t, i, n, r) {
                e && this._gl.uniform4f(e, t, i, n, r)
            }, e.prototype.setColor3 = function(e, t) {
                e && this._gl.uniform3f(e, t.r, t.g, t.b)
            }, e.prototype.setColor4 = function(e, t, i) {
                e && this._gl.uniform4f(e, t.r, t.g, t.b, i)
            }, e.prototype.setDirectColor4 = function(e, t) {
                e && this._gl.uniform4f(e, t.r, t.g, t.b, t.a)
            }, e.prototype.setState = function(e, t, i, n) {
                void 0 === t && (t = 0), void 0 === n && (n = !1), (this._depthCullingState.cull !== e || i) && (this._depthCullingState.cull = e);
                var r = this.cullBackFaces ? this._gl.BACK : this._gl.FRONT;
                (this._depthCullingState.cullFace !== r || i) && (this._depthCullingState.cullFace = r), this.setZOffset(t);
                var o = n ? this._gl.CW : this._gl.CCW;
                (this._depthCullingState.frontFace !== o || i) && (this._depthCullingState.frontFace = o)
            }, e.prototype.setZOffset = function(e) {
                this._depthCullingState.zOffset = e
            }, e.prototype.getZOffset = function() {
                return this._depthCullingState.zOffset
            }, e.prototype.setDepthBuffer = function(e) {
                this._depthCullingState.depthTest = e
            }, e.prototype.getDepthWrite = function() {
                return this._depthCullingState.depthMask
            }, e.prototype.setDepthWrite = function(e) {
                this._depthCullingState.depthMask = e
            }, e.prototype.setColorWrite = function(e) {
                this._gl.colorMask(e, e, e, e), this._colorWrite = e
            }, e.prototype.getColorWrite = function() {
                return this._colorWrite
            }, e.prototype.setAlphaConstants = function(e, t, i, n) {
                this._alphaState.setAlphaBlendConstants(e, t, i, n)
            }, e.prototype.setAlphaMode = function(t, i) {
                if (void 0 === i && (i = !1), this._alphaMode !== t) {
                    switch (t) {
                        case e.ALPHA_DISABLE:
                            this._alphaState.alphaBlend = !1;
                            break;
                        case e.ALPHA_PREMULTIPLIED:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_PREMULTIPLIED_PORTERDUFF:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_COMBINE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_ALPHA, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_ONEONE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE, this._gl.ZERO, this._gl.ONE), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_ADD:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE, this._gl.ZERO, this._gl.ONE), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_SUBTRACT:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_MULTIPLY:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR, this._gl.ZERO, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_MAXIMIZED:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_INTERPOLATE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR, this._gl.ONE_MINUS_CONSTANT_COLOR, this._gl.CONSTANT_ALPHA, this._gl.ONE_MINUS_CONSTANT_ALPHA), this._alphaState.alphaBlend = !0;
                            break;
                        case e.ALPHA_SCREENMODE:
                            this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE, this._gl.ONE_MINUS_SRC_COLOR, this._gl.ONE, this._gl.ONE_MINUS_SRC_ALPHA), this._alphaState.alphaBlend = !0
                    }
                    i || this.setDepthWrite(t === e.ALPHA_DISABLE), this._alphaMode = t
                }
            }, e.prototype.getAlphaMode = function() {
                return this._alphaMode
            }, e.prototype.clearInternalTexturesCache = function() {
                this._internalTexturesCache = []
            }, e.prototype.wipeCaches = function(e) {
                this.preventCacheWipeBetweenFrames && !e || (this._currentEffect = null, this._viewportCached.x = 0, this._viewportCached.y = 0, this._viewportCached.z = 0, this._viewportCached.w = 0, e && (this.resetTextureCache(), this._currentProgram = null, this._stencilState.reset(), this._depthCullingState.reset(), this.setDepthFunctionToLessOrEqual(), this._alphaState.reset(), this._unpackFlipYCached = null), this._resetVertexBufferBinding(), this._cachedIndexBuffer = null, this._cachedEffectForVertexBuffers = null, this._unbindVertexArrayObject(), this.bindIndexBuffer(null))
            }, e.prototype.setTextureFormatToUse = function(e) {
                for (var t = 0, i = this.texturesSupported.length; t < i; t++)
                    for (var n = 0, r = e.length; n < r; n++)
                        if (this._texturesSupported[t] === e[n].toLowerCase()) return this._textureFormatInUse = this._texturesSupported[t];
                return this._textureFormatInUse = null, null
            }, e.prototype._getSamplingParameters = function(t, i) {
                var n = this._gl,
                    r = n.NEAREST,
                    o = n.NEAREST;
                switch (t) {
                    case e.TEXTURE_BILINEAR_SAMPLINGMODE:
                        r = n.LINEAR, o = i ? n.LINEAR_MIPMAP_NEAREST : n.LINEAR;
                        break;
                    case e.TEXTURE_TRILINEAR_SAMPLINGMODE:
                        r = n.LINEAR, o = i ? n.LINEAR_MIPMAP_LINEAR : n.LINEAR;
                        break;
                    case e.TEXTURE_NEAREST_SAMPLINGMODE:
                        r = n.NEAREST, o = i ? n.NEAREST_MIPMAP_LINEAR : n.NEAREST;
                        break;
                    case e.TEXTURE_NEAREST_NEAREST_MIPNEAREST:
                        r = n.NEAREST, o = i ? n.NEAREST_MIPMAP_NEAREST : n.NEAREST;
                        break;
                    case e.TEXTURE_NEAREST_LINEAR_MIPNEAREST:
                        r = n.NEAREST, o = i ? n.LINEAR_MIPMAP_NEAREST : n.LINEAR;
                        break;
                    case e.TEXTURE_NEAREST_LINEAR_MIPLINEAR:
                        r = n.NEAREST, o = i ? n.LINEAR_MIPMAP_LINEAR : n.LINEAR;
                        break;
                    case e.TEXTURE_NEAREST_LINEAR:
                        r = n.NEAREST, o = n.LINEAR;
                        break;
                    case e.TEXTURE_NEAREST_NEAREST:
                        r = n.NEAREST, o = n.NEAREST;
                        break;
                    case e.TEXTURE_LINEAR_NEAREST_MIPNEAREST:
                        r = n.LINEAR, o = i ? n.NEAREST_MIPMAP_NEAREST : n.NEAREST;
                        break;
                    case e.TEXTURE_LINEAR_NEAREST_MIPLINEAR:
                        r = n.LINEAR, o = i ? n.NEAREST_MIPMAP_LINEAR : n.NEAREST;
                        break;
                    case e.TEXTURE_LINEAR_LINEAR:
                        r = n.LINEAR, o = n.LINEAR;
                        break;
                    case e.TEXTURE_LINEAR_NEAREST:
                        r = n.LINEAR, o = n.NEAREST
                }
                return {
                    min: o,
                    mag: r
                }
            }, e.prototype._createTexture = function() {
                var e = this._gl.createTexture();
                if (!e) throw new Error("Unable to create texture");
                return e
            }, e.prototype.createTexture = function(t, i, n, r, o, s, a, u, h, l, c, d) {
                var f = this;
                void 0 === o && (o = e.TEXTURE_TRILINEAR_SAMPLINGMODE), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === u && (u = null), void 0 === h && (h = null), void 0 === l && (l = null), void 0 === c && (c = null), void 0 === d && (d = []);
                for (var p = String(t), _ = "data:" === p.substr(0, 5), g = "blob:" === p.substr(0, 5), m = _ && -1 !== p.indexOf(";base64,"), v = h || new Le(this, Le.DATASOURCE_URL), y = p.lastIndexOf("."), T = c || (y > -1 ? p.substring(y).toLowerCase() : ""), b = null, E = 0, A = e._TextureLoaders; E < A.length; E++) {
                    var M = A[E];
                    if (-1 === d.indexOf(M) && M.canLoad(T, this._textureFormatInUse, h, m, !!u)) {
                        b = M;
                        break
                    }
                }
                b && (p = b.transformUrl(p, this._textureFormatInUse)), r && r._addPendingData(v), v.url = p, v.generateMipMaps = !i, v.samplingMode = o, v.invertY = n, this._doNotHandleContextLost || (v._buffer = u);
                var R = null;
                s && !h && (R = v.onLoadedObservable.add(s)), h || this._internalTexturesCache.push(v);
                var x = function(e, n) {
                    r && r._removePendingData(v);
                    var s = !1;
                    b && (b.getFallbackTextureUrl(p, f._textureFormatInUse) && (s = !0, d.push(b), K.Warn(b.constructor.name + " failed when trying to load " + v.url + ", falling back to the next supported loader"), f.createTexture(t, i, v.invertY, r, o, null, null, u, v, void 0, void 0, d)));
                    s || (R && v.onLoadedObservable.remove(R), K.UseFallbackTexture && f.createTexture(K.fallbackTexture, i, v.invertY, r, o, null, null, u, v)), a && a(e || "Unknown error", n)
                };
                if (b) {
                    var P = function(e) {
                        b.loadData(e, v, (function(e, t, i, n, s, a) {
                            a ? x("TextureLoader failed to load data") : f._prepareWebGLTexture(v, r, e, t, v.invertY, !i, n, (function() {
                                return s(), !1
                            }), o)
                        }))
                    };
                    u ? P(u) : this._loadFile(p, P, void 0, r ? r.offlineProvider : void 0, !0, (function(e, t) {
                        x("Unable to load " + (e && e.responseURL, t))
                    }))
                } else {
                    var I = function(t) {
                        g && !f._doNotHandleContextLost && (v._buffer = t), f._prepareWebGLTexture(v, r, t.width, t.height, v.invertY, i, !1, (function(i, n, o) {
                            var s = f._gl,
                                a = t.width === i && t.height === n,
                                u = l ? f._getInternalFormat(l) : ".jpg" === T ? s.RGB : s.RGBA;
                            if (a) return s.texImage2D(s.TEXTURE_2D, 0, u, u, s.UNSIGNED_BYTE, t), !1;
                            var h = f._caps.maxTextureSize;
                            if (t.width > h || t.height > h || null === e._RescalePostProcessFactory) return f._prepareWorkingCanvas(), !(!f._workingCanvas || !f._workingContext) && (f._workingCanvas.width = i, f._workingCanvas.height = n, f._workingContext.drawImage(t, 0, 0, t.width, t.height, 0, 0, i, n), s.texImage2D(s.TEXTURE_2D, 0, u, u, s.UNSIGNED_BYTE, f._workingCanvas), v.width = i, v.height = n, !1);
                            var c = new Le(f, Le.DATASOURCE_TEMP);
                            return f._bindTextureDirectly(s.TEXTURE_2D, c, !0), s.texImage2D(s.TEXTURE_2D, 0, u, u, s.UNSIGNED_BYTE, t), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_MAG_FILTER, s.LINEAR), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_MIN_FILTER, s.LINEAR), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_WRAP_S, s.CLAMP_TO_EDGE), s.texParameteri(s.TEXTURE_2D, s.TEXTURE_WRAP_T, s.CLAMP_TO_EDGE), f._rescaleTexture(c, v, r, u, (function() {
                                f._releaseTexture(c), f._bindTextureDirectly(s.TEXTURE_2D, v, !0), o()
                            })), !0
                        }), o)
                    };
                    !_ || m ? u instanceof HTMLImageElement ? I(u) : K.LoadImage(p, I, x, r ? r.offlineProvider : null) : "string" == typeof u || u instanceof ArrayBuffer || u instanceof Blob ? K.LoadImage(u, I, x, r ? r.offlineProvider : null) : I(u)
                }
                return v
            }, e.prototype._rescaleTexture = function(t, i, n, r, o) {
                var s = this,
                    a = this.createRenderTargetTexture({
                        width: i.width,
                        height: i.height
                    }, {
                        generateMipMaps: !1,
                        type: e.TEXTURETYPE_UNSIGNED_INT,
                        samplingMode: e.TEXTURE_BILINEAR_SAMPLINGMODE,
                        generateDepthBuffer: !1,
                        generateStencilBuffer: !1
                    });
                !this._rescalePostProcess && e._RescalePostProcessFactory && (this._rescalePostProcess = e._RescalePostProcessFactory(this)), this._rescalePostProcess.getEffect().executeWhenCompiled((function() {
                    s._rescalePostProcess.onApply = function(e) {
                        e._bindTexture("textureSampler", t)
                    };
                    var e = n;
                    e || (e = s.scenes[s.scenes.length - 1]), e.postProcessManager.directRender([s._rescalePostProcess], a, !0), s._bindTextureDirectly(s._gl.TEXTURE_2D, i, !0), s._gl.copyTexImage2D(s._gl.TEXTURE_2D, 0, r, 0, 0, i.width, i.height, 0), s.unBindFramebuffer(a), s._releaseTexture(a), o && o()
                }))
            }, e.prototype.createRawTexture = function(t, i, n, r, o, s, a, u, h) {
                throw void 0 === u && (u = null), void 0 === h && (h = e.TEXTURETYPE_UNSIGNED_INT), X.WarnImport("Engine.RawTexture")
            }, e.prototype._unpackFlipY = function(e) {
                this._unpackFlipYCached !== e && (this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, e ? 1 : 0), this.enableUnpackFlipYCached && (this._unpackFlipYCached = e))
            }, e.prototype._getUnpackAlignement = function() {
                return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)
            }, e.prototype.createDynamicTexture = function(e, t, i, n) {
                var r = new Le(this, Le.DATASOURCE_DYNAMIC);
                return r.baseWidth = e, r.baseHeight = t, i && (e = this.needPOTTextures ? K.GetExponentOfTwo(e, this._caps.maxTextureSize) : e, t = this.needPOTTextures ? K.GetExponentOfTwo(t, this._caps.maxTextureSize) : t), r.width = e, r.height = t, r.isReady = !1, r.generateMipMaps = i, r.samplingMode = n, this.updateTextureSamplingMode(n, r), this._internalTexturesCache.push(r), r
            }, e.prototype.updateTextureSamplingMode = function(e, t) {
                var i = this._getSamplingParameters(e, t.generateMipMaps);
                t.isCube ? (this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MAG_FILTER, i.mag, t), this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_MIN_FILTER, i.min), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null)) : t.is3D ? (this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MAG_FILTER, i.mag, t), this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_MIN_FILTER, i.min), this._bindTextureDirectly(this._gl.TEXTURE_3D, null)) : (this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, i.mag, t), this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, i.min), this._bindTextureDirectly(this._gl.TEXTURE_2D, null)), t.samplingMode = e
            }, e.prototype.updateDynamicTexture = function(e, t, i, n, r, o) {
                if (void 0 === n && (n = !1), void 0 === o && (o = !1), e) {
                    this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0, o), this._unpackFlipY(i), n && this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);
                    var s = r ? this._getInternalFormat(r) : this._gl.RGBA;
                    this._gl.texImage2D(this._gl.TEXTURE_2D, 0, s, s, this._gl.UNSIGNED_BYTE, t), e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(this._gl.TEXTURE_2D, null), n && this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 0), e.isReady = !0
                }
            }, e.prototype.updateVideoTexture = function(e, t, i) {
                if (e && !e._isDisabled) {
                    var n = this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0);
                    this._unpackFlipY(!i);
                    try {
                        if (void 0 === this._videoTextureSupported && (this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, t), 0 !== this._gl.getError() ? this._videoTextureSupported = !1 : this._videoTextureSupported = !0), this._videoTextureSupported) this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, t);
                        else {
                            if (!e._workingCanvas) {
                                e._workingCanvas = document.createElement("canvas");
                                var r = e._workingCanvas.getContext("2d");
                                if (!r) throw new Error("Unable to get 2d context");
                                e._workingContext = r, e._workingCanvas.width = e.width, e._workingCanvas.height = e.height
                            }
                            e._workingContext.drawImage(t, 0, 0, t.videoWidth, t.videoHeight, 0, 0, e.width, e.height), this._gl.texImage2D(this._gl.TEXTURE_2D, 0, this._gl.RGBA, this._gl.RGBA, this._gl.UNSIGNED_BYTE, e._workingCanvas)
                        }
                        e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), n || this._bindTextureDirectly(this._gl.TEXTURE_2D, null), e.isReady = !0
                    } catch (t) {
                        e._isDisabled = !0
                    }
                }
            }, e.prototype.updateTextureComparisonFunction = function(t, i) {
                if (1 !== this.webGLVersion) {
                    var n = this._gl;
                    t.isCube ? (this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, t, !0), 0 === i ? (n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_FUNC, e.LEQUAL), n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_MODE, n.NONE)) : (n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_FUNC, i), n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_COMPARE_MODE, n.COMPARE_REF_TO_TEXTURE)), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null)) : (this._bindTextureDirectly(this._gl.TEXTURE_2D, t, !0), 0 === i ? (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_FUNC, e.LEQUAL), n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_MODE, n.NONE)) : (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_FUNC, i), n.texParameteri(n.TEXTURE_2D, n.TEXTURE_COMPARE_MODE, n.COMPARE_REF_TO_TEXTURE)), this._bindTextureDirectly(this._gl.TEXTURE_2D, null)), t._comparisonFunction = i
                } else V.Error("WebGL 1 does not support texture comparison.")
            }, e.prototype._setupDepthStencilTexture = function(t, i, n, r, o) {
                var s = i.width || i,
                    a = i.height || i;
                t.baseWidth = s, t.baseHeight = a, t.width = s, t.height = a, t.isReady = !0, t.samples = 1, t.generateMipMaps = !1, t._generateDepthBuffer = !0, t._generateStencilBuffer = n, t.samplingMode = r ? e.TEXTURE_BILINEAR_SAMPLINGMODE : e.TEXTURE_NEAREST_SAMPLINGMODE, t.type = e.TEXTURETYPE_UNSIGNED_INT, t._comparisonFunction = o;
                var u = this._gl,
                    h = t.isCube ? u.TEXTURE_CUBE_MAP : u.TEXTURE_2D,
                    l = this._getSamplingParameters(t.samplingMode, !1);
                u.texParameteri(h, u.TEXTURE_MAG_FILTER, l.mag), u.texParameteri(h, u.TEXTURE_MIN_FILTER, l.min), u.texParameteri(h, u.TEXTURE_WRAP_S, u.CLAMP_TO_EDGE), u.texParameteri(h, u.TEXTURE_WRAP_T, u.CLAMP_TO_EDGE), 0 === o ? (u.texParameteri(h, u.TEXTURE_COMPARE_FUNC, e.LEQUAL), u.texParameteri(h, u.TEXTURE_COMPARE_MODE, u.NONE)) : (u.texParameteri(h, u.TEXTURE_COMPARE_FUNC, o), u.texParameteri(h, u.TEXTURE_COMPARE_MODE, u.COMPARE_REF_TO_TEXTURE))
            }, e.prototype.createDepthStencilTexture = function(e, t) {
                if (t.isCube) {
                    var i = e.width || e;
                    return this._createDepthStencilCubeTexture(i, t)
                }
                return this._createDepthStencilTexture(e, t)
            }, e.prototype._createDepthStencilTexture = function(e, t) {
                var i = new Le(this, Le.DATASOURCE_DEPTHTEXTURE);
                if (!this._caps.depthTextureExtension) return V.Error("Depth texture is not supported by your browser or hardware."), i;
                var n = o({
                        bilinearFiltering: !1,
                        comparisonFunction: 0,
                        generateStencil: !1
                    }, t),
                    r = this._gl;
                return this._bindTextureDirectly(r.TEXTURE_2D, i, !0), this._setupDepthStencilTexture(i, e, n.generateStencil, n.bilinearFiltering, n.comparisonFunction), this.webGLVersion > 1 ? n.generateStencil ? r.texImage2D(r.TEXTURE_2D, 0, r.DEPTH24_STENCIL8, i.width, i.height, 0, r.DEPTH_STENCIL, r.UNSIGNED_INT_24_8, null) : r.texImage2D(r.TEXTURE_2D, 0, r.DEPTH_COMPONENT24, i.width, i.height, 0, r.DEPTH_COMPONENT, r.UNSIGNED_INT, null) : n.generateStencil ? r.texImage2D(r.TEXTURE_2D, 0, r.DEPTH_STENCIL, i.width, i.height, 0, r.DEPTH_STENCIL, r.UNSIGNED_INT_24_8, null) : r.texImage2D(r.TEXTURE_2D, 0, r.DEPTH_COMPONENT, i.width, i.height, 0, r.DEPTH_COMPONENT, r.UNSIGNED_INT, null), this._bindTextureDirectly(r.TEXTURE_2D, null), i
            }, e.prototype.setFrameBufferDepthStencilTexture = function(e) {
                var t = e.getInternalTexture();
                if (t && t._framebuffer && e.depthStencilTexture) {
                    var i = this._gl,
                        n = e.depthStencilTexture;
                    this._bindUnboundFramebuffer(t._framebuffer), n.isCube ? n._generateStencilBuffer ? i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_STENCIL_ATTACHMENT, i.TEXTURE_CUBE_MAP_POSITIVE_X, n._webGLTexture, 0) : i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_ATTACHMENT, i.TEXTURE_CUBE_MAP_POSITIVE_X, n._webGLTexture, 0) : n._generateStencilBuffer ? i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_STENCIL_ATTACHMENT, i.TEXTURE_2D, n._webGLTexture, 0) : i.framebufferTexture2D(i.FRAMEBUFFER, i.DEPTH_ATTACHMENT, i.TEXTURE_2D, n._webGLTexture, 0), this._bindUnboundFramebuffer(null)
                }
            }, e.prototype.createRenderTargetTexture = function(t, i) {
                var n = new we;
                void 0 !== i && "object" == typeof i ? (n.generateMipMaps = i.generateMipMaps, n.generateDepthBuffer = void 0 === i.generateDepthBuffer || i.generateDepthBuffer, n.generateStencilBuffer = n.generateDepthBuffer && i.generateStencilBuffer, n.type = void 0 === i.type ? e.TEXTURETYPE_UNSIGNED_INT : i.type, n.samplingMode = void 0 === i.samplingMode ? e.TEXTURE_TRILINEAR_SAMPLINGMODE : i.samplingMode, n.format = void 0 === i.format ? e.TEXTUREFORMAT_RGBA : i.format) : (n.generateMipMaps = i, n.generateDepthBuffer = !0, n.generateStencilBuffer = !1, n.type = e.TEXTURETYPE_UNSIGNED_INT, n.samplingMode = e.TEXTURE_TRILINEAR_SAMPLINGMODE, n.format = e.TEXTUREFORMAT_RGBA), (n.type !== e.TEXTURETYPE_FLOAT || this._caps.textureFloatLinearFiltering) && (n.type !== e.TEXTURETYPE_HALF_FLOAT || this._caps.textureHalfFloatLinearFiltering) || (n.samplingMode = e.TEXTURE_NEAREST_SAMPLINGMODE);
                var r = this._gl,
                    o = new Le(this, Le.DATASOURCE_RENDERTARGET);
                this._bindTextureDirectly(r.TEXTURE_2D, o, !0);
                var s = t.width || t,
                    a = t.height || t,
                    u = this._getSamplingParameters(n.samplingMode, !!n.generateMipMaps);
                n.type !== e.TEXTURETYPE_FLOAT || this._caps.textureFloat || (n.type = e.TEXTURETYPE_UNSIGNED_INT, V.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")), r.texParameteri(r.TEXTURE_2D, r.TEXTURE_MAG_FILTER, u.mag), r.texParameteri(r.TEXTURE_2D, r.TEXTURE_MIN_FILTER, u.min), r.texParameteri(r.TEXTURE_2D, r.TEXTURE_WRAP_S, r.CLAMP_TO_EDGE), r.texParameteri(r.TEXTURE_2D, r.TEXTURE_WRAP_T, r.CLAMP_TO_EDGE), r.texImage2D(r.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(n.type, n.format), s, a, 0, this._getInternalFormat(n.format), this._getWebGLTextureType(n.type), null);
                var h = this._currentFramebuffer,
                    l = r.createFramebuffer();
                return this._bindUnboundFramebuffer(l), r.framebufferTexture2D(r.FRAMEBUFFER, r.COLOR_ATTACHMENT0, r.TEXTURE_2D, o._webGLTexture, 0), o._depthStencilBuffer = this._setupFramebufferDepthAttachments(!!n.generateStencilBuffer, n.generateDepthBuffer, s, a), n.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(r.TEXTURE_2D, null), r.bindRenderbuffer(r.RENDERBUFFER, null), this._bindUnboundFramebuffer(h), o._framebuffer = l, o.baseWidth = s, o.baseHeight = a, o.width = s, o.height = a, o.isReady = !0, o.samples = 1, o.generateMipMaps = !!n.generateMipMaps, o.samplingMode = n.samplingMode, o.type = n.type, o.format = n.format, o._generateDepthBuffer = n.generateDepthBuffer, o._generateStencilBuffer = !!n.generateStencilBuffer, this._internalTexturesCache.push(o), o
            }, e.prototype._setupFramebufferDepthAttachments = function(e, t, i, n, r) {
                void 0 === r && (r = 1);
                var o = null,
                    s = this._gl;
                return e ? (o = s.createRenderbuffer(), s.bindRenderbuffer(s.RENDERBUFFER, o), r > 1 ? s.renderbufferStorageMultisample(s.RENDERBUFFER, r, s.DEPTH24_STENCIL8, i, n) : s.renderbufferStorage(s.RENDERBUFFER, s.DEPTH_STENCIL, i, n), s.framebufferRenderbuffer(s.FRAMEBUFFER, s.DEPTH_STENCIL_ATTACHMENT, s.RENDERBUFFER, o)) : t && (o = s.createRenderbuffer(), s.bindRenderbuffer(s.RENDERBUFFER, o), r > 1 ? s.renderbufferStorageMultisample(s.RENDERBUFFER, r, s.DEPTH_COMPONENT16, i, n) : s.renderbufferStorage(s.RENDERBUFFER, s.DEPTH_COMPONENT16, i, n), s.framebufferRenderbuffer(s.FRAMEBUFFER, s.DEPTH_ATTACHMENT, s.RENDERBUFFER, o)), o
            }, e.prototype.updateRenderTargetTextureSampleCount = function(e, t) {
                if (this.webGLVersion < 2 || !e) return 1;
                if (e.samples === t) return t;
                var i = this._gl;
                if (t = Math.min(t, i.getParameter(i.MAX_SAMPLES)), e._depthStencilBuffer && (i.deleteRenderbuffer(e._depthStencilBuffer), e._depthStencilBuffer = null), e._MSAAFramebuffer && (i.deleteFramebuffer(e._MSAAFramebuffer), e._MSAAFramebuffer = null), e._MSAARenderBuffer && (i.deleteRenderbuffer(e._MSAARenderBuffer), e._MSAARenderBuffer = null), t > 1) {
                    var n = i.createFramebuffer();
                    if (!n) throw new Error("Unable to create multi sampled framebuffer");
                    e._MSAAFramebuffer = n, this._bindUnboundFramebuffer(e._MSAAFramebuffer);
                    var r = i.createRenderbuffer();
                    if (!r) throw new Error("Unable to create multi sampled framebuffer");
                    i.bindRenderbuffer(i.RENDERBUFFER, r), i.renderbufferStorageMultisample(i.RENDERBUFFER, t, this._getRGBAMultiSampleBufferFormat(e.type), e.width, e.height), i.framebufferRenderbuffer(i.FRAMEBUFFER, i.COLOR_ATTACHMENT0, i.RENDERBUFFER, r), e._MSAARenderBuffer = r
                } else this._bindUnboundFramebuffer(e._framebuffer);
                return e.samples = t, e._depthStencilBuffer = this._setupFramebufferDepthAttachments(e._generateStencilBuffer, e._generateDepthBuffer, e.width, e.height, t), i.bindRenderbuffer(i.RENDERBUFFER, null), this._bindUnboundFramebuffer(null), t
            }, e.prototype._uploadCompressedDataToTextureDirectly = function(e, t, i, n, r, o, s) {
                void 0 === o && (o = 0), void 0 === s && (s = 0);
                var a = this._gl,
                    u = a.TEXTURE_2D;
                e.isCube && (u = a.TEXTURE_CUBE_MAP_POSITIVE_X + o), this._gl.compressedTexImage2D(u, s, t, i, n, 0, r)
            }, e.prototype._uploadDataToTextureDirectly = function(e, t, i, n) {
                void 0 === i && (i = 0), void 0 === n && (n = 0);
                var r = this._gl,
                    o = this._getWebGLTextureType(e.type),
                    s = this._getInternalFormat(e.format),
                    a = this._getRGBABufferInternalSizedFormat(e.type, s);
                this._unpackFlipY(e.invertY);
                var u = r.TEXTURE_2D;
                e.isCube && (u = r.TEXTURE_CUBE_MAP_POSITIVE_X + i);
                var h = Math.round(m.Log2(e.width)),
                    l = Math.round(m.Log2(e.height)),
                    c = Math.pow(2, Math.max(h - n, 0)),
                    d = Math.pow(2, Math.max(l - n, 0));
                r.texImage2D(u, n, a, c, d, 0, s, o, t)
            }, e.prototype._uploadArrayBufferViewToTexture = function(e, t, i, n) {
                void 0 === i && (i = 0), void 0 === n && (n = 0);
                var r = this._gl,
                    o = e.isCube ? r.TEXTURE_CUBE_MAP : r.TEXTURE_2D;
                this._bindTextureDirectly(o, e, !0), this._uploadDataToTextureDirectly(e, t, i, n), this._bindTextureDirectly(o, null, !0)
            }, e.prototype._uploadImageToTexture = function(e, t, i, n) {
                void 0 === i && (i = 0), void 0 === n && (n = 0);
                var r = this._gl,
                    o = this._getWebGLTextureType(e.type),
                    s = this._getInternalFormat(e.format),
                    a = this._getRGBABufferInternalSizedFormat(e.type, s),
                    u = e.isCube ? r.TEXTURE_CUBE_MAP : r.TEXTURE_2D;
                this._bindTextureDirectly(u, e, !0), this._unpackFlipY(e.invertY);
                var h = r.TEXTURE_2D;
                e.isCube && (h = r.TEXTURE_CUBE_MAP_POSITIVE_X + i), r.texImage2D(h, n, a, s, o, t), this._bindTextureDirectly(u, null, !0)
            }, e.prototype._setCubeMapTextureParams = function(e) {
                var t = this._gl;
                t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MAG_FILTER, t.LINEAR), t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MIN_FILTER, e ? t.LINEAR_MIPMAP_LINEAR : t.LINEAR), t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE), t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE), this._bindTextureDirectly(t.TEXTURE_CUBE_MAP, null)
            }, e.prototype.createRawCubeTexture = function(e, t, i, n, r, o, s, a) {
                throw void 0 === a && (a = null), X.WarnImport("Engine.RawTexture")
            }, e.prototype.createRawTexture3D = function(t, i, n, r, o, s, a, u, h, l) {
                throw void 0 === h && (h = null), void 0 === l && (l = e.TEXTURETYPE_UNSIGNED_INT), X.WarnImport("Engine.RawTexture")
            }, e.prototype._prepareWebGLTextureContinuation = function(e, t, i, n, r) {
                var o = this._gl;
                if (o) {
                    var s = this._getSamplingParameters(r, !i);
                    o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, s.mag), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, s.min), i || n || o.generateMipmap(o.TEXTURE_2D), this._bindTextureDirectly(o.TEXTURE_2D, null), t && t._removePendingData(e), e.onLoadedObservable.notifyObservers(e), e.onLoadedObservable.clear()
                }
            }, e.prototype._prepareWebGLTexture = function(t, i, n, r, o, s, a, u, h) {
                var l = this;
                void 0 === h && (h = e.TEXTURE_TRILINEAR_SAMPLINGMODE);
                var c = this.getCaps().maxTextureSize,
                    d = Math.min(c, this.needPOTTextures ? K.GetExponentOfTwo(n, c) : n),
                    f = Math.min(c, this.needPOTTextures ? K.GetExponentOfTwo(r, c) : r),
                    p = this._gl;
                p && (t._webGLTexture ? (this._bindTextureDirectly(p.TEXTURE_2D, t, !0), this._unpackFlipY(void 0 === o || !!o), t.baseWidth = n, t.baseHeight = r, t.width = d, t.height = f, t.isReady = !0, u(d, f, (function() {
                    l._prepareWebGLTextureContinuation(t, i, s, a, h)
                })) || this._prepareWebGLTextureContinuation(t, i, s, a, h)) : i && i._removePendingData(t))
            }, e.prototype._convertRGBtoRGBATextureData = function(t, i, n, r) {
                var o;
                o = r === e.TEXTURETYPE_FLOAT ? new Float32Array(i * n * 4) : new Uint32Array(i * n * 4);
                for (var s = 0; s < i; s++)
                    for (var a = 0; a < n; a++) {
                        var u = 3 * (a * i + s),
                            h = 4 * (a * i + s);
                        o[h + 0] = t[u + 0], o[h + 1] = t[u + 1], o[h + 2] = t[u + 2], o[h + 3] = 1
                    }
                return o
            }, e.prototype._releaseFramebufferObjects = function(e) {
                var t = this._gl;
                e._framebuffer && (t.deleteFramebuffer(e._framebuffer), e._framebuffer = null), e._depthStencilBuffer && (t.deleteRenderbuffer(e._depthStencilBuffer), e._depthStencilBuffer = null), e._MSAAFramebuffer && (t.deleteFramebuffer(e._MSAAFramebuffer), e._MSAAFramebuffer = null), e._MSAARenderBuffer && (t.deleteRenderbuffer(e._MSAARenderBuffer), e._MSAARenderBuffer = null)
            }, e.prototype._releaseTexture = function(e) {
                var t = this._gl;
                this._releaseFramebufferObjects(e), t.deleteTexture(e._webGLTexture), this.unbindAllTextures();
                var i = this._internalTexturesCache.indexOf(e); - 1 !== i && this._internalTexturesCache.splice(i, 1), e._lodTextureHigh && e._lodTextureHigh.dispose(), e._lodTextureMid && e._lodTextureMid.dispose(), e._lodTextureLow && e._lodTextureLow.dispose(), this.scenes.forEach((function(t) {
                    t.postProcesses.forEach((function(t) {
                        t._outputTexture == e && (t._outputTexture = null)
                    })), t.cameras.forEach((function(t) {
                        t._postProcesses.forEach((function(t) {
                            t && t._outputTexture == e && (t._outputTexture = null)
                        }))
                    }))
                }))
            }, e.prototype.setProgram = function(e) {
                this._currentProgram !== e && (this._gl.useProgram(e), this._currentProgram = e)
            }, e.prototype.bindSamplers = function(e) {
                var t = e.getPipelineContext();
                this.setProgram(t.program);
                for (var i = e.getSamplers(), n = 0; n < i.length; n++) {
                    var r = e.getUniform(i[n]);
                    r && (this._boundUniforms[n] = r)
                }
                this._currentEffect = null
            }, e.prototype._activateCurrentTexture = function() {
                this._currentTextureChannel !== this._activeChannel && (this._gl.activeTexture(this._gl.TEXTURE0 + this._activeChannel), this._currentTextureChannel = this._activeChannel)
            }, e.prototype._bindTextureDirectly = function(e, t, i, n) {
                void 0 === i && (i = !1), void 0 === n && (n = !1);
                var r = !1,
                    o = t && t._associatedChannel > -1;
                return i && o && (this._activeChannel = t._associatedChannel), this._boundTexturesCache[this._activeChannel] !== t || n ? (this._activateCurrentTexture(), t && t.isMultiview ? this._gl.bindTexture(e, t ? t._colorTextureArray : null) : this._gl.bindTexture(e, t ? t._webGLTexture : null), this._boundTexturesCache[this._activeChannel] = t, t && (t._associatedChannel = this._activeChannel)) : i && (r = !0, this._activateCurrentTexture()), o && !i && this._bindSamplerUniformToChannel(t._associatedChannel, this._activeChannel), r
            }, e.prototype._bindTexture = function(e, t) {
                void 0 !== e && (t && (t._associatedChannel = e), this._activeChannel = e, this._bindTextureDirectly(this._gl.TEXTURE_2D, t))
            }, e.prototype.setTextureFromPostProcess = function(e, t) {
                this._bindTexture(e, t ? t._textures.data[t._currentRenderTextureInd] : null)
            }, e.prototype.setTextureFromPostProcessOutput = function(e, t) {
                this._bindTexture(e, t ? t._outputTexture : null)
            }, e.prototype.unbindAllTextures = function() {
                for (var e = 0; e < this._maxSimultaneousTextures; e++) this._activeChannel = e, this._bindTextureDirectly(this._gl.TEXTURE_2D, null), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null), this.webGLVersion > 1 && this._bindTextureDirectly(this._gl.TEXTURE_3D, null)
            }, e.prototype.setTexture = function(e, t, i) {
                void 0 !== e && (t && (this._boundUniforms[e] = t), this._setTexture(e, i))
            }, e.prototype.setDepthStencilTexture = function(e, t, i) {
                void 0 !== e && (t && (this._boundUniforms[e] = t), i && i.depthStencilTexture ? this._setTexture(e, i, !1, !0) : this._setTexture(e, null))
            }, e.prototype._bindSamplerUniformToChannel = function(e, t) {
                var i = this._boundUniforms[e];
                i._currentState !== t && (this._gl.uniform1i(i, t), i._currentState = t)
            }, e.prototype._getTextureWrapMode = function(t) {
                switch (t) {
                    case e.TEXTURE_WRAP_ADDRESSMODE:
                        return this._gl.REPEAT;
                    case e.TEXTURE_CLAMP_ADDRESSMODE:
                        return this._gl.CLAMP_TO_EDGE;
                    case e.TEXTURE_MIRROR_ADDRESSMODE:
                        return this._gl.MIRRORED_REPEAT
                }
                return this._gl.REPEAT
            }, e.prototype._setTexture = function(t, i, n, r) {
                if (void 0 === n && (n = !1), void 0 === r && (r = !1), !i) return null != this._boundTexturesCache[t] && (this._activeChannel = t, this._bindTextureDirectly(this._gl.TEXTURE_2D, null), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null), this.webGLVersion > 1 && this._bindTextureDirectly(this._gl.TEXTURE_3D, null)), !1;
                if (i.video) this._activeChannel = t, i.update();
                else if (i.delayLoadState === e.DELAYLOADSTATE_NOTLOADED) return i.delayLoad(), !1;
                var o;
                o = r ? i.depthStencilTexture : i.isReady() ? i.getInternalTexture() : i.isCube ? this.emptyCubeTexture : i.is3D ? this.emptyTexture3D : this.emptyTexture, !n && o && (o._associatedChannel = t);
                var s = !0;
                if (this._boundTexturesCache[t] === o && (n || this._bindSamplerUniformToChannel(o._associatedChannel, t), s = !1), this._activeChannel = t, o && o.isMultiview) s && this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY, o, n);
                else if (o && o.is3D) s && this._bindTextureDirectly(this._gl.TEXTURE_3D, o, n), o && o._cachedWrapU !== i.wrapU && (o._cachedWrapU = i.wrapU, this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(i.wrapU), o)), o && o._cachedWrapV !== i.wrapV && (o._cachedWrapV = i.wrapV, this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(i.wrapV), o)), o && o._cachedWrapR !== i.wrapR && (o._cachedWrapR = i.wrapR, this._setTextureParameterInteger(this._gl.TEXTURE_3D, this._gl.TEXTURE_WRAP_R, this._getTextureWrapMode(i.wrapR), o)), this._setAnisotropicLevel(this._gl.TEXTURE_3D, i);
                else if (o && o.isCube) {
                    if (s && this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, o, n), o._cachedCoordinatesMode !== i.coordinatesMode) {
                        o._cachedCoordinatesMode = i.coordinatesMode;
                        var a = i.coordinatesMode !== e.TEXTURE_CUBIC_MODE && i.coordinatesMode !== e.TEXTURE_SKYBOX_MODE ? this._gl.REPEAT : this._gl.CLAMP_TO_EDGE;
                        this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_S, a, o), this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP, this._gl.TEXTURE_WRAP_T, a)
                    }
                    this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP, i)
                } else s && this._bindTextureDirectly(this._gl.TEXTURE_2D, o, n), o && o._cachedWrapU !== i.wrapU && (o._cachedWrapU = i.wrapU, this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_S, this._getTextureWrapMode(i.wrapU), o)), o && o._cachedWrapV !== i.wrapV && (o._cachedWrapV = i.wrapV, this._setTextureParameterInteger(this._gl.TEXTURE_2D, this._gl.TEXTURE_WRAP_T, this._getTextureWrapMode(i.wrapV), o)), this._setAnisotropicLevel(this._gl.TEXTURE_2D, i);
                return !0
            }, e.prototype.setTextureArray = function(e, t, i) {
                if (void 0 !== e && t) {
                    this._textureUnits && this._textureUnits.length === i.length || (this._textureUnits = new Int32Array(i.length));
                    for (var n = 0; n < i.length; n++) {
                        var r = i[n].getInternalTexture();
                        r ? (this._textureUnits[e + n] = e + n, r._associatedChannel = e + n) : this._textureUnits[e + n] = -1
                    }
                    this._gl.uniform1iv(t, this._textureUnits);
                    for (var o = 0; o < i.length; o++) this._setTexture(this._textureUnits[o], i[o], !0)
                }
            }, e.prototype._setAnisotropicLevel = function(t, i) {
                var n = i.getInternalTexture();
                if (n) {
                    var r = this._caps.textureAnisotropicFilterExtension,
                        o = i.anisotropicFilteringLevel;
                    n.samplingMode !== e.TEXTURE_LINEAR_LINEAR_MIPNEAREST && n.samplingMode !== e.TEXTURE_LINEAR_LINEAR_MIPLINEAR && n.samplingMode !== e.TEXTURE_LINEAR_LINEAR && (o = 1), r && n._cachedAnisotropicFilteringLevel !== o && (this._setTextureParameterFloat(t, r.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(o, this._caps.maxAnisotropy), n), n._cachedAnisotropicFilteringLevel = o)
                }
            }, e.prototype._setTextureParameterFloat = function(e, t, i, n) {
                this._bindTextureDirectly(e, n, !0, !0), this._gl.texParameterf(e, t, i)
            }, e.prototype._setTextureParameterInteger = function(e, t, i, n) {
                n && this._bindTextureDirectly(e, n, !0, !0), this._gl.texParameteri(e, t, i)
            }, e.prototype.readPixels = function(e, t, i, n) {
                var r = new Uint8Array(n * i * 4);
                return this._gl.readPixels(e, t, i, n, this._gl.RGBA, this._gl.UNSIGNED_BYTE, r), r
            }, e.prototype.addExternalData = function(e, t) {
                return this._externalData || (this._externalData = new _), this._externalData.add(e, t)
            }, e.prototype.getExternalData = function(e) {
                return this._externalData || (this._externalData = new _), this._externalData.get(e)
            }, e.prototype.getOrAddExternalDataWithFactory = function(e, t) {
                return this._externalData || (this._externalData = new _), this._externalData.getOrAddWithFactory(e, t)
            }, e.prototype.removeExternalData = function(e) {
                return this._externalData || (this._externalData = new _), this._externalData.remove(e)
            }, e.prototype.unbindAllAttributes = function() {
                if (this._mustWipeVertexAttributes) {
                    this._mustWipeVertexAttributes = !1;
                    for (var e = 0; e < this._caps.maxVertexAttribs; e++) this._gl.disableVertexAttribArray(e), this._vertexAttribArraysEnabled[e] = !1, this._currentBufferPointers[e].active = !1
                } else {
                    e = 0;
                    for (var t = this._vertexAttribArraysEnabled.length; e < t; e++) e >= this._caps.maxVertexAttribs || !this._vertexAttribArraysEnabled[e] || (this._gl.disableVertexAttribArray(e), this._vertexAttribArraysEnabled[e] = !1, this._currentBufferPointers[e].active = !1)
                }
            }, e.prototype.releaseEffects = function() {
                for (var e in this._compiledEffects) {
                    var t = this._compiledEffects[e].getPipelineContext();
                    this._deletePipelineContext(t)
                }
                this._compiledEffects = {}
            }, e.prototype.dispose = function() {
                for (this.hideLoadingUI(), this.stopRenderLoop(), this.onNewSceneAddedObservable.clear(); this.postProcesses.length;) this.postProcesses[0].dispose();
                for (this._emptyTexture && (this._releaseTexture(this._emptyTexture), this._emptyTexture = null), this._emptyCubeTexture && (this._releaseTexture(this._emptyCubeTexture), this._emptyCubeTexture = null), this._rescalePostProcess && this._rescalePostProcess.dispose(); this.scenes.length;) this.scenes[0].dispose();
                1 === e.Instances.length && e.audioEngine && e.audioEngine.dispose(), this.releaseEffects(), this.unbindAllAttributes(), this._boundUniforms = [], this._dummyFramebuffer && this._gl.deleteFramebuffer(this._dummyFramebuffer), this.disableVR(), c.IsWindowObjectExist() && (window.removeEventListener("blur", this._onBlur), window.removeEventListener("focus", this._onFocus), this._renderingCanvas && (this._renderingCanvas.removeEventListener("focus", this._onCanvasFocus), this._renderingCanvas.removeEventListener("blur", this._onCanvasBlur), this._renderingCanvas.removeEventListener("pointerout", this._onCanvasPointerOut), this._doNotHandleContextLost || (this._renderingCanvas.removeEventListener("webglcontextlost", this._onContextLost), this._renderingCanvas.removeEventListener("webglcontextrestored", this._onContextRestored))), document.removeEventListener("fullscreenchange", this._onFullscreenChange), document.removeEventListener("mozfullscreenchange", this._onFullscreenChange), document.removeEventListener("webkitfullscreenchange", this._onFullscreenChange), document.removeEventListener("msfullscreenchange", this._onFullscreenChange), document.removeEventListener("pointerlockchange", this._onPointerLockChange), document.removeEventListener("mspointerlockchange", this._onPointerLockChange), document.removeEventListener("mozpointerlockchange", this._onPointerLockChange), document.removeEventListener("webkitpointerlockchange", this._onPointerLockChange));
                var t = e.Instances.indexOf(this);
                t >= 0 && e.Instances.splice(t, 1), this._workingCanvas = null, this._workingContext = null, this._currentBufferPointers = [], this._renderingCanvas = null, this._currentProgram = null, this._bindedRenderFunction = null, this.onResizeObservable.clear(), this.onCanvasBlurObservable.clear(), this.onCanvasFocusObservable.clear(), this.onCanvasPointerOutObservable.clear(), this.onBeginFrameObservable.clear(), this.onEndFrameObservable.clear(), ie.ResetCache();
                for (var i = 0, n = this._activeRequests; i < n.length; i++) {
                    n[i].abort()
                }
            }, e.prototype.displayLoadingUI = function() {
                if (c.IsWindowObjectExist()) {
                    var e = this.loadingScreen;
                    e && e.displayLoadingUI()
                }
            }, e.prototype.hideLoadingUI = function() {
                if (c.IsWindowObjectExist()) {
                    var e = this._loadingScreen;
                    e && e.hideLoadingUI()
                }
            }, Object.defineProperty(e.prototype, "loadingScreen", {
                get: function() {
                    return !this._loadingScreen && this._renderingCanvas && (this._loadingScreen = e.DefaultLoadingScreenFactory(this._renderingCanvas)), this._loadingScreen
                },
                set: function(e) {
                    this._loadingScreen = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "loadingUIText", {
                set: function(e) {
                    this.loadingScreen.loadingUIText = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "loadingUIBackgroundColor", {
                set: function(e) {
                    this.loadingScreen.loadingUIBackgroundColor = e
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.attachContextLostEvent = function(e) {
                this._renderingCanvas && this._renderingCanvas.addEventListener("webglcontextlost", e, !1)
            }, e.prototype.attachContextRestoredEvent = function(e) {
                this._renderingCanvas && this._renderingCanvas.addEventListener("webglcontextrestored", e, !1)
            }, e.prototype.getVertexShaderSource = function(e) {
                var t = this._gl.getAttachedShaders(e);
                return t ? this._gl.getShaderSource(t[0]) : null
            }, e.prototype.getFragmentShaderSource = function(e) {
                var t = this._gl.getAttachedShaders(e);
                return t ? this._gl.getShaderSource(t[1]) : null
            }, e.prototype.getError = function() {
                return this._gl.getError()
            }, e.prototype.getFps = function() {
                return this._fps
            }, e.prototype.getDeltaTime = function() {
                return this._deltaTime
            }, e.prototype._measureFps = function() {
                this._performanceMonitor.sampleFrame(), this._fps = this._performanceMonitor.averageFPS, this._deltaTime = this._performanceMonitor.instantaneousFrameTime || 0
            }, e.prototype._readTexturePixels = function(e, t, i, n, r, o) {
                void 0 === n && (n = -1), void 0 === r && (r = 0), void 0 === o && (o = null);
                var s = this._gl;
                if (!this._dummyFramebuffer) {
                    var a = s.createFramebuffer();
                    if (!a) throw new Error("Unable to create dummy framebuffer");
                    this._dummyFramebuffer = a
                }
                s.bindFramebuffer(s.FRAMEBUFFER, this._dummyFramebuffer), n > -1 ? s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_CUBE_MAP_POSITIVE_X + n, e._webGLTexture, r) : s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_2D, e._webGLTexture, r);
                var u = void 0 !== e.type ? this._getWebGLTextureType(e.type) : s.UNSIGNED_BYTE;
                switch (u) {
                    case s.UNSIGNED_BYTE:
                        o || (o = new Uint8Array(4 * t * i)), u = s.UNSIGNED_BYTE;
                        break;
                    default:
                        o || (o = new Float32Array(4 * t * i)), u = s.FLOAT
                }
                return s.readPixels(0, 0, t, i, s.RGBA, u, o), s.bindFramebuffer(s.FRAMEBUFFER, this._currentFramebuffer), o
            }, e.prototype._canRenderToFloatFramebuffer = function() {
                return this._webGLVersion > 1 ? this._caps.colorBufferFloat : this._canRenderToFramebuffer(e.TEXTURETYPE_FLOAT)
            }, e.prototype._canRenderToHalfFloatFramebuffer = function() {
                return this._webGLVersion > 1 ? this._caps.colorBufferFloat : this._canRenderToFramebuffer(e.TEXTURETYPE_HALF_FLOAT)
            }, e.prototype._canRenderToFramebuffer = function(e) {
                for (var t = this._gl; t.getError() !== t.NO_ERROR;);
                var i = !0,
                    n = t.createTexture();
                t.bindTexture(t.TEXTURE_2D, n), t.texImage2D(t.TEXTURE_2D, 0, this._getRGBABufferInternalSizedFormat(e), 1, 1, 0, t.RGBA, this._getWebGLTextureType(e), null), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.NEAREST), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, t.NEAREST);
                var r = t.createFramebuffer();
                t.bindFramebuffer(t.FRAMEBUFFER, r), t.framebufferTexture2D(t.FRAMEBUFFER, t.COLOR_ATTACHMENT0, t.TEXTURE_2D, n, 0);
                var o = t.checkFramebufferStatus(t.FRAMEBUFFER);
                if ((i = (i = i && o === t.FRAMEBUFFER_COMPLETE) && t.getError() === t.NO_ERROR) && (t.clear(t.COLOR_BUFFER_BIT), i = i && t.getError() === t.NO_ERROR), i) {
                    t.bindFramebuffer(t.FRAMEBUFFER, null);
                    var s = t.RGBA,
                        a = t.UNSIGNED_BYTE,
                        u = new Uint8Array(4);
                    t.readPixels(0, 0, 1, 1, s, a, u), i = i && t.getError() === t.NO_ERROR
                }
                for (t.deleteTexture(n), t.deleteFramebuffer(r), t.bindFramebuffer(t.FRAMEBUFFER, null); !i && t.getError() !== t.NO_ERROR;);
                return i
            }, e.prototype._getWebGLTextureType = function(t) {
                if (1 === this._webGLVersion) {
                    switch (t) {
                        case e.TEXTURETYPE_FLOAT:
                            return this._gl.FLOAT;
                        case e.TEXTURETYPE_HALF_FLOAT:
                            return this._gl.HALF_FLOAT_OES;
                        case e.TEXTURETYPE_UNSIGNED_BYTE:
                            return this._gl.UNSIGNED_BYTE
                    }
                    return this._gl.UNSIGNED_BYTE
                }
                switch (t) {
                    case e.TEXTURETYPE_BYTE:
                        return this._gl.BYTE;
                    case e.TEXTURETYPE_UNSIGNED_BYTE:
                        return this._gl.UNSIGNED_BYTE;
                    case e.TEXTURETYPE_SHORT:
                        return this._gl.SHORT;
                    case e.TEXTURETYPE_UNSIGNED_SHORT:
                        return this._gl.UNSIGNED_SHORT;
                    case e.TEXTURETYPE_INT:
                        return this._gl.INT;
                    case e.TEXTURETYPE_UNSIGNED_INTEGER:
                        return this._gl.UNSIGNED_INT;
                    case e.TEXTURETYPE_FLOAT:
                        return this._gl.FLOAT;
                    case e.TEXTURETYPE_HALF_FLOAT:
                        return this._gl.HALF_FLOAT;
                    case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:
                        return this._gl.UNSIGNED_SHORT_4_4_4_4;
                    case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:
                        return this._gl.UNSIGNED_SHORT_5_5_5_1;
                    case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:
                        return this._gl.UNSIGNED_SHORT_5_6_5;
                    case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:
                        return this._gl.UNSIGNED_INT_2_10_10_10_REV;
                    case e.TEXTURETYPE_UNSIGNED_INT_24_8:
                        return this._gl.UNSIGNED_INT_24_8;
                    case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:
                        return this._gl.UNSIGNED_INT_10F_11F_11F_REV;
                    case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:
                        return this._gl.UNSIGNED_INT_5_9_9_9_REV;
                    case e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:
                        return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV
                }
                return this._gl.UNSIGNED_BYTE
            }, e.prototype._getInternalFormat = function(t) {
                var i = this._gl.RGBA;
                switch (t) {
                    case e.TEXTUREFORMAT_ALPHA:
                        i = this._gl.ALPHA;
                        break;
                    case e.TEXTUREFORMAT_LUMINANCE:
                        i = this._gl.LUMINANCE;
                        break;
                    case e.TEXTUREFORMAT_LUMINANCE_ALPHA:
                        i = this._gl.LUMINANCE_ALPHA;
                        break;
                    case e.TEXTUREFORMAT_RED:
                        i = this._gl.RED;
                        break;
                    case e.TEXTUREFORMAT_RG:
                        i = this._gl.RG;
                        break;
                    case e.TEXTUREFORMAT_RGB:
                        i = this._gl.RGB;
                        break;
                    case e.TEXTUREFORMAT_RGBA:
                        i = this._gl.RGBA
                }
                if (this._webGLVersion > 1) switch (t) {
                    case e.TEXTUREFORMAT_RED_INTEGER:
                        i = this._gl.RED_INTEGER;
                        break;
                    case e.TEXTUREFORMAT_RG_INTEGER:
                        i = this._gl.RG_INTEGER;
                        break;
                    case e.TEXTUREFORMAT_RGB_INTEGER:
                        i = this._gl.RGB_INTEGER;
                        break;
                    case e.TEXTUREFORMAT_RGBA_INTEGER:
                        i = this._gl.RGBA_INTEGER
                }
                return i
            }, e.prototype._getRGBABufferInternalSizedFormat = function(t, i) {
                if (1 === this._webGLVersion) {
                    if (void 0 !== i) switch (i) {
                        case e.TEXTUREFORMAT_ALPHA:
                            return this._gl.ALPHA;
                        case e.TEXTUREFORMAT_LUMINANCE:
                            return this._gl.LUMINANCE;
                        case e.TEXTUREFORMAT_LUMINANCE_ALPHA:
                            return this._gl.LUMINANCE_ALPHA
                    }
                    return this._gl.RGBA
                }
                switch (t) {
                    case e.TEXTURETYPE_BYTE:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED:
                                return this._gl.R8_SNORM;
                            case e.TEXTUREFORMAT_RG:
                                return this._gl.RG8_SNORM;
                            case e.TEXTUREFORMAT_RGB:
                                return this._gl.RGB8_SNORM;
                            case e.TEXTUREFORMAT_RED_INTEGER:
                                return this._gl.R8I;
                            case e.TEXTUREFORMAT_RG_INTEGER:
                                return this._gl.RG8I;
                            case e.TEXTUREFORMAT_RGB_INTEGER:
                                return this._gl.RGB8I;
                            case e.TEXTUREFORMAT_RGBA_INTEGER:
                                return this._gl.RGBA8I;
                            default:
                                return this._gl.RGBA8_SNORM
                        }
                    case e.TEXTURETYPE_UNSIGNED_BYTE:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED:
                                return this._gl.R8;
                            case e.TEXTUREFORMAT_RG:
                                return this._gl.RG8;
                            case e.TEXTUREFORMAT_RGB:
                                return this._gl.RGB8;
                            case e.TEXTUREFORMAT_RGBA:
                                return this._gl.RGBA8;
                            case e.TEXTUREFORMAT_RED_INTEGER:
                                return this._gl.R8UI;
                            case e.TEXTUREFORMAT_RG_INTEGER:
                                return this._gl.RG8UI;
                            case e.TEXTUREFORMAT_RGB_INTEGER:
                                return this._gl.RGB8UI;
                            case e.TEXTUREFORMAT_RGBA_INTEGER:
                                return this._gl.RGBA8UI;
                            case e.TEXTUREFORMAT_ALPHA:
                                return this._gl.ALPHA;
                            case e.TEXTUREFORMAT_LUMINANCE:
                                return this._gl.LUMINANCE;
                            case e.TEXTUREFORMAT_LUMINANCE_ALPHA:
                                return this._gl.LUMINANCE_ALPHA;
                            default:
                                return this._gl.RGBA8
                        }
                    case e.TEXTURETYPE_SHORT:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED_INTEGER:
                                return this._gl.R16I;
                            case e.TEXTUREFORMAT_RG_INTEGER:
                                return this._gl.RG16I;
                            case e.TEXTUREFORMAT_RGB_INTEGER:
                                return this._gl.RGB16I;
                            case e.TEXTUREFORMAT_RGBA_INTEGER:
                            default:
                                return this._gl.RGBA16I
                        }
                    case e.TEXTURETYPE_UNSIGNED_SHORT:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED_INTEGER:
                                return this._gl.R16UI;
                            case e.TEXTUREFORMAT_RG_INTEGER:
                                return this._gl.RG16UI;
                            case e.TEXTUREFORMAT_RGB_INTEGER:
                                return this._gl.RGB16UI;
                            case e.TEXTUREFORMAT_RGBA_INTEGER:
                            default:
                                return this._gl.RGBA16UI
                        }
                    case e.TEXTURETYPE_INT:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED_INTEGER:
                                return this._gl.R32I;
                            case e.TEXTUREFORMAT_RG_INTEGER:
                                return this._gl.RG32I;
                            case e.TEXTUREFORMAT_RGB_INTEGER:
                                return this._gl.RGB32I;
                            case e.TEXTUREFORMAT_RGBA_INTEGER:
                            default:
                                return this._gl.RGBA32I
                        }
                    case e.TEXTURETYPE_UNSIGNED_INTEGER:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED_INTEGER:
                                return this._gl.R32UI;
                            case e.TEXTUREFORMAT_RG_INTEGER:
                                return this._gl.RG32UI;
                            case e.TEXTUREFORMAT_RGB_INTEGER:
                                return this._gl.RGB32UI;
                            case e.TEXTUREFORMAT_RGBA_INTEGER:
                            default:
                                return this._gl.RGBA32UI
                        }
                    case e.TEXTURETYPE_FLOAT:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED:
                                return this._gl.R32F;
                            case e.TEXTUREFORMAT_RG:
                                return this._gl.RG32F;
                            case e.TEXTUREFORMAT_RGB:
                                return this._gl.RGB32F;
                            case e.TEXTUREFORMAT_RGBA:
                            default:
                                return this._gl.RGBA32F
                        }
                    case e.TEXTURETYPE_HALF_FLOAT:
                        switch (i) {
                            case e.TEXTUREFORMAT_RED:
                                return this._gl.R16F;
                            case e.TEXTUREFORMAT_RG:
                                return this._gl.RG16F;
                            case e.TEXTUREFORMAT_RGB:
                                return this._gl.RGB16F;
                            case e.TEXTUREFORMAT_RGBA:
                            default:
                                return this._gl.RGBA16F
                        }
                    case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:
                        return this._gl.RGB565;
                    case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:
                        return this._gl.R11F_G11F_B10F;
                    case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:
                        return this._gl.RGB9_E5;
                    case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:
                        return this._gl.RGBA4;
                    case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:
                        return this._gl.RGB5_A1;
                    case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:
                        switch (i) {
                            case e.TEXTUREFORMAT_RGBA:
                                return this._gl.RGB10_A2;
                            case e.TEXTUREFORMAT_RGBA_INTEGER:
                                return this._gl.RGB10_A2UI;
                            default:
                                return this._gl.RGB10_A2
                        }
                }
                return this._gl.RGBA8
            }, e.prototype._getRGBAMultiSampleBufferFormat = function(t) {
                return t === e.TEXTURETYPE_FLOAT ? this._gl.RGBA32F : t === e.TEXTURETYPE_HALF_FLOAT ? this._gl.RGBA16F : this._gl.RGBA8
            }, e.prototype._loadFile = function(e, t, i, n, r, o) {
                var s = this,
                    a = K.LoadFile(e, t, i, n, r, o);
                return this._activeRequests.push(a), a.onCompleteObservable.add((function(e) {
                    s._activeRequests.splice(s._activeRequests.indexOf(e), 1)
                })), a
            }, e.prototype._loadFileAsync = function(e, t, i) {
                var n = this;
                return new Promise((function(r, o) {
                    n._loadFile(e, (function(e) {
                        r(e)
                    }), void 0, t, i, (function(e, t) {
                        o(t)
                    }))
                }))
            }, e.isSupported = function() {
                try {
                    var e = document.createElement("canvas");
                    return null != (e.getContext("webgl") || e.getContext("experimental-webgl")) && !!window.WebGLRenderingContext
                } catch (e) {
                    return !1
                }
            }, e.ExceptionList = [{
                key: "Chrome/63.0",
                capture: "63\\.0\\.3239\\.(\\d+)",
                captureConstraint: 108,
                targets: ["uniformBuffer"]
            }, {
                key: "Firefox/58",
                capture: null,
                captureConstraint: null,
                targets: ["uniformBuffer"]
            }, {
                key: "Firefox/59",
                capture: null,
                captureConstraint: null,
                targets: ["uniformBuffer"]
            }, {
                key: "Chrome/72.+?Mobile",
                capture: null,
                captureConstraint: null,
                targets: ["vao"]
            }, {
                key: "Chrome/73.+?Mobile",
                capture: null,
                captureConstraint: null,
                targets: ["vao"]
            }, {
                key: "Chrome/74.+?Mobile",
                capture: null,
                captureConstraint: null,
                targets: ["vao"]
            }, {
                key: "Mac OS.+Chrome/71",
                capture: null,
                captureConstraint: null,
                targets: ["vao"]
            }, {
                key: "Mac OS.+Chrome/72",
                capture: null,
                captureConstraint: null,
                targets: ["vao"]
            }], e._TextureLoaders = [], e.ALPHA_DISABLE = k.ALPHA_DISABLE, e.ALPHA_ADD = k.ALPHA_ADD, e.ALPHA_COMBINE = k.ALPHA_COMBINE, e.ALPHA_SUBTRACT = k.ALPHA_SUBTRACT, e.ALPHA_MULTIPLY = k.ALPHA_MULTIPLY, e.ALPHA_MAXIMIZED = k.ALPHA_MAXIMIZED, e.ALPHA_ONEONE = k.ALPHA_ONEONE, e.ALPHA_PREMULTIPLIED = k.ALPHA_PREMULTIPLIED, e.ALPHA_PREMULTIPLIED_PORTERDUFF = k.ALPHA_PREMULTIPLIED_PORTERDUFF, e.ALPHA_INTERPOLATE = k.ALPHA_INTERPOLATE, e.ALPHA_SCREENMODE = k.ALPHA_SCREENMODE, e.DELAYLOADSTATE_NONE = k.DELAYLOADSTATE_NONE, e.DELAYLOADSTATE_LOADED = k.DELAYLOADSTATE_LOADED, e.DELAYLOADSTATE_LOADING = k.DELAYLOADSTATE_LOADING, e.DELAYLOADSTATE_NOTLOADED = k.DELAYLOADSTATE_NOTLOADED, e.NEVER = k.NEVER, e.ALWAYS = k.ALWAYS, e.LESS = k.LESS, e.EQUAL = k.EQUAL, e.LEQUAL = k.LEQUAL, e.GREATER = k.GREATER, e.GEQUAL = k.GEQUAL, e.NOTEQUAL = k.NOTEQUAL, e.KEEP = k.KEEP, e.REPLACE = k.REPLACE, e.INCR = k.INCR, e.DECR = k.DECR, e.INVERT = k.INVERT, e.INCR_WRAP = k.INCR_WRAP, e.DECR_WRAP = k.DECR_WRAP, e.TEXTURE_CLAMP_ADDRESSMODE = k.TEXTURE_CLAMP_ADDRESSMODE, e.TEXTURE_WRAP_ADDRESSMODE = k.TEXTURE_WRAP_ADDRESSMODE, e.TEXTURE_MIRROR_ADDRESSMODE = k.TEXTURE_MIRROR_ADDRESSMODE, e.TEXTUREFORMAT_ALPHA = k.TEXTUREFORMAT_ALPHA, e.TEXTUREFORMAT_LUMINANCE = k.TEXTUREFORMAT_LUMINANCE, e.TEXTUREFORMAT_LUMINANCE_ALPHA = k.TEXTUREFORMAT_LUMINANCE_ALPHA, e.TEXTUREFORMAT_RGB = k.TEXTUREFORMAT_RGB, e.TEXTUREFORMAT_RGBA = k.TEXTUREFORMAT_RGBA, e.TEXTUREFORMAT_RED = k.TEXTUREFORMAT_RED, e.TEXTUREFORMAT_R = k.TEXTUREFORMAT_R, e.TEXTUREFORMAT_RG = k.TEXTUREFORMAT_RG, e.TEXTUREFORMAT_RED_INTEGER = k.TEXTUREFORMAT_RED_INTEGER, e.TEXTUREFORMAT_R_INTEGER = k.TEXTUREFORMAT_R_INTEGER, e.TEXTUREFORMAT_RG_INTEGER = k.TEXTUREFORMAT_RG_INTEGER, e.TEXTUREFORMAT_RGB_INTEGER = k.TEXTUREFORMAT_RGB_INTEGER, e.TEXTUREFORMAT_RGBA_INTEGER = k.TEXTUREFORMAT_RGBA_INTEGER, e.TEXTURETYPE_UNSIGNED_BYTE = k.TEXTURETYPE_UNSIGNED_BYTE, e.TEXTURETYPE_UNSIGNED_INT = k.TEXTURETYPE_UNSIGNED_INT, e.TEXTURETYPE_FLOAT = k.TEXTURETYPE_FLOAT, e.TEXTURETYPE_HALF_FLOAT = k.TEXTURETYPE_HALF_FLOAT, e.TEXTURETYPE_BYTE = k.TEXTURETYPE_BYTE, e.TEXTURETYPE_SHORT = k.TEXTURETYPE_SHORT, e.TEXTURETYPE_UNSIGNED_SHORT = k.TEXTURETYPE_UNSIGNED_SHORT, e.TEXTURETYPE_INT = k.TEXTURETYPE_INT, e.TEXTURETYPE_UNSIGNED_INTEGER = k.TEXTURETYPE_UNSIGNED_INTEGER, e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 = k.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4, e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 = k.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1, e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5 = k.TEXTURETYPE_UNSIGNED_SHORT_5_6_5, e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV = k.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV, e.TEXTURETYPE_UNSIGNED_INT_24_8 = k.TEXTURETYPE_UNSIGNED_INT_24_8, e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV = k.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV, e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV = k.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV, e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV = k.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV, e.TEXTURE_NEAREST_SAMPLINGMODE = k.TEXTURE_NEAREST_SAMPLINGMODE, e.TEXTURE_BILINEAR_SAMPLINGMODE = k.TEXTURE_BILINEAR_SAMPLINGMODE, e.TEXTURE_TRILINEAR_SAMPLINGMODE = k.TEXTURE_TRILINEAR_SAMPLINGMODE, e.TEXTURE_NEAREST_NEAREST_MIPLINEAR = k.TEXTURE_NEAREST_NEAREST_MIPLINEAR, e.TEXTURE_LINEAR_LINEAR_MIPNEAREST = k.TEXTURE_LINEAR_LINEAR_MIPNEAREST, e.TEXTURE_LINEAR_LINEAR_MIPLINEAR = k.TEXTURE_LINEAR_LINEAR_MIPLINEAR, e.TEXTURE_NEAREST_NEAREST_MIPNEAREST = k.TEXTURE_NEAREST_NEAREST_MIPNEAREST, e.TEXTURE_NEAREST_LINEAR_MIPNEAREST = k.TEXTURE_NEAREST_LINEAR_MIPNEAREST, e.TEXTURE_NEAREST_LINEAR_MIPLINEAR = k.TEXTURE_NEAREST_LINEAR_MIPLINEAR, e.TEXTURE_NEAREST_LINEAR = k.TEXTURE_NEAREST_LINEAR, e.TEXTURE_NEAREST_NEAREST = k.TEXTURE_NEAREST_NEAREST, e.TEXTURE_LINEAR_NEAREST_MIPNEAREST = k.TEXTURE_LINEAR_NEAREST_MIPNEAREST, e.TEXTURE_LINEAR_NEAREST_MIPLINEAR = k.TEXTURE_LINEAR_NEAREST_MIPLINEAR, e.TEXTURE_LINEAR_LINEAR = k.TEXTURE_LINEAR_LINEAR, e.TEXTURE_LINEAR_NEAREST = k.TEXTURE_LINEAR_NEAREST, e.TEXTURE_EXPLICIT_MODE = k.TEXTURE_EXPLICIT_MODE, e.TEXTURE_SPHERICAL_MODE = k.TEXTURE_SPHERICAL_MODE, e.TEXTURE_PLANAR_MODE = k.TEXTURE_PLANAR_MODE, e.TEXTURE_CUBIC_MODE = k.TEXTURE_CUBIC_MODE, e.TEXTURE_PROJECTION_MODE = k.TEXTURE_PROJECTION_MODE, e.TEXTURE_SKYBOX_MODE = k.TEXTURE_SKYBOX_MODE, e.TEXTURE_INVCUBIC_MODE = k.TEXTURE_INVCUBIC_MODE, e.TEXTURE_EQUIRECTANGULAR_MODE = k.TEXTURE_EQUIRECTANGULAR_MODE, e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE = k.TEXTURE_FIXED_EQUIRECTANGULAR_MODE, e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE = k.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE, e.SCALEMODE_FLOOR = k.SCALEMODE_FLOOR, e.SCALEMODE_NEAREST = k.SCALEMODE_NEAREST, e.SCALEMODE_CEILING = k.SCALEMODE_CEILING, e.CollisionsEpsilon = .001, e._RescalePostProcessFactory = null, e
        }(),
        We = function() {
            function e(t) {
                this.length = 0, this.data = new Array(t), this._id = e._GlobalId++
            }
            return e.prototype.push = function(e) {
                this.data[this.length++] = e, this.length > this.data.length && (this.data.length *= 2)
            }, e.prototype.forEach = function(e) {
                for (var t = 0; t < this.length; t++) e(this.data[t])
            }, e.prototype.sort = function(e) {
                this.data.sort(e)
            }, e.prototype.reset = function() {
                this.length = 0
            }, e.prototype.dispose = function() {
                this.reset(), this.data && (this.data.length = 0, this.data = [])
            }, e.prototype.concat = function(e) {
                if (0 !== e.length) {
                    this.length + e.length > this.data.length && (this.data.length = 2 * (this.length + e.length));
                    for (var t = 0; t < e.length; t++) this.data[this.length++] = (e.data || e)[t]
                }
            }, e.prototype.indexOf = function(e) {
                var t = this.data.indexOf(e);
                return t >= this.length ? -1 : t
            }, e.prototype.contains = function(e) {
                return -1 !== this.indexOf(e)
            }, e._GlobalId = 0, e
        }(),
        Xe = function(e) {
            function t() {
                var t = null !== e && e.apply(this, arguments) || this;
                return t._duplicateId = 0, t
            }
            return r(t, e), t.prototype.push = function(t) {
                e.prototype.push.call(this, t), t.__smartArrayFlags || (t.__smartArrayFlags = {}), t.__smartArrayFlags[this._id] = this._duplicateId
            }, t.prototype.pushNoDuplicate = function(e) {
                return (!e.__smartArrayFlags || e.__smartArrayFlags[this._id] !== this._duplicateId) && (this.push(e), !0)
            }, t.prototype.reset = function() {
                e.prototype.reset.call(this), this._duplicateId++
            }, t.prototype.concatWithNoDuplicate = function(e) {
                if (0 !== e.length) {
                    this.length + e.length > this.data.length && (this.data.length = 2 * (this.length + e.length));
                    for (var t = 0; t < e.length; t++) {
                        var i = (e.data || e)[t];
                        this.pushNoDuplicate(i)
                    }
                }
            }, t
        }(We),
        He = function() {
            function e(e, t, i) {
                void 0 === t && (t = null), void 0 === i && (i = !0), this.state = "", this.metadata = null, this.reservedDataStore = null, this.doNotSerialize = !1, this._isDisposed = !1, this.animations = new Array, this._ranges = {}, this.onReady = null, this._isEnabled = !0, this._isParentEnabled = !0, this._isReady = !0, this._currentRenderId = -1, this._parentUpdateId = -1, this._childUpdateId = -1, this._waitingParentId = null, this._cache = {}, this._parentNode = null, this._children = null, this._worldMatrix = R.Identity(), this._worldMatrixDeterminant = 0, this._worldMatrixDeterminantIsDirty = !0, this._sceneRootNodesIndex = -1, this._animationPropertiesOverride = null, this._isNode = !0, this.onDisposeObservable = new l, this._onDisposeObserver = null, this._behaviors = new Array, this.name = e, this.id = e, this._scene = t || ve.LastCreatedScene, this.uniqueId = this._scene.getUniqueId(), this._initCache(), i && this.addToSceneRootNodes()
            }
            return e.AddNodeConstructor = function(e, t) {
                this._NodeConstructors[e] = t
            }, e.Construct = function(e, t, i, n) {
                var r = this._NodeConstructors[e];
                return r ? r(t, i, n) : null
            }, e.prototype.isDisposed = function() {
                return this._isDisposed
            }, Object.defineProperty(e.prototype, "parent", {
                get: function() {
                    return this._parentNode
                },
                set: function(e) {
                    if (this._parentNode !== e) {
                        var t = this._parentNode;
                        if (this._parentNode && void 0 !== this._parentNode._children && null !== this._parentNode._children) {
                            var i = this._parentNode._children.indexOf(this); - 1 !== i && this._parentNode._children.splice(i, 1), e || this._isDisposed || this.addToSceneRootNodes()
                        }
                        this._parentNode = e, this._parentNode && (void 0 !== this._parentNode._children && null !== this._parentNode._children || (this._parentNode._children = new Array), this._parentNode._children.push(this), t || this.removeFromSceneRootNodes()), this._syncParentEnabledState()
                    }
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.addToSceneRootNodes = function() {
                -1 === this._sceneRootNodesIndex && (this._sceneRootNodesIndex = this._scene.rootNodes.length, this._scene.rootNodes.push(this))
            }, e.prototype.removeFromSceneRootNodes = function() {
                if (-1 !== this._sceneRootNodesIndex) {
                    var e = this._scene.rootNodes,
                        t = e.length - 1;
                    e[this._sceneRootNodesIndex] = e[t], e[this._sceneRootNodesIndex]._sceneRootNodesIndex = this._sceneRootNodesIndex, this._scene.rootNodes.pop(), this._sceneRootNodesIndex = -1
                }
            }, Object.defineProperty(e.prototype, "animationPropertiesOverride", {
                get: function() {
                    return this._animationPropertiesOverride ? this._animationPropertiesOverride : this._scene.animationPropertiesOverride
                },
                set: function(e) {
                    this._animationPropertiesOverride = e
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getClassName = function() {
                return "Node"
            }, Object.defineProperty(e.prototype, "onDispose", {
                set: function(e) {
                    this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getScene = function() {
                return this._scene
            }, e.prototype.getEngine = function() {
                return this._scene.getEngine()
            }, e.prototype.addBehavior = function(e, t) {
                var i = this;
                return void 0 === t && (t = !1), -1 !== this._behaviors.indexOf(e) ? this : (e.init(), this._scene.isLoading && !t ? this._scene.onDataLoadedObservable.addOnce((function() {
                    e.attach(i)
                })) : e.attach(this), this._behaviors.push(e), this)
            }, e.prototype.removeBehavior = function(e) {
                var t = this._behaviors.indexOf(e);
                return -1 === t ? this : (this._behaviors[t].detach(), this._behaviors.splice(t, 1), this)
            }, Object.defineProperty(e.prototype, "behaviors", {
                get: function() {
                    return this._behaviors
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getBehaviorByName = function(e) {
                for (var t = 0, i = this._behaviors; t < i.length; t++) {
                    var n = i[t];
                    if (n.name === e) return n
                }
                return null
            }, e.prototype.getWorldMatrix = function() {
                return this._currentRenderId !== this._scene.getRenderId() && this.computeWorldMatrix(), this._worldMatrix
            }, e.prototype._getWorldMatrixDeterminant = function() {
                return this._worldMatrixDeterminantIsDirty && (this._worldMatrixDeterminantIsDirty = !1, this._worldMatrixDeterminant = this._worldMatrix.determinant()), this._worldMatrixDeterminant
            }, Object.defineProperty(e.prototype, "worldMatrixFromCache", {
                get: function() {
                    return this._worldMatrix
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._initCache = function() {
                this._cache = {}, this._cache.parent = void 0
            }, e.prototype.updateCache = function(e) {
                !e && this.isSynchronized() || (this._cache.parent = this.parent, this._updateCache())
            }, e.prototype._getActionManagerForTrigger = function(e, t) {
                return void 0 === t && (t = !0), this.parent ? this.parent._getActionManagerForTrigger(e, !1) : null
            }, e.prototype._updateCache = function(e) {}, e.prototype._isSynchronized = function() {
                return !0
            }, e.prototype._markSyncedWithParent = function() {
                this._parentNode && (this._parentUpdateId = this._parentNode._childUpdateId)
            }, e.prototype.isSynchronizedWithParent = function() {
                return !this._parentNode || this._parentUpdateId === this._parentNode._childUpdateId && this._parentNode.isSynchronized()
            }, e.prototype.isSynchronized = function() {
                return this._cache.parent != this._parentNode ? (this._cache.parent = this._parentNode, !1) : !(this._parentNode && !this.isSynchronizedWithParent()) && this._isSynchronized()
            }, e.prototype.isReady = function(e) {
                return void 0 === e && (e = !1), this._isReady
            }, e.prototype.isEnabled = function(e) {
                return void 0 === e && (e = !0), !1 === e ? this._isEnabled : !!this._isEnabled && this._isParentEnabled
            }, e.prototype._syncParentEnabledState = function() {
                this._isParentEnabled = !this._parentNode || this._parentNode.isEnabled(), this._children && this._children.forEach((function(e) {
                    e._syncParentEnabledState()
                }))
            }, e.prototype.setEnabled = function(e) {
                this._isEnabled = e, this._syncParentEnabledState()
            }, e.prototype.isDescendantOf = function(e) {
                return !!this.parent && (this.parent === e || this.parent.isDescendantOf(e))
            }, e.prototype._getDescendants = function(e, t, i) {
                if (void 0 === t && (t = !1), this._children)
                    for (var n = 0; n < this._children.length; n++) {
                        var r = this._children[n];
                        i && !i(r) || e.push(r), t || r._getDescendants(e, !1, i)
                    }
            }, e.prototype.getDescendants = function(e, t) {
                var i = new Array;
                return this._getDescendants(i, e, t), i
            }, e.prototype.getChildMeshes = function(e, t) {
                var i = [];
                return this._getDescendants(i, e, (function(e) {
                    return (!t || t(e)) && void 0 !== e.cullingStrategy
                })), i
            }, e.prototype.getChildren = function(e, t) {
                return void 0 === t && (t = !0), this.getDescendants(t, e)
            }, e.prototype._setReady = function(e) {
                e !== this._isReady && (e ? (this.onReady && this.onReady(this), this._isReady = !0) : this._isReady = !1)
            }, e.prototype.getAnimationByName = function(e) {
                for (var t = 0; t < this.animations.length; t++) {
                    var i = this.animations[t];
                    if (i.name === e) return i
                }
                return null
            }, e.prototype.createAnimationRange = function(t, i, n) {
                if (!this._ranges[t]) {
                    this._ranges[t] = e._AnimationRangeFactory(t, i, n);
                    for (var r = 0, o = this.animations.length; r < o; r++) this.animations[r] && this.animations[r].createRange(t, i, n)
                }
            }, e.prototype.deleteAnimationRange = function(e, t) {
                void 0 === t && (t = !0);
                for (var i = 0, n = this.animations.length; i < n; i++) this.animations[i] && this.animations[i].deleteRange(e, t);
                this._ranges[e] = null
            }, e.prototype.getAnimationRange = function(e) {
                return this._ranges[e]
            }, e.prototype.getAnimationRanges = function() {
                var e, t = [];
                for (e in this._ranges) t.push(this._ranges[e]);
                return t
            }, e.prototype.beginAnimation = function(e, t, i, n) {
                var r = this.getAnimationRange(e);
                return r ? this._scene.beginAnimation(this, r.from, r.to, t, i, n) : null
            }, e.prototype.serializeAnimationRanges = function() {
                var e = [];
                for (var t in this._ranges) {
                    var i = this._ranges[t];
                    if (i) {
                        var n = {};
                        n.name = t, n.from = i.from, n.to = i.to, e.push(n)
                    }
                }
                return e
            }, e.prototype.computeWorldMatrix = function(e) {
                return this._worldMatrix || (this._worldMatrix = R.Identity()), this._worldMatrix
            }, e.prototype.dispose = function(e, t) {
                if (void 0 === t && (t = !1), this._isDisposed = !0, !e)
                    for (var i = 0, n = this.getDescendants(!0); i < n.length; i++) {
                        n[i].dispose(e, t)
                    }
                this.parent ? this.parent = null : this.removeFromSceneRootNodes(), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear();
                for (var r = 0, o = this._behaviors; r < o.length; r++) {
                    o[r].detach()
                }
                this._behaviors = []
            }, e.ParseAnimationRanges = function(e, t, i) {
                if (t.ranges)
                    for (var n = 0; n < t.ranges.length; n++) {
                        var r = t.ranges[n];
                        e.createAnimationRange(r.name, r.from, r.to)
                    }
            }, e.prototype.getHierarchyBoundingVectors = function(e, t) {
                var i, n;
                void 0 === e && (e = !0), void 0 === t && (t = null), this.getScene().incrementRenderId(), this.computeWorldMatrix(!0);
                if (this.getBoundingInfo && this.subMeshes) {
                    var r = this.getBoundingInfo();
                    i = r.boundingBox.minimumWorld, n = r.boundingBox.maximumWorld
                } else i = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), n = new b(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);
                if (e)
                    for (var o = 0, s = this.getDescendants(!1); o < s.length; o++) {
                        var a = s[o];
                        if (a.computeWorldMatrix(!0), (!t || t(a)) && a.getBoundingInfo && 0 !== a.getTotalVertices()) {
                            var u = a.getBoundingInfo().boundingBox,
                                h = u.minimumWorld,
                                l = u.maximumWorld;
                            K.CheckExtends(h, i, n), K.CheckExtends(l, i, n)
                        }
                    }
                return {
                    min: i,
                    max: n
                }
            }, e._AnimationRangeFactory = function(e, t, i) {
                throw X.WarnImport("AnimationRange")
            }, e._NodeConstructors = {}, s([ce()], e.prototype, "name", void 0), s([ce()], e.prototype, "id", void 0), s([ce()], e.prototype, "uniqueId", void 0), s([ce()], e.prototype, "state", void 0), s([ce()], e.prototype, "metadata", void 0), e
        }(),
        je = function(e) {
            function t(i, n, r) {
                void 0 === n && (n = null), void 0 === r && (r = !0);
                var o = e.call(this, i, n) || this;
                return o._forward = new b(0, 0, 1), o._forwardInverted = new b(0, 0, -1), o._up = new b(0, 1, 0), o._right = new b(1, 0, 0), o._rightInverted = new b(-1, 0, 0), o._position = b.Zero(), o._rotation = b.Zero(), o._rotationQuaternion = null, o._scaling = b.One(), o._isDirty = !1, o._transformToBoneReferal = null, o._billboardMode = t.BILLBOARDMODE_NONE, o._preserveParentRotationForBillboard = !1, o.scalingDeterminant = 1, o._infiniteDistance = !1, o.ignoreNonUniformScaling = !1, o.reIntegrateRotationIntoRotationQuaternion = !1, o._poseMatrix = null, o._localMatrix = R.Zero(), o._usePivotMatrix = !1, o._absolutePosition = b.Zero(), o._pivotMatrix = R.Identity(), o._postMultiplyPivotMatrix = !1, o._isWorldMatrixFrozen = !1, o._indexInSceneTransformNodesArray = -1, o.onAfterWorldMatrixUpdateObservable = new l, o._nonUniformScaling = !1, r && o.getScene().addTransformNode(o), o
            }
            var i;
            return r(t, e), Object.defineProperty(t.prototype, "billboardMode", {
                get: function() {
                    return this._billboardMode
                },
                set: function(e) {
                    this._billboardMode !== e && (this._billboardMode = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "preserveParentRotationForBillboard", {
                get: function() {
                    return this._preserveParentRotationForBillboard
                },
                set: function(e) {
                    e !== this._preserveParentRotationForBillboard && (this._preserveParentRotationForBillboard = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "infiniteDistance", {
                get: function() {
                    return this._infiniteDistance
                },
                set: function(e) {
                    this._infiniteDistance !== e && (this._infiniteDistance = e)
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getClassName = function() {
                return "TransformNode"
            }, Object.defineProperty(t.prototype, "position", {
                get: function() {
                    return this._position
                },
                set: function(e) {
                    this._position = e, this._isDirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "rotation", {
                get: function() {
                    return this._rotation
                },
                set: function(e) {
                    this._rotation = e, this._rotationQuaternion = null, this._isDirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "scaling", {
                get: function() {
                    return this._scaling
                },
                set: function(e) {
                    this._scaling = e, this._isDirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "rotationQuaternion", {
                get: function() {
                    return this._rotationQuaternion
                },
                set: function(e) {
                    this._rotationQuaternion = e, e && this._rotation.setAll(0), this._isDirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "forward", {
                get: function() {
                    return b.Normalize(b.TransformNormal(this.getScene().useRightHandedSystem ? this._forwardInverted : this._forward, this.getWorldMatrix()))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "up", {
                get: function() {
                    return b.Normalize(b.TransformNormal(this._up, this.getWorldMatrix()))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "right", {
                get: function() {
                    return b.Normalize(b.TransformNormal(this.getScene().useRightHandedSystem ? this._rightInverted : this._right, this.getWorldMatrix()))
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.updatePoseMatrix = function(e) {
                return this._poseMatrix ? (this._poseMatrix.copyFrom(e), this) : (this._poseMatrix = e.clone(), this)
            }, t.prototype.getPoseMatrix = function() {
                return this._poseMatrix || (this._poseMatrix = R.Identity()), this._poseMatrix
            }, t.prototype._isSynchronized = function() {
                var e = this._cache;
                if (this.billboardMode !== e.billboardMode || this.billboardMode !== t.BILLBOARDMODE_NONE) return !1;
                if (e.pivotMatrixUpdated) return !1;
                if (this.infiniteDistance) return !1;
                if (!e.position.equals(this._position)) return !1;
                if (this._rotationQuaternion) {
                    if (!e.rotationQuaternion.equals(this._rotationQuaternion)) return !1
                } else if (!e.rotation.equals(this._rotation)) return !1;
                return !!e.scaling.equals(this._scaling)
            }, t.prototype._initCache = function() {
                e.prototype._initCache.call(this);
                var t = this._cache;
                t.localMatrixUpdated = !1, t.position = b.Zero(), t.scaling = b.Zero(), t.rotation = b.Zero(), t.rotationQuaternion = new M(0, 0, 0, 0), t.billboardMode = -1, t.infiniteDistance = !1
            }, t.prototype.markAsDirty = function(e) {
                return this._currentRenderId = Number.MAX_VALUE, this._isDirty = !0, this
            }, Object.defineProperty(t.prototype, "absolutePosition", {
                get: function() {
                    return this._absolutePosition
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.setPreTransformMatrix = function(e) {
                return this.setPivotMatrix(e, !1)
            }, t.prototype.setPivotMatrix = function(e, t) {
                return void 0 === t && (t = !0), this._pivotMatrix.copyFrom(e), this._usePivotMatrix = !this._pivotMatrix.isIdentity(), this._cache.pivotMatrixUpdated = !0, this._postMultiplyPivotMatrix = t, this._postMultiplyPivotMatrix && (this._pivotMatrixInverse ? this._pivotMatrix.invertToRef(this._pivotMatrixInverse) : this._pivotMatrixInverse = R.Invert(this._pivotMatrix)), this
            }, t.prototype.getPivotMatrix = function() {
                return this._pivotMatrix
            }, t.prototype.freezeWorldMatrix = function() {
                return this._isWorldMatrixFrozen = !1, this.computeWorldMatrix(!0), this._isWorldMatrixFrozen = !0, this
            }, t.prototype.unfreezeWorldMatrix = function() {
                return this._isWorldMatrixFrozen = !1, this.computeWorldMatrix(!0), this
            }, Object.defineProperty(t.prototype, "isWorldMatrixFrozen", {
                get: function() {
                    return this._isWorldMatrixFrozen
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getAbsolutePosition = function() {
                return this.computeWorldMatrix(), this._absolutePosition
            }, t.prototype.setAbsolutePosition = function(e) {
                if (!e) return this;
                var t, i, n;
                if (void 0 === e.x) {
                    if (arguments.length < 3) return this;
                    t = arguments[0], i = arguments[1], n = arguments[2]
                } else t = e.x, i = e.y, n = e.z;
                if (this.parent) {
                    var r = N.Matrix[0];
                    this.parent.getWorldMatrix().invertToRef(r), b.TransformCoordinatesFromFloatsToRef(t, i, n, r, this.position)
                } else this.position.x = t, this.position.y = i, this.position.z = n;
                return this
            }, t.prototype.setPositionWithLocalVector = function(e) {
                return this.computeWorldMatrix(), this.position = b.TransformNormal(e, this._localMatrix), this
            }, t.prototype.getPositionExpressedInLocalSpace = function() {
                this.computeWorldMatrix();
                var e = N.Matrix[0];
                return this._localMatrix.invertToRef(e), b.TransformNormal(this.position, e)
            }, t.prototype.locallyTranslate = function(e) {
                return this.computeWorldMatrix(!0), this.position = b.TransformCoordinates(e, this._localMatrix), this
            }, t.prototype.lookAt = function(e, i, n, r, o) {
                void 0 === i && (i = 0), void 0 === n && (n = 0), void 0 === r && (r = 0), void 0 === o && (o = a.LOCAL);
                var s = t._lookAtVectorCache,
                    u = o === a.LOCAL ? this.position : this.getAbsolutePosition();
                if (e.subtractToRef(u, s), this.setDirection(s, i, n, r), o === a.WORLD && this.parent)
                    if (this.rotationQuaternion) {
                        var h = N.Matrix[0];
                        this.rotationQuaternion.toRotationMatrix(h);
                        var l = N.Matrix[1];
                        this.parent.getWorldMatrix().getRotationMatrixToRef(l), l.invert(), h.multiplyToRef(l, h), this.rotationQuaternion.fromRotationMatrix(h)
                    } else {
                        var c = N.Quaternion[0];
                        M.FromEulerVectorToRef(this.rotation, c);
                        h = N.Matrix[0];
                        c.toRotationMatrix(h);
                        l = N.Matrix[1];
                        this.parent.getWorldMatrix().getRotationMatrixToRef(l), l.invert(), h.multiplyToRef(l, h), c.fromRotationMatrix(h), c.toEulerAnglesToRef(this.rotation)
                    }
                return this
            }, t.prototype.getDirection = function(e) {
                var t = b.Zero();
                return this.getDirectionToRef(e, t), t
            }, t.prototype.getDirectionToRef = function(e, t) {
                return b.TransformNormalToRef(e, this.getWorldMatrix(), t), this
            }, t.prototype.setDirection = function(e, t, i, n) {
                void 0 === t && (t = 0), void 0 === i && (i = 0), void 0 === n && (n = 0);
                var r = -Math.atan2(e.z, e.x) + Math.PI / 2,
                    o = Math.sqrt(e.x * e.x + e.z * e.z),
                    s = -Math.atan2(e.y, o);
                return this.rotationQuaternion ? M.RotationYawPitchRollToRef(r + t, s + i, n, this.rotationQuaternion) : (this.rotation.x = s + i, this.rotation.y = r + t, this.rotation.z = n), this
            }, t.prototype.setPivotPoint = function(e, t) {
                void 0 === t && (t = a.LOCAL), 0 == this.getScene().getRenderId() && this.computeWorldMatrix(!0);
                var i = this.getWorldMatrix();
                if (t == a.WORLD) {
                    var n = N.Matrix[0];
                    i.invertToRef(n), e = b.TransformCoordinates(e, n)
                }
                return this.setPivotMatrix(R.Translation(-e.x, -e.y, -e.z), !0)
            }, t.prototype.getPivotPoint = function() {
                var e = b.Zero();
                return this.getPivotPointToRef(e), e
            }, t.prototype.getPivotPointToRef = function(e) {
                return e.x = -this._pivotMatrix.m[12], e.y = -this._pivotMatrix.m[13], e.z = -this._pivotMatrix.m[14], this
            }, t.prototype.getAbsolutePivotPoint = function() {
                var e = b.Zero();
                return this.getAbsolutePivotPointToRef(e), e
            }, t.prototype.getAbsolutePivotPointToRef = function(e) {
                return e.x = this._pivotMatrix.m[12], e.y = this._pivotMatrix.m[13], e.z = this._pivotMatrix.m[14], this.getPivotPointToRef(e), b.TransformCoordinatesToRef(e, this.getWorldMatrix(), e), this
            }, t.prototype.setParent = function(e) {
                if (!e && !this.parent) return this;
                var t = N.Quaternion[0],
                    i = N.Vector3[0],
                    n = N.Vector3[1];
                if (e) {
                    var r = N.Matrix[0],
                        o = N.Matrix[1];
                    this.computeWorldMatrix(!0), e.computeWorldMatrix(!0), e.getWorldMatrix().invertToRef(o), this.getWorldMatrix().multiplyToRef(o, r), r.decompose(n, t, i)
                } else this.parent && this.parent.computeWorldMatrix && this.parent.computeWorldMatrix(!0), this.computeWorldMatrix(!0), this.getWorldMatrix().decompose(n, t, i);
                return this.rotationQuaternion ? this.rotationQuaternion.copyFrom(t) : t.toEulerAnglesToRef(this.rotation), this.scaling.copyFrom(n), this.position.copyFrom(i), this.parent = e, this
            }, Object.defineProperty(t.prototype, "nonUniformScaling", {
                get: function() {
                    return this._nonUniformScaling
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._updateNonUniformScalingState = function(e) {
                return this._nonUniformScaling !== e && (this._nonUniformScaling = e, !0)
            }, t.prototype.attachToBone = function(e, t) {
                return this._transformToBoneReferal = t, this.parent = e, e.getWorldMatrix().determinant() < 0 && (this.scalingDeterminant *= -1), this
            }, t.prototype.detachFromBone = function() {
                return this.parent ? (this.parent.getWorldMatrix().determinant() < 0 && (this.scalingDeterminant *= -1), this._transformToBoneReferal = null, this.parent = null, this) : this
            }, t.prototype.rotate = function(e, i, n) {
                var r;
                if (e.normalize(), this.rotationQuaternion || (this.rotationQuaternion = this.rotation.toQuaternion(), this.rotation.setAll(0)), n && n !== a.LOCAL) {
                    if (this.parent) {
                        var o = N.Matrix[0];
                        this.parent.getWorldMatrix().invertToRef(o), e = b.TransformNormal(e, o)
                    }(r = M.RotationAxisToRef(e, i, t._rotationAxisCache)).multiplyToRef(this.rotationQuaternion, this.rotationQuaternion)
                } else r = M.RotationAxisToRef(e, i, t._rotationAxisCache), this.rotationQuaternion.multiplyToRef(r, this.rotationQuaternion);
                return this
            }, t.prototype.rotateAround = function(e, t, i) {
                t.normalize(), this.rotationQuaternion || (this.rotationQuaternion = M.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z), this.rotation.setAll(0));
                var n = N.Vector3[0],
                    r = N.Vector3[1],
                    o = N.Vector3[2],
                    s = N.Quaternion[0],
                    a = N.Matrix[0],
                    u = N.Matrix[1],
                    h = N.Matrix[2],
                    l = N.Matrix[3];
                return e.subtractToRef(this.position, n), R.TranslationToRef(n.x, n.y, n.z, a), R.TranslationToRef(-n.x, -n.y, -n.z, u), R.RotationAxisToRef(t, i, h), u.multiplyToRef(h, l), l.multiplyToRef(a, l), l.decompose(r, s, o), this.position.addInPlace(o), s.multiplyToRef(this.rotationQuaternion, this.rotationQuaternion), this
            }, t.prototype.translate = function(e, t, i) {
                var n = e.scale(t);
                if (i && i !== a.LOCAL) this.setAbsolutePosition(this.getAbsolutePosition().add(n));
                else {
                    var r = this.getPositionExpressedInLocalSpace().add(n);
                    this.setPositionWithLocalVector(r)
                }
                return this
            }, t.prototype.addRotation = function(e, t, i) {
                var n;
                this.rotationQuaternion ? n = this.rotationQuaternion : (n = N.Quaternion[1], M.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, n));
                var r = N.Quaternion[0];
                return M.RotationYawPitchRollToRef(t, e, i, r), n.multiplyInPlace(r), this.rotationQuaternion || n.toEulerAnglesToRef(this.rotation), this
            }, t.prototype._getEffectiveParent = function() {
                return this.parent
            }, t.prototype.computeWorldMatrix = function(e) {
                if (this._isWorldMatrixFrozen && !this._isDirty) return this._worldMatrix;
                var i = this.getScene().getRenderId();
                if (!this._isDirty && !e && this.isSynchronized()) return this._currentRenderId = i, this._worldMatrix;
                this._updateCache();
                var n = this._cache;
                n.pivotMatrixUpdated = !1, n.billboardMode = this.billboardMode, n.infiniteDistance = this.infiniteDistance, this._currentRenderId = i, this._childUpdateId++, this._isDirty = !1;
                var r = this._getEffectiveParent(),
                    o = this._billboardMode !== t.BILLBOARDMODE_NONE && !this.preserveParentRotationForBillboard,
                    s = this.getScene().activeCamera,
                    a = n.scaling,
                    u = n.position;
                if (this._infiniteDistance)
                    if (!this.parent && s) {
                        var h = s.getWorldMatrix(),
                            l = new b(h.m[12], h.m[13], h.m[14]);
                        u.copyFromFloats(this._position.x + l.x, this._position.y + l.y, this._position.z + l.z)
                    } else u.copyFrom(this._position);
                else u.copyFrom(this._position);
                a.copyFromFloats(this._scaling.x * this.scalingDeterminant, this._scaling.y * this.scalingDeterminant, this._scaling.z * this.scalingDeterminant);
                var c = n.rotationQuaternion;
                if (this._rotationQuaternion) {
                    if (this.reIntegrateRotationIntoRotationQuaternion) this.rotation.lengthSquared() && (this._rotationQuaternion.multiplyInPlace(M.RotationYawPitchRoll(this._rotation.y, this._rotation.x, this._rotation.z)), this._rotation.copyFromFloats(0, 0, 0));
                    c.copyFrom(this._rotationQuaternion)
                } else M.RotationYawPitchRollToRef(this._rotation.y, this._rotation.x, this._rotation.z, c), n.rotation.copyFrom(this._rotation);
                if (this._usePivotMatrix) {
                    var d = N.Matrix[1];
                    R.ScalingToRef(a.x, a.y, a.z, d);
                    var f = N.Matrix[0];
                    c.toRotationMatrix(f), this._pivotMatrix.multiplyToRef(d, N.Matrix[4]), N.Matrix[4].multiplyToRef(f, this._localMatrix), this._postMultiplyPivotMatrix && this._localMatrix.multiplyToRef(this._pivotMatrixInverse, this._localMatrix), this._localMatrix.addTranslationFromFloats(u.x, u.y, u.z)
                } else R.ComposeToRef(a, c, u, this._localMatrix);
                if (r && r.getWorldMatrix) {
                    if (o) {
                        this._transformToBoneReferal ? r.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), N.Matrix[7]) : N.Matrix[7].copyFrom(r.getWorldMatrix());
                        var p = N.Vector3[5],
                            _ = N.Vector3[6];
                        N.Matrix[7].decompose(_, void 0, p), R.ScalingToRef(_.x, _.y, _.z, N.Matrix[7]), N.Matrix[7].setTranslation(p), this._localMatrix.multiplyToRef(N.Matrix[7], this._worldMatrix)
                    } else this._transformToBoneReferal ? (this._localMatrix.multiplyToRef(r.getWorldMatrix(), N.Matrix[6]), N.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(), this._worldMatrix)) : this._localMatrix.multiplyToRef(r.getWorldMatrix(), this._worldMatrix);
                    this._markSyncedWithParent()
                } else this._worldMatrix.copyFrom(this._localMatrix);
                if (o && s) {
                    var g = N.Vector3[0];
                    if (this._worldMatrix.getTranslationToRef(g), N.Matrix[1].copyFrom(s.getViewMatrix()), N.Matrix[1].setTranslationFromFloats(0, 0, 0), N.Matrix[1].invertToRef(N.Matrix[0]), (this.billboardMode & t.BILLBOARDMODE_ALL) !== t.BILLBOARDMODE_ALL) {
                        N.Matrix[0].decompose(void 0, N.Quaternion[0], void 0);
                        var m = N.Vector3[1];
                        N.Quaternion[0].toEulerAnglesToRef(m), (this.billboardMode & t.BILLBOARDMODE_X) !== t.BILLBOARDMODE_X && (m.x = 0), (this.billboardMode & t.BILLBOARDMODE_Y) !== t.BILLBOARDMODE_Y && (m.y = 0), (this.billboardMode & t.BILLBOARDMODE_Z) !== t.BILLBOARDMODE_Z && (m.z = 0), R.RotationYawPitchRollToRef(m.y, m.x, m.z, N.Matrix[0])
                    }
                    this._worldMatrix.setTranslationFromFloats(0, 0, 0), this._worldMatrix.multiplyToRef(N.Matrix[0], this._worldMatrix), this._worldMatrix.setTranslation(N.Vector3[0])
                }
                return this.ignoreNonUniformScaling ? this._updateNonUniformScalingState(!1) : this._scaling.isNonUniform ? this._updateNonUniformScalingState(!0) : r && r._nonUniformScaling ? this._updateNonUniformScalingState(r._nonUniformScaling) : this._updateNonUniformScalingState(!1), this._afterComputeWorldMatrix(), this._absolutePosition.copyFromFloats(this._worldMatrix.m[12], this._worldMatrix.m[13], this._worldMatrix.m[14]), this.onAfterWorldMatrixUpdateObservable.notifyObservers(this), this._poseMatrix || (this._poseMatrix = R.Invert(this._worldMatrix)), this._worldMatrixDeterminantIsDirty = !0, this._worldMatrix
            }, t.prototype._afterComputeWorldMatrix = function() {}, t.prototype.registerAfterWorldMatrixUpdate = function(e) {
                return this.onAfterWorldMatrixUpdateObservable.add(e), this
            }, t.prototype.unregisterAfterWorldMatrixUpdate = function(e) {
                return this.onAfterWorldMatrixUpdateObservable.removeCallback(e), this
            }, t.prototype.getPositionInCameraSpace = function(e) {
                return void 0 === e && (e = null), e || (e = this.getScene().activeCamera), b.TransformCoordinates(this.absolutePosition, e.getViewMatrix())
            }, t.prototype.getDistanceToCamera = function(e) {
                return void 0 === e && (e = null), e || (e = this.getScene().activeCamera), this.absolutePosition.subtract(e.globalPosition).length()
            }, t.prototype.clone = function(e, i, n) {
                var r = this,
                    o = me.Clone((function() {
                        return new t(e, r.getScene())
                    }), this);
                if (o.name = e, o.id = e, i && (o.parent = i), !n)
                    for (var s = this.getDescendants(!0), a = 0; a < s.length; a++) {
                        var u = s[a];
                        u.clone && u.clone(e + "." + u.name, o)
                    }
                return o
            }, t.prototype.serialize = function(e) {
                var t = me.Serialize(this, e);
                return t.type = this.getClassName(), this.parent && (t.parentId = this.parent.id), t.localMatrix = this.getPivotMatrix().asArray(), t.isEnabled = this.isEnabled(), this.parent && (t.parentId = this.parent.id), t
            }, t.Parse = function(e, i, n) {
                var r = me.Parse((function() {
                    return new t(e.name, i)
                }), e, i, n);
                return e.localMatrix ? r.setPreTransformMatrix(R.FromArray(e.localMatrix)) : e.pivotMatrix && r.setPivotMatrix(R.FromArray(e.pivotMatrix)), r.setEnabled(e.isEnabled), e.parentId && (r._waitingParentId = e.parentId), r
            }, t.prototype.getChildTransformNodes = function(e, i) {
                var n = [];
                return this._getDescendants(n, e, (function(e) {
                    return (!i || i(e)) && e instanceof t
                })), n
            }, t.prototype.dispose = function(t, i) {
                if (void 0 === i && (i = !1), this.getScene().stopAnimation(this), this.getScene().removeTransformNode(this), this.onAfterWorldMatrixUpdateObservable.clear(), t)
                    for (var n = 0, r = this.getChildTransformNodes(!0); n < r.length; n++) {
                        var o = r[n];
                        o.parent = null, o.computeWorldMatrix(!0)
                    }
                e.prototype.dispose.call(this, t, i)
            }, t.BILLBOARDMODE_NONE = 0, t.BILLBOARDMODE_X = 1, t.BILLBOARDMODE_Y = 2, t.BILLBOARDMODE_Z = 4, t.BILLBOARDMODE_ALL = 7, t._lookAtVectorCache = new b(0, 0, 0), t._rotationAxisCache = new M, s([_e("position")], t.prototype, "_position", void 0), s([_e("rotation")], t.prototype, "_rotation", void 0), s([(i = "rotationQuaternion", he(10, i))], t.prototype, "_rotationQuaternion", void 0), s([_e("scaling")], t.prototype, "_scaling", void 0), s([ce("billboardMode")], t.prototype, "_billboardMode", void 0), s([ce()], t.prototype, "scalingDeterminant", void 0), s([ce("infiniteDistance")], t.prototype, "_infiniteDistance", void 0), s([ce()], t.prototype, "ignoreNonUniformScaling", void 0), s([ce()], t.prototype, "reIntegrateRotationIntoRotationQuaternion", void 0), t
        }(He),
        Ye = function() {
            function e() {}
            return e.prototype.set = function(e, t) {
                switch (t) {
                    case Te.PositionKind:
                        this.positions = e;
                        break;
                    case Te.NormalKind:
                        this.normals = e;
                        break;
                    case Te.TangentKind:
                        this.tangents = e;
                        break;
                    case Te.UVKind:
                        this.uvs = e;
                        break;
                    case Te.UV2Kind:
                        this.uvs2 = e;
                        break;
                    case Te.UV3Kind:
                        this.uvs3 = e;
                        break;
                    case Te.UV4Kind:
                        this.uvs4 = e;
                        break;
                    case Te.UV5Kind:
                        this.uvs5 = e;
                        break;
                    case Te.UV6Kind:
                        this.uvs6 = e;
                        break;
                    case Te.ColorKind:
                        this.colors = e;
                        break;
                    case Te.MatricesIndicesKind:
                        this.matricesIndices = e;
                        break;
                    case Te.MatricesWeightsKind:
                        this.matricesWeights = e;
                        break;
                    case Te.MatricesIndicesExtraKind:
                        this.matricesIndicesExtra = e;
                        break;
                    case Te.MatricesWeightsExtraKind:
                        this.matricesWeightsExtra = e
                }
            }, e.prototype.applyToMesh = function(e, t) {
                return this._applyTo(e, t), this
            }, e.prototype.applyToGeometry = function(e, t) {
                return this._applyTo(e, t), this
            }, e.prototype.updateMesh = function(e) {
                return this._update(e), this
            }, e.prototype.updateGeometry = function(e) {
                return this._update(e), this
            }, e.prototype._applyTo = function(e, t) {
                return void 0 === t && (t = !1), this.positions && e.setVerticesData(Te.PositionKind, this.positions, t), this.normals && e.setVerticesData(Te.NormalKind, this.normals, t), this.tangents && e.setVerticesData(Te.TangentKind, this.tangents, t), this.uvs && e.setVerticesData(Te.UVKind, this.uvs, t), this.uvs2 && e.setVerticesData(Te.UV2Kind, this.uvs2, t), this.uvs3 && e.setVerticesData(Te.UV3Kind, this.uvs3, t), this.uvs4 && e.setVerticesData(Te.UV4Kind, this.uvs4, t), this.uvs5 && e.setVerticesData(Te.UV5Kind, this.uvs5, t), this.uvs6 && e.setVerticesData(Te.UV6Kind, this.uvs6, t), this.colors && e.setVerticesData(Te.ColorKind, this.colors, t), this.matricesIndices && e.setVerticesData(Te.MatricesIndicesKind, this.matricesIndices, t), this.matricesWeights && e.setVerticesData(Te.MatricesWeightsKind, this.matricesWeights, t), this.matricesIndicesExtra && e.setVerticesData(Te.MatricesIndicesExtraKind, this.matricesIndicesExtra, t), this.matricesWeightsExtra && e.setVerticesData(Te.MatricesWeightsExtraKind, this.matricesWeightsExtra, t), this.indices ? e.setIndices(this.indices, null, t) : e.setIndices([], null), this
            }, e.prototype._update = function(e, t, i) {
                return this.positions && e.updateVerticesData(Te.PositionKind, this.positions, t, i), this.normals && e.updateVerticesData(Te.NormalKind, this.normals, t, i), this.tangents && e.updateVerticesData(Te.TangentKind, this.tangents, t, i), this.uvs && e.updateVerticesData(Te.UVKind, this.uvs, t, i), this.uvs2 && e.updateVerticesData(Te.UV2Kind, this.uvs2, t, i), this.uvs3 && e.updateVerticesData(Te.UV3Kind, this.uvs3, t, i), this.uvs4 && e.updateVerticesData(Te.UV4Kind, this.uvs4, t, i), this.uvs5 && e.updateVerticesData(Te.UV5Kind, this.uvs5, t, i), this.uvs6 && e.updateVerticesData(Te.UV6Kind, this.uvs6, t, i), this.colors && e.updateVerticesData(Te.ColorKind, this.colors, t, i), this.matricesIndices && e.updateVerticesData(Te.MatricesIndicesKind, this.matricesIndices, t, i), this.matricesWeights && e.updateVerticesData(Te.MatricesWeightsKind, this.matricesWeights, t, i), this.matricesIndicesExtra && e.updateVerticesData(Te.MatricesIndicesExtraKind, this.matricesIndicesExtra, t, i), this.matricesWeightsExtra && e.updateVerticesData(Te.MatricesWeightsExtraKind, this.matricesWeightsExtra, t, i), this.indices && e.setIndices(this.indices, null), this
            }, e.prototype.transform = function(e) {
                var t, i = e.m[0] * e.m[5] * e.m[10] < 0,
                    n = b.Zero();
                if (this.positions) {
                    var r = b.Zero();
                    for (t = 0; t < this.positions.length; t += 3) b.FromArrayToRef(this.positions, t, r), b.TransformCoordinatesToRef(r, e, n), this.positions[t] = n.x, this.positions[t + 1] = n.y, this.positions[t + 2] = n.z
                }
                if (this.normals) {
                    var o = b.Zero();
                    for (t = 0; t < this.normals.length; t += 3) b.FromArrayToRef(this.normals, t, o), b.TransformNormalToRef(o, e, n), this.normals[t] = n.x, this.normals[t + 1] = n.y, this.normals[t + 2] = n.z
                }
                if (this.tangents) {
                    var s = E.Zero(),
                        a = E.Zero();
                    for (t = 0; t < this.tangents.length; t += 4) E.FromArrayToRef(this.tangents, t, s), E.TransformNormalToRef(s, e, a), this.tangents[t] = a.x, this.tangents[t + 1] = a.y, this.tangents[t + 2] = a.z, this.tangents[t + 3] = a.w
                }
                if (i && this.indices)
                    for (t = 0; t < this.indices.length; t += 3) {
                        var u = this.indices[t + 1];
                        this.indices[t + 1] = this.indices[t + 2], this.indices[t + 2] = u
                    }
                return this
            }, e.prototype.merge = function(e, t) {
                if (void 0 === t && (t = !1), this._validate(), e._validate(), !this.normals != !e.normals || !this.tangents != !e.tangents || !this.uvs != !e.uvs || !this.uvs2 != !e.uvs2 || !this.uvs3 != !e.uvs3 || !this.uvs4 != !e.uvs4 || !this.uvs5 != !e.uvs5 || !this.uvs6 != !e.uvs6 || !this.colors != !e.colors || !this.matricesIndices != !e.matricesIndices || !this.matricesWeights != !e.matricesWeights || !this.matricesIndicesExtra != !e.matricesIndicesExtra || !this.matricesWeightsExtra != !e.matricesWeightsExtra) throw new Error("Cannot merge vertex data that do not have the same set of attributes");
                if (e.indices) {
                    this.indices || (this.indices = []);
                    var i = this.positions ? this.positions.length / 3 : 0;
                    if (void 0 !== this.indices.BYTES_PER_ELEMENT) {
                        var n = this.indices.length + e.indices.length,
                            r = t || this.indices instanceof Uint32Array ? new Uint32Array(n) : new Uint16Array(n);
                        r.set(this.indices);
                        for (var o = this.indices.length, s = 0; s < e.indices.length; s++) r[o + s] = e.indices[s] + i;
                        this.indices = r
                    } else
                        for (s = 0; s < e.indices.length; s++) this.indices.push(e.indices[s] + i)
                }
                return this.positions = this._mergeElement(this.positions, e.positions), this.normals = this._mergeElement(this.normals, e.normals), this.tangents = this._mergeElement(this.tangents, e.tangents), this.uvs = this._mergeElement(this.uvs, e.uvs), this.uvs2 = this._mergeElement(this.uvs2, e.uvs2), this.uvs3 = this._mergeElement(this.uvs3, e.uvs3), this.uvs4 = this._mergeElement(this.uvs4, e.uvs4), this.uvs5 = this._mergeElement(this.uvs5, e.uvs5), this.uvs6 = this._mergeElement(this.uvs6, e.uvs6), this.colors = this._mergeElement(this.colors, e.colors), this.matricesIndices = this._mergeElement(this.matricesIndices, e.matricesIndices), this.matricesWeights = this._mergeElement(this.matricesWeights, e.matricesWeights), this.matricesIndicesExtra = this._mergeElement(this.matricesIndicesExtra, e.matricesIndicesExtra), this.matricesWeightsExtra = this._mergeElement(this.matricesWeightsExtra, e.matricesWeightsExtra), this
            }, e.prototype._mergeElement = function(e, t) {
                if (!e) return t;
                if (!t) return e;
                var i = t.length + e.length,
                    n = e instanceof Float32Array,
                    r = t instanceof Float32Array;
                if (n) {
                    var o = new Float32Array(i);
                    return o.set(e), o.set(t, e.length), o
                }
                if (r) {
                    var s = e.slice(0),
                        a = 0;
                    for (i = t.length; a < i; a++) s.push(t[a]);
                    return s
                }
                return e.concat(t)
            }, e.prototype._validate = function() {
                if (!this.positions) throw new Error("Positions are required");
                var e = function(e, t) {
                        var i = Te.DeduceStride(e);
                        if (t.length % i != 0) throw new Error("The " + e + "s array count must be a multiple of " + i);
                        return t.length / i
                    },
                    t = e(Te.PositionKind, this.positions),
                    i = function(i, n) {
                        var r = e(i, n);
                        if (r !== t) throw new Error("The " + i + "s element count (" + r + ") does not match the positions count (" + t + ")")
                    };
                this.normals && i(Te.NormalKind, this.normals), this.tangents && i(Te.TangentKind, this.tangents), this.uvs && i(Te.UVKind, this.uvs), this.uvs2 && i(Te.UV2Kind, this.uvs2), this.uvs3 && i(Te.UV3Kind, this.uvs3), this.uvs4 && i(Te.UV4Kind, this.uvs4), this.uvs5 && i(Te.UV5Kind, this.uvs5), this.uvs6 && i(Te.UV6Kind, this.uvs6), this.colors && i(Te.ColorKind, this.colors), this.matricesIndices && i(Te.MatricesIndicesKind, this.matricesIndices), this.matricesWeights && i(Te.MatricesWeightsKind, this.matricesWeights), this.matricesIndicesExtra && i(Te.MatricesIndicesExtraKind, this.matricesIndicesExtra), this.matricesWeightsExtra && i(Te.MatricesWeightsExtraKind, this.matricesWeightsExtra)
            }, e.prototype.serialize = function() {
                var e = this.serialize();
                return this.positions && (e.positions = this.positions), this.normals && (e.normals = this.normals), this.tangents && (e.tangents = this.tangents), this.uvs && (e.uvs = this.uvs), this.uvs2 && (e.uvs2 = this.uvs2), this.uvs3 && (e.uvs3 = this.uvs3), this.uvs4 && (e.uvs4 = this.uvs4), this.uvs5 && (e.uvs5 = this.uvs5), this.uvs6 && (e.uvs6 = this.uvs6), this.colors && (e.colors = this.colors), this.matricesIndices && (e.matricesIndices = this.matricesIndices, e.matricesIndices._isExpanded = !0), this.matricesWeights && (e.matricesWeights = this.matricesWeights), this.matricesIndicesExtra && (e.matricesIndicesExtra = this.matricesIndicesExtra, e.matricesIndicesExtra._isExpanded = !0), this.matricesWeightsExtra && (e.matricesWeightsExtra = this.matricesWeightsExtra), e.indices = this.indices, e
            }, e.ExtractFromMesh = function(t, i, n) {
                return e._ExtractFrom(t, i, n)
            }, e.ExtractFromGeometry = function(t, i, n) {
                return e._ExtractFrom(t, i, n)
            }, e._ExtractFrom = function(t, i, n) {
                var r = new e;
                return t.isVerticesDataPresent(Te.PositionKind) && (r.positions = t.getVerticesData(Te.PositionKind, i, n)), t.isVerticesDataPresent(Te.NormalKind) && (r.normals = t.getVerticesData(Te.NormalKind, i, n)), t.isVerticesDataPresent(Te.TangentKind) && (r.tangents = t.getVerticesData(Te.TangentKind, i, n)), t.isVerticesDataPresent(Te.UVKind) && (r.uvs = t.getVerticesData(Te.UVKind, i, n)), t.isVerticesDataPresent(Te.UV2Kind) && (r.uvs2 = t.getVerticesData(Te.UV2Kind, i, n)), t.isVerticesDataPresent(Te.UV3Kind) && (r.uvs3 = t.getVerticesData(Te.UV3Kind, i, n)), t.isVerticesDataPresent(Te.UV4Kind) && (r.uvs4 = t.getVerticesData(Te.UV4Kind, i, n)), t.isVerticesDataPresent(Te.UV5Kind) && (r.uvs5 = t.getVerticesData(Te.UV5Kind, i, n)), t.isVerticesDataPresent(Te.UV6Kind) && (r.uvs6 = t.getVerticesData(Te.UV6Kind, i, n)), t.isVerticesDataPresent(Te.ColorKind) && (r.colors = t.getVerticesData(Te.ColorKind, i, n)), t.isVerticesDataPresent(Te.MatricesIndicesKind) && (r.matricesIndices = t.getVerticesData(Te.MatricesIndicesKind, i, n)), t.isVerticesDataPresent(Te.MatricesWeightsKind) && (r.matricesWeights = t.getVerticesData(Te.MatricesWeightsKind, i, n)), t.isVerticesDataPresent(Te.MatricesIndicesExtraKind) && (r.matricesIndicesExtra = t.getVerticesData(Te.MatricesIndicesExtraKind, i, n)), t.isVerticesDataPresent(Te.MatricesWeightsExtraKind) && (r.matricesWeightsExtra = t.getVerticesData(Te.MatricesWeightsExtraKind, i, n)), r.indices = t.getIndices(i, n), r
            }, e.CreateRibbon = function(e) {
                throw X.WarnImport("ribbonBuilder")
            }, e.CreateBox = function(e) {
                throw X.WarnImport("boxBuilder")
            }, e.CreateSphere = function(e) {
                throw X.WarnImport("sphereBuilder")
            }, e.CreateCylinder = function(e) {
                throw X.WarnImport("cylinderBuilder")
            }, e.CreateTorus = function(e) {
                throw X.WarnImport("torusBuilder")
            }, e.CreateLineSystem = function(e) {
                throw X.WarnImport("linesBuilder")
            }, e.CreateDashedLines = function(e) {
                throw X.WarnImport("linesBuilder")
            }, e.CreateGround = function(e) {
                throw X.WarnImport("groundBuilder")
            }, e.CreateTiledGround = function(e) {
                throw X.WarnImport("groundBuilder")
            }, e.CreateGroundFromHeightMap = function(e) {
                throw X.WarnImport("groundBuilder")
            }, e.CreatePlane = function(e) {
                throw X.WarnImport("planeBuilder")
            }, e.CreateDisc = function(e) {
                throw X.WarnImport("discBuilder")
            }, e.CreatePolygon = function(e, t, i, n, r, o) {
                throw X.WarnImport("polygonBuilder")
            }, e.CreateIcoSphere = function(e) {
                throw X.WarnImport("icoSphereBuilder")
            }, e.CreatePolyhedron = function(e) {
                throw X.WarnImport("polyhedronBuilder")
            }, e.CreateTorusKnot = function(e) {
                throw X.WarnImport("torusKnotBuilder")
            }, e.ComputeNormals = function(e, t, i, n) {
                var r = 0,
                    o = 0,
                    s = 0,
                    a = 0,
                    u = 0,
                    h = 0,
                    l = 0,
                    c = 0,
                    d = 0,
                    f = 0,
                    p = 0,
                    _ = 0,
                    g = 0,
                    m = 0,
                    v = 0,
                    y = 0,
                    T = 0,
                    E = 0,
                    A = 0,
                    M = 0,
                    R = !1,
                    x = !1,
                    P = !1,
                    I = !1,
                    C = 1,
                    S = 0,
                    O = null;
                if (n && (R = !!n.facetNormals, x = !!n.facetPositions, P = !!n.facetPartitioning, C = !0 === n.useRightHandedSystem ? -1 : 1, S = n.ratio || 0, I = !!n.depthSort, O = n.distanceTo, I)) {
                    void 0 === O && (O = b.Zero());
                    var D = n.depthSortedFacets
                }
                var w = 0,
                    L = 0,
                    F = 0,
                    N = 0;
                if (P && n && n.bbSize) {
                    var U = 0,
                        B = 0,
                        k = 0,
                        V = 0,
                        G = 0,
                        z = 0,
                        W = 0,
                        X = 0,
                        H = 0,
                        j = 0,
                        Y = 0,
                        K = 0,
                        q = 0,
                        Z = 0,
                        Q = 0,
                        J = 0,
                        $ = n.bbSize.x > n.bbSize.y ? n.bbSize.x : n.bbSize.y;
                    $ = $ > n.bbSize.z ? $ : n.bbSize.z, w = n.subDiv.X * S / n.bbSize.x, L = n.subDiv.Y * S / n.bbSize.y, F = n.subDiv.Z * S / n.bbSize.z, N = n.subDiv.max * n.subDiv.max, n.facetPartitioning.length = 0
                }
                for (r = 0; r < e.length; r++) i[r] = 0;
                var ee = t.length / 3 | 0;
                for (r = 0; r < ee; r++) {
                    if (g = (_ = 3 * t[3 * r]) + 1, m = _ + 2, y = (v = 3 * t[3 * r + 1]) + 1, T = v + 2, A = (E = 3 * t[3 * r + 2]) + 1, M = E + 2, o = e[_] - e[v], s = e[g] - e[y], a = e[m] - e[T], u = e[E] - e[v], h = e[A] - e[y], c = C * (s * (l = e[M] - e[T]) - a * h), d = C * (a * u - o * l), f = C * (o * h - s * u), c /= p = 0 === (p = Math.sqrt(c * c + d * d + f * f)) ? 1 : p, d /= p, f /= p, R && n && (n.facetNormals[r].x = c, n.facetNormals[r].y = d, n.facetNormals[r].z = f), x && n && (n.facetPositions[r].x = (e[_] + e[v] + e[E]) / 3, n.facetPositions[r].y = (e[g] + e[y] + e[A]) / 3, n.facetPositions[r].z = (e[m] + e[T] + e[M]) / 3), P && n && (U = Math.floor((n.facetPositions[r].x - n.bInfo.minimum.x * S) * w), B = Math.floor((n.facetPositions[r].y - n.bInfo.minimum.y * S) * L), k = Math.floor((n.facetPositions[r].z - n.bInfo.minimum.z * S) * F), V = Math.floor((e[_] - n.bInfo.minimum.x * S) * w), G = Math.floor((e[g] - n.bInfo.minimum.y * S) * L), z = Math.floor((e[m] - n.bInfo.minimum.z * S) * F), W = Math.floor((e[v] - n.bInfo.minimum.x * S) * w), X = Math.floor((e[y] - n.bInfo.minimum.y * S) * L), H = Math.floor((e[T] - n.bInfo.minimum.z * S) * F), j = Math.floor((e[E] - n.bInfo.minimum.x * S) * w), Y = Math.floor((e[A] - n.bInfo.minimum.y * S) * L), K = Math.floor((e[M] - n.bInfo.minimum.z * S) * F), Z = V + n.subDiv.max * G + N * z, Q = W + n.subDiv.max * X + N * H, J = j + n.subDiv.max * Y + N * K, q = U + n.subDiv.max * B + N * k, n.facetPartitioning[q] = n.facetPartitioning[q] ? n.facetPartitioning[q] : new Array, n.facetPartitioning[Z] = n.facetPartitioning[Z] ? n.facetPartitioning[Z] : new Array, n.facetPartitioning[Q] = n.facetPartitioning[Q] ? n.facetPartitioning[Q] : new Array, n.facetPartitioning[J] = n.facetPartitioning[J] ? n.facetPartitioning[J] : new Array, n.facetPartitioning[Z].push(r), Q != Z && n.facetPartitioning[Q].push(r), J != Q && J != Z && n.facetPartitioning[J].push(r), q != Z && q != Q && q != J && n.facetPartitioning[q].push(r)), I && n && n.facetPositions) {
                        var te = D[r];
                        te.ind = 3 * r, te.sqDistance = b.DistanceSquared(n.facetPositions[r], O)
                    }
                    i[_] += c, i[g] += d, i[m] += f, i[v] += c, i[y] += d, i[T] += f, i[E] += c, i[A] += d, i[M] += f
                }
                for (r = 0; r < i.length / 3; r++) c = i[3 * r], d = i[3 * r + 1], f = i[3 * r + 2], c /= p = 0 === (p = Math.sqrt(c * c + d * d + f * f)) ? 1 : p, d /= p, f /= p, i[3 * r] = c, i[3 * r + 1] = d, i[3 * r + 2] = f
            }, e._ComputeSides = function(t, i, n, r, o, s, a) {
                var u, h, l = n.length,
                    c = r.length;
                switch (t = t || e.DEFAULTSIDE) {
                    case e.FRONTSIDE:
                        break;
                    case e.BACKSIDE:
                        var d;
                        for (u = 0; u < l; u += 3) d = n[u], n[u] = n[u + 2], n[u + 2] = d;
                        for (h = 0; h < c; h++) r[h] = -r[h];
                        break;
                    case e.DOUBLESIDE:
                        for (var f = i.length, p = f / 3, _ = 0; _ < f; _++) i[f + _] = i[_];
                        for (u = 0; u < l; u += 3) n[u + l] = n[u + 2] + p, n[u + 1 + l] = n[u + 1] + p, n[u + 2 + l] = n[u] + p;
                        for (h = 0; h < c; h++) r[c + h] = -r[h];
                        var g = o.length,
                            m = 0;
                        for (m = 0; m < g; m++) o[m + g] = o[m];
                        for (s = s || new E(0, 0, 1, 1), a = a || new E(0, 0, 1, 1), m = 0, u = 0; u < g / 2; u++) o[m] = s.x + (s.z - s.x) * o[m], o[m + 1] = s.y + (s.w - s.y) * o[m + 1], o[m + g] = a.x + (a.z - a.x) * o[m + g], o[m + g + 1] = a.y + (a.w - a.y) * o[m + g + 1], m += 2
                }
            }, e.ImportVertexData = function(t, i) {
                var n = new e,
                    r = t.positions;
                r && n.set(r, Te.PositionKind);
                var o = t.normals;
                o && n.set(o, Te.NormalKind);
                var s = t.tangents;
                s && n.set(s, Te.TangentKind);
                var a = t.uvs;
                a && n.set(a, Te.UVKind);
                var u = t.uv2s;
                u && n.set(u, Te.UV2Kind);
                var h = t.uv3s;
                h && n.set(h, Te.UV3Kind);
                var l = t.uv4s;
                l && n.set(l, Te.UV4Kind);
                var c = t.uv5s;
                c && n.set(c, Te.UV5Kind);
                var d = t.uv6s;
                d && n.set(d, Te.UV6Kind);
                var f = t.colors;
                f && n.set(y.CheckColors4(f, r.length / 3), Te.ColorKind);
                var p = t.matricesIndices;
                p && n.set(p, Te.MatricesIndicesKind);
                var _ = t.matricesWeights;
                _ && n.set(_, Te.MatricesWeightsKind);
                var g = t.indices;
                g && (n.indices = g), i.setAllVerticesData(n, t.updatable)
            }, e.FRONTSIDE = 0, e.BACKSIDE = 1, e.DOUBLESIDE = 2, e.DEFAULTSIDE = 0, e
        }(),
        Ke = function() {
            function e() {
                this._pickingUnavailable = !1, this.hit = !1, this.distance = 0, this.pickedPoint = null, this.pickedMesh = null, this.bu = 0, this.bv = 0, this.faceId = -1, this.subMeshId = 0, this.pickedSprite = null, this.originMesh = null, this.ray = null
            }
            return e.prototype.getNormal = function(e, t) {
                if (void 0 === e && (e = !1), void 0 === t && (t = !0), !this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(Te.NormalKind)) return null;
                var i, n = this.pickedMesh.getIndices();
                if (!n) return null;
                if (t) {
                    var r = this.pickedMesh.getVerticesData(Te.NormalKind),
                        o = b.FromArray(r, 3 * n[3 * this.faceId]),
                        s = b.FromArray(r, 3 * n[3 * this.faceId + 1]),
                        a = b.FromArray(r, 3 * n[3 * this.faceId + 2]);
                    o = o.scale(this.bu), s = s.scale(this.bv), a = a.scale(1 - this.bu - this.bv), i = new b(o.x + s.x + a.x, o.y + s.y + a.y, o.z + s.z + a.z)
                } else {
                    var u = this.pickedMesh.getVerticesData(Te.PositionKind),
                        h = b.FromArray(u, 3 * n[3 * this.faceId]),
                        l = b.FromArray(u, 3 * n[3 * this.faceId + 1]),
                        c = b.FromArray(u, 3 * n[3 * this.faceId + 2]),
                        d = h.subtract(l),
                        f = c.subtract(l);
                    i = b.Cross(d, f)
                }
                if (e) {
                    var p = this.pickedMesh.getWorldMatrix();
                    this.pickedMesh.nonUniformScaling && (N.Matrix[0].copyFrom(p), (p = N.Matrix[0]).setTranslationFromFloats(0, 0, 0), p.invert(), p.transposeToRef(N.Matrix[1]), p = N.Matrix[1]), i = b.TransformNormal(i, p)
                }
                return i.normalize(), i
            }, e.prototype.getTextureCoordinates = function() {
                if (!this.pickedMesh || !this.pickedMesh.isVerticesDataPresent(Te.UVKind)) return null;
                var e = this.pickedMesh.getIndices();
                if (!e) return null;
                var t = this.pickedMesh.getVerticesData(Te.UVKind);
                if (!t) return null;
                var i = T.FromArray(t, 2 * e[3 * this.faceId]),
                    n = T.FromArray(t, 2 * e[3 * this.faceId + 1]),
                    r = T.FromArray(t, 2 * e[3 * this.faceId + 2]);
                return i = i.scale(1 - this.bu - this.bv), n = n.scale(this.bu), r = r.scale(this.bv), new T(i.x + n.x + r.x, i.y + n.y + r.y)
            }, e
        }(),
        qe = function() {
            this._checkCollisions = !1, this._collisionMask = -1, this._collisionGroup = -1, this._collider = null, this._oldPositionForCollisions = new b(0, 0, 0), this._diffPositionForCollisions = new b(0, 0, 0)
        },
        Ze = function() {
            this.facetNb = 0, this.partitioningSubdivisions = 10, this.partitioningBBoxRatio = 1.01, this.facetDataEnabled = !1, this.facetParameters = {}, this.bbSize = b.Zero(), this.subDiv = {
                max: 1,
                X: 1,
                Y: 1,
                Z: 1
            }, this.facetDepthSort = !1, this.facetDepthSortEnabled = !1
        },
        Qe = function() {
            this._hasVertexAlpha = !1, this._useVertexColors = !0, this._numBoneInfluencers = 4, this._applyFog = !0, this._receiveShadows = !1, this._facetData = new Ze, this._visibility = 1, this._skeleton = null, this._layerMask = 268435455, this._computeBonesUsingShaders = !0, this._isActive = !1, this._onlyForInstances = !1, this._isActiveIntermediate = !1, this._onlyForInstancesIntermediate = !1
        },
        Je = function(e) {
            function t(i, n) {
                void 0 === n && (n = null);
                var r = e.call(this, i, n, !1) || this;
                return r._internalAbstractMeshDataInfo = new Qe, r.cullingStrategy = t.CULLINGSTRATEGY_STANDARD, r.onCollideObservable = new l, r.onCollisionPositionChangeObservable = new l, r.onMaterialChangedObservable = new l, r.definedFacingForward = !0, r._occlusionQuery = null, r._renderingGroup = null, r.alphaIndex = Number.MAX_VALUE, r.isVisible = !0, r.isPickable = !0, r.showSubMeshesBoundingBox = !1, r.isBlocker = !1, r.enablePointerMoveEvents = !1, r.renderingGroupId = 0, r._material = null, r.outlineColor = v.Red(), r.outlineWidth = .02, r.overlayColor = v.Red(), r.overlayAlpha = .5, r.useOctreeForRenderingSelection = !0, r.useOctreeForPicking = !0, r.useOctreeForCollisions = !0, r.alwaysSelectAsActiveMesh = !1, r.doNotSyncBoundingInfo = !1, r.actionManager = null, r._meshCollisionData = new qe, r.ellipsoid = new b(.5, 1, .5), r.ellipsoidOffset = new b(0, 0, 0), r.edgesWidth = 1, r.edgesColor = new y(1, 0, 0, 1), r._edgesRenderer = null, r._masterMesh = null, r._boundingInfo = null, r._renderId = 0, r._intersectionsInProgress = new Array, r._unIndexed = !1, r._lightSources = new Array, r._waitingData = {
                    lods: null,
                    actions: null,
                    freezeWorldMatrix: null
                }, r._bonesTransformMatrices = null, r.onRebuildObservable = new l, r._onCollisionPositionChange = function(e, t, i) {
                    void 0 === i && (i = null), t.subtractToRef(r._meshCollisionData._oldPositionForCollisions, r._meshCollisionData._diffPositionForCollisions), r._meshCollisionData._diffPositionForCollisions.length() > ze.CollisionsEpsilon && r.position.addInPlace(r._meshCollisionData._diffPositionForCollisions), i && r.onCollideObservable.notifyObservers(i), r.onCollisionPositionChangeObservable.notifyObservers(r.position)
                }, r.getScene().addMesh(r), r._resyncLightSources(), r
            }
            return r(t, e), Object.defineProperty(t, "BILLBOARDMODE_NONE", {
                get: function() {
                    return je.BILLBOARDMODE_NONE
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "BILLBOARDMODE_X", {
                get: function() {
                    return je.BILLBOARDMODE_X
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "BILLBOARDMODE_Y", {
                get: function() {
                    return je.BILLBOARDMODE_Y
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "BILLBOARDMODE_Z", {
                get: function() {
                    return je.BILLBOARDMODE_Z
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "BILLBOARDMODE_ALL", {
                get: function() {
                    return je.BILLBOARDMODE_ALL
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "facetNb", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._facetData.facetNb
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "partitioningSubdivisions", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "partitioningBBoxRatio", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "mustDepthSortFacets", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._facetData.facetDepthSort
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._facetData.facetDepthSort = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "facetDepthSortFrom", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "isFacetDataEnabled", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._updateNonUniformScalingState = function(t) {
                return !!e.prototype._updateNonUniformScalingState.call(this, t) && (this._markSubMeshesAsMiscDirty(), !0)
            }, Object.defineProperty(t.prototype, "onCollide", {
                set: function(e) {
                    this._meshCollisionData._onCollideObserver && this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver), this._meshCollisionData._onCollideObserver = this.onCollideObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "onCollisionPositionChange", {
                set: function(e) {
                    this._meshCollisionData._onCollisionPositionChangeObserver && this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver), this._meshCollisionData._onCollisionPositionChangeObserver = this.onCollisionPositionChangeObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "visibility", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._visibility
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._visibility !== e && (this._internalAbstractMeshDataInfo._visibility = e, this._markSubMeshesAsMiscDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "material", {
                get: function() {
                    return this._material
                },
                set: function(e) {
                    this._material !== e && (this._material && this._material.meshMap && (this._material.meshMap[this.uniqueId] = void 0), this._material = e, e && e.meshMap && (e.meshMap[this.uniqueId] = this), this.onMaterialChangedObservable.hasObservers && this.onMaterialChangedObservable.notifyObservers(this), this.subMeshes && this._unBindEffect())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "receiveShadows", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._receiveShadows
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._receiveShadows !== e && (this._internalAbstractMeshDataInfo._receiveShadows = e, this._markSubMeshesAsLightDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "hasVertexAlpha", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._hasVertexAlpha
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._hasVertexAlpha !== e && (this._internalAbstractMeshDataInfo._hasVertexAlpha = e, this._markSubMeshesAsAttributesDirty(), this._markSubMeshesAsMiscDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "useVertexColors", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._useVertexColors
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._useVertexColors !== e && (this._internalAbstractMeshDataInfo._useVertexColors = e, this._markSubMeshesAsAttributesDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "computeBonesUsingShaders", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._computeBonesUsingShaders
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._computeBonesUsingShaders !== e && (this._internalAbstractMeshDataInfo._computeBonesUsingShaders = e, this._markSubMeshesAsAttributesDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "numBoneInfluencers", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._numBoneInfluencers
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._numBoneInfluencers !== e && (this._internalAbstractMeshDataInfo._numBoneInfluencers = e, this._markSubMeshesAsAttributesDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "applyFog", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._applyFog
                },
                set: function(e) {
                    this._internalAbstractMeshDataInfo._applyFog !== e && (this._internalAbstractMeshDataInfo._applyFog = e, this._markSubMeshesAsMiscDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "layerMask", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._layerMask
                },
                set: function(e) {
                    e !== this._internalAbstractMeshDataInfo._layerMask && (this._internalAbstractMeshDataInfo._layerMask = e, this._resyncLightSources())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "collisionMask", {
                get: function() {
                    return this._meshCollisionData._collisionMask
                },
                set: function(e) {
                    this._meshCollisionData._collisionMask = isNaN(e) ? -1 : e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "collisionGroup", {
                get: function() {
                    return this._meshCollisionData._collisionGroup
                },
                set: function(e) {
                    this._meshCollisionData._collisionGroup = isNaN(e) ? -1 : e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "lightSources", {
                get: function() {
                    return this._lightSources
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "_positions", {
                get: function() {
                    return null
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "skeleton", {
                get: function() {
                    return this._internalAbstractMeshDataInfo._skeleton
                },
                set: function(e) {
                    var t = this._internalAbstractMeshDataInfo._skeleton;
                    t && t.needInitialSkinMatrix && t._unregisterMeshWithPoseMatrix(this), e && e.needInitialSkinMatrix && e._registerMeshWithPoseMatrix(this), this._internalAbstractMeshDataInfo._skeleton = e, this._internalAbstractMeshDataInfo._skeleton || (this._bonesTransformMatrices = null), this._markSubMeshesAsAttributesDirty()
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getClassName = function() {
                return "AbstractMesh"
            }, t.prototype.toString = function(e) {
                var t = "Name: " + this.name + ", isInstance: " + ("InstancedMesh" !== this.getClassName() ? "YES" : "NO");
                t += ", # of submeshes: " + (this.subMeshes ? this.subMeshes.length : 0);
                var i = this._internalAbstractMeshDataInfo._skeleton;
                return i && (t += ", skeleton: " + i.name), e && (t += ", billboard mode: " + ["NONE", "X", "Y", null, "Z", null, null, "ALL"][this.billboardMode], t += ", freeze wrld mat: " + (this._isWorldMatrixFrozen || this._waitingData.freezeWorldMatrix ? "YES" : "NO")), t
            }, t.prototype._getEffectiveParent = function() {
                return this._masterMesh && this.billboardMode !== je.BILLBOARDMODE_NONE ? this._masterMesh : e.prototype._getEffectiveParent.call(this)
            }, t.prototype._getActionManagerForTrigger = function(e, t) {
                if (void 0 === t && (t = !0), this.actionManager && (t || this.actionManager.isRecursive)) {
                    if (!e) return this.actionManager;
                    if (this.actionManager.hasSpecificTrigger(e)) return this.actionManager
                }
                return this.parent ? this.parent._getActionManagerForTrigger(e, !1) : null
            }, t.prototype._rebuild = function() {
                if (this.onRebuildObservable.notifyObservers(this), this._occlusionQuery && (this._occlusionQuery = null), this.subMeshes)
                    for (var e = 0, t = this.subMeshes; e < t.length; e++) {
                        t[e]._rebuild()
                    }
            }, t.prototype._resyncLightSources = function() {
                this._lightSources.length = 0;
                for (var e = 0, t = this.getScene().lights; e < t.length; e++) {
                    var i = t[e];
                    i.isEnabled() && (i.canAffectMesh(this) && this._lightSources.push(i))
                }
                this._markSubMeshesAsLightDirty()
            }, t.prototype._resyncLighSource = function(e) {
                var t = e.isEnabled() && e.canAffectMesh(this),
                    i = this._lightSources.indexOf(e);
                if (-1 === i) {
                    if (!t) return;
                    this._lightSources.push(e)
                } else {
                    if (t) return;
                    this._lightSources.splice(i, 1)
                }
                this._markSubMeshesAsLightDirty()
            }, t.prototype._unBindEffect = function() {
                for (var e = 0, t = this.subMeshes; e < t.length; e++) {
                    t[e].setEffect(null)
                }
            }, t.prototype._removeLightSource = function(e) {
                var t = this._lightSources.indexOf(e); - 1 !== t && (this._lightSources.splice(t, 1), this._markSubMeshesAsLightDirty())
            }, t.prototype._markSubMeshesAsDirty = function(e) {
                if (this.subMeshes)
                    for (var t = 0, i = this.subMeshes; t < i.length; t++) {
                        var n = i[t];
                        n._materialDefines && e(n._materialDefines)
                    }
            }, t.prototype._markSubMeshesAsLightDirty = function() {
                this._markSubMeshesAsDirty((function(e) {
                    return e.markAsLightDirty()
                }))
            }, t.prototype._markSubMeshesAsAttributesDirty = function() {
                this._markSubMeshesAsDirty((function(e) {
                    return e.markAsAttributesDirty()
                }))
            }, t.prototype._markSubMeshesAsMiscDirty = function() {
                if (this.subMeshes)
                    for (var e = 0, t = this.subMeshes; e < t.length; e++) {
                        var i = t[e].getMaterial();
                        i && i.markAsDirty(k.MATERIAL_MiscDirtyFlag)
                    }
            }, Object.defineProperty(t.prototype, "scaling", {
                get: function() {
                    return this._scaling
                },
                set: function(e) {
                    this._scaling = e, this.physicsImpostor && this.physicsImpostor.forceUpdate()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "isBlocked", {
                get: function() {
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getLOD = function(e) {
                return this
            }, t.prototype.getTotalVertices = function() {
                return 0
            }, t.prototype.getTotalIndices = function() {
                return 0
            }, t.prototype.getIndices = function() {
                return null
            }, t.prototype.getVerticesData = function(e) {
                return null
            }, t.prototype.setVerticesData = function(e, t, i, n) {
                return this
            }, t.prototype.updateVerticesData = function(e, t, i, n) {
                return this
            }, t.prototype.setIndices = function(e, t) {
                return this
            }, t.prototype.isVerticesDataPresent = function(e) {
                return !1
            }, t.prototype.getBoundingInfo = function() {
                return this._masterMesh ? this._masterMesh.getBoundingInfo() : (this._boundingInfo || this._updateBoundingInfo(), this._boundingInfo)
            }, t.prototype.normalizeToUnitCube = function(e, t) {
                void 0 === e && (e = !0), void 0 === t && (t = !1);
                var i = null,
                    n = null;
                t && (this.rotationQuaternion ? (n = this.rotationQuaternion.clone(), this.rotationQuaternion.copyFromFloats(0, 0, 0, 1)) : this.rotation && (i = this.rotation.clone(), this.rotation.copyFromFloats(0, 0, 0)));
                var r = this.getHierarchyBoundingVectors(e),
                    o = r.max.subtract(r.min),
                    s = Math.max(o.x, o.y, o.z);
                if (0 === s) return this;
                var a = 1 / s;
                return this.scaling.scaleInPlace(a), t && (this.rotationQuaternion && n ? this.rotationQuaternion.copyFrom(n) : this.rotation && i && this.rotation.copyFrom(i)), this
            }, t.prototype.setBoundingInfo = function(e) {
                return this._boundingInfo = e, this
            }, Object.defineProperty(t.prototype, "useBones", {
                get: function() {
                    return this.skeleton && this.getScene().skeletonsEnabled && this.isVerticesDataPresent(Te.MatricesIndicesKind) && this.isVerticesDataPresent(Te.MatricesWeightsKind)
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._preActivate = function() {}, t.prototype._preActivateForIntermediateRendering = function(e) {}, t.prototype._activate = function(e, t) {
                return this._renderId = e, !0
            }, t.prototype._postActivate = function() {}, t.prototype._freeze = function() {}, t.prototype._unFreeze = function() {}, t.prototype.getWorldMatrix = function() {
                return this._masterMesh && this.billboardMode === je.BILLBOARDMODE_NONE ? this._masterMesh.getWorldMatrix() : e.prototype.getWorldMatrix.call(this)
            }, t.prototype._getWorldMatrixDeterminant = function() {
                return this._masterMesh ? this._masterMesh._getWorldMatrixDeterminant() : e.prototype._getWorldMatrixDeterminant.call(this)
            }, Object.defineProperty(t.prototype, "isAnInstance", {
                get: function() {
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.movePOV = function(e, t, i) {
                return this.position.addInPlace(this.calcMovePOV(e, t, i)), this
            }, t.prototype.calcMovePOV = function(e, t, i) {
                var n = new R;
                (this.rotationQuaternion ? this.rotationQuaternion : M.RotationYawPitchRoll(this.rotation.y, this.rotation.x, this.rotation.z)).toRotationMatrix(n);
                var r = b.Zero(),
                    o = this.definedFacingForward ? -1 : 1;
                return b.TransformCoordinatesFromFloatsToRef(e * o, t, i * o, n, r), r
            }, t.prototype.rotatePOV = function(e, t, i) {
                return this.rotation.addInPlace(this.calcRotatePOV(e, t, i)), this
            }, t.prototype.calcRotatePOV = function(e, t, i) {
                var n = this.definedFacingForward ? 1 : -1;
                return new b(e * n, t, i * n)
            }, t.prototype.refreshBoundingInfo = function(e) {
                return void 0 === e && (e = !1), this._boundingInfo && this._boundingInfo.isLocked ? this : (this._refreshBoundingInfo(this._getPositionData(e), null), this)
            }, t.prototype._refreshBoundingInfo = function(e, t) {
                if (e) {
                    var i = K.ExtractMinAndMax(e, 0, this.getTotalVertices(), t);
                    this._boundingInfo ? this._boundingInfo.reConstruct(i.minimum, i.maximum) : this._boundingInfo = new Ie(i.minimum, i.maximum)
                }
                if (this.subMeshes)
                    for (var n = 0; n < this.subMeshes.length; n++) this.subMeshes[n].refreshBoundingInfo(e);
                this._updateBoundingInfo()
            }, t.prototype._getPositionData = function(e) {
                var t = this.getVerticesData(Te.PositionKind);
                if (t && e && this.skeleton) {
                    t = K.Slice(t), this._generatePointsArray();
                    var i = this.getVerticesData(Te.MatricesIndicesKind),
                        n = this.getVerticesData(Te.MatricesWeightsKind);
                    if (n && i) {
                        var r = this.numBoneInfluencers > 4,
                            o = r ? this.getVerticesData(Te.MatricesIndicesExtraKind) : null,
                            s = r ? this.getVerticesData(Te.MatricesWeightsExtraKind) : null;
                        this.skeleton.prepare();
                        for (var a = this.skeleton.getTransformMatrices(this), u = N.Vector3[0], h = N.Matrix[0], l = N.Matrix[1], c = 0, d = 0; d < t.length; d += 3, c += 4) {
                            var f, p;
                            for (h.reset(), f = 0; f < 4; f++)(p = n[c + f]) > 0 && (R.FromFloat32ArrayToRefScaled(a, Math.floor(16 * i[c + f]), p, l), h.addToSelf(l));
                            if (r)
                                for (f = 0; f < 4; f++)(p = s[c + f]) > 0 && (R.FromFloat32ArrayToRefScaled(a, Math.floor(16 * o[c + f]), p, l), h.addToSelf(l));
                            b.TransformCoordinatesFromFloatsToRef(t[d], t[d + 1], t[d + 2], h, u), u.toArray(t, d), this._positions && this._positions[d / 3].copyFrom(u)
                        }
                    }
                }
                return t
            }, t.prototype._updateBoundingInfo = function() {
                var e = this._effectiveMesh;
                return this._boundingInfo ? this._boundingInfo.update(e.worldMatrixFromCache) : this._boundingInfo = new Ie(this.absolutePosition, this.absolutePosition, e.worldMatrixFromCache), this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache), this
            }, t.prototype._updateSubMeshesBoundingInfo = function(e) {
                if (!this.subMeshes) return this;
                for (var t = this.subMeshes.length, i = 0; i < t; i++) {
                    var n = this.subMeshes[i];
                    (t > 1 || !n.IsGlobal) && n.updateBoundingInfo(e)
                }
                return this
            }, t.prototype._afterComputeWorldMatrix = function() {
                this.doNotSyncBoundingInfo || this._updateBoundingInfo()
            }, Object.defineProperty(t.prototype, "_effectiveMesh", {
                get: function() {
                    return this.skeleton && this.skeleton.overrideMesh || this
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.isInFrustum = function(e) {
                return null !== this._boundingInfo && this._boundingInfo.isInFrustum(e, this.cullingStrategy)
            }, t.prototype.isCompletelyInFrustum = function(e) {
                return null !== this._boundingInfo && this._boundingInfo.isCompletelyInFrustum(e)
            }, t.prototype.intersectsMesh = function(e, t, i) {
                if (void 0 === t && (t = !1), !this._boundingInfo || !e._boundingInfo) return !1;
                if (this._boundingInfo.intersects(e._boundingInfo, t)) return !0;
                if (i)
                    for (var n = 0, r = this.getChildMeshes(); n < r.length; n++) {
                        if (r[n].intersectsMesh(e, t, !0)) return !0
                    }
                return !1
            }, t.prototype.intersectsPoint = function(e) {
                return !!this._boundingInfo && this._boundingInfo.intersectsPoint(e)
            }, Object.defineProperty(t.prototype, "checkCollisions", {
                get: function() {
                    return this._meshCollisionData._checkCollisions
                },
                set: function(e) {
                    this._meshCollisionData._checkCollisions = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "collider", {
                get: function() {
                    return this._meshCollisionData._collider
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.moveWithCollisions = function(e) {
                this.getAbsolutePosition().addToRef(this.ellipsoidOffset, this._meshCollisionData._oldPositionForCollisions);
                var t = this.getScene().collisionCoordinator;
                return this._meshCollisionData._collider || (this._meshCollisionData._collider = t.createCollider()), this._meshCollisionData._collider._radius = this.ellipsoid, t.getNewPosition(this._meshCollisionData._oldPositionForCollisions, e, this._meshCollisionData._collider, 3, this, this._onCollisionPositionChange, this.uniqueId), this
            }, t.prototype._collideForSubMesh = function(e, t, i) {
                if (this._generatePointsArray(), !this._positions) return this;
                if (!e._lastColliderWorldVertices || !e._lastColliderTransformMatrix.equals(t)) {
                    e._lastColliderTransformMatrix = t.clone(), e._lastColliderWorldVertices = [], e._trianglePlanes = [];
                    for (var n = e.verticesStart, r = e.verticesStart + e.verticesCount, o = n; o < r; o++) e._lastColliderWorldVertices.push(b.TransformCoordinates(this._positions[o], t))
                }
                return i._collide(e._trianglePlanes, e._lastColliderWorldVertices, this.getIndices(), e.indexStart, e.indexStart + e.indexCount, e.verticesStart, !!e.getMaterial()), i.collisionFound && (i.collidedMesh = this), this
            }, t.prototype._processCollisionsForSubMeshes = function(e, t) {
                for (var i = this._scene.getCollidingSubMeshCandidates(this, e), n = i.length, r = 0; r < n; r++) {
                    var o = i.data[r];
                    n > 1 && !o._checkCollision(e) || this._collideForSubMesh(o, t, e)
                }
                return this
            }, t.prototype._checkCollision = function(e) {
                if (!this._boundingInfo || !this._boundingInfo._checkCollision(e)) return this;
                var t = N.Matrix[0],
                    i = N.Matrix[1];
                return R.ScalingToRef(1 / e._radius.x, 1 / e._radius.y, 1 / e._radius.z, t), this.worldMatrixFromCache.multiplyToRef(t, i), this._processCollisionsForSubMeshes(e, i), this
            }, t.prototype._generatePointsArray = function() {
                return !1
            }, t.prototype.intersects = function(e, t, i) {
                var n = new Ke,
                    r = "InstancedLinesMesh" === this.getClassName() || "LinesMesh" === this.getClassName() ? this.intersectionThreshold : 0,
                    o = this._boundingInfo;
                if (!(this.subMeshes && o && e.intersectsSphere(o.boundingSphere, r) && e.intersectsBox(o.boundingBox, r))) return n;
                if (!this._generatePointsArray()) return n;
                for (var s = null, a = this._scene.getIntersectingSubMeshCandidates(this, e), u = a.length, h = 0; h < u; h++) {
                    var l = a.data[h];
                    if (!(u > 1) || l.canIntersects(e)) {
                        var c = l.intersects(e, this._positions, this.getIndices(), t, i);
                        if (c && (t || !s || c.distance < s.distance) && ((s = c).subMeshId = h, t)) break
                    }
                }
                if (s) {
                    var d = this.getWorldMatrix(),
                        f = N.Vector3[0],
                        p = N.Vector3[1];
                    b.TransformCoordinatesToRef(e.origin, d, f), e.direction.scaleToRef(s.distance, p);
                    var _ = b.TransformNormal(p, d).addInPlace(f);
                    return n.hit = !0, n.distance = b.Distance(f, _), n.pickedPoint = _, n.pickedMesh = this, n.bu = s.bu || 0, n.bv = s.bv || 0, n.faceId = s.faceId, n.subMeshId = s.subMeshId, n
                }
                return n
            }, t.prototype.clone = function(e, t, i) {
                return null
            }, t.prototype.releaseSubMeshes = function() {
                if (this.subMeshes)
                    for (; this.subMeshes.length;) this.subMeshes[0].dispose();
                else this.subMeshes = new Array;
                return this
            }, t.prototype.dispose = function(t, i) {
                var n, r = this;
                for (void 0 === i && (i = !1), this.getScene().freeActiveMeshes(), this.getScene().freeRenderingGroups(), void 0 !== this.actionManager && null !== this.actionManager && (this.actionManager.dispose(), this.actionManager = null), this._internalAbstractMeshDataInfo._skeleton = null, n = 0; n < this._intersectionsInProgress.length; n++) {
                    var o = this._intersectionsInProgress[n],
                        s = o._intersectionsInProgress.indexOf(this);
                    o._intersectionsInProgress.splice(s, 1)
                }
                this._intersectionsInProgress = [], this.getScene().lights.forEach((function(e) {
                    var t = e.includedOnlyMeshes.indexOf(r); - 1 !== t && e.includedOnlyMeshes.splice(t, 1), -1 !== (t = e.excludedMeshes.indexOf(r)) && e.excludedMeshes.splice(t, 1);
                    var i = e.getShadowGenerator();
                    if (i) {
                        var n = i.getShadowMap();
                        n && n.renderList && -1 !== (t = n.renderList.indexOf(r)) && n.renderList.splice(t, 1)
                    }
                })), "InstancedMesh" === this.getClassName() && "InstancedLinesMesh" === this.getClassName() || this.releaseSubMeshes();
                var a = this.getScene().getEngine();
                if (this._occlusionQuery && (this.isOcclusionQueryInProgress = !1, a.deleteQuery(this._occlusionQuery), this._occlusionQuery = null), a.wipeCaches(), this.getScene().removeMesh(this), i && this.material && ("MultiMaterial" === this.material.getClassName() ? this.material.dispose(!1, !0, !0) : this.material.dispose(!1, !0)), !t)
                    for (n = 0; n < this.getScene().particleSystems.length; n++) this.getScene().particleSystems[n].emitter === this && (this.getScene().particleSystems[n].dispose(), n--);
                this._internalAbstractMeshDataInfo._facetData.facetDataEnabled && this.disableFacetData(), this.onAfterWorldMatrixUpdateObservable.clear(), this.onCollideObservable.clear(), this.onCollisionPositionChangeObservable.clear(), this.onRebuildObservable.clear(), e.prototype.dispose.call(this, t, i)
            }, t.prototype.addChild = function(e) {
                return e.setParent(this), this
            }, t.prototype.removeChild = function(e) {
                return e.setParent(null), this
            }, t.prototype._initFacetData = function() {
                var e = this._internalAbstractMeshDataInfo._facetData;
                e.facetNormals || (e.facetNormals = new Array), e.facetPositions || (e.facetPositions = new Array), e.facetPartitioning || (e.facetPartitioning = new Array), e.facetNb = this.getIndices().length / 3 | 0, e.partitioningSubdivisions = e.partitioningSubdivisions ? e.partitioningSubdivisions : 10, e.partitioningBBoxRatio = e.partitioningBBoxRatio ? e.partitioningBBoxRatio : 1.01;
                for (var t = 0; t < e.facetNb; t++) e.facetNormals[t] = b.Zero(), e.facetPositions[t] = b.Zero();
                return e.facetDataEnabled = !0, this
            }, t.prototype.updateFacetData = function() {
                var e = this._internalAbstractMeshDataInfo._facetData;
                e.facetDataEnabled || this._initFacetData();
                var t = this.getVerticesData(Te.PositionKind),
                    i = this.getIndices(),
                    n = this.getVerticesData(Te.NormalKind),
                    r = this.getBoundingInfo();
                if (e.facetDepthSort && !e.facetDepthSortEnabled) {
                    if (e.facetDepthSortEnabled = !0, i instanceof Uint16Array) e.depthSortedIndices = new Uint16Array(i);
                    else if (i instanceof Uint32Array) e.depthSortedIndices = new Uint32Array(i);
                    else {
                        for (var o = !1, s = 0; s < i.length; s++)
                            if (i[s] > 65535) {
                                o = !0;
                                break
                            }
                        e.depthSortedIndices = o ? new Uint32Array(i) : new Uint16Array(i)
                    }
                    if (e.facetDepthSortFunction = function(e, t) {
                            return t.sqDistance - e.sqDistance
                        }, !e.facetDepthSortFrom) {
                        var a = this.getScene().activeCamera;
                        e.facetDepthSortFrom = a ? a.position : b.Zero()
                    }
                    e.depthSortedFacets = [];
                    for (var u = 0; u < e.facetNb; u++) {
                        var h = {
                            ind: 3 * u,
                            sqDistance: 0
                        };
                        e.depthSortedFacets.push(h)
                    }
                    e.invertedMatrix = R.Identity(), e.facetDepthSortOrigin = b.Zero()
                }
                e.bbSize.x = r.maximum.x - r.minimum.x > .001 ? r.maximum.x - r.minimum.x : .001, e.bbSize.y = r.maximum.y - r.minimum.y > .001 ? r.maximum.y - r.minimum.y : .001, e.bbSize.z = r.maximum.z - r.minimum.z > .001 ? r.maximum.z - r.minimum.z : .001;
                var l = e.bbSize.x > e.bbSize.y ? e.bbSize.x : e.bbSize.y;
                if (l = l > e.bbSize.z ? l : e.bbSize.z, e.subDiv.max = e.partitioningSubdivisions, e.subDiv.X = Math.floor(e.subDiv.max * e.bbSize.x / l), e.subDiv.Y = Math.floor(e.subDiv.max * e.bbSize.y / l), e.subDiv.Z = Math.floor(e.subDiv.max * e.bbSize.z / l), e.subDiv.X = e.subDiv.X < 1 ? 1 : e.subDiv.X, e.subDiv.Y = e.subDiv.Y < 1 ? 1 : e.subDiv.Y, e.subDiv.Z = e.subDiv.Z < 1 ? 1 : e.subDiv.Z, e.facetParameters.facetNormals = this.getFacetLocalNormals(), e.facetParameters.facetPositions = this.getFacetLocalPositions(), e.facetParameters.facetPartitioning = this.getFacetLocalPartitioning(), e.facetParameters.bInfo = r, e.facetParameters.bbSize = e.bbSize, e.facetParameters.subDiv = e.subDiv, e.facetParameters.ratio = this.partitioningBBoxRatio, e.facetParameters.depthSort = e.facetDepthSort, e.facetDepthSort && e.facetDepthSortEnabled && (this.computeWorldMatrix(!0), this._worldMatrix.invertToRef(e.invertedMatrix), b.TransformCoordinatesToRef(e.facetDepthSortFrom, e.invertedMatrix, e.facetDepthSortOrigin), e.facetParameters.distanceTo = e.facetDepthSortOrigin), e.facetParameters.depthSortedFacets = e.depthSortedFacets, Ye.ComputeNormals(t, i, n, e.facetParameters), e.facetDepthSort && e.facetDepthSortEnabled) {
                    e.depthSortedFacets.sort(e.facetDepthSortFunction);
                    var c = e.depthSortedIndices.length / 3 | 0;
                    for (u = 0; u < c; u++) {
                        var d = e.depthSortedFacets[u].ind;
                        e.depthSortedIndices[3 * u] = i[d], e.depthSortedIndices[3 * u + 1] = i[d + 1], e.depthSortedIndices[3 * u + 2] = i[d + 2]
                    }
                    this.updateIndices(e.depthSortedIndices, void 0, !0)
                }
                return this
            }, t.prototype.getFacetLocalNormals = function() {
                var e = this._internalAbstractMeshDataInfo._facetData;
                return e.facetNormals || this.updateFacetData(), e.facetNormals
            }, t.prototype.getFacetLocalPositions = function() {
                var e = this._internalAbstractMeshDataInfo._facetData;
                return e.facetPositions || this.updateFacetData(), e.facetPositions
            }, t.prototype.getFacetLocalPartitioning = function() {
                var e = this._internalAbstractMeshDataInfo._facetData;
                return e.facetPartitioning || this.updateFacetData(), e.facetPartitioning
            }, t.prototype.getFacetPosition = function(e) {
                var t = b.Zero();
                return this.getFacetPositionToRef(e, t), t
            }, t.prototype.getFacetPositionToRef = function(e, t) {
                var i = this.getFacetLocalPositions()[e],
                    n = this.getWorldMatrix();
                return b.TransformCoordinatesToRef(i, n, t), this
            }, t.prototype.getFacetNormal = function(e) {
                var t = b.Zero();
                return this.getFacetNormalToRef(e, t), t
            }, t.prototype.getFacetNormalToRef = function(e, t) {
                var i = this.getFacetLocalNormals()[e];
                return b.TransformNormalToRef(i, this.getWorldMatrix(), t), this
            }, t.prototype.getFacetsAtLocalCoordinates = function(e, t, i) {
                var n = this.getBoundingInfo(),
                    r = this._internalAbstractMeshDataInfo._facetData,
                    o = Math.floor((e - n.minimum.x * r.partitioningBBoxRatio) * r.subDiv.X * r.partitioningBBoxRatio / r.bbSize.x),
                    s = Math.floor((t - n.minimum.y * r.partitioningBBoxRatio) * r.subDiv.Y * r.partitioningBBoxRatio / r.bbSize.y),
                    a = Math.floor((i - n.minimum.z * r.partitioningBBoxRatio) * r.subDiv.Z * r.partitioningBBoxRatio / r.bbSize.z);
                return o < 0 || o > r.subDiv.max || s < 0 || s > r.subDiv.max || a < 0 || a > r.subDiv.max ? null : r.facetPartitioning[o + r.subDiv.max * s + r.subDiv.max * r.subDiv.max * a]
            }, t.prototype.getClosestFacetAtCoordinates = function(e, t, i, n, r, o) {
                void 0 === r && (r = !1), void 0 === o && (o = !0);
                var s = this.getWorldMatrix(),
                    a = N.Matrix[5];
                s.invertToRef(a);
                var u = N.Vector3[8];
                b.TransformCoordinatesFromFloatsToRef(e, t, i, a, u);
                var h = this.getClosestFacetAtLocalCoordinates(u.x, u.y, u.z, n, r, o);
                return n && b.TransformCoordinatesFromFloatsToRef(n.x, n.y, n.z, s, n), h
            }, t.prototype.getClosestFacetAtLocalCoordinates = function(e, t, i, n, r, o) {
                void 0 === r && (r = !1), void 0 === o && (o = !0);
                var s = null,
                    a = 0,
                    u = 0,
                    h = 0,
                    l = 0,
                    c = 0,
                    d = 0,
                    f = 0,
                    p = 0,
                    _ = this.getFacetLocalPositions(),
                    g = this.getFacetLocalNormals(),
                    m = this.getFacetsAtLocalCoordinates(e, t, i);
                if (!m) return null;
                for (var v, y, T, b = Number.MAX_VALUE, E = b, A = 0; A < m.length; A++) y = g[v = m[A]], l = (e - (T = _[v]).x) * y.x + (t - T.y) * y.y + (i - T.z) * y.z, (!r || r && o && l >= 0 || r && !o && l <= 0) && (l = y.x * T.x + y.y * T.y + y.z * T.z, c = -(y.x * e + y.y * t + y.z * i - l) / (y.x * y.x + y.y * y.y + y.z * y.z), (E = (a = (d = e + y.x * c) - e) * a + (u = (f = t + y.y * c) - t) * u + (h = (p = i + y.z * c) - i) * h) < b && (b = E, s = v, n && (n.x = d, n.y = f, n.z = p)));
                return s
            }, t.prototype.getFacetDataParameters = function() {
                return this._internalAbstractMeshDataInfo._facetData.facetParameters
            }, t.prototype.disableFacetData = function() {
                var e = this._internalAbstractMeshDataInfo._facetData;
                return e.facetDataEnabled && (e.facetDataEnabled = !1, e.facetPositions = new Array, e.facetNormals = new Array, e.facetPartitioning = new Array, e.facetParameters = null, e.depthSortedIndices = new Uint32Array(0)), this
            }, t.prototype.updateIndices = function(e, t, i) {
                return void 0 === i && (i = !1), this
            }, t.prototype.createNormals = function(e) {
                var t, i = this.getVerticesData(Te.PositionKind),
                    n = this.getIndices();
                return t = this.isVerticesDataPresent(Te.NormalKind) ? this.getVerticesData(Te.NormalKind) : [], Ye.ComputeNormals(i, n, t, {
                    useRightHandedSystem: this.getScene().useRightHandedSystem
                }), this.setVerticesData(Te.NormalKind, t, e), this
            }, t.prototype.alignWithNormal = function(e, t) {
                t || (t = S.Y);
                var i = N.Vector3[0],
                    n = N.Vector3[1];
                return b.CrossToRef(t, e, n), b.CrossToRef(e, n, i), this.rotationQuaternion ? M.RotationQuaternionFromAxisToRef(i, e, n, this.rotationQuaternion) : b.RotationFromAxisToRef(i, e, n, this.rotation), this
            }, t.prototype._checkOcclusionQuery = function() {
                return !1
            }, t.prototype.disableEdgesRendering = function() {
                throw X.WarnImport("EdgesRenderer")
            }, t.prototype.enableEdgesRendering = function(e, t) {
                throw X.WarnImport("EdgesRenderer")
            }, t.OCCLUSION_TYPE_NONE = 0, t.OCCLUSION_TYPE_OPTIMISTIC = 1, t.OCCLUSION_TYPE_STRICT = 2, t.OCCLUSION_ALGORITHM_TYPE_ACCURATE = 0, t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE = 1, t.CULLINGSTRATEGY_STANDARD = k.MESHES_CULLINGSTRATEGY_STANDARD, t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY = k.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY, t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION = k.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION, t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY = k.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY, t
        }(je),
        $e = function(e) {
            function t(i, n, r, o) {
                void 0 === o && (o = !0);
                var s = e.call(this, i, r) || this;
                return s._position = b.Zero(), s.upVector = b.Up(), s.orthoLeft = null, s.orthoRight = null, s.orthoBottom = null, s.orthoTop = null, s.fov = .8, s.minZ = 1, s.maxZ = 1e4, s.inertia = .9, s.mode = t.PERSPECTIVE_CAMERA, s.isIntermediate = !1, s.viewport = new P(0, 0, 1, 1), s.layerMask = 268435455, s.fovMode = t.FOVMODE_VERTICAL_FIXED, s.cameraRigMode = t.RIG_MODE_NONE, s.customRenderTargets = new Array, s.outputRenderTarget = null, s.onViewMatrixChangedObservable = new l, s.onProjectionMatrixChangedObservable = new l, s.onAfterCheckInputsObservable = new l, s.onRestoreStateObservable = new l, s._rigCameras = new Array, s._webvrViewMatrix = R.Identity(), s._skipRendering = !1, s._projectionMatrix = new R, s._postProcesses = new Array, s._activeMeshes = new We(256), s._globalPosition = b.Zero(), s._computedViewMatrix = R.Identity(), s._doNotComputeProjectionMatrix = !1, s._transformMatrix = R.Zero(), s._refreshFrustumPlanes = !0, s._isCamera = !0, s._isLeftCamera = !1, s._isRightCamera = !0, s.getScene().addCamera(s), o && !s.getScene().activeCamera && (s.getScene().activeCamera = s), s.position = n, s
            }
            return r(t, e), Object.defineProperty(t.prototype, "position", {
                get: function() {
                    return this._position
                },
                set: function(e) {
                    this._position = e
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.storeState = function() {
                return this._stateStored = !0, this._storedFov = this.fov, this
            }, t.prototype._restoreStateValues = function() {
                return !!this._stateStored && (this.fov = this._storedFov, !0)
            }, t.prototype.restoreState = function() {
                return !!this._restoreStateValues() && (this.onRestoreStateObservable.notifyObservers(this), !0)
            }, t.prototype.getClassName = function() {
                return "Camera"
            }, t.prototype.toString = function(e) {
                var t = "Name: " + this.name;
                if (t += ", type: " + this.getClassName(), this.animations)
                    for (var i = 0; i < this.animations.length; i++) t += ", animation[0]: " + this.animations[i].toString(e);
                return t
            }, Object.defineProperty(t.prototype, "globalPosition", {
                get: function() {
                    return this._globalPosition
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getActiveMeshes = function() {
                return this._activeMeshes
            }, t.prototype.isActiveMesh = function(e) {
                return -1 !== this._activeMeshes.indexOf(e)
            }, t.prototype.isReady = function(t) {
                if (void 0 === t && (t = !1), t)
                    for (var i = 0, n = this._postProcesses; i < n.length; i++) {
                        var r = n[i];
                        if (r && !r.isReady()) return !1
                    }
                return e.prototype.isReady.call(this, t)
            }, t.prototype._initCache = function() {
                e.prototype._initCache.call(this), this._cache.position = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.upVector = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.mode = void 0, this._cache.minZ = void 0, this._cache.maxZ = void 0, this._cache.fov = void 0, this._cache.fovMode = void 0, this._cache.aspectRatio = void 0, this._cache.orthoLeft = void 0, this._cache.orthoRight = void 0, this._cache.orthoBottom = void 0, this._cache.orthoTop = void 0, this._cache.renderWidth = void 0, this._cache.renderHeight = void 0
            }, t.prototype._updateCache = function(t) {
                t || e.prototype._updateCache.call(this), this._cache.position.copyFrom(this.position), this._cache.upVector.copyFrom(this.upVector)
            }, t.prototype._isSynchronized = function() {
                return this._isSynchronizedViewMatrix() && this._isSynchronizedProjectionMatrix()
            }, t.prototype._isSynchronizedViewMatrix = function() {
                return !!e.prototype._isSynchronized.call(this) && (this._cache.position.equals(this.position) && this._cache.upVector.equals(this.upVector) && this.isSynchronizedWithParent())
            }, t.prototype._isSynchronizedProjectionMatrix = function() {
                var e = this._cache.mode === this.mode && this._cache.minZ === this.minZ && this._cache.maxZ === this.maxZ;
                if (!e) return !1;
                var i = this.getEngine();
                return e = this.mode === t.PERSPECTIVE_CAMERA ? this._cache.fov === this.fov && this._cache.fovMode === this.fovMode && this._cache.aspectRatio === i.getAspectRatio(this) : this._cache.orthoLeft === this.orthoLeft && this._cache.orthoRight === this.orthoRight && this._cache.orthoBottom === this.orthoBottom && this._cache.orthoTop === this.orthoTop && this._cache.renderWidth === i.getRenderWidth() && this._cache.renderHeight === i.getRenderHeight()
            }, t.prototype.attachControl = function(e, t) {}, t.prototype.detachControl = function(e) {}, t.prototype.update = function() {
                this._checkInputs(), this.cameraRigMode !== t.RIG_MODE_NONE && this._updateRigCameras()
            }, t.prototype._checkInputs = function() {
                this.onAfterCheckInputsObservable.notifyObservers(this)
            }, Object.defineProperty(t.prototype, "rigCameras", {
                get: function() {
                    return this._rigCameras
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "rigPostProcess", {
                get: function() {
                    return this._rigPostProcess
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._getFirstPostProcess = function() {
                for (var e = 0; e < this._postProcesses.length; e++)
                    if (null !== this._postProcesses[e]) return this._postProcesses[e];
                return null
            }, t.prototype._cascadePostProcessesToRigCams = function() {
                var e = this._getFirstPostProcess();
                e && e.markTextureDirty();
                for (var t = 0, i = this._rigCameras.length; t < i; t++) {
                    var n = this._rigCameras[t],
                        r = n._rigPostProcess;
                    if (r) "pass" === r.getEffectName() && (n.isIntermediate = 0 === this._postProcesses.length), n._postProcesses = this._postProcesses.slice(0).concat(r), r.markTextureDirty();
                    else n._postProcesses = this._postProcesses.slice(0)
                }
            }, t.prototype.attachPostProcess = function(e, t) {
                return void 0 === t && (t = null), !e.isReusable() && this._postProcesses.indexOf(e) > -1 ? (V.Error("You're trying to reuse a post process not defined as reusable."), 0) : (null == t || t < 0 ? this._postProcesses.push(e) : null === this._postProcesses[t] ? this._postProcesses[t] = e : this._postProcesses.splice(t, 0, e), this._cascadePostProcessesToRigCams(), this._postProcesses.indexOf(e))
            }, t.prototype.detachPostProcess = function(e) {
                var t = this._postProcesses.indexOf(e); - 1 !== t && (this._postProcesses[t] = null), this._cascadePostProcessesToRigCams()
            }, t.prototype.getWorldMatrix = function() {
                return this._isSynchronizedViewMatrix() ? this._worldMatrix : (this.getViewMatrix(), this._worldMatrix)
            }, t.prototype._getViewMatrix = function() {
                return R.Identity()
            }, t.prototype.getViewMatrix = function(e) {
                return !e && this._isSynchronizedViewMatrix() ? this._computedViewMatrix : (this.updateCache(), this._computedViewMatrix = this._getViewMatrix(), this._currentRenderId = this.getScene().getRenderId(), this._childUpdateId++, this._refreshFrustumPlanes = !0, this._cameraRigParams && this._cameraRigParams.vrPreViewMatrix && this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix, this._computedViewMatrix), this.parent && this.parent.onViewMatrixChangedObservable && this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent), this.onViewMatrixChangedObservable.notifyObservers(this), this._computedViewMatrix.invertToRef(this._worldMatrix), this._computedViewMatrix)
            }, t.prototype.freezeProjectionMatrix = function(e) {
                this._doNotComputeProjectionMatrix = !0, void 0 !== e && (this._projectionMatrix = e)
            }, t.prototype.unfreezeProjectionMatrix = function() {
                this._doNotComputeProjectionMatrix = !1
            }, t.prototype.getProjectionMatrix = function(e) {
                if (this._doNotComputeProjectionMatrix || !e && this._isSynchronizedProjectionMatrix()) return this._projectionMatrix;
                this._cache.mode = this.mode, this._cache.minZ = this.minZ, this._cache.maxZ = this.maxZ, this._refreshFrustumPlanes = !0;
                var i = this.getEngine(),
                    n = this.getScene();
                if (this.mode === t.PERSPECTIVE_CAMERA) this._cache.fov = this.fov, this._cache.fovMode = this.fovMode, this._cache.aspectRatio = i.getAspectRatio(this), this.minZ <= 0 && (this.minZ = .1), n.useRightHandedSystem ? R.PerspectiveFovRHToRef(this.fov, i.getAspectRatio(this), this.minZ, this.maxZ, this._projectionMatrix, this.fovMode === t.FOVMODE_VERTICAL_FIXED) : R.PerspectiveFovLHToRef(this.fov, i.getAspectRatio(this), this.minZ, this.maxZ, this._projectionMatrix, this.fovMode === t.FOVMODE_VERTICAL_FIXED);
                else {
                    var r = i.getRenderWidth() / 2,
                        o = i.getRenderHeight() / 2;
                    n.useRightHandedSystem ? R.OrthoOffCenterRHToRef(this.orthoLeft || -r, this.orthoRight || r, this.orthoBottom || -o, this.orthoTop || o, this.minZ, this.maxZ, this._projectionMatrix) : R.OrthoOffCenterLHToRef(this.orthoLeft || -r, this.orthoRight || r, this.orthoBottom || -o, this.orthoTop || o, this.minZ, this.maxZ, this._projectionMatrix), this._cache.orthoLeft = this.orthoLeft, this._cache.orthoRight = this.orthoRight, this._cache.orthoBottom = this.orthoBottom, this._cache.orthoTop = this.orthoTop, this._cache.renderWidth = i.getRenderWidth(), this._cache.renderHeight = i.getRenderHeight()
                }
                return this.onProjectionMatrixChangedObservable.notifyObservers(this), this._projectionMatrix
            }, t.prototype.getTransformationMatrix = function() {
                return this._computedViewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix), this._transformMatrix
            }, t.prototype._updateFrustumPlanes = function() {
                this._refreshFrustumPlanes && (this.getTransformationMatrix(), this._frustumPlanes ? I.GetPlanesToRef(this._transformMatrix, this._frustumPlanes) : this._frustumPlanes = I.GetPlanes(this._transformMatrix), this._refreshFrustumPlanes = !1)
            }, t.prototype.isInFrustum = function(e, t) {
                if (void 0 === t && (t = !1), this._updateFrustumPlanes(), t && this.rigCameras.length > 0) {
                    var i = !1;
                    return this.rigCameras.forEach((function(t) {
                        t._updateFrustumPlanes(), i = i || e.isInFrustum(t._frustumPlanes)
                    })), i
                }
                return e.isInFrustum(this._frustumPlanes)
            }, t.prototype.isCompletelyInFrustum = function(e) {
                return this._updateFrustumPlanes(), e.isCompletelyInFrustum(this._frustumPlanes)
            }, t.prototype.getForwardRay = function(e, t, i) {
                throw void 0 === e && (e = 100), X.WarnImport("Ray")
            }, t.prototype.dispose = function(i, n) {
                for (void 0 === n && (n = !1), this.onViewMatrixChangedObservable.clear(), this.onProjectionMatrixChangedObservable.clear(), this.onAfterCheckInputsObservable.clear(), this.onRestoreStateObservable.clear(), this.inputs && this.inputs.clear(), this.getScene().stopAnimation(this), this.getScene().removeCamera(this); this._rigCameras.length > 0;) {
                    var r = this._rigCameras.pop();
                    r && r.dispose()
                }
                if (this._rigPostProcess) this._rigPostProcess.dispose(this), this._rigPostProcess = null, this._postProcesses = [];
                else if (this.cameraRigMode !== t.RIG_MODE_NONE) this._rigPostProcess = null, this._postProcesses = [];
                else
                    for (var o = this._postProcesses.length; --o >= 0;) {
                        var s = this._postProcesses[o];
                        s && s.dispose(this)
                    }
                for (o = this.customRenderTargets.length; --o >= 0;) this.customRenderTargets[o].dispose();
                this.customRenderTargets = [], this._activeMeshes.dispose(), e.prototype.dispose.call(this, i, n)
            }, Object.defineProperty(t.prototype, "isLeftCamera", {
                get: function() {
                    return this._isLeftCamera
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "isRightCamera", {
                get: function() {
                    return this._isRightCamera
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "leftCamera", {
                get: function() {
                    return this._rigCameras.length < 1 ? null : this._rigCameras[0]
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "rightCamera", {
                get: function() {
                    return this._rigCameras.length < 2 ? null : this._rigCameras[1]
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getLeftTarget = function() {
                return this._rigCameras.length < 1 ? null : this._rigCameras[0].getTarget()
            }, t.prototype.getRightTarget = function() {
                return this._rigCameras.length < 2 ? null : this._rigCameras[1].getTarget()
            }, t.prototype.setCameraRigMode = function(e, i) {
                if (this.cameraRigMode !== e) {
                    for (; this._rigCameras.length > 0;) {
                        var n = this._rigCameras.pop();
                        n && n.dispose()
                    }
                    if (this.cameraRigMode = e, this._cameraRigParams = {}, this._cameraRigParams.interaxialDistance = i.interaxialDistance || .0637, this._cameraRigParams.stereoHalfAngle = K.ToRadians(this._cameraRigParams.interaxialDistance / .0637), this.cameraRigMode !== t.RIG_MODE_NONE) {
                        var r = this.createRigCamera(this.name + "_L", 0);
                        r && (r._isLeftCamera = !0);
                        var o = this.createRigCamera(this.name + "_R", 1);
                        o && (o._isRightCamera = !0), r && o && (this._rigCameras.push(r), this._rigCameras.push(o))
                    }
                    switch (this.cameraRigMode) {
                        case t.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                            t._setStereoscopicAnaglyphRigMode(this);
                            break;
                        case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                        case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                        case t.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                            t._setStereoscopicRigMode(this);
                            break;
                        case t.RIG_MODE_VR:
                            t._setVRRigMode(this, i);
                            break;
                        case t.RIG_MODE_WEBVR:
                            t._setWebVRRigMode(this, i)
                    }
                    this._cascadePostProcessesToRigCams(), this.update()
                }
            }, t._setStereoscopicRigMode = function(e) {
                throw "Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"
            }, t._setStereoscopicAnaglyphRigMode = function(e) {
                throw "Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"
            }, t._setVRRigMode = function(e, t) {
                throw "Import Cameras/RigModes/vrRigMode before using VR rig mode"
            }, t._setWebVRRigMode = function(e, t) {
                throw "Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"
            }, t.prototype._getVRProjectionMatrix = function() {
                return R.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov, this._cameraRigParams.vrMetrics.aspectRatio, this.minZ, this.maxZ, this._cameraRigParams.vrWorkMatrix), this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix, this._projectionMatrix), this._projectionMatrix
            }, t.prototype._updateCameraRotationMatrix = function() {}, t.prototype._updateWebVRCameraRotationMatrix = function() {}, t.prototype._getWebVRProjectionMatrix = function() {
                return R.Identity()
            }, t.prototype._getWebVRViewMatrix = function() {
                return R.Identity()
            }, t.prototype.setCameraRigParameter = function(e, t) {
                this._cameraRigParams || (this._cameraRigParams = {}), this._cameraRigParams[e] = t, "interaxialDistance" === e && (this._cameraRigParams.stereoHalfAngle = K.ToRadians(t / .0637))
            }, t.prototype.createRigCamera = function(e, t) {
                return null
            }, t.prototype._updateRigCameras = function() {
                for (var e = 0; e < this._rigCameras.length; e++) this._rigCameras[e].minZ = this.minZ, this._rigCameras[e].maxZ = this.maxZ, this._rigCameras[e].fov = this.fov, this._rigCameras[e].upVector.copyFrom(this.upVector);
                this.cameraRigMode === t.RIG_MODE_STEREOSCOPIC_ANAGLYPH && (this._rigCameras[0].viewport = this._rigCameras[1].viewport = this.viewport)
            }, t.prototype._setupInputs = function() {}, t.prototype.serialize = function() {
                var e = me.Serialize(this);
                return e.type = this.getClassName(), this.parent && (e.parentId = this.parent.id), this.inputs && this.inputs.serialize(e), me.AppendSerializedAnimations(this, e), e.ranges = this.serializeAnimationRanges(), e
            }, t.prototype.clone = function(e) {
                return me.Clone(t.GetConstructorFromName(this.getClassName(), e, this.getScene(), this.interaxialDistance, this.isStereoscopicSideBySide), this)
            }, t.prototype.getDirection = function(e) {
                var t = b.Zero();
                return this.getDirectionToRef(e, t), t
            }, t.prototype.getDirectionToRef = function(e, t) {
                b.TransformNormalToRef(e, this.getWorldMatrix(), t)
            }, t.GetConstructorFromName = function(e, i, n, r, o) {
                void 0 === r && (r = 0), void 0 === o && (o = !0);
                var s = He.Construct(e, i, n, {
                    interaxial_distance: r,
                    isStereoscopicSideBySide: o
                });
                return s || function() {
                    return t._createDefaultParsedCamera(i, n)
                }
            }, t.prototype.computeWorldMatrix = function() {
                return this.getWorldMatrix()
            }, t.Parse = function(e, i) {
                var n = e.type,
                    r = t.GetConstructorFromName(n, e.name, i, e.interaxial_distance, e.isStereoscopicSideBySide),
                    o = me.Parse(r, e, i);
                if (e.parentId && (o._waitingParentId = e.parentId), o.inputs && (o.inputs.parse(e), o._setupInputs()), o.setPosition && (o.position.copyFromFloats(0, 0, 0), o.setPosition(b.FromArray(e.position))), e.target && o.setTarget && o.setTarget(b.FromArray(e.target)), e.cameraRigMode) {
                    var s = e.interaxial_distance ? {
                        interaxialDistance: e.interaxial_distance
                    } : {};
                    o.setCameraRigMode(e.cameraRigMode, s)
                }
                if (e.animations) {
                    for (var a = 0; a < e.animations.length; a++) {
                        var u = e.animations[a],
                            h = G.GetClass("BABYLON.Animation");
                        h && o.animations.push(h.Parse(u))
                    }
                    He.ParseAnimationRanges(o, e, i)
                }
                return e.autoAnimate && i.beginAnimation(o, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, e.autoAnimateSpeed || 1), o
            }, t._createDefaultParsedCamera = function(e, t) {
                throw X.WarnImport("UniversalCamera")
            }, t.PERSPECTIVE_CAMERA = 0, t.ORTHOGRAPHIC_CAMERA = 1, t.FOVMODE_VERTICAL_FIXED = 0, t.FOVMODE_HORIZONTAL_FIXED = 1, t.RIG_MODE_NONE = 0, t.RIG_MODE_STEREOSCOPIC_ANAGLYPH = 10, t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL = 11, t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED = 12, t.RIG_MODE_STEREOSCOPIC_OVERUNDER = 13, t.RIG_MODE_VR = 20, t.RIG_MODE_WEBVR = 21, t.RIG_MODE_CUSTOM = 22, t.ForceAttachControlToAlwaysPreventDefault = !1, s([_e("position")], t.prototype, "_position", void 0), s([_e()], t.prototype, "upVector", void 0), s([ce()], t.prototype, "orthoLeft", void 0), s([ce()], t.prototype, "orthoRight", void 0), s([ce()], t.prototype, "orthoBottom", void 0), s([ce()], t.prototype, "orthoTop", void 0), s([ce()], t.prototype, "fov", void 0), s([ce()], t.prototype, "minZ", void 0), s([ce()], t.prototype, "maxZ", void 0), s([ce()], t.prototype, "inertia", void 0), s([ce()], t.prototype, "mode", void 0), s([ce()], t.prototype, "layerMask", void 0), s([ce()], t.prototype, "fovMode", void 0), s([ce()], t.prototype, "cameraRigMode", void 0), s([ce()], t.prototype, "interaxialDistance", void 0), s([ce()], t.prototype, "isStereoscopicSideBySide", void 0), t
        }(He),
        et = function() {
            function e() {
                this.rootNodes = new Array, this.cameras = new Array, this.lights = new Array, this.meshes = new Array, this.skeletons = new Array, this.particleSystems = new Array, this.animations = [], this.animationGroups = new Array, this.multiMaterials = new Array, this.materials = new Array, this.morphTargetManagers = new Array, this.geometries = new Array, this.transformNodes = new Array, this.actionManagers = new Array, this.textures = new Array, this.environmentTexture = null
            }
            return e.AddParser = function(e, t) {
                this._BabylonFileParsers[e] = t
            }, e.GetParser = function(e) {
                return this._BabylonFileParsers[e] ? this._BabylonFileParsers[e] : null
            }, e.AddIndividualParser = function(e, t) {
                this._IndividualBabylonFileParsers[e] = t
            }, e.GetIndividualParser = function(e) {
                return this._IndividualBabylonFileParsers[e] ? this._IndividualBabylonFileParsers[e] : null
            }, e.Parse = function(e, t, i, n) {
                for (var r in this._BabylonFileParsers) this._BabylonFileParsers.hasOwnProperty(r) && this._BabylonFileParsers[r](e, t, i, n)
            }, e._BabylonFileParsers = {}, e._IndividualBabylonFileParsers = {}, e
        }(),
        tt = function() {
            function e() {
                this._isDirty = !0, this._areLightsDirty = !0, this._areAttributesDirty = !0, this._areTexturesDirty = !0, this._areFresnelDirty = !0, this._areMiscDirty = !0, this._areImageProcessingDirty = !0, this._normals = !1, this._uvs = !1, this._needNormals = !1, this._needUVs = !1
            }
            return Object.defineProperty(e.prototype, "isDirty", {
                get: function() {
                    return this._isDirty
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.markAsProcessed = function() {
                this._isDirty = !1, this._areAttributesDirty = !1, this._areTexturesDirty = !1, this._areFresnelDirty = !1, this._areLightsDirty = !1, this._areMiscDirty = !1, this._areImageProcessingDirty = !1
            }, e.prototype.markAsUnprocessed = function() {
                this._isDirty = !0
            }, e.prototype.markAllAsDirty = function() {
                this._areTexturesDirty = !0, this._areAttributesDirty = !0, this._areLightsDirty = !0, this._areFresnelDirty = !0, this._areMiscDirty = !0, this._areImageProcessingDirty = !0, this._isDirty = !0
            }, e.prototype.markAsImageProcessingDirty = function() {
                this._areImageProcessingDirty = !0, this._isDirty = !0
            }, e.prototype.markAsLightDirty = function() {
                this._areLightsDirty = !0, this._isDirty = !0
            }, e.prototype.markAsAttributesDirty = function() {
                this._areAttributesDirty = !0, this._isDirty = !0
            }, e.prototype.markAsTexturesDirty = function() {
                this._areTexturesDirty = !0, this._isDirty = !0
            }, e.prototype.markAsFresnelDirty = function() {
                this._areFresnelDirty = !0, this._isDirty = !0
            }, e.prototype.markAsMiscDirty = function() {
                this._areMiscDirty = !0, this._isDirty = !0
            }, e.prototype.rebuild = function() {
                this._keys && delete this._keys, this._keys = [];
                for (var e = 0, t = Object.keys(this); e < t.length; e++) {
                    var i = t[e];
                    "_" !== i[0] && this._keys.push(i)
                }
            }, e.prototype.isEqual = function(e) {
                if (this._keys.length !== e._keys.length) return !1;
                for (var t = 0; t < this._keys.length; t++) {
                    var i = this._keys[t];
                    if (this[i] !== e[i]) return !1
                }
                return !0
            }, e.prototype.cloneTo = function(e) {
                this._keys.length !== e._keys.length && (e._keys = this._keys.slice(0));
                for (var t = 0; t < this._keys.length; t++) {
                    var i = this._keys[t];
                    e[i] = this[i]
                }
            }, e.prototype.reset = function() {
                for (var e = 0; e < this._keys.length; e++) {
                    var t = this._keys[e];
                    switch (typeof this[t]) {
                        case "number":
                            this[t] = 0;
                            break;
                        case "string":
                            this[t] = "";
                            break;
                        default:
                            this[t] = !1
                    }
                }
            }, e.prototype.toString = function() {
                for (var e = "", t = 0; t < this._keys.length; t++) {
                    var i = this._keys[t],
                        n = this[i];
                    switch (typeof n) {
                        case "number":
                        case "string":
                            e += "#define " + i + " " + n + "\n";
                            break;
                        default:
                            n && (e += "#define " + i + "\n")
                    }
                }
                return e
            }, e
        }(),
        it = function() {
            function e() {
                this._dirty = !0, this._tempColor = new y(0, 0, 0, 0), this._globalCurve = new y(0, 0, 0, 0), this._highlightsCurve = new y(0, 0, 0, 0), this._midtonesCurve = new y(0, 0, 0, 0), this._shadowsCurve = new y(0, 0, 0, 0), this._positiveCurve = new y(0, 0, 0, 0), this._negativeCurve = new y(0, 0, 0, 0), this._globalHue = 30, this._globalDensity = 0, this._globalSaturation = 0, this._globalExposure = 0, this._highlightsHue = 30, this._highlightsDensity = 0, this._highlightsSaturation = 0, this._highlightsExposure = 0, this._midtonesHue = 30, this._midtonesDensity = 0, this._midtonesSaturation = 0, this._midtonesExposure = 0, this._shadowsHue = 30, this._shadowsDensity = 0, this._shadowsSaturation = 0, this._shadowsExposure = 0
            }
            return Object.defineProperty(e.prototype, "globalHue", {
                get: function() {
                    return this._globalHue
                },
                set: function(e) {
                    this._globalHue = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "globalDensity", {
                get: function() {
                    return this._globalDensity
                },
                set: function(e) {
                    this._globalDensity = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "globalSaturation", {
                get: function() {
                    return this._globalSaturation
                },
                set: function(e) {
                    this._globalSaturation = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "globalExposure", {
                get: function() {
                    return this._globalExposure
                },
                set: function(e) {
                    this._globalExposure = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "highlightsHue", {
                get: function() {
                    return this._highlightsHue
                },
                set: function(e) {
                    this._highlightsHue = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "highlightsDensity", {
                get: function() {
                    return this._highlightsDensity
                },
                set: function(e) {
                    this._highlightsDensity = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "highlightsSaturation", {
                get: function() {
                    return this._highlightsSaturation
                },
                set: function(e) {
                    this._highlightsSaturation = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "highlightsExposure", {
                get: function() {
                    return this._highlightsExposure
                },
                set: function(e) {
                    this._highlightsExposure = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "midtonesHue", {
                get: function() {
                    return this._midtonesHue
                },
                set: function(e) {
                    this._midtonesHue = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "midtonesDensity", {
                get: function() {
                    return this._midtonesDensity
                },
                set: function(e) {
                    this._midtonesDensity = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "midtonesSaturation", {
                get: function() {
                    return this._midtonesSaturation
                },
                set: function(e) {
                    this._midtonesSaturation = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "midtonesExposure", {
                get: function() {
                    return this._midtonesExposure
                },
                set: function(e) {
                    this._midtonesExposure = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "shadowsHue", {
                get: function() {
                    return this._shadowsHue
                },
                set: function(e) {
                    this._shadowsHue = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "shadowsDensity", {
                get: function() {
                    return this._shadowsDensity
                },
                set: function(e) {
                    this._shadowsDensity = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "shadowsSaturation", {
                get: function() {
                    return this._shadowsSaturation
                },
                set: function(e) {
                    this._shadowsSaturation = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "shadowsExposure", {
                get: function() {
                    return this._shadowsExposure
                },
                set: function(e) {
                    this._shadowsExposure = e, this._dirty = !0
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getClassName = function() {
                return "ColorCurves"
            }, e.Bind = function(e, t, i, n, r) {
                void 0 === i && (i = "vCameraColorCurvePositive"), void 0 === n && (n = "vCameraColorCurveNeutral"), void 0 === r && (r = "vCameraColorCurveNegative"), e._dirty && (e._dirty = !1, e.getColorGradingDataToRef(e._globalHue, e._globalDensity, e._globalSaturation, e._globalExposure, e._globalCurve), e.getColorGradingDataToRef(e._highlightsHue, e._highlightsDensity, e._highlightsSaturation, e._highlightsExposure, e._tempColor), e._tempColor.multiplyToRef(e._globalCurve, e._highlightsCurve), e.getColorGradingDataToRef(e._midtonesHue, e._midtonesDensity, e._midtonesSaturation, e._midtonesExposure, e._tempColor), e._tempColor.multiplyToRef(e._globalCurve, e._midtonesCurve), e.getColorGradingDataToRef(e._shadowsHue, e._shadowsDensity, e._shadowsSaturation, e._shadowsExposure, e._tempColor), e._tempColor.multiplyToRef(e._globalCurve, e._shadowsCurve), e._highlightsCurve.subtractToRef(e._midtonesCurve, e._positiveCurve), e._midtonesCurve.subtractToRef(e._shadowsCurve, e._negativeCurve)), t && (t.setFloat4(i, e._positiveCurve.r, e._positiveCurve.g, e._positiveCurve.b, e._positiveCurve.a), t.setFloat4(n, e._midtonesCurve.r, e._midtonesCurve.g, e._midtonesCurve.b, e._midtonesCurve.a), t.setFloat4(r, e._negativeCurve.r, e._negativeCurve.g, e._negativeCurve.b, e._negativeCurve.a))
            }, e.PrepareUniforms = function(e) {
                e.push("vCameraColorCurveNeutral", "vCameraColorCurvePositive", "vCameraColorCurveNegative")
            }, e.prototype.getColorGradingDataToRef = function(t, i, n, r, o) {
                null != t && (t = e.clamp(t, 0, 360), i = e.clamp(i, -100, 100), n = e.clamp(n, -100, 100), r = e.clamp(r, -100, 100), i = e.applyColorGradingSliderNonlinear(i), i *= .5, r = e.applyColorGradingSliderNonlinear(r), i < 0 && (i *= -1, t = (t + 180) % 360), e.fromHSBToRef(t, i, 50 + .25 * r, o), o.scaleToRef(2, o), o.a = 1 + .01 * n)
            }, e.applyColorGradingSliderNonlinear = function(e) {
                e /= 100;
                var t = Math.abs(e);
                return t = Math.pow(t, 2), e < 0 && (t *= -1), t *= 100
            }, e.fromHSBToRef = function(t, i, n, r) {
                var o = e.clamp(t, 0, 360),
                    s = e.clamp(i / 100, 0, 1),
                    a = e.clamp(n / 100, 0, 1);
                if (0 === s) r.r = a, r.g = a, r.b = a;
                else {
                    o /= 60;
                    var u = Math.floor(o),
                        h = o - u,
                        l = a * (1 - s),
                        c = a * (1 - s * h),
                        d = a * (1 - s * (1 - h));
                    switch (u) {
                        case 0:
                            r.r = a, r.g = d, r.b = l;
                            break;
                        case 1:
                            r.r = c, r.g = a, r.b = l;
                            break;
                        case 2:
                            r.r = l, r.g = a, r.b = d;
                            break;
                        case 3:
                            r.r = l, r.g = c, r.b = a;
                            break;
                        case 4:
                            r.r = d, r.g = l, r.b = a;
                            break;
                        default:
                            r.r = a, r.g = l, r.b = c
                    }
                }
                r.a = 1
            }, e.clamp = function(e, t, i) {
                return Math.min(Math.max(e, t), i)
            }, e.prototype.clone = function() {
                return me.Clone((function() {
                    return new e
                }), this)
            }, e.prototype.serialize = function() {
                return me.Serialize(this)
            }, e.Parse = function(t) {
                return me.Parse((function() {
                    return new e
                }), t, null, null)
            }, s([ce()], e.prototype, "_globalHue", void 0), s([ce()], e.prototype, "_globalDensity", void 0), s([ce()], e.prototype, "_globalSaturation", void 0), s([ce()], e.prototype, "_globalExposure", void 0), s([ce()], e.prototype, "_highlightsHue", void 0), s([ce()], e.prototype, "_highlightsDensity", void 0), s([ce()], e.prototype, "_highlightsSaturation", void 0), s([ce()], e.prototype, "_highlightsExposure", void 0), s([ce()], e.prototype, "_midtonesHue", void 0), s([ce()], e.prototype, "_midtonesDensity", void 0), s([ce()], e.prototype, "_midtonesSaturation", void 0), s([ce()], e.prototype, "_midtonesExposure", void 0), e
        }();
    me._ColorCurvesParser = it.Parse;
    ! function(e) {
        function t() {
            var t = e.call(this) || this;
            return t.IMAGEPROCESSING = !1, t.VIGNETTE = !1, t.VIGNETTEBLENDMODEMULTIPLY = !1, t.VIGNETTEBLENDMODEOPAQUE = !1, t.TONEMAPPING = !1, t.TONEMAPPING_ACES = !1, t.CONTRAST = !1, t.COLORCURVES = !1, t.COLORGRADING = !1, t.COLORGRADING3D = !1, t.SAMPLER3DGREENDEPTH = !1, t.SAMPLER3DBGRMAP = !1, t.IMAGEPROCESSINGPOSTPROCESS = !1, t.EXPOSURE = !1, t.rebuild(), t
        }
        r(t, e)
    }(tt);
    var nt = function() {
        function e() {
            this.colorCurves = new it, this._colorCurvesEnabled = !1, this._colorGradingEnabled = !1, this._colorGradingWithGreenDepth = !0, this._colorGradingBGR = !0, this._exposure = 1, this._toneMappingEnabled = !1, this._toneMappingType = e.TONEMAPPING_STANDARD, this._contrast = 1, this.vignetteStretch = 0, this.vignetteCentreX = 0, this.vignetteCentreY = 0, this.vignetteWeight = 1.5, this.vignetteColor = new y(0, 0, 0, 0), this.vignetteCameraFov = .5, this._vignetteBlendMode = e.VIGNETTEMODE_MULTIPLY, this._vignetteEnabled = !1, this._applyByPostProcess = !1, this._isEnabled = !0, this.onUpdateParameters = new l
        }
        var t;
        return Object.defineProperty(e.prototype, "colorCurvesEnabled", {
            get: function() {
                return this._colorCurvesEnabled
            },
            set: function(e) {
                this._colorCurvesEnabled !== e && (this._colorCurvesEnabled = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "colorGradingTexture", {
            get: function() {
                return this._colorGradingTexture
            },
            set: function(e) {
                this._colorGradingTexture !== e && (this._colorGradingTexture = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "colorGradingEnabled", {
            get: function() {
                return this._colorGradingEnabled
            },
            set: function(e) {
                this._colorGradingEnabled !== e && (this._colorGradingEnabled = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "colorGradingWithGreenDepth", {
            get: function() {
                return this._colorGradingWithGreenDepth
            },
            set: function(e) {
                this._colorGradingWithGreenDepth !== e && (this._colorGradingWithGreenDepth = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "colorGradingBGR", {
            get: function() {
                return this._colorGradingBGR
            },
            set: function(e) {
                this._colorGradingBGR !== e && (this._colorGradingBGR = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "exposure", {
            get: function() {
                return this._exposure
            },
            set: function(e) {
                this._exposure !== e && (this._exposure = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "toneMappingEnabled", {
            get: function() {
                return this._toneMappingEnabled
            },
            set: function(e) {
                this._toneMappingEnabled !== e && (this._toneMappingEnabled = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "toneMappingType", {
            get: function() {
                return this._toneMappingType
            },
            set: function(e) {
                this._toneMappingType !== e && (this._toneMappingType = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "contrast", {
            get: function() {
                return this._contrast
            },
            set: function(e) {
                this._contrast !== e && (this._contrast = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "vignetteBlendMode", {
            get: function() {
                return this._vignetteBlendMode
            },
            set: function(e) {
                this._vignetteBlendMode !== e && (this._vignetteBlendMode = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "vignetteEnabled", {
            get: function() {
                return this._vignetteEnabled
            },
            set: function(e) {
                this._vignetteEnabled !== e && (this._vignetteEnabled = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "applyByPostProcess", {
            get: function() {
                return this._applyByPostProcess
            },
            set: function(e) {
                this._applyByPostProcess !== e && (this._applyByPostProcess = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "isEnabled", {
            get: function() {
                return this._isEnabled
            },
            set: function(e) {
                this._isEnabled !== e && (this._isEnabled = e, this._updateParameters())
            },
            enumerable: !0,
            configurable: !0
        }), e.prototype._updateParameters = function() {
            this.onUpdateParameters.notifyObservers(this)
        }, e.prototype.getClassName = function() {
            return "ImageProcessingConfiguration"
        }, e.PrepareUniforms = function(e, t) {
            t.EXPOSURE && e.push("exposureLinear"), t.CONTRAST && e.push("contrast"), t.COLORGRADING && e.push("colorTransformSettings"), t.VIGNETTE && (e.push("vInverseScreenSize"), e.push("vignetteSettings1"), e.push("vignetteSettings2")), t.COLORCURVES && it.PrepareUniforms(e)
        }, e.PrepareSamplers = function(e, t) {
            t.COLORGRADING && e.push("txColorTransform")
        }, e.prototype.prepareDefines = function(t, i) {
            if (void 0 === i && (i = !1), i !== this.applyByPostProcess || !this._isEnabled) return t.VIGNETTE = !1, t.TONEMAPPING = !1, t.TONEMAPPING_ACES = !1, t.CONTRAST = !1, t.EXPOSURE = !1, t.COLORCURVES = !1, t.COLORGRADING = !1, t.COLORGRADING3D = !1, t.IMAGEPROCESSING = !1, void(t.IMAGEPROCESSINGPOSTPROCESS = this.applyByPostProcess && this._isEnabled);
            switch (t.VIGNETTE = this.vignetteEnabled, t.VIGNETTEBLENDMODEMULTIPLY = this.vignetteBlendMode === e._VIGNETTEMODE_MULTIPLY, t.VIGNETTEBLENDMODEOPAQUE = !t.VIGNETTEBLENDMODEMULTIPLY, t.TONEMAPPING = this.toneMappingEnabled, this._toneMappingType) {
                case e.TONEMAPPING_ACES:
                    t.TONEMAPPING_ACES = !0;
                    break;
                default:
                    t.TONEMAPPING_ACES = !1
            }
            t.CONTRAST = 1 !== this.contrast, t.EXPOSURE = 1 !== this.exposure, t.COLORCURVES = this.colorCurvesEnabled && !!this.colorCurves, t.COLORGRADING = this.colorGradingEnabled && !!this.colorGradingTexture, t.COLORGRADING ? t.COLORGRADING3D = this.colorGradingTexture.is3D : t.COLORGRADING3D = !1, t.SAMPLER3DGREENDEPTH = this.colorGradingWithGreenDepth, t.SAMPLER3DBGRMAP = this.colorGradingBGR, t.IMAGEPROCESSINGPOSTPROCESS = this.applyByPostProcess, t.IMAGEPROCESSING = t.VIGNETTE || t.TONEMAPPING || t.CONTRAST || t.EXPOSURE || t.COLORCURVES || t.COLORGRADING
        }, e.prototype.isReady = function() {
            return !this.colorGradingEnabled || !this.colorGradingTexture || this.colorGradingTexture.isReady()
        }, e.prototype.bind = function(e, t) {
            if (void 0 === t && (t = 1), this._colorCurvesEnabled && this.colorCurves && it.Bind(this.colorCurves, e), this._vignetteEnabled) {
                var i = 1 / e.getEngine().getRenderWidth(),
                    n = 1 / e.getEngine().getRenderHeight();
                e.setFloat2("vInverseScreenSize", i, n);
                var r = Math.tan(.5 * this.vignetteCameraFov),
                    o = r * t,
                    s = Math.sqrt(o * r);
                o = K.Mix(o, s, this.vignetteStretch), r = K.Mix(r, s, this.vignetteStretch), e.setFloat4("vignetteSettings1", o, r, -o * this.vignetteCentreX, -r * this.vignetteCentreY);
                var a = -2 * this.vignetteWeight;
                e.setFloat4("vignetteSettings2", this.vignetteColor.r, this.vignetteColor.g, this.vignetteColor.b, a)
            }
            if (e.setFloat("exposureLinear", this.exposure), e.setFloat("contrast", this.contrast), this.colorGradingTexture) {
                e.setTexture("txColorTransform", this.colorGradingTexture);
                var u = this.colorGradingTexture.getSize().height;
                e.setFloat4("colorTransformSettings", (u - 1) / u, .5 / u, u, this.colorGradingTexture.level)
            }
        }, e.prototype.clone = function() {
            return me.Clone((function() {
                return new e
            }), this)
        }, e.prototype.serialize = function() {
            return me.Serialize(this)
        }, e.Parse = function(t) {
            return me.Parse((function() {
                return new e
            }), t, null, null)
        }, Object.defineProperty(e, "VIGNETTEMODE_MULTIPLY", {
            get: function() {
                return this._VIGNETTEMODE_MULTIPLY
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e, "VIGNETTEMODE_OPAQUE", {
            get: function() {
                return this._VIGNETTEMODE_OPAQUE
            },
            enumerable: !0,
            configurable: !0
        }), e.TONEMAPPING_STANDARD = 0, e.TONEMAPPING_ACES = 1, e._VIGNETTEMODE_MULTIPLY = 0, e._VIGNETTEMODE_OPAQUE = 1, s([he(7, t)], e.prototype, "colorCurves", void 0), s([ce()], e.prototype, "_colorCurvesEnabled", void 0), s([de("colorGradingTexture")], e.prototype, "_colorGradingTexture", void 0), s([ce()], e.prototype, "_colorGradingEnabled", void 0), s([ce()], e.prototype, "_colorGradingWithGreenDepth", void 0), s([ce()], e.prototype, "_colorGradingBGR", void 0), s([ce()], e.prototype, "_exposure", void 0), s([ce()], e.prototype, "_toneMappingEnabled", void 0), s([ce()], e.prototype, "_toneMappingType", void 0), s([ce()], e.prototype, "_contrast", void 0), s([ce()], e.prototype, "vignetteStretch", void 0), s([ce()], e.prototype, "vignetteCentreX", void 0), s([ce()], e.prototype, "vignetteCentreY", void 0), s([ce()], e.prototype, "vignetteWeight", void 0), s([ge()], e.prototype, "vignetteColor", void 0), s([ce()], e.prototype, "vignetteCameraFov", void 0), s([ce()], e.prototype, "_vignetteBlendMode", void 0), s([ce()], e.prototype, "_vignetteEnabled", void 0), s([ce()], e.prototype, "_applyByPostProcess", void 0), s([ce()], e.prototype, "_isEnabled", void 0), e
    }();
    me._ImageProcessingConfigurationParser = nt.Parse;
    var rt = function(e) {
            function t(i, n) {
                var r = e.call(this, i, n) || this;
                return r.diffuse = new v(1, 1, 1), r.specular = new v(1, 1, 1), r.falloffType = t.FALLOFF_DEFAULT, r.intensity = 1, r._range = Number.MAX_VALUE, r._inverseSquaredRange = 0, r._photometricScale = 1, r._intensityMode = t.INTENSITYMODE_AUTOMATIC, r._radius = 1e-5, r.renderPriority = 0, r._shadowEnabled = !0, r._excludeWithLayerMask = 0, r._includeOnlyWithLayerMask = 0, r._lightmapMode = 0, r._excludedMeshesIds = new Array, r._includedOnlyMeshesIds = new Array, r._isLight = !0, r.getScene().addLight(r), r._uniformBuffer = new Oe(r.getScene().getEngine()), r._buildUniformLayout(), r.includedOnlyMeshes = new Array, r.excludedMeshes = new Array, r._resyncMeshes(), r
            }
            return r(t, e), Object.defineProperty(t.prototype, "range", {
                get: function() {
                    return this._range
                },
                set: function(e) {
                    this._range = e, this._inverseSquaredRange = 1 / (this.range * this.range)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "intensityMode", {
                get: function() {
                    return this._intensityMode
                },
                set: function(e) {
                    this._intensityMode = e, this._computePhotometricScale()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "radius", {
                get: function() {
                    return this._radius
                },
                set: function(e) {
                    this._radius = e, this._computePhotometricScale()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "shadowEnabled", {
                get: function() {
                    return this._shadowEnabled
                },
                set: function(e) {
                    this._shadowEnabled !== e && (this._shadowEnabled = e, this._markMeshesAsLightDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "includedOnlyMeshes", {
                get: function() {
                    return this._includedOnlyMeshes
                },
                set: function(e) {
                    this._includedOnlyMeshes = e, this._hookArrayForIncludedOnly(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "excludedMeshes", {
                get: function() {
                    return this._excludedMeshes
                },
                set: function(e) {
                    this._excludedMeshes = e, this._hookArrayForExcluded(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "excludeWithLayerMask", {
                get: function() {
                    return this._excludeWithLayerMask
                },
                set: function(e) {
                    this._excludeWithLayerMask = e, this._resyncMeshes()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "includeOnlyWithLayerMask", {
                get: function() {
                    return this._includeOnlyWithLayerMask
                },
                set: function(e) {
                    this._includeOnlyWithLayerMask = e, this._resyncMeshes()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "lightmapMode", {
                get: function() {
                    return this._lightmapMode
                },
                set: function(e) {
                    this._lightmapMode !== e && (this._lightmapMode = e, this._markMeshesAsLightDirty())
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getClassName = function() {
                return "Light"
            }, t.prototype.toString = function(e) {
                var t = "Name: " + this.name;
                if (t += ", type: " + ["Point", "Directional", "Spot", "Hemispheric"][this.getTypeID()], this.animations)
                    for (var i = 0; i < this.animations.length; i++) t += ", animation[0]: " + this.animations[i].toString(e);
                return t
            }, t.prototype._syncParentEnabledState = function() {
                e.prototype._syncParentEnabledState.call(this), this._resyncMeshes()
            }, t.prototype.setEnabled = function(t) {
                e.prototype.setEnabled.call(this, t), this._resyncMeshes()
            }, t.prototype.getShadowGenerator = function() {
                return this._shadowGenerator
            }, t.prototype.getAbsolutePosition = function() {
                return b.Zero()
            }, t.prototype.canAffectMesh = function(e) {
                return !e || !(this.includedOnlyMeshes && this.includedOnlyMeshes.length > 0 && -1 === this.includedOnlyMeshes.indexOf(e)) && (!(this.excludedMeshes && this.excludedMeshes.length > 0 && -1 !== this.excludedMeshes.indexOf(e)) && ((0 === this.includeOnlyWithLayerMask || 0 != (this.includeOnlyWithLayerMask & e.layerMask)) && !(0 !== this.excludeWithLayerMask && this.excludeWithLayerMask & e.layerMask)))
            }, t.CompareLightsPriority = function(e, t) {
                return e.shadowEnabled !== t.shadowEnabled ? (t.shadowEnabled ? 1 : 0) - (e.shadowEnabled ? 1 : 0) : t.renderPriority - e.renderPriority
            }, t.prototype.dispose = function(t, i) {
                void 0 === i && (i = !1), this._shadowGenerator && (this._shadowGenerator.dispose(), this._shadowGenerator = null), this.getScene().stopAnimation(this);
                for (var n = 0, r = this.getScene().meshes; n < r.length; n++) {
                    r[n]._removeLightSource(this)
                }
                this._uniformBuffer.dispose(), this.getScene().removeLight(this), e.prototype.dispose.call(this, t, i)
            }, t.prototype.getTypeID = function() {
                return 0
            }, t.prototype.getScaledIntensity = function() {
                return this._photometricScale * this.intensity
            }, t.prototype.clone = function(e) {
                var i = t.GetConstructorFromName(this.getTypeID(), e, this.getScene());
                return i ? me.Clone(i, this) : null
            }, t.prototype.serialize = function() {
                var e = me.Serialize(this);
                return e.type = this.getTypeID(), this.parent && (e.parentId = this.parent.id), this.excludedMeshes.length > 0 && (e.excludedMeshesIds = [], this.excludedMeshes.forEach((function(t) {
                    e.excludedMeshesIds.push(t.id)
                }))), this.includedOnlyMeshes.length > 0 && (e.includedOnlyMeshesIds = [], this.includedOnlyMeshes.forEach((function(t) {
                    e.includedOnlyMeshesIds.push(t.id)
                }))), me.AppendSerializedAnimations(this, e), e.ranges = this.serializeAnimationRanges(), e
            }, t.GetConstructorFromName = function(e, t, i) {
                var n = He.Construct("Light_Type_" + e, t, i);
                return n || null
            }, t.Parse = function(e, i) {
                var n = t.GetConstructorFromName(e.type, e.name, i);
                if (!n) return null;
                var r = me.Parse(n, e, i);
                if (e.excludedMeshesIds && (r._excludedMeshesIds = e.excludedMeshesIds), e.includedOnlyMeshesIds && (r._includedOnlyMeshesIds = e.includedOnlyMeshesIds), e.parentId && (r._waitingParentId = e.parentId), void 0 !== e.falloffType && (r.falloffType = e.falloffType), void 0 !== e.lightmapMode && (r.lightmapMode = e.lightmapMode), e.animations) {
                    for (var o = 0; o < e.animations.length; o++) {
                        var s = e.animations[o],
                            a = G.GetClass("BABYLON.Animation");
                        a && r.animations.push(a.Parse(s))
                    }
                    He.ParseAnimationRanges(r, e, i)
                }
                return e.autoAnimate && i.beginAnimation(r, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, e.autoAnimateSpeed || 1), r
            }, t.prototype._hookArrayForExcluded = function(e) {
                var t = this,
                    i = e.push;
                e.push = function() {
                    for (var n = [], r = 0; r < arguments.length; r++) n[r] = arguments[r];
                    for (var o = i.apply(e, n), s = 0, a = n; s < a.length; s++) {
                        var u = a[s];
                        u._resyncLighSource(t)
                    }
                    return o
                };
                var n = e.splice;
                e.splice = function(i, r) {
                    for (var o = n.apply(e, [i, r]), s = 0, a = o; s < a.length; s++) {
                        a[s]._resyncLighSource(t)
                    }
                    return o
                };
                for (var r = 0, o = e; r < o.length; r++) {
                    o[r]._resyncLighSource(this)
                }
            }, t.prototype._hookArrayForIncludedOnly = function(e) {
                var t = this,
                    i = e.push;
                e.push = function() {
                    for (var n = [], r = 0; r < arguments.length; r++) n[r] = arguments[r];
                    var o = i.apply(e, n);
                    return t._resyncMeshes(), o
                };
                var n = e.splice;
                e.splice = function(i, r) {
                    var o = n.apply(e, [i, r]);
                    return t._resyncMeshes(), o
                }, this._resyncMeshes()
            }, t.prototype._resyncMeshes = function() {
                for (var e = 0, t = this.getScene().meshes; e < t.length; e++) {
                    t[e]._resyncLighSource(this)
                }
            }, t.prototype._markMeshesAsLightDirty = function() {
                for (var e = 0, t = this.getScene().meshes; e < t.length; e++) {
                    var i = t[e]; - 1 !== i.lightSources.indexOf(this) && i._markSubMeshesAsLightDirty()
                }
            }, t.prototype._computePhotometricScale = function() {
                this._photometricScale = this._getPhotometricScale(), this.getScene().resetCachedMaterial()
            }, t.prototype._getPhotometricScale = function() {
                var e = 0,
                    i = this.getTypeID(),
                    n = this.intensityMode;
                switch (n === t.INTENSITYMODE_AUTOMATIC && (n = i === t.LIGHTTYPEID_DIRECTIONALLIGHT ? t.INTENSITYMODE_ILLUMINANCE : t.INTENSITYMODE_LUMINOUSINTENSITY), i) {
                    case t.LIGHTTYPEID_POINTLIGHT:
                    case t.LIGHTTYPEID_SPOTLIGHT:
                        switch (n) {
                            case t.INTENSITYMODE_LUMINOUSPOWER:
                                e = 1 / (4 * Math.PI);
                                break;
                            case t.INTENSITYMODE_LUMINOUSINTENSITY:
                                e = 1;
                                break;
                            case t.INTENSITYMODE_LUMINANCE:
                                e = this.radius * this.radius
                        }
                        break;
                    case t.LIGHTTYPEID_DIRECTIONALLIGHT:
                        switch (n) {
                            case t.INTENSITYMODE_ILLUMINANCE:
                                e = 1;
                                break;
                            case t.INTENSITYMODE_LUMINANCE:
                                var r = this.radius;
                                r = Math.max(r, .001), e = 2 * Math.PI * (1 - Math.cos(r))
                        }
                        break;
                    case t.LIGHTTYPEID_HEMISPHERICLIGHT:
                        e = 1
                }
                return e
            }, t.prototype._reorderLightsInScene = function() {
                var e = this.getScene();
                0 != this._renderPriority && (e.requireLightSorting = !0), this.getScene().sortLightsByPriority()
            }, t.FALLOFF_DEFAULT = 0, t.FALLOFF_PHYSICAL = 1, t.FALLOFF_GLTF = 2, t.FALLOFF_STANDARD = 3, t.LIGHTMAP_DEFAULT = 0, t.LIGHTMAP_SPECULAR = 1, t.LIGHTMAP_SHADOWSONLY = 2, t.INTENSITYMODE_AUTOMATIC = 0, t.INTENSITYMODE_LUMINOUSPOWER = 1, t.INTENSITYMODE_LUMINOUSINTENSITY = 2, t.INTENSITYMODE_ILLUMINANCE = 3, t.INTENSITYMODE_LUMINANCE = 4, t.LIGHTTYPEID_POINTLIGHT = 0, t.LIGHTTYPEID_DIRECTIONALLIGHT = 1, t.LIGHTTYPEID_SPOTLIGHT = 2, t.LIGHTTYPEID_HEMISPHERICLIGHT = 3, s([fe()], t.prototype, "diffuse", void 0), s([fe()], t.prototype, "specular", void 0), s([ce()], t.prototype, "falloffType", void 0), s([ce()], t.prototype, "intensity", void 0), s([ce()], t.prototype, "range", null), s([ce()], t.prototype, "intensityMode", null), s([ce()], t.prototype, "radius", null), s([ce()], t.prototype, "_renderPriority", void 0), s([le("_reorderLightsInScene")], t.prototype, "renderPriority", void 0), s([ce("shadowEnabled")], t.prototype, "_shadowEnabled", void 0), s([ce("excludeWithLayerMask")], t.prototype, "_excludeWithLayerMask", void 0), s([ce("includeOnlyWithLayerMask")], t.prototype, "_includeOnlyWithLayerMask", void 0), s([ce("lightmapMode")], t.prototype, "_lightmapMode", void 0), t
        }(He),
        ot = function() {
            function e(e, t, i, n, r, o) {
                this.source = e, this.pointerX = t, this.pointerY = i, this.meshUnderPointer = n, this.sourceEvent = r, this.additionalData = o
            }
            return e.CreateNew = function(t, i, n) {
                var r = t.getScene();
                return new e(t, r.pointerX, r.pointerY, r.meshUnderPointer || t, i, n)
            }, e.CreateNewFromSprite = function(t, i, n, r) {
                return new e(t, i.pointerX, i.pointerY, i.meshUnderPointer, n, r)
            }, e.CreateNewFromScene = function(t, i) {
                return new e(null, t.pointerX, t.pointerY, t.meshUnderPointer, i)
            }, e.CreateNewFromPrimitive = function(t, i, n, r) {
                return new e(t, i.x, i.y, null, n, r)
            }, e
        }(),
        st = function() {
            function e(e) {
                this._vertexBuffers = {}, this._scene = e
            }
            return e.prototype._prepareBuffers = function() {
                if (!this._vertexBuffers[Te.PositionKind]) {
                    var e = [];
                    e.push(1, 1), e.push(-1, 1), e.push(-1, -1), e.push(1, -1), this._vertexBuffers[Te.PositionKind] = new Te(this._scene.getEngine(), e, Te.PositionKind, !1, !1, 2), this._buildIndexBuffer()
                }
            }, e.prototype._buildIndexBuffer = function() {
                var e = [];
                e.push(0), e.push(1), e.push(2), e.push(0), e.push(2), e.push(3), this._indexBuffer = this._scene.getEngine().createIndexBuffer(e)
            }, e.prototype._rebuild = function() {
                var e = this._vertexBuffers[Te.PositionKind];
                e && (e._rebuild(), this._buildIndexBuffer())
            }, e.prototype._prepareFrame = function(e, t) {
                void 0 === e && (e = null), void 0 === t && (t = null);
                var i = this._scene.activeCamera;
                return !!i && (!(!(t = t || i._postProcesses.filter((function(e) {
                    return null != e
                }))) || 0 === t.length || !this._scene.postProcessesEnabled) && (t[0].activate(i, e, null != t), !0))
            }, e.prototype.directRender = function(e, t, i, n, r) {
                void 0 === t && (t = null), void 0 === i && (i = !1), void 0 === n && (n = 0), void 0 === r && (r = 0);
                for (var o = this._scene.getEngine(), s = 0; s < e.length; s++) {
                    s < e.length - 1 ? e[s + 1].activate(this._scene.activeCamera, t) : t ? o.bindFramebuffer(t, n, void 0, void 0, i, void 0, r) : o.restoreDefaultFramebuffer();
                    var a = e[s],
                        u = a.apply();
                    u && (a.onBeforeRenderObservable.notifyObservers(u), this._prepareBuffers(), o.bindBuffers(this._vertexBuffers, this._indexBuffer, u), o.drawElementsType(De.TriangleFillMode, 0, 6), a.onAfterRenderObservable.notifyObservers(u))
                }
                o.setDepthBuffer(!0), o.setDepthWrite(!0)
            }, e.prototype._finalizeFrame = function(e, t, i, n, r) {
                void 0 === r && (r = !1);
                var o = this._scene.activeCamera;
                if (o && 0 !== (n = n || o._postProcesses.filter((function(e) {
                        return null != e
                    }))).length && this._scene.postProcessesEnabled) {
                    for (var s = this._scene.getEngine(), a = 0, u = n.length; a < u; a++) {
                        var h = n[a];
                        if (a < u - 1 ? h._outputTexture = n[a + 1].activate(o, t) : t ? (s.bindFramebuffer(t, i, void 0, void 0, r), h._outputTexture = t) : (s.restoreDefaultFramebuffer(), h._outputTexture = null), e) break;
                        var l = h.apply();
                        l && (h.onBeforeRenderObservable.notifyObservers(l), this._prepareBuffers(), s.bindBuffers(this._vertexBuffers, this._indexBuffer, l), s.drawElementsType(De.TriangleFillMode, 0, 6), h.onAfterRenderObservable.notifyObservers(l))
                    }
                    s.setDepthBuffer(!0), s.setDepthWrite(!0), s.setAlphaMode(k.ALPHA_DISABLE)
                }
            }, e.prototype.dispose = function() {
                var e = this._vertexBuffers[Te.PositionKind];
                e && (e.dispose(), this._vertexBuffers[Te.PositionKind] = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null)
            }, e
        }(),
        at = function() {
            function e(e, t, i, n, r) {
                void 0 === i && (i = null), void 0 === n && (n = null), void 0 === r && (r = null), this.index = e, this._opaqueSubMeshes = new We(256), this._transparentSubMeshes = new We(256), this._alphaTestSubMeshes = new We(256), this._depthOnlySubMeshes = new We(256), this._particleSystems = new We(256), this._spriteManagers = new We(256), this._edgesRenderers = new We(16), this._scene = t, this.opaqueSortCompareFn = i, this.alphaTestSortCompareFn = n, this.transparentSortCompareFn = r
            }
            return Object.defineProperty(e.prototype, "opaqueSortCompareFn", {
                set: function(t) {
                    this._opaqueSortCompareFn = t, this._renderOpaque = t ? this.renderOpaqueSorted : e.renderUnsorted
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "alphaTestSortCompareFn", {
                set: function(t) {
                    this._alphaTestSortCompareFn = t, this._renderAlphaTest = t ? this.renderAlphaTestSorted : e.renderUnsorted
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "transparentSortCompareFn", {
                set: function(t) {
                    this._transparentSortCompareFn = t || e.defaultTransparentSortCompare, this._renderTransparent = this.renderTransparentSorted
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.render = function(e, t, i, n) {
                if (e) e(this._opaqueSubMeshes, this._alphaTestSubMeshes, this._transparentSubMeshes, this._depthOnlySubMeshes);
                else {
                    var r = this._scene.getEngine();
                    0 !== this._depthOnlySubMeshes.length && (r.setColorWrite(!1), this._renderAlphaTest(this._depthOnlySubMeshes), r.setColorWrite(!0)), 0 !== this._opaqueSubMeshes.length && this._renderOpaque(this._opaqueSubMeshes), 0 !== this._alphaTestSubMeshes.length && this._renderAlphaTest(this._alphaTestSubMeshes);
                    var o = r.getStencilBuffer();
                    if (r.setStencilBuffer(!1), t && this._renderSprites(), i && this._renderParticles(n), this.onBeforeTransparentRendering && this.onBeforeTransparentRendering(), 0 !== this._transparentSubMeshes.length && (this._renderTransparent(this._transparentSubMeshes), r.setAlphaMode(k.ALPHA_DISABLE)), r.setStencilBuffer(!1), this._edgesRenderers.length) {
                        for (var s = 0; s < this._edgesRenderers.length; s++) this._edgesRenderers.data[s].render();
                        r.setAlphaMode(k.ALPHA_DISABLE)
                    }
                    r.setStencilBuffer(o)
                }
            }, e.prototype.renderOpaqueSorted = function(t) {
                return e.renderSorted(t, this._opaqueSortCompareFn, this._scene.activeCamera, !1)
            }, e.prototype.renderAlphaTestSorted = function(t) {
                return e.renderSorted(t, this._alphaTestSortCompareFn, this._scene.activeCamera, !1)
            }, e.prototype.renderTransparentSorted = function(t) {
                return e.renderSorted(t, this._transparentSortCompareFn, this._scene.activeCamera, !0)
            }, e.renderSorted = function(e, t, i, n) {
                for (var r, o = 0, s = i ? i.globalPosition : b.Zero(); o < e.length; o++)(r = e.data[o])._alphaIndex = r.getMesh().alphaIndex, r._distanceToCamera = r.getBoundingInfo().boundingSphere.centerWorld.subtract(s).length();
                var a = e.data.slice(0, e.length);
                for (t && a.sort(t), o = 0; o < a.length; o++) {
                    if (r = a[o], n) {
                        var u = r.getMaterial();
                        if (u && u.needDepthPrePass) {
                            var h = u.getScene().getEngine();
                            h.setColorWrite(!1), h.setAlphaMode(k.ALPHA_DISABLE), r.render(!1), h.setColorWrite(!0)
                        }
                    }
                    r.render(n)
                }
            }, e.renderUnsorted = function(e) {
                for (var t = 0; t < e.length; t++) {
                    e.data[t].render(!1)
                }
            }, e.defaultTransparentSortCompare = function(t, i) {
                return t._alphaIndex > i._alphaIndex ? 1 : t._alphaIndex < i._alphaIndex ? -1 : e.backToFrontSortCompare(t, i)
            }, e.backToFrontSortCompare = function(e, t) {
                return e._distanceToCamera < t._distanceToCamera ? 1 : e._distanceToCamera > t._distanceToCamera ? -1 : 0
            }, e.frontToBackSortCompare = function(e, t) {
                return e._distanceToCamera < t._distanceToCamera ? -1 : e._distanceToCamera > t._distanceToCamera ? 1 : 0
            }, e.prototype.prepare = function() {
                this._opaqueSubMeshes.reset(), this._transparentSubMeshes.reset(), this._alphaTestSubMeshes.reset(), this._depthOnlySubMeshes.reset(), this._particleSystems.reset(), this._spriteManagers.reset(), this._edgesRenderers.reset()
            }, e.prototype.dispose = function() {
                this._opaqueSubMeshes.dispose(), this._transparentSubMeshes.dispose(), this._alphaTestSubMeshes.dispose(), this._depthOnlySubMeshes.dispose(), this._particleSystems.dispose(), this._spriteManagers.dispose(), this._edgesRenderers.dispose()
            }, e.prototype.dispatch = function(e, t, i) {
                void 0 === t && (t = e.getMesh()), void 0 === i && (i = e.getMaterial()), null != i && (i.needAlphaBlendingForMesh(t) ? this._transparentSubMeshes.push(e) : i.needAlphaTesting() ? (i.needDepthPrePass && this._depthOnlySubMeshes.push(e), this._alphaTestSubMeshes.push(e)) : (i.needDepthPrePass && this._depthOnlySubMeshes.push(e), this._opaqueSubMeshes.push(e)), t._renderingGroup = this, t._edgesRenderer && t._edgesRenderer.isEnabled && this._edgesRenderers.push(t._edgesRenderer))
            }, e.prototype.dispatchSprites = function(e) {
                this._spriteManagers.push(e)
            }, e.prototype.dispatchParticles = function(e) {
                this._particleSystems.push(e)
            }, e.prototype._renderParticles = function(e) {
                if (0 !== this._particleSystems.length) {
                    var t = this._scene.activeCamera;
                    this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);
                    for (var i = 0; i < this._particleSystems.length; i++) {
                        var n = this._particleSystems.data[i];
                        if (0 !== (t && t.layerMask & n.layerMask)) {
                            var r = n.emitter;
                            r.position && e && -1 === e.indexOf(r) || this._scene._activeParticles.addCount(n.render(), !1)
                        }
                    }
                    this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)
                }
            }, e.prototype._renderSprites = function() {
                if (this._scene.spritesEnabled && 0 !== this._spriteManagers.length) {
                    var e = this._scene.activeCamera;
                    this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);
                    for (var t = 0; t < this._spriteManagers.length; t++) {
                        var i = this._spriteManagers.data[t];
                        0 !== (e && e.layerMask & i.layerMask) && i.render()
                    }
                    this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)
                }
            }, e
        }(),
        ut = function() {},
        ht = function() {
            function e(t) {
                this._useSceneAutoClearSetup = !1, this._renderingGroups = new Array, this._autoClearDepthStencil = {}, this._customOpaqueSortCompareFn = {}, this._customAlphaTestSortCompareFn = {}, this._customTransparentSortCompareFn = {}, this._renderingGroupInfo = new ut, this._scene = t;
                for (var i = e.MIN_RENDERINGGROUPS; i < e.MAX_RENDERINGGROUPS; i++) this._autoClearDepthStencil[i] = {
                    autoClear: !0,
                    depth: !0,
                    stencil: !0
                }
            }
            return e.prototype._clearDepthStencilBuffer = function(e, t) {
                void 0 === e && (e = !0), void 0 === t && (t = !0), this._depthStencilBufferAlreadyCleaned || (this._scene.getEngine().clear(null, !1, e, t), this._depthStencilBufferAlreadyCleaned = !0)
            }, e.prototype.render = function(t, i, n, r) {
                var o = this._renderingGroupInfo;
                if (o.scene = this._scene, o.camera = this._scene.activeCamera, this._scene.spriteManagers && r)
                    for (var s = 0; s < this._scene.spriteManagers.length; s++) {
                        var a = this._scene.spriteManagers[s];
                        this.dispatchSprites(a)
                    }
                for (s = e.MIN_RENDERINGGROUPS; s < e.MAX_RENDERINGGROUPS; s++) {
                    this._depthStencilBufferAlreadyCleaned = s === e.MIN_RENDERINGGROUPS;
                    var u = this._renderingGroups[s];
                    if (u) {
                        var h = Math.pow(2, s);
                        if (o.renderingGroupId = s, this._scene.onBeforeRenderingGroupObservable.notifyObservers(o, h), e.AUTOCLEAR) {
                            var l = this._useSceneAutoClearSetup ? this._scene.getAutoClearDepthStencilSetup(s) : this._autoClearDepthStencil[s];
                            l && l.autoClear && this._clearDepthStencilBuffer(l.depth, l.stencil)
                        }
                        for (var c = 0, d = this._scene._beforeRenderingGroupDrawStage; c < d.length; c++) {
                            d[c].action(s)
                        }
                        u.render(t, r, n, i);
                        for (var f = 0, p = this._scene._afterRenderingGroupDrawStage; f < p.length; f++) {
                            p[f].action(s)
                        }
                        this._scene.onAfterRenderingGroupObservable.notifyObservers(o, h)
                    }
                }
            }, e.prototype.reset = function() {
                for (var t = e.MIN_RENDERINGGROUPS; t < e.MAX_RENDERINGGROUPS; t++) {
                    var i = this._renderingGroups[t];
                    i && i.prepare()
                }
            }, e.prototype.dispose = function() {
                this.freeRenderingGroups(), this._renderingGroups.length = 0, this._renderingGroupInfo = null
            }, e.prototype.freeRenderingGroups = function() {
                for (var t = e.MIN_RENDERINGGROUPS; t < e.MAX_RENDERINGGROUPS; t++) {
                    var i = this._renderingGroups[t];
                    i && i.dispose()
                }
            }, e.prototype._prepareRenderingGroup = function(e) {
                void 0 === this._renderingGroups[e] && (this._renderingGroups[e] = new at(e, this._scene, this._customOpaqueSortCompareFn[e], this._customAlphaTestSortCompareFn[e], this._customTransparentSortCompareFn[e]))
            }, e.prototype.dispatchSprites = function(e) {
                var t = e.renderingGroupId || 0;
                this._prepareRenderingGroup(t), this._renderingGroups[t].dispatchSprites(e)
            }, e.prototype.dispatchParticles = function(e) {
                var t = e.renderingGroupId || 0;
                this._prepareRenderingGroup(t), this._renderingGroups[t].dispatchParticles(e)
            }, e.prototype.dispatch = function(e, t, i) {
                void 0 === t && (t = e.getMesh());
                var n = t.renderingGroupId || 0;
                this._prepareRenderingGroup(n), this._renderingGroups[n].dispatch(e, t, i)
            }, e.prototype.setRenderingOrder = function(e, t, i, n) {
                if (void 0 === t && (t = null), void 0 === i && (i = null), void 0 === n && (n = null), this._customOpaqueSortCompareFn[e] = t, this._customAlphaTestSortCompareFn[e] = i, this._customTransparentSortCompareFn[e] = n, this._renderingGroups[e]) {
                    var r = this._renderingGroups[e];
                    r.opaqueSortCompareFn = this._customOpaqueSortCompareFn[e], r.alphaTestSortCompareFn = this._customAlphaTestSortCompareFn[e], r.transparentSortCompareFn = this._customTransparentSortCompareFn[e]
                }
            }, e.prototype.setRenderingAutoClearDepthStencil = function(e, t, i, n) {
                void 0 === i && (i = !0), void 0 === n && (n = !0), this._autoClearDepthStencil[e] = {
                    autoClear: t,
                    depth: i,
                    stencil: n
                }
            }, e.prototype.getAutoClearDepthStencilSetup = function(e) {
                return this._autoClearDepthStencil[e]
            }, e.MAX_RENDERINGGROUPS = 4, e.MIN_RENDERINGGROUPS = 0, e.AUTOCLEAR = !0, e
        }(),
        lt = function() {
            function e() {}
            return e.NAME_EFFECTLAYER = "EffectLayer", e.NAME_LAYER = "Layer", e.NAME_LENSFLARESYSTEM = "LensFlareSystem", e.NAME_BOUNDINGBOXRENDERER = "BoundingBoxRenderer", e.NAME_PARTICLESYSTEM = "ParticleSystem", e.NAME_GAMEPAD = "Gamepad", e.NAME_SIMPLIFICATIONQUEUE = "SimplificationQueue", e.NAME_GEOMETRYBUFFERRENDERER = "GeometryBufferRenderer", e.NAME_DEPTHRENDERER = "DepthRenderer", e.NAME_POSTPROCESSRENDERPIPELINEMANAGER = "PostProcessRenderPipelineManager", e.NAME_SPRITE = "Sprite", e.NAME_OUTLINERENDERER = "Outline", e.NAME_PROCEDURALTEXTURE = "ProceduralTexture", e.NAME_SHADOWGENERATOR = "ShadowGenerator", e.NAME_OCTREE = "Octree", e.NAME_PHYSICSENGINE = "PhysicsEngine", e.NAME_AUDIO = "Audio", e.STEP_ISREADYFORMESH_EFFECTLAYER = 0, e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER = 0, e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER = 0, e.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER = 0, e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER = 1, e.STEP_BEFORECAMERADRAW_EFFECTLAYER = 0, e.STEP_BEFORECAMERADRAW_LAYER = 1, e.STEP_BEFORERENDERTARGETDRAW_LAYER = 0, e.STEP_BEFORERENDERINGMESH_OUTLINE = 0, e.STEP_AFTERRENDERINGMESH_OUTLINE = 0, e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW = 0, e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER = 1, e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE = 0, e.STEP_BEFORECAMERAUPDATE_GAMEPAD = 1, e.STEP_BEFORECLEAR_PROCEDURALTEXTURE = 0, e.STEP_AFTERRENDERTARGETDRAW_LAYER = 0, e.STEP_AFTERCAMERADRAW_EFFECTLAYER = 0, e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM = 1, e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW = 2, e.STEP_AFTERCAMERADRAW_LAYER = 3, e.STEP_AFTERRENDER_AUDIO = 0, e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR = 0, e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER = 1, e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER = 2, e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER = 3, e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER = 0, e.STEP_POINTERMOVE_SPRITE = 0, e.STEP_POINTERDOWN_SPRITE = 0, e.STEP_POINTERUP_SPRITE = 0, e
        }(),
        ct = function(e) {
            function t(t) {
                return e.apply(this, t) || this
            }
            return r(t, e), t.Create = function() {
                return Object.create(t.prototype)
            }, t.prototype.registerStep = function(e, t, i) {
                var n = 0;
                for (Number.MAX_VALUE; n < this.length; n++) {
                    if (e < this[n].index) break
                }
                this.splice(n, 0, {
                    index: e,
                    component: t,
                    action: i.bind(t)
                })
            }, t.prototype.clear = function() {
                this.length = 0
            }, t
        }(Array),
        dt = function() {
            function e() {}
            return e.POINTERDOWN = 1, e.POINTERUP = 2, e.POINTERMOVE = 4, e.POINTERWHEEL = 8, e.POINTERPICK = 16, e.POINTERTAP = 32, e.POINTERDOUBLETAP = 64, e
        }(),
        ft = function(e, t) {
            this.type = e, this.event = t
        },
        pt = function(e) {
            function t(t, i, n, r) {
                var o = e.call(this, t, i) || this;
                return o.ray = null, o.skipOnPointerObservable = !1, o.localPosition = new T(n, r), o
            }
            return r(t, e), t
        }(ft),
        _t = function(e) {
            function t(t, i, n) {
                var r = e.call(this, t, i) || this;
                return r.pickInfo = n, r
            }
            return r(t, e), t
        }(ft),
        gt = function() {
            function e() {
                this.hoverCursor = "", this.actions = new Array, this.isRecursive = !1
            }
            return Object.defineProperty(e, "HasTriggers", {
                get: function() {
                    for (var t in e.Triggers)
                        if (e.Triggers.hasOwnProperty(t)) return !0;
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "HasPickTriggers", {
                get: function() {
                    for (var t in e.Triggers)
                        if (e.Triggers.hasOwnProperty(t)) {
                            var i = parseInt(t);
                            if (i >= k.ACTION_OnPickTrigger && i <= k.ACTION_OnPickUpTrigger) return !0
                        }
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), e.HasSpecificTrigger = function(t) {
                for (var i in e.Triggers) {
                    if (e.Triggers.hasOwnProperty(i))
                        if (parseInt(i) === t) return !0
                }
                return !1
            }, e.Triggers = {}, e
        }(),
        mt = function() {
            function e() {}
            return e.KEYDOWN = 1, e.KEYUP = 2, e
        }(),
        vt = function(e, t) {
            this.type = e, this.event = t
        },
        yt = function(e) {
            function t(t, i) {
                var n = e.call(this, t, i) || this;
                return n.type = t, n.event = i, n.skipOnPointerObservable = !1, n
            }
            return r(t, e), t
        }(vt),
        Tt = function() {
            function e() {
                this._singleClick = !1, this._doubleClick = !1, this._hasSwiped = !1, this._ignore = !1
            }
            return Object.defineProperty(e.prototype, "singleClick", {
                get: function() {
                    return this._singleClick
                },
                set: function(e) {
                    this._singleClick = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "doubleClick", {
                get: function() {
                    return this._doubleClick
                },
                set: function(e) {
                    this._doubleClick = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "hasSwiped", {
                get: function() {
                    return this._hasSwiped
                },
                set: function(e) {
                    this._hasSwiped = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "ignore", {
                get: function() {
                    return this._ignore
                },
                set: function(e) {
                    this._ignore = e
                },
                enumerable: !0,
                configurable: !0
            }), e
        }(),
        bt = function() {
            function e(e) {
                this._wheelEventName = "", this._meshPickProceed = !1, this._currentPickResult = null, this._previousPickResult = null, this._totalPointersPressed = 0, this._doubleClickOccured = !1, this._pointerX = 0, this._pointerY = 0, this._startingPointerPosition = new T(0, 0), this._previousStartingPointerPosition = new T(0, 0), this._startingPointerTime = 0, this._previousStartingPointerTime = 0, this._pointerCaptures = {}, this._scene = e
            }
            return Object.defineProperty(e.prototype, "meshUnderPointer", {
                get: function() {
                    return this._pointerOverMesh
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "unTranslatedPointer", {
                get: function() {
                    return new T(this._unTranslatedPointerX, this._unTranslatedPointerY)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "pointerX", {
                get: function() {
                    return this._pointerX
                },
                set: function(e) {
                    this._pointerX = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "pointerY", {
                get: function() {
                    return this._pointerY
                },
                set: function(e) {
                    this._pointerY = e
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._updatePointerPosition = function(e) {
                var t = this._scene.getEngine().getRenderingCanvasClientRect();
                t && (this._pointerX = e.clientX - t.left, this._pointerY = e.clientY - t.top, this._unTranslatedPointerX = this._pointerX, this._unTranslatedPointerY = this._pointerY)
            }, e.prototype._processPointerMove = function(e, t) {
                var i = this._scene,
                    n = i.getEngine().getRenderingCanvas();
                if (n) {
                    n.tabIndex = 1, n.style.cursor = i.defaultCursor;
                    var r = !!(e && e.hit && e.pickedMesh);
                    r ? (i.setPointerOverMesh(e.pickedMesh), this._pointerOverMesh && this._pointerOverMesh.actionManager && this._pointerOverMesh.actionManager.hasPointerTriggers && (this._pointerOverMesh.actionManager.hoverCursor ? n.style.cursor = this._pointerOverMesh.actionManager.hoverCursor : n.style.cursor = i.hoverCursor)) : i.setPointerOverMesh(null);
                    for (var o = 0, s = i._pointerMoveStage; o < s.length; o++) {
                        e = s[o].action(this._unTranslatedPointerX, this._unTranslatedPointerY, e, r, n)
                    }
                    if (e) {
                        var a = t.type === this._wheelEventName ? dt.POINTERWHEEL : dt.POINTERMOVE;
                        if (i.onPointerMove && i.onPointerMove(t, e, a), i.onPointerObservable.hasObservers()) {
                            var u = new _t(a, t, e);
                            this._setRayOnPointerInfo(u), i.onPointerObservable.notifyObservers(u, a)
                        }
                    }
                }
            }, e.prototype._setRayOnPointerInfo = function(e) {
                var t = this._scene;
                e.pickInfo && !e.pickInfo._pickingUnavailable && (e.pickInfo.ray || (e.pickInfo.ray = t.createPickingRay(e.event.offsetX, e.event.offsetY, R.Identity(), t.activeCamera)))
            }, e.prototype._checkPrePointerObservable = function(e, t, i) {
                var n = this._scene,
                    r = new pt(i, t, this._unTranslatedPointerX, this._unTranslatedPointerY);
                return e && (r.ray = e.ray), n.onPrePointerObservable.notifyObservers(r, i), !!r.skipOnPointerObservable
            }, e.prototype.simulatePointerMove = function(e, t) {
                var i = new PointerEvent("pointermove", t);
                this._checkPrePointerObservable(e, i, dt.POINTERMOVE) || this._processPointerMove(e, i)
            }, e.prototype.simulatePointerDown = function(e, t) {
                var i = new PointerEvent("pointerdown", t);
                this._checkPrePointerObservable(e, i, dt.POINTERDOWN) || this._processPointerDown(e, i)
            }, e.prototype._processPointerDown = function(t, i) {
                var n = this,
                    r = this._scene;
                if (t && t.hit && t.pickedMesh) {
                    this._pickedDownMesh = t.pickedMesh;
                    var o = t.pickedMesh.actionManager;
                    if (o) {
                        if (o.hasPickTriggers) switch (o.processTrigger(k.ACTION_OnPickDownTrigger, ot.CreateNew(t.pickedMesh, i)), i.button) {
                            case 0:
                                o.processTrigger(k.ACTION_OnLeftPickTrigger, ot.CreateNew(t.pickedMesh, i));
                                break;
                            case 1:
                                o.processTrigger(k.ACTION_OnCenterPickTrigger, ot.CreateNew(t.pickedMesh, i));
                                break;
                            case 2:
                                o.processTrigger(k.ACTION_OnRightPickTrigger, ot.CreateNew(t.pickedMesh, i))
                        }
                        o.hasSpecificTrigger(k.ACTION_OnLongPressTrigger) && window.setTimeout((function() {
                            var t = r.pick(n._unTranslatedPointerX, n._unTranslatedPointerY, (function(e) {
                                return e.isPickable && e.isVisible && e.isReady() && e.actionManager && e.actionManager.hasSpecificTrigger(k.ACTION_OnLongPressTrigger) && e == n._pickedDownMesh
                            }), !1, r.cameraToUseForPointers);
                            t && t.hit && t.pickedMesh && o && 0 !== n._totalPointersPressed && Date.now() - n._startingPointerTime > e.LongPressDelay && !n._isPointerSwiping() && (n._startingPointerTime = 0, o.processTrigger(k.ACTION_OnLongPressTrigger, ot.CreateNew(t.pickedMesh, i)))
                        }), e.LongPressDelay)
                    }
                } else
                    for (var s = 0, a = r._pointerDownStage; s < a.length; s++) {
                        t = a[s].action(this._unTranslatedPointerX, this._unTranslatedPointerY, t, i)
                    }
                if (t) {
                    var u = dt.POINTERDOWN;
                    if (r.onPointerDown && r.onPointerDown(i, t, u), r.onPointerObservable.hasObservers()) {
                        var h = new _t(u, i, t);
                        this._setRayOnPointerInfo(h), r.onPointerObservable.notifyObservers(h, u)
                    }
                }
            }, e.prototype._isPointerSwiping = function() {
                return Math.abs(this._startingPointerPosition.x - this._pointerX) > e.DragMovementThreshold || Math.abs(this._startingPointerPosition.y - this._pointerY) > e.DragMovementThreshold
            }, e.prototype.simulatePointerUp = function(e, t, i) {
                var n = new PointerEvent("pointerup", t),
                    r = new Tt;
                i ? r.doubleClick = !0 : r.singleClick = !0, this._checkPrePointerObservable(e, n, dt.POINTERUP) || this._processPointerUp(e, n, r)
            }, e.prototype._processPointerUp = function(e, t, i) {
                var n = this._scene;
                if (e && e && e.pickedMesh) {
                    if (this._pickedUpMesh = e.pickedMesh, this._pickedDownMesh === this._pickedUpMesh && (n.onPointerPick && n.onPointerPick(t, e), i.singleClick && !i.ignore && n.onPointerObservable.hasObservers())) {
                        var r = dt.POINTERPICK,
                            o = new _t(r, t, e);
                        this._setRayOnPointerInfo(o), n.onPointerObservable.notifyObservers(o, r)
                    }
                    var s = e.pickedMesh._getActionManagerForTrigger();
                    if (s && !i.ignore) {
                        s.processTrigger(k.ACTION_OnPickUpTrigger, ot.CreateNew(e.pickedMesh, t)), !i.hasSwiped && i.singleClick && s.processTrigger(k.ACTION_OnPickTrigger, ot.CreateNew(e.pickedMesh, t));
                        var a = e.pickedMesh._getActionManagerForTrigger(k.ACTION_OnDoublePickTrigger);
                        i.doubleClick && a && a.processTrigger(k.ACTION_OnDoublePickTrigger, ot.CreateNew(e.pickedMesh, t))
                    }
                } else if (!i.ignore)
                    for (var u = 0, h = n._pointerUpStage; u < h.length; u++) {
                        e = h[u].action(this._unTranslatedPointerX, this._unTranslatedPointerY, e, t)
                    }
                if (this._pickedDownMesh && this._pickedDownMesh !== this._pickedUpMesh) {
                    var l = this._pickedDownMesh._getActionManagerForTrigger(k.ACTION_OnPickOutTrigger);
                    l && l.processTrigger(k.ACTION_OnPickOutTrigger, ot.CreateNew(this._pickedDownMesh, t))
                }
                var c = 0;
                if (n.onPointerObservable.hasObservers()) {
                    if (!i.ignore && !i.hasSwiped && (i.singleClick && n.onPointerObservable.hasSpecificMask(dt.POINTERTAP) ? c = dt.POINTERTAP : i.doubleClick && n.onPointerObservable.hasSpecificMask(dt.POINTERDOUBLETAP) && (c = dt.POINTERDOUBLETAP), c)) {
                        o = new _t(c, t, e);
                        this._setRayOnPointerInfo(o), n.onPointerObservable.notifyObservers(o, c)
                    }
                    if (!i.ignore) {
                        c = dt.POINTERUP;
                        o = new _t(c, t, e);
                        this._setRayOnPointerInfo(o), n.onPointerObservable.notifyObservers(o, c)
                    }
                }
                n.onPointerUp && !i.ignore && n.onPointerUp(t, e, c)
            }, e.prototype.isPointerCaptured = function(e) {
                return void 0 === e && (e = 0), this._pointerCaptures[e]
            }, e.prototype.attachControl = function(t, i, n) {
                var r = this;
                void 0 === t && (t = !0), void 0 === i && (i = !0), void 0 === n && (n = !0);
                var o = this._scene,
                    s = o.getEngine().getRenderingCanvas();
                if (s) {
                    var a = o.getEngine();
                    this._initActionManager = function(e, t) {
                        if (!r._meshPickProceed) {
                            var i = o.pick(r._unTranslatedPointerX, r._unTranslatedPointerY, o.pointerDownPredicate, !1, o.cameraToUseForPointers);
                            r._currentPickResult = i, i && (e = i.hit && i.pickedMesh ? i.pickedMesh._getActionManagerForTrigger() : null), r._meshPickProceed = !0
                        }
                        return e
                    }, this._delayedSimpleClick = function(t, i, n) {
                        (Date.now() - r._previousStartingPointerTime > e.DoubleClickDelay && !r._doubleClickOccured || t !== r._previousButtonPressed) && (r._doubleClickOccured = !1, i.singleClick = !0, i.ignore = !1, n(i, r._currentPickResult))
                    }, this._initClickEvent = function(t, i, n, o) {
                        var s = new Tt;
                        r._currentPickResult = null;
                        var a = null,
                            u = t.hasSpecificMask(dt.POINTERPICK) || i.hasSpecificMask(dt.POINTERPICK) || t.hasSpecificMask(dt.POINTERTAP) || i.hasSpecificMask(dt.POINTERTAP) || t.hasSpecificMask(dt.POINTERDOUBLETAP) || i.hasSpecificMask(dt.POINTERDOUBLETAP);
                        !u && gt && (a = r._initActionManager(a, s)) && (u = a.hasPickTriggers);
                        var h = !1;
                        if (u) {
                            var l = n.button;
                            if (s.hasSwiped = r._isPointerSwiping(), !s.hasSwiped) {
                                var c = !e.ExclusiveDoubleClickMode;
                                c || (c = !t.hasSpecificMask(dt.POINTERDOUBLETAP) && !i.hasSpecificMask(dt.POINTERDOUBLETAP)) && !gt.HasSpecificTrigger(k.ACTION_OnDoublePickTrigger) && (a = r._initActionManager(a, s)) && (c = !a.hasSpecificTrigger(k.ACTION_OnDoublePickTrigger)), c ? (Date.now() - r._previousStartingPointerTime > e.DoubleClickDelay || l !== r._previousButtonPressed) && (s.singleClick = !0, o(s, r._currentPickResult), h = !0) : (r._previousDelayedSimpleClickTimeout = r._delayedSimpleClickTimeout, r._delayedSimpleClickTimeout = window.setTimeout(r._delayedSimpleClick.bind(r, l, s, o), e.DoubleClickDelay));
                                var d = t.hasSpecificMask(dt.POINTERDOUBLETAP) || i.hasSpecificMask(dt.POINTERDOUBLETAP);
                                !d && gt.HasSpecificTrigger(k.ACTION_OnDoublePickTrigger) && (a = r._initActionManager(a, s)) && (d = a.hasSpecificTrigger(k.ACTION_OnDoublePickTrigger)), d && (l === r._previousButtonPressed && Date.now() - r._previousStartingPointerTime < e.DoubleClickDelay && !r._doubleClickOccured ? (s.hasSwiped || r._isPointerSwiping() ? (r._doubleClickOccured = !1, r._previousStartingPointerTime = r._startingPointerTime, r._previousStartingPointerPosition.x = r._startingPointerPosition.x, r._previousStartingPointerPosition.y = r._startingPointerPosition.y, r._previousButtonPressed = l, e.ExclusiveDoubleClickMode ? (r._previousDelayedSimpleClickTimeout && clearTimeout(r._previousDelayedSimpleClickTimeout), r._previousDelayedSimpleClickTimeout = r._delayedSimpleClickTimeout, o(s, r._previousPickResult)) : o(s, r._currentPickResult)) : (r._previousStartingPointerTime = 0, r._doubleClickOccured = !0, s.doubleClick = !0, s.ignore = !1, e.ExclusiveDoubleClickMode && r._previousDelayedSimpleClickTimeout && clearTimeout(r._previousDelayedSimpleClickTimeout), r._previousDelayedSimpleClickTimeout = r._delayedSimpleClickTimeout, o(s, r._currentPickResult)), h = !0) : (r._doubleClickOccured = !1, r._previousStartingPointerTime = r._startingPointerTime, r._previousStartingPointerPosition.x = r._startingPointerPosition.x, r._previousStartingPointerPosition.y = r._startingPointerPosition.y, r._previousButtonPressed = l))
                            }
                        }
                        h || o(s, r._currentPickResult)
                    }, this._onPointerMove = function(e) {
                        if (r._updatePointerPosition(e), !r._checkPrePointerObservable(null, e, e.type === r._wheelEventName ? dt.POINTERWHEEL : dt.POINTERMOVE) && (o.cameraToUseForPointers || o.activeCamera)) {
                            o.pointerMovePredicate || (o.pointerMovePredicate = function(e) {
                                return e.isPickable && e.isVisible && e.isReady() && e.isEnabled() && (e.enablePointerMoveEvents || o.constantlyUpdateMeshUnderPointer || null !== e.actionManager && void 0 !== e.actionManager) && (!o.cameraToUseForPointers || 0 != (o.cameraToUseForPointers.layerMask & e.layerMask))
                            });
                            var t = o.pick(r._unTranslatedPointerX, r._unTranslatedPointerY, o.pointerMovePredicate, !1, o.cameraToUseForPointers);
                            r._processPointerMove(t, e)
                        }
                    }, this._onPointerDown = function(e) {
                        if (r._totalPointersPressed++, r._pickedDownMesh = null, r._meshPickProceed = !1, r._updatePointerPosition(e), o.preventDefaultOnPointerDown && s && (e.preventDefault(), s.focus()), r._startingPointerPosition.x = r._pointerX, r._startingPointerPosition.y = r._pointerY, r._startingPointerTime = Date.now(), !r._checkPrePointerObservable(null, e, dt.POINTERDOWN) && (o.cameraToUseForPointers || o.activeCamera)) {
                            r._pointerCaptures[e.pointerId] = !0, o.pointerDownPredicate || (o.pointerDownPredicate = function(e) {
                                return e.isPickable && e.isVisible && e.isReady() && e.isEnabled() && (!o.cameraToUseForPointers || 0 != (o.cameraToUseForPointers.layerMask & e.layerMask))
                            }), r._pickedDownMesh = null;
                            var t = o.pick(r._unTranslatedPointerX, r._unTranslatedPointerY, o.pointerDownPredicate, !1, o.cameraToUseForPointers);
                            r._processPointerDown(t, e)
                        }
                    }, this._onPointerUp = function(e) {
                        0 !== r._totalPointersPressed && (r._totalPointersPressed--, r._pickedUpMesh = null, r._meshPickProceed = !1, r._updatePointerPosition(e), o.preventDefaultOnPointerUp && s && (e.preventDefault(), s.focus()), r._initClickEvent(o.onPrePointerObservable, o.onPointerObservable, e, (function(t, i) {
                            if (o.onPrePointerObservable.hasObservers() && !t.ignore) {
                                if (!t.hasSwiped) {
                                    if (t.singleClick && o.onPrePointerObservable.hasSpecificMask(dt.POINTERTAP) && r._checkPrePointerObservable(null, e, dt.POINTERTAP)) return;
                                    if (t.doubleClick && o.onPrePointerObservable.hasSpecificMask(dt.POINTERDOUBLETAP) && r._checkPrePointerObservable(null, e, dt.POINTERDOUBLETAP)) return
                                }
                                if (r._checkPrePointerObservable(null, e, dt.POINTERUP)) return
                            }
                            r._pointerCaptures[e.pointerId] && (r._pointerCaptures[e.pointerId] = !1, (o.cameraToUseForPointers || o.activeCamera) && (o.pointerUpPredicate || (o.pointerUpPredicate = function(e) {
                                return e.isPickable && e.isVisible && e.isReady() && e.isEnabled() && (!o.cameraToUseForPointers || 0 != (o.cameraToUseForPointers.layerMask & e.layerMask))
                            }), !r._meshPickProceed && (gt && gt.HasTriggers || o.onPointerObservable.hasObservers()) && r._initActionManager(null, t), i || (i = r._currentPickResult), r._processPointerUp(i, e, t), r._previousPickResult = r._currentPickResult))
                        })))
                    }, this._onKeyDown = function(e) {
                        var t = mt.KEYDOWN;
                        if (o.onPreKeyboardObservable.hasObservers()) {
                            var i = new yt(t, e);
                            if (o.onPreKeyboardObservable.notifyObservers(i, t), i.skipOnPointerObservable) return
                        }
                        if (o.onKeyboardObservable.hasObservers()) {
                            i = new vt(t, e);
                            o.onKeyboardObservable.notifyObservers(i, t)
                        }
                        o.actionManager && o.actionManager.processTrigger(k.ACTION_OnKeyDownTrigger, ot.CreateNewFromScene(o, e))
                    }, this._onKeyUp = function(e) {
                        var t = mt.KEYUP;
                        if (o.onPreKeyboardObservable.hasObservers()) {
                            var i = new yt(t, e);
                            if (o.onPreKeyboardObservable.notifyObservers(i, t), i.skipOnPointerObservable) return
                        }
                        if (o.onKeyboardObservable.hasObservers()) {
                            i = new vt(t, e);
                            o.onKeyboardObservable.notifyObservers(i, t)
                        }
                        o.actionManager && o.actionManager.processTrigger(k.ACTION_OnKeyUpTrigger, ot.CreateNewFromScene(o, e))
                    }, this._onCanvasFocusObserver = a.onCanvasFocusObservable.add((function() {
                        s && (s.addEventListener("keydown", r._onKeyDown, !1), s.addEventListener("keyup", r._onKeyUp, !1))
                    })), this._onCanvasBlurObserver = a.onCanvasBlurObservable.add((function() {
                        s && (s.removeEventListener("keydown", r._onKeyDown), s.removeEventListener("keyup", r._onKeyUp))
                    }));
                    var u = K.GetPointerPrefix();
                    n && (s.addEventListener(u + "move", this._onPointerMove, !1), this._wheelEventName = "onwheel" in document.createElement("div") ? "wheel" : void 0 !== document.onmousewheel ? "mousewheel" : "DOMMouseScroll", s.addEventListener(this._wheelEventName, this._onPointerMove, !1)), i && s.addEventListener(u + "down", this._onPointerDown, !1), t && window.addEventListener(u + "up", this._onPointerUp, !1)
                }
            }, e.prototype.detachControl = function() {
                var e = K.GetPointerPrefix(),
                    t = this._scene.getEngine().getRenderingCanvas(),
                    i = this._scene.getEngine();
                t && (t.removeEventListener(e + "move", this._onPointerMove), t.removeEventListener(e + "down", this._onPointerDown), window.removeEventListener(e + "up", this._onPointerUp), this._onCanvasBlurObserver && i.onCanvasBlurObservable.remove(this._onCanvasBlurObserver), this._onCanvasFocusObserver && i.onCanvasFocusObservable.remove(this._onCanvasFocusObserver), t.removeEventListener("keydown", this._onKeyDown), t.removeEventListener("keyup", this._onKeyUp), t.style.cursor = this._scene.defaultCursor)
            }, e.prototype.setPointerOverMesh = function(e) {
                var t;
                this._pointerOverMesh !== e && (this._pointerOverMesh && (t = this._pointerOverMesh._getActionManagerForTrigger(k.ACTION_OnPointerOutTrigger)) && t.processTrigger(k.ACTION_OnPointerOutTrigger, ot.CreateNew(this._pointerOverMesh)), this._pointerOverMesh = e, this._pointerOverMesh && (t = this._pointerOverMesh._getActionManagerForTrigger(k.ACTION_OnPointerOverTrigger)) && t.processTrigger(k.ACTION_OnPointerOverTrigger, ot.CreateNew(this._pointerOverMesh)))
            }, e.prototype.getPointerOverMesh = function() {
                return this._pointerOverMesh
            }, e.DragMovementThreshold = 10, e.LongPressDelay = 500, e.DoubleClickDelay = 300, e.ExclusiveDoubleClickMode = !1, e
        }(),
        Et = function(e) {
            function t(i, n) {
                var r = e.call(this) || this;
                return r._inputManager = new bt(r), r.cameraToUseForPointers = null, r._isScene = !0, r.autoClear = !0, r.autoClearDepthAndStencil = !0, r.clearColor = new y(.2, .2, .3, 1), r.ambientColor = new v(0, 0, 0), r._forceWireframe = !1, r._forcePointsCloud = !1, r.animationsEnabled = !0, r._animationPropertiesOverride = null, r.useConstantAnimationDeltaTime = !1, r.constantlyUpdateMeshUnderPointer = !1, r.hoverCursor = "pointer", r.defaultCursor = "", r.preventDefaultOnPointerDown = !0, r.preventDefaultOnPointerUp = !0, r.metadata = null, r.reservedDataStore = null, r.disableOfflineSupportExceptionRules = new Array, r.onDisposeObservable = new l, r._onDisposeObserver = null, r.onBeforeRenderObservable = new l, r._onBeforeRenderObserver = null, r.onAfterRenderObservable = new l, r._onAfterRenderObserver = null, r.onBeforeAnimationsObservable = new l, r.onAfterAnimationsObservable = new l, r.onBeforeDrawPhaseObservable = new l, r.onAfterDrawPhaseObservable = new l, r.onReadyObservable = new l, r.onBeforeCameraRenderObservable = new l, r._onBeforeCameraRenderObserver = null, r.onAfterCameraRenderObservable = new l, r._onAfterCameraRenderObserver = null, r.onBeforeActiveMeshesEvaluationObservable = new l, r.onAfterActiveMeshesEvaluationObservable = new l, r.onBeforeParticlesRenderingObservable = new l, r.onAfterParticlesRenderingObservable = new l, r.onDataLoadedObservable = new l, r.onNewCameraAddedObservable = new l, r.onCameraRemovedObservable = new l, r.onNewLightAddedObservable = new l, r.onLightRemovedObservable = new l, r.onNewGeometryAddedObservable = new l, r.onGeometryRemovedObservable = new l, r.onNewTransformNodeAddedObservable = new l, r.onTransformNodeRemovedObservable = new l, r.onNewMeshAddedObservable = new l, r.onMeshRemovedObservable = new l, r.onNewSkeletonAddedObservable = new l, r.onSkeletonRemovedObservable = new l, r.onNewMaterialAddedObservable = new l, r.onMaterialRemovedObservable = new l, r.onNewTextureAddedObservable = new l, r.onTextureRemovedObservable = new l, r.onBeforeRenderTargetsRenderObservable = new l, r.onAfterRenderTargetsRenderObservable = new l, r.onBeforeStepObservable = new l, r.onAfterStepObservable = new l, r.onActiveCameraChanged = new l, r.onBeforeRenderingGroupObservable = new l, r.onAfterRenderingGroupObservable = new l, r.onMeshImportedObservable = new l, r._registeredForLateAnimationBindings = new Xe(256), r.onPrePointerObservable = new l, r.onPointerObservable = new l, r.onPreKeyboardObservable = new l, r.onKeyboardObservable = new l, r._useRightHandedSystem = !1, r._timeAccumulator = 0, r._currentStepId = 0, r._currentInternalStep = 0, r._fogEnabled = !0, r._fogMode = t.FOGMODE_NONE, r.fogColor = new v(.2, .2, .3), r.fogDensity = .1, r.fogStart = 0, r.fogEnd = 1e3, r._shadowsEnabled = !0, r._lightsEnabled = !0, r.activeCameras = new Array, r._texturesEnabled = !0, r.particlesEnabled = !0, r.spritesEnabled = !0, r._skeletonsEnabled = !0, r.lensFlaresEnabled = !0, r.collisionsEnabled = !0, r.gravity = new b(0, -9.807, 0), r.postProcessesEnabled = !0, r.postProcesses = new Array, r.renderTargetsEnabled = !0, r.dumpNextRenderTargets = !1, r.customRenderTargets = new Array, r.importedMeshesFiles = new Array, r.probesEnabled = !0, r._meshesForIntersections = new Xe(256), r.proceduralTexturesEnabled = !0, r._totalVertices = new q, r._activeIndices = new q, r._activeParticles = new q, r._activeBones = new q, r._animationTime = 0, r.animationTimeScale = 1, r._renderId = 0, r._frameId = 0, r._executeWhenReadyTimeoutId = -1, r._intermediateRendering = !1, r._viewUpdateFlag = -1, r._projectionUpdateFlag = -1, r._toBeDisposed = new Array(256), r._activeRequests = new Array, r._pendingData = new Array, r._isDisposed = !1, r.dispatchAllSubMeshesOfActiveMeshes = !1, r._activeMeshes = new We(256), r._processedMaterials = new We(256), r._renderTargets = new Xe(256), r._activeParticleSystems = new We(256), r._activeSkeletons = new Xe(32), r._softwareSkinnedMeshes = new Xe(32), r._activeAnimatables = new Array, r._transformMatrix = R.Zero(), r.requireLightSorting = !1, r._components = [], r._serializableComponents = [], r._transientComponents = [], r._beforeCameraUpdateStage = ct.Create(), r._beforeClearStage = ct.Create(), r._gatherRenderTargetsStage = ct.Create(), r._gatherActiveCameraRenderTargetsStage = ct.Create(), r._isReadyForMeshStage = ct.Create(), r._beforeEvaluateActiveMeshStage = ct.Create(), r._evaluateSubMeshStage = ct.Create(), r._activeMeshStage = ct.Create(), r._cameraDrawRenderTargetStage = ct.Create(), r._beforeCameraDrawStage = ct.Create(), r._beforeRenderTargetDrawStage = ct.Create(), r._beforeRenderingGroupDrawStage = ct.Create(), r._beforeRenderingMeshStage = ct.Create(), r._afterRenderingMeshStage = ct.Create(), r._afterRenderingGroupDrawStage = ct.Create(), r._afterCameraDrawStage = ct.Create(), r._afterRenderTargetDrawStage = ct.Create(), r._afterRenderStage = ct.Create(), r._pointerMoveStage = ct.Create(), r._pointerDownStage = ct.Create(), r._pointerUpStage = ct.Create(), r.geometriesByUniqueId = null, r._defaultMeshCandidates = {
                    data: [],
                    length: 0
                }, r._defaultSubMeshCandidates = {
                    data: [],
                    length: 0
                }, r._preventFreeActiveMeshesAndRenderingGroups = !1, r._activeMeshesFrozen = !1, r._allowPostProcessClearColor = !0, r.getDeterministicFrameTime = function() {
                    return 1e3 / 60
                }, r._blockMaterialDirtyMechanism = !1, r._engine = i || ve.LastCreatedEngine, n && n.virtual || (ve._LastCreatedScene = r, r._engine.scenes.push(r)), r._uid = null, r._renderingManager = new ht(r), st && (r.postProcessManager = new st(r)), c.IsWindowObjectExist() && r.attachControl(), r._createUbo(), nt && (r._imageProcessingConfiguration = new nt), r.setDefaultCandidateProviders(), n && !0 === n.useGeometryUniqueIdsMap && (r.geometriesByUniqueId = {}), r.useMaterialMeshMap = n && n.useGeometryUniqueIdsMap || !1, r.useClonedMeshhMap = n && n.useClonedMeshhMap || !1, n && n.virtual || r._engine.onNewSceneAddedObservable.notifyObservers(r), r
            }
            return r(t, e), t.DefaultMaterialFactory = function(e) {
                throw X.WarnImport("StandardMaterial")
            }, t.CollisionCoordinatorFactory = function() {
                throw X.WarnImport("DefaultCollisionCoordinator")
            }, Object.defineProperty(t.prototype, "environmentTexture", {
                get: function() {
                    return this._environmentTexture
                },
                set: function(e) {
                    this._environmentTexture !== e && (this._environmentTexture = e, this.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "imageProcessingConfiguration", {
                get: function() {
                    return this._imageProcessingConfiguration
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "forceWireframe", {
                get: function() {
                    return this._forceWireframe
                },
                set: function(e) {
                    this._forceWireframe !== e && (this._forceWireframe = e, this.markAllMaterialsAsDirty(k.MATERIAL_MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "forcePointsCloud", {
                get: function() {
                    return this._forcePointsCloud
                },
                set: function(e) {
                    this._forcePointsCloud !== e && (this._forcePointsCloud = e, this.markAllMaterialsAsDirty(k.MATERIAL_MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "animationPropertiesOverride", {
                get: function() {
                    return this._animationPropertiesOverride
                },
                set: function(e) {
                    this._animationPropertiesOverride = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "onDispose", {
                set: function(e) {
                    this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "beforeRender", {
                set: function(e) {
                    this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver), e && (this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "afterRender", {
                set: function(e) {
                    this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver), e && (this._onAfterRenderObserver = this.onAfterRenderObservable.add(e))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "beforeCameraRender", {
                set: function(e) {
                    this._onBeforeCameraRenderObserver && this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver), this._onBeforeCameraRenderObserver = this.onBeforeCameraRenderObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "afterCameraRender", {
                set: function(e) {
                    this._onAfterCameraRenderObserver && this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver), this._onAfterCameraRenderObserver = this.onAfterCameraRenderObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "unTranslatedPointer", {
                get: function() {
                    return this._inputManager.unTranslatedPointer
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "DragMovementThreshold", {
                get: function() {
                    return bt.DragMovementThreshold
                },
                set: function(e) {
                    bt.DragMovementThreshold = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "LongPressDelay", {
                get: function() {
                    return bt.LongPressDelay
                },
                set: function(e) {
                    bt.LongPressDelay = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "DoubleClickDelay", {
                get: function() {
                    return bt.DoubleClickDelay
                },
                set: function(e) {
                    bt.DoubleClickDelay = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "ExclusiveDoubleClickMode", {
                get: function() {
                    return bt.ExclusiveDoubleClickMode
                },
                set: function(e) {
                    bt.ExclusiveDoubleClickMode = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "useRightHandedSystem", {
                get: function() {
                    return this._useRightHandedSystem
                },
                set: function(e) {
                    this._useRightHandedSystem !== e && (this._useRightHandedSystem = e, this.markAllMaterialsAsDirty(k.MATERIAL_MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.setStepId = function(e) {
                this._currentStepId = e
            }, t.prototype.getStepId = function() {
                return this._currentStepId
            }, t.prototype.getInternalStep = function() {
                return this._currentInternalStep
            }, Object.defineProperty(t.prototype, "fogEnabled", {
                get: function() {
                    return this._fogEnabled
                },
                set: function(e) {
                    this._fogEnabled !== e && (this._fogEnabled = e, this.markAllMaterialsAsDirty(k.MATERIAL_MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "fogMode", {
                get: function() {
                    return this._fogMode
                },
                set: function(e) {
                    this._fogMode !== e && (this._fogMode = e, this.markAllMaterialsAsDirty(k.MATERIAL_MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "shadowsEnabled", {
                get: function() {
                    return this._shadowsEnabled
                },
                set: function(e) {
                    this._shadowsEnabled !== e && (this._shadowsEnabled = e, this.markAllMaterialsAsDirty(k.MATERIAL_LightDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "lightsEnabled", {
                get: function() {
                    return this._lightsEnabled
                },
                set: function(e) {
                    this._lightsEnabled !== e && (this._lightsEnabled = e, this.markAllMaterialsAsDirty(k.MATERIAL_LightDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "activeCamera", {
                get: function() {
                    return this._activeCamera
                },
                set: function(e) {
                    e !== this._activeCamera && (this._activeCamera = e, this.onActiveCameraChanged.notifyObservers(this))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "defaultMaterial", {
                get: function() {
                    return this._defaultMaterial || (this._defaultMaterial = t.DefaultMaterialFactory(this)), this._defaultMaterial
                },
                set: function(e) {
                    this._defaultMaterial = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "texturesEnabled", {
                get: function() {
                    return this._texturesEnabled
                },
                set: function(e) {
                    this._texturesEnabled !== e && (this._texturesEnabled = e, this.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "skeletonsEnabled", {
                get: function() {
                    return this._skeletonsEnabled
                },
                set: function(e) {
                    this._skeletonsEnabled !== e && (this._skeletonsEnabled = e, this.markAllMaterialsAsDirty(k.MATERIAL_AttributesDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "collisionCoordinator", {
                get: function() {
                    return this._collisionCoordinator || (this._collisionCoordinator = t.CollisionCoordinatorFactory(), this._collisionCoordinator.init(this)), this._collisionCoordinator
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "frustumPlanes", {
                get: function() {
                    return this._frustumPlanes
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._registerTransientComponents = function() {
                if (this._transientComponents.length > 0) {
                    for (var e = 0, t = this._transientComponents; e < t.length; e++) {
                        t[e].register()
                    }
                    this._transientComponents = []
                }
            }, t.prototype._addComponent = function(e) {
                this._components.push(e), this._transientComponents.push(e);
                var t = e;
                t.addFromContainer && this._serializableComponents.push(t)
            }, t.prototype._getComponent = function(e) {
                for (var t = 0, i = this._components; t < i.length; t++) {
                    var n = i[t];
                    if (n.name === e) return n
                }
                return null
            }, t.prototype.getClassName = function() {
                return "Scene"
            }, t.prototype._getDefaultMeshCandidates = function() {
                return this._defaultMeshCandidates.data = this.meshes, this._defaultMeshCandidates.length = this.meshes.length, this._defaultMeshCandidates
            }, t.prototype._getDefaultSubMeshCandidates = function(e) {
                return this._defaultSubMeshCandidates.data = e.subMeshes, this._defaultSubMeshCandidates.length = e.subMeshes.length, this._defaultSubMeshCandidates
            }, t.prototype.setDefaultCandidateProviders = function() {
                this.getActiveMeshCandidates = this._getDefaultMeshCandidates.bind(this), this.getActiveSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this), this.getIntersectingSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this), this.getCollidingSubMeshCandidates = this._getDefaultSubMeshCandidates.bind(this)
            }, Object.defineProperty(t.prototype, "meshUnderPointer", {
                get: function() {
                    return this._inputManager.meshUnderPointer
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "pointerX", {
                get: function() {
                    return this._inputManager.pointerX
                },
                set: function(e) {
                    this._inputManager.pointerX = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "pointerY", {
                get: function() {
                    return this._inputManager.pointerY
                },
                set: function(e) {
                    this._inputManager.pointerY = e
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getCachedMaterial = function() {
                return this._cachedMaterial
            }, t.prototype.getCachedEffect = function() {
                return this._cachedEffect
            }, t.prototype.getCachedVisibility = function() {
                return this._cachedVisibility
            }, t.prototype.isCachedMaterialInvalid = function(e, t, i) {
                return void 0 === i && (i = 1), this._cachedEffect !== t || this._cachedMaterial !== e || this._cachedVisibility !== i
            }, t.prototype.getEngine = function() {
                return this._engine
            }, t.prototype.getTotalVertices = function() {
                return this._totalVertices.current
            }, Object.defineProperty(t.prototype, "totalVerticesPerfCounter", {
                get: function() {
                    return this._totalVertices
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getActiveIndices = function() {
                return this._activeIndices.current
            }, Object.defineProperty(t.prototype, "totalActiveIndicesPerfCounter", {
                get: function() {
                    return this._activeIndices
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getActiveParticles = function() {
                return this._activeParticles.current
            }, Object.defineProperty(t.prototype, "activeParticlesPerfCounter", {
                get: function() {
                    return this._activeParticles
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getActiveBones = function() {
                return this._activeBones.current
            }, Object.defineProperty(t.prototype, "activeBonesPerfCounter", {
                get: function() {
                    return this._activeBones
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getActiveMeshes = function() {
                return this._activeMeshes
            }, t.prototype.getAnimationRatio = function() {
                return void 0 !== this._animationRatio ? this._animationRatio : 1
            }, t.prototype.getRenderId = function() {
                return this._renderId
            }, t.prototype.getFrameId = function() {
                return this._frameId
            }, t.prototype.incrementRenderId = function() {
                this._renderId++
            }, t.prototype._createUbo = function() {
                this._sceneUbo = new Oe(this._engine, void 0, !0), this._sceneUbo.addUniform("viewProjection", 16), this._sceneUbo.addUniform("view", 16)
            }, t.prototype.simulatePointerMove = function(e, t) {
                return this._inputManager.simulatePointerMove(e, t), this
            }, t.prototype.simulatePointerDown = function(e, t) {
                return this._inputManager.simulatePointerDown(e, t), this
            }, t.prototype.simulatePointerUp = function(e, t, i) {
                return this._inputManager.simulatePointerUp(e, t, i), this
            }, t.prototype.isPointerCaptured = function(e) {
                return void 0 === e && (e = 0), this._inputManager.isPointerCaptured(e)
            }, t.prototype.attachControl = function(e, t, i) {
                void 0 === e && (e = !0), void 0 === t && (t = !0), void 0 === i && (i = !0), this._inputManager.attachControl(e, t, i)
            }, t.prototype.detachControl = function() {
                this._inputManager.detachControl()
            }, t.prototype.isReady = function() {
                if (this._isDisposed) return !1;
                var e, t = this.getEngine();
                if (!t.areAllEffectsReady()) return !1;
                if (this._pendingData.length > 0) return !1;
                for (e = 0; e < this.meshes.length; e++) {
                    var i = this.meshes[e];
                    if (i.isEnabled() && (i.subMeshes && 0 !== i.subMeshes.length)) {
                        if (!i.isReady(!0)) return !1;
                        for (var n = "InstancedMesh" === i.getClassName() || "InstancedLinesMesh" === i.getClassName() || t.getCaps().instancedArrays && i.instances.length > 0, r = 0, o = this._isReadyForMeshStage; r < o.length; r++) {
                            if (!o[r].action(i, n)) return !1
                        }
                    }
                }
                for (e = 0; e < this.geometries.length; e++) {
                    if (this.geometries[e].delayLoadState === k.DELAYLOADSTATE_LOADING) return !1
                }
                if (this.activeCameras && this.activeCameras.length > 0)
                    for (var s = 0, a = this.activeCameras; s < a.length; s++) {
                        if (!a[s].isReady(!0)) return !1
                    } else if (this.activeCamera && !this.activeCamera.isReady(!0)) return !1;
                for (var u = 0, h = this.particleSystems; u < h.length; u++) {
                    if (!h[u].isReady()) return !1
                }
                return !0
            }, t.prototype.resetCachedMaterial = function() {
                this._cachedMaterial = null, this._cachedEffect = null, this._cachedVisibility = null
            }, t.prototype.registerBeforeRender = function(e) {
                this.onBeforeRenderObservable.add(e)
            }, t.prototype.unregisterBeforeRender = function(e) {
                this.onBeforeRenderObservable.removeCallback(e)
            }, t.prototype.registerAfterRender = function(e) {
                this.onAfterRenderObservable.add(e)
            }, t.prototype.unregisterAfterRender = function(e) {
                this.onAfterRenderObservable.removeCallback(e)
            }, t.prototype._executeOnceBeforeRender = function(e) {
                var t = this,
                    i = function() {
                        e(), setTimeout((function() {
                            t.unregisterBeforeRender(i)
                        }))
                    };
                this.registerBeforeRender(i)
            }, t.prototype.executeOnceBeforeRender = function(e, t) {
                var i = this;
                void 0 !== t ? setTimeout((function() {
                    i._executeOnceBeforeRender(e)
                }), t) : this._executeOnceBeforeRender(e)
            }, t.prototype._addPendingData = function(e) {
                this._pendingData.push(e)
            }, t.prototype._removePendingData = function(e) {
                var t = this.isLoading,
                    i = this._pendingData.indexOf(e); - 1 !== i && this._pendingData.splice(i, 1), t && !this.isLoading && this.onDataLoadedObservable.notifyObservers(this)
            }, t.prototype.getWaitingItemsCount = function() {
                return this._pendingData.length
            }, Object.defineProperty(t.prototype, "isLoading", {
                get: function() {
                    return this._pendingData.length > 0
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.executeWhenReady = function(e) {
                var t = this;
                this.onReadyObservable.add(e), -1 === this._executeWhenReadyTimeoutId && (this._executeWhenReadyTimeoutId = setTimeout((function() {
                    t._checkIsReady()
                }), 150))
            }, t.prototype.whenReadyAsync = function() {
                var e = this;
                return new Promise((function(t) {
                    e.executeWhenReady((function() {
                        t()
                    }))
                }))
            }, t.prototype._checkIsReady = function() {
                var e = this;
                if (this._registerTransientComponents(), this.isReady()) return this.onReadyObservable.notifyObservers(this), this.onReadyObservable.clear(), void(this._executeWhenReadyTimeoutId = -1);
                this._executeWhenReadyTimeoutId = setTimeout((function() {
                    e._checkIsReady()
                }), 150)
            }, Object.defineProperty(t.prototype, "animatables", {
                get: function() {
                    return this._activeAnimatables
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.resetLastAnimationTimeFrame = function() {
                this._animationTimeLast = d.Now
            }, t.prototype.getViewMatrix = function() {
                return this._viewMatrix
            }, t.prototype.getProjectionMatrix = function() {
                return this._projectionMatrix
            }, t.prototype.getTransformMatrix = function() {
                return this._transformMatrix
            }, t.prototype.setTransformMatrix = function(e, t, i, n) {
                this._viewUpdateFlag === e.updateFlag && this._projectionUpdateFlag === t.updateFlag || (this._viewUpdateFlag = e.updateFlag, this._projectionUpdateFlag = t.updateFlag, this._viewMatrix = e, this._projectionMatrix = t, this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix), this._frustumPlanes ? I.GetPlanesToRef(this._transformMatrix, this._frustumPlanes) : this._frustumPlanes = I.GetPlanes(this._transformMatrix), this._multiviewSceneUbo && this._multiviewSceneUbo.useUbo ? this._updateMultiviewUbo(i, n) : this._sceneUbo.useUbo && (this._sceneUbo.updateMatrix("viewProjection", this._transformMatrix), this._sceneUbo.updateMatrix("view", this._viewMatrix), this._sceneUbo.update()))
            }, t.prototype.getSceneUniformBuffer = function() {
                return this._multiviewSceneUbo ? this._multiviewSceneUbo : this._sceneUbo
            }, t.prototype.getUniqueId = function() {
                var e = t._uniqueIdCounter;
                return t._uniqueIdCounter++, e
            }, t.prototype.addMesh = function(e, t) {
                var i = this;
                void 0 === t && (t = !1), this.meshes.push(e), e._resyncLightSources(), this.onNewMeshAddedObservable.notifyObservers(e), t && e.getChildMeshes().forEach((function(e) {
                    i.addMesh(e)
                }))
            }, t.prototype.removeMesh = function(e, t) {
                var i = this;
                void 0 === t && (t = !1);
                var n = this.meshes.indexOf(e);
                return -1 !== n && (this.meshes[n] = this.meshes[this.meshes.length - 1], this.meshes.pop()), this.onMeshRemovedObservable.notifyObservers(e), t && e.getChildMeshes().forEach((function(e) {
                    i.removeMesh(e)
                })), n
            }, t.prototype.addTransformNode = function(e) {
                e._indexInSceneTransformNodesArray = this.transformNodes.length, this.transformNodes.push(e), this.onNewTransformNodeAddedObservable.notifyObservers(e)
            }, t.prototype.removeTransformNode = function(e) {
                var t = e._indexInSceneTransformNodesArray;
                if (-1 !== t) {
                    if (t !== this.transformNodes.length - 1) {
                        var i = this.transformNodes[this.transformNodes.length - 1];
                        this.transformNodes[t] = i, i._indexInSceneTransformNodesArray = t
                    }
                    e._indexInSceneTransformNodesArray = -1, this.transformNodes.pop()
                }
                return this.onTransformNodeRemovedObservable.notifyObservers(e), t
            }, t.prototype.removeSkeleton = function(e) {
                var t = this.skeletons.indexOf(e);
                return -1 !== t && (this.skeletons.splice(t, 1), this.onSkeletonRemovedObservable.notifyObservers(e)), t
            }, t.prototype.removeMorphTargetManager = function(e) {
                var t = this.morphTargetManagers.indexOf(e);
                return -1 !== t && this.morphTargetManagers.splice(t, 1), t
            }, t.prototype.removeLight = function(e) {
                var t = this.lights.indexOf(e);
                if (-1 !== t) {
                    for (var i = 0, n = this.meshes; i < n.length; i++) {
                        n[i]._removeLightSource(e)
                    }
                    this.lights.splice(t, 1), this.sortLightsByPriority()
                }
                return this.onLightRemovedObservable.notifyObservers(e), t
            }, t.prototype.removeCamera = function(e) {
                var t = this.cameras.indexOf(e); - 1 !== t && this.cameras.splice(t, 1);
                var i = this.activeCameras.indexOf(e);
                return -1 !== i && this.activeCameras.splice(i, 1), this.activeCamera === e && (this.cameras.length > 0 ? this.activeCamera = this.cameras[0] : this.activeCamera = null), this.onCameraRemovedObservable.notifyObservers(e), t
            }, t.prototype.removeParticleSystem = function(e) {
                var t = this.particleSystems.indexOf(e);
                return -1 !== t && this.particleSystems.splice(t, 1), t
            }, t.prototype.removeAnimation = function(e) {
                var t = this.animations.indexOf(e);
                return -1 !== t && this.animations.splice(t, 1), t
            }, t.prototype.stopAnimation = function(e, t, i) {}, t.prototype.removeAnimationGroup = function(e) {
                var t = this.animationGroups.indexOf(e);
                return -1 !== t && this.animationGroups.splice(t, 1), t
            }, t.prototype.removeMultiMaterial = function(e) {
                var t = this.multiMaterials.indexOf(e);
                return -1 !== t && this.multiMaterials.splice(t, 1), t
            }, t.prototype.removeMaterial = function(e) {
                var t = e._indexInSceneMaterialArray;
                if (-1 !== t && t < this.materials.length) {
                    if (t !== this.materials.length - 1) {
                        var i = this.materials[this.materials.length - 1];
                        this.materials[t] = i, i._indexInSceneMaterialArray = t
                    }
                    e._indexInSceneMaterialArray = -1, this.materials.pop()
                }
                return this.onMaterialRemovedObservable.notifyObservers(e), t
            }, t.prototype.removeActionManager = function(e) {
                var t = this.actionManagers.indexOf(e);
                return -1 !== t && this.actionManagers.splice(t, 1), t
            }, t.prototype.removeTexture = function(e) {
                var t = this.textures.indexOf(e);
                return -1 !== t && this.textures.splice(t, 1), this.onTextureRemovedObservable.notifyObservers(e), t
            }, t.prototype.addLight = function(e) {
                this.lights.push(e), this.sortLightsByPriority();
                for (var t = 0, i = this.meshes; t < i.length; t++) {
                    var n = i[t]; - 1 === n.lightSources.indexOf(e) && (n.lightSources.push(e), n._resyncLightSources())
                }
                this.onNewLightAddedObservable.notifyObservers(e)
            }, t.prototype.sortLightsByPriority = function() {
                this.requireLightSorting && this.lights.sort(rt.CompareLightsPriority)
            }, t.prototype.addCamera = function(e) {
                this.cameras.push(e), this.onNewCameraAddedObservable.notifyObservers(e)
            }, t.prototype.addSkeleton = function(e) {
                this.skeletons.push(e), this.onNewSkeletonAddedObservable.notifyObservers(e)
            }, t.prototype.addParticleSystem = function(e) {
                this.particleSystems.push(e)
            }, t.prototype.addAnimation = function(e) {
                this.animations.push(e)
            }, t.prototype.addAnimationGroup = function(e) {
                this.animationGroups.push(e)
            }, t.prototype.addMultiMaterial = function(e) {
                this.multiMaterials.push(e)
            }, t.prototype.addMaterial = function(e) {
                e._indexInSceneMaterialArray = this.materials.length, this.materials.push(e), this.onNewMaterialAddedObservable.notifyObservers(e)
            }, t.prototype.addMorphTargetManager = function(e) {
                this.morphTargetManagers.push(e)
            }, t.prototype.addGeometry = function(e) {
                this.geometriesByUniqueId && (this.geometriesByUniqueId[e.uniqueId] = this.geometries.length), this.geometries.push(e)
            }, t.prototype.addActionManager = function(e) {
                this.actionManagers.push(e)
            }, t.prototype.addTexture = function(e) {
                this.textures.push(e), this.onNewTextureAddedObservable.notifyObservers(e)
            }, t.prototype.switchActiveCamera = function(e, t) {
                void 0 === t && (t = !0);
                var i = this._engine.getRenderingCanvas();
                i && (this.activeCamera && this.activeCamera.detachControl(i), this.activeCamera = e, t && e.attachControl(i))
            }, t.prototype.setActiveCameraByID = function(e) {
                var t = this.getCameraByID(e);
                return t ? (this.activeCamera = t, t) : null
            }, t.prototype.setActiveCameraByName = function(e) {
                var t = this.getCameraByName(e);
                return t ? (this.activeCamera = t, t) : null
            }, t.prototype.getAnimationGroupByName = function(e) {
                for (var t = 0; t < this.animationGroups.length; t++)
                    if (this.animationGroups[t].name === e) return this.animationGroups[t];
                return null
            }, t.prototype.getMaterialByUniqueID = function(e) {
                for (var t = 0; t < this.materials.length; t++)
                    if (this.materials[t].uniqueId === e) return this.materials[t];
                return null
            }, t.prototype.getMaterialByID = function(e) {
                for (var t = 0; t < this.materials.length; t++)
                    if (this.materials[t].id === e) return this.materials[t];
                return null
            }, t.prototype.getMaterialByName = function(e) {
                for (var t = 0; t < this.materials.length; t++)
                    if (this.materials[t].name === e) return this.materials[t];
                return null
            }, t.prototype.getCameraByID = function(e) {
                for (var t = 0; t < this.cameras.length; t++)
                    if (this.cameras[t].id === e) return this.cameras[t];
                return null
            }, t.prototype.getCameraByUniqueID = function(e) {
                for (var t = 0; t < this.cameras.length; t++)
                    if (this.cameras[t].uniqueId === e) return this.cameras[t];
                return null
            }, t.prototype.getCameraByName = function(e) {
                for (var t = 0; t < this.cameras.length; t++)
                    if (this.cameras[t].name === e) return this.cameras[t];
                return null
            }, t.prototype.getBoneByID = function(e) {
                for (var t = 0; t < this.skeletons.length; t++)
                    for (var i = this.skeletons[t], n = 0; n < i.bones.length; n++)
                        if (i.bones[n].id === e) return i.bones[n];
                return null
            }, t.prototype.getBoneByName = function(e) {
                for (var t = 0; t < this.skeletons.length; t++)
                    for (var i = this.skeletons[t], n = 0; n < i.bones.length; n++)
                        if (i.bones[n].name === e) return i.bones[n];
                return null
            }, t.prototype.getLightByName = function(e) {
                for (var t = 0; t < this.lights.length; t++)
                    if (this.lights[t].name === e) return this.lights[t];
                return null
            }, t.prototype.getLightByID = function(e) {
                for (var t = 0; t < this.lights.length; t++)
                    if (this.lights[t].id === e) return this.lights[t];
                return null
            }, t.prototype.getLightByUniqueID = function(e) {
                for (var t = 0; t < this.lights.length; t++)
                    if (this.lights[t].uniqueId === e) return this.lights[t];
                return null
            }, t.prototype.getParticleSystemByID = function(e) {
                for (var t = 0; t < this.particleSystems.length; t++)
                    if (this.particleSystems[t].id === e) return this.particleSystems[t];
                return null
            }, t.prototype.getGeometryByID = function(e) {
                for (var t = 0; t < this.geometries.length; t++)
                    if (this.geometries[t].id === e) return this.geometries[t];
                return null
            }, t.prototype._getGeometryByUniqueID = function(e) {
                if (this.geometriesByUniqueId) {
                    var t = this.geometriesByUniqueId[e];
                    if (void 0 !== t) return this.geometries[t]
                } else
                    for (var i = 0; i < this.geometries.length; i++)
                        if (this.geometries[i].uniqueId === e) return this.geometries[i];
                return null
            }, t.prototype.pushGeometry = function(e, t) {
                return !(!t && this._getGeometryByUniqueID(e.uniqueId)) && (this.addGeometry(e), this.onNewGeometryAddedObservable.notifyObservers(e), !0)
            }, t.prototype.removeGeometry = function(e) {
                var t;
                if (this.geometriesByUniqueId) {
                    if (void 0 === (t = this.geometriesByUniqueId[e.uniqueId])) return !1
                } else if ((t = this.geometries.indexOf(e)) < 0) return !1;
                if (t !== this.geometries.length - 1) {
                    var i = this.geometries[this.geometries.length - 1];
                    this.geometries[t] = i, this.geometriesByUniqueId && (this.geometriesByUniqueId[i.uniqueId] = t, this.geometriesByUniqueId[e.uniqueId] = void 0)
                }
                return this.geometries.pop(), this.onGeometryRemovedObservable.notifyObservers(e), !0
            }, t.prototype.getGeometries = function() {
                return this.geometries
            }, t.prototype.getMeshByID = function(e) {
                for (var t = 0; t < this.meshes.length; t++)
                    if (this.meshes[t].id === e) return this.meshes[t];
                return null
            }, t.prototype.getMeshesByID = function(e) {
                return this.meshes.filter((function(t) {
                    return t.id === e
                }))
            }, t.prototype.getTransformNodeByID = function(e) {
                for (var t = 0; t < this.transformNodes.length; t++)
                    if (this.transformNodes[t].id === e) return this.transformNodes[t];
                return null
            }, t.prototype.getTransformNodeByUniqueID = function(e) {
                for (var t = 0; t < this.transformNodes.length; t++)
                    if (this.transformNodes[t].uniqueId === e) return this.transformNodes[t];
                return null
            }, t.prototype.getTransformNodesByID = function(e) {
                return this.transformNodes.filter((function(t) {
                    return t.id === e
                }))
            }, t.prototype.getMeshByUniqueID = function(e) {
                for (var t = 0; t < this.meshes.length; t++)
                    if (this.meshes[t].uniqueId === e) return this.meshes[t];
                return null
            }, t.prototype.getLastMeshByID = function(e) {
                for (var t = this.meshes.length - 1; t >= 0; t--)
                    if (this.meshes[t].id === e) return this.meshes[t];
                return null
            }, t.prototype.getLastEntryByID = function(e) {
                var t;
                for (t = this.meshes.length - 1; t >= 0; t--)
                    if (this.meshes[t].id === e) return this.meshes[t];
                for (t = this.transformNodes.length - 1; t >= 0; t--)
                    if (this.transformNodes[t].id === e) return this.transformNodes[t];
                for (t = this.cameras.length - 1; t >= 0; t--)
                    if (this.cameras[t].id === e) return this.cameras[t];
                for (t = this.lights.length - 1; t >= 0; t--)
                    if (this.lights[t].id === e) return this.lights[t];
                return null
            }, t.prototype.getNodeByID = function(e) {
                var t = this.getMeshByID(e);
                if (t) return t;
                var i = this.getTransformNodeByID(e);
                if (i) return i;
                var n = this.getLightByID(e);
                if (n) return n;
                var r = this.getCameraByID(e);
                if (r) return r;
                var o = this.getBoneByID(e);
                return o || null
            }, t.prototype.getNodeByName = function(e) {
                var t = this.getMeshByName(e);
                if (t) return t;
                var i = this.getTransformNodeByName(e);
                if (i) return i;
                var n = this.getLightByName(e);
                if (n) return n;
                var r = this.getCameraByName(e);
                if (r) return r;
                var o = this.getBoneByName(e);
                return o || null
            }, t.prototype.getMeshByName = function(e) {
                for (var t = 0; t < this.meshes.length; t++)
                    if (this.meshes[t].name === e) return this.meshes[t];
                return null
            }, t.prototype.getTransformNodeByName = function(e) {
                for (var t = 0; t < this.transformNodes.length; t++)
                    if (this.transformNodes[t].name === e) return this.transformNodes[t];
                return null
            }, t.prototype.getLastSkeletonByID = function(e) {
                for (var t = this.skeletons.length - 1; t >= 0; t--)
                    if (this.skeletons[t].id === e) return this.skeletons[t];
                return null
            }, t.prototype.getSkeletonByUniqueId = function(e) {
                for (var t = 0; t < this.skeletons.length; t++)
                    if (this.skeletons[t].uniqueId === e) return this.skeletons[t];
                return null
            }, t.prototype.getSkeletonById = function(e) {
                for (var t = 0; t < this.skeletons.length; t++)
                    if (this.skeletons[t].id === e) return this.skeletons[t];
                return null
            }, t.prototype.getSkeletonByName = function(e) {
                for (var t = 0; t < this.skeletons.length; t++)
                    if (this.skeletons[t].name === e) return this.skeletons[t];
                return null
            }, t.prototype.getMorphTargetManagerById = function(e) {
                for (var t = 0; t < this.morphTargetManagers.length; t++)
                    if (this.morphTargetManagers[t].uniqueId === e) return this.morphTargetManagers[t];
                return null
            }, t.prototype.getMorphTargetById = function(e) {
                for (var t = 0; t < this.morphTargetManagers.length; ++t)
                    for (var i = this.morphTargetManagers[t], n = 0; n < i.numTargets; ++n) {
                        var r = i.getTarget(n);
                        if (r.id === e) return r
                    }
                return null
            }, t.prototype.isActiveMesh = function(e) {
                return -1 !== this._activeMeshes.indexOf(e)
            }, Object.defineProperty(t.prototype, "uid", {
                get: function() {
                    return this._uid || (this._uid = K.RandomId()), this._uid
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.addExternalData = function(e, t) {
                return this._externalData || (this._externalData = new _), this._externalData.add(e, t)
            }, t.prototype.getExternalData = function(e) {
                return this._externalData ? this._externalData.get(e) : null
            }, t.prototype.getOrAddExternalDataWithFactory = function(e, t) {
                return this._externalData || (this._externalData = new _), this._externalData.getOrAddWithFactory(e, t)
            }, t.prototype.removeExternalData = function(e) {
                return this._externalData.remove(e)
            }, t.prototype._evaluateSubMesh = function(e, t, i) {
                if (i.isAnInstance || this.dispatchAllSubMeshesOfActiveMeshes || t.alwaysSelectAsActiveMesh || 1 === t.subMeshes.length || e.isInFrustum(this._frustumPlanes)) {
                    for (var n = 0, r = this._evaluateSubMeshStage; n < r.length; n++) {
                        r[n].action(t, e)
                    }
                    var o = e.getMaterial();
                    null != o && (o.hasRenderTargetTextures && null != o.getRenderTargetTextures && -1 === this._processedMaterials.indexOf(o) && (this._processedMaterials.push(o), this._renderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())), this._activeIndices.addCount(e.indexCount, !1), this._renderingManager.dispatch(e, t, o))
                }
            }, t.prototype.freeProcessedMaterials = function() {
                this._processedMaterials.dispose()
            }, Object.defineProperty(t.prototype, "blockfreeActiveMeshesAndRenderingGroups", {
                get: function() {
                    return this._preventFreeActiveMeshesAndRenderingGroups
                },
                set: function(e) {
                    this._preventFreeActiveMeshesAndRenderingGroups !== e && (e && (this.freeActiveMeshes(), this.freeRenderingGroups()), this._preventFreeActiveMeshesAndRenderingGroups = e)
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.freeActiveMeshes = function() {
                if (!this.blockfreeActiveMeshesAndRenderingGroups && (this._activeMeshes.dispose(), this.activeCamera && this.activeCamera._activeMeshes && this.activeCamera._activeMeshes.dispose(), this.activeCameras))
                    for (var e = 0; e < this.activeCameras.length; e++) {
                        var t = this.activeCameras[e];
                        t && t._activeMeshes && t._activeMeshes.dispose()
                    }
            }, t.prototype.freeRenderingGroups = function() {
                if (!this.blockfreeActiveMeshesAndRenderingGroups && (this._renderingManager && this._renderingManager.freeRenderingGroups(), this.textures))
                    for (var e = 0; e < this.textures.length; e++) {
                        var t = this.textures[e];
                        t && t.renderList && t.freeRenderingGroups()
                    }
            }, t.prototype._isInIntermediateRendering = function() {
                return this._intermediateRendering
            }, t.prototype.freezeActiveMeshes = function() {
                if (!this.activeCamera) return this;
                this._frustumPlanes || this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix()), this._evaluateActiveMeshes(), this._activeMeshesFrozen = !0;
                for (var e = 0; e < this._activeMeshes.length; e++) this._activeMeshes.data[e]._freeze();
                return this
            }, t.prototype.unfreezeActiveMeshes = function() {
                for (var e = 0; e < this._activeMeshes.length; e++) this._activeMeshes.data[e]._unFreeze();
                return this._activeMeshesFrozen = !1, this
            }, t.prototype._evaluateActiveMeshes = function() {
                if (this._activeMeshesFrozen && this._activeMeshes.length)
                    for (var e = this._activeMeshes.length, t = 0; t < e; t++) {
                        (s = this._activeMeshes.data[t]).computeWorldMatrix()
                    } else if (this.activeCamera) {
                        this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this), this.activeCamera._activeMeshes.reset(), this._activeMeshes.reset(), this._renderingManager.reset(), this._processedMaterials.reset(), this._activeParticleSystems.reset(), this._activeSkeletons.reset(), this._softwareSkinnedMeshes.reset();
                        for (var i = 0, n = this._beforeEvaluateActiveMeshStage; i < n.length; i++) {
                            n[i].action()
                        }
                        var r = this.getActiveMeshCandidates(),
                            o = r.length;
                        for (t = 0; t < o; t++) {
                            var s;
                            if (!(s = r.data[t]).isBlocked && (this._totalVertices.addCount(s.getTotalVertices(), !1), s.isReady() && s.isEnabled() && 0 !== s.scaling.lengthSquared())) {
                                s.computeWorldMatrix(), s.actionManager && s.actionManager.hasSpecificTriggers2(k.ACTION_OnIntersectionEnterTrigger, k.ACTION_OnIntersectionExitTrigger) && this._meshesForIntersections.pushNoDuplicate(s);
                                var a = this.customLODSelector ? this.customLODSelector(s, this.activeCamera) : s.getLOD(this.activeCamera);
                                null != a && (a !== s && a.billboardMode !== je.BILLBOARDMODE_NONE && a.computeWorldMatrix(), s._preActivate(), s.isVisible && s.visibility > 0 && 0 != (s.layerMask & this.activeCamera.layerMask) && (s.alwaysSelectAsActiveMesh || s.isInFrustum(this._frustumPlanes)) && (this._activeMeshes.push(s), this.activeCamera._activeMeshes.push(s), a !== s && a._activate(this._renderId, !1), s._activate(this._renderId, !1) && (s.isAnInstance || (a._internalAbstractMeshDataInfo._onlyForInstances = !1), a._internalAbstractMeshDataInfo._isActive = !0, this._activeMesh(s, a)), s._postActivate()))
                            }
                        }
                        if (this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this), this.particlesEnabled) {
                            this.onBeforeParticlesRenderingObservable.notifyObservers(this);
                            for (var u = 0; u < this.particleSystems.length; u++) {
                                var h = this.particleSystems[u];
                                if (h.isStarted() && h.emitter) {
                                    var l = h.emitter;
                                    l.position && !l.isEnabled() || (this._activeParticleSystems.push(h), h.animate(), this._renderingManager.dispatchParticles(h))
                                }
                            }
                            this.onAfterParticlesRenderingObservable.notifyObservers(this)
                        }
                    }
            }, t.prototype._activeMesh = function(e, t) {
                this._skeletonsEnabled && null !== t.skeleton && void 0 !== t.skeleton && (this._activeSkeletons.pushNoDuplicate(t.skeleton) && t.skeleton.prepare(), t.computeBonesUsingShaders || this._softwareSkinnedMeshes.pushNoDuplicate(t));
                for (var i = 0, n = this._activeMeshStage; i < n.length; i++) {
                    n[i].action(e, t)
                }
                if (null != t && void 0 !== t.subMeshes && null !== t.subMeshes && t.subMeshes.length > 0)
                    for (var r = this.getActiveSubMeshCandidates(t), o = r.length, s = 0; s < o; s++) {
                        var a = r.data[s];
                        this._evaluateSubMesh(a, t, e)
                    }
            }, t.prototype.updateTransformMatrix = function(e) {
                this.activeCamera && this.setTransformMatrix(this.activeCamera.getViewMatrix(), this.activeCamera.getProjectionMatrix(e))
            }, t.prototype._bindFrameBuffer = function() {
                if (this.activeCamera && this.activeCamera._multiviewTexture) this.activeCamera._multiviewTexture._bindFrameBuffer();
                else if (this.activeCamera && this.activeCamera.outputRenderTarget) {
                    if (this.getEngine().getCaps().multiview && this.activeCamera.outputRenderTarget && this.activeCamera.outputRenderTarget.getViewCount() > 1) this.activeCamera.outputRenderTarget._bindFrameBuffer();
                    else {
                        var e = this.activeCamera.outputRenderTarget.getInternalTexture();
                        e ? this.getEngine().bindFramebuffer(e) : V.Error("Camera contains invalid customDefaultRenderTarget")
                    }
                } else this.getEngine().restoreDefaultFramebuffer()
            }, t.prototype._renderForCamera = function(e, t) {
                if (!e || !e._skipRendering) {
                    var i = this._engine;
                    if (this._activeCamera = e, !this.activeCamera) throw new Error("Active camera not set");
                    i.setViewport(this.activeCamera.viewport), this.resetCachedMaterial(), this._renderId++, this.getEngine().getCaps().multiview && e.outputRenderTarget && e.outputRenderTarget.getViewCount() > 1 ? this.setTransformMatrix(e._rigCameras[0].getViewMatrix(), e._rigCameras[0].getProjectionMatrix(), e._rigCameras[1].getViewMatrix(), e._rigCameras[1].getProjectionMatrix()) : this.updateTransformMatrix(), this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera), this._evaluateActiveMeshes();
                    for (var n = 0; n < this._softwareSkinnedMeshes.length; n++) {
                        var r = this._softwareSkinnedMeshes.data[n];
                        r.applySkeleton(r.skeleton)
                    }
                    this.onBeforeRenderTargetsRenderObservable.notifyObservers(this), e.customRenderTargets && e.customRenderTargets.length > 0 && this._renderTargets.concatWithNoDuplicate(e.customRenderTargets), t && t.customRenderTargets && t.customRenderTargets.length > 0 && this._renderTargets.concatWithNoDuplicate(t.customRenderTargets);
                    for (var o = 0, s = this._gatherActiveCameraRenderTargetsStage; o < s.length; o++) {
                        s[o].action(this._renderTargets)
                    }
                    if (this.renderTargetsEnabled) {
                        this._intermediateRendering = !0;
                        var a = !1;
                        if (this._renderTargets.length > 0) {
                            K.StartPerformanceCounter("Render targets", this._renderTargets.length > 0);
                            for (var u = 0; u < this._renderTargets.length; u++) {
                                var h = this._renderTargets.data[u];
                                if (h._shouldRender()) {
                                    this._renderId++;
                                    var l = h.activeCamera && h.activeCamera !== this.activeCamera;
                                    h.render(l, this.dumpNextRenderTargets), a = !0
                                }
                            }
                            K.EndPerformanceCounter("Render targets", this._renderTargets.length > 0), this._renderId++
                        }
                        for (var c = 0, d = this._cameraDrawRenderTargetStage; c < d.length; c++) {
                            a = d[c].action(this.activeCamera) || a
                        }
                        this._intermediateRendering = !1, a && this._bindFrameBuffer()
                    }
                    this.onAfterRenderTargetsRenderObservable.notifyObservers(this), this.postProcessManager && !e._multiviewTexture && this.postProcessManager._prepareFrame();
                    for (var f = 0, p = this._beforeCameraDrawStage; f < p.length; f++) {
                        p[f].action(this.activeCamera)
                    }
                    this.onBeforeDrawPhaseObservable.notifyObservers(this), this._renderingManager.render(null, null, !0, !0), this.onAfterDrawPhaseObservable.notifyObservers(this);
                    for (var _ = 0, g = this._afterCameraDrawStage; _ < g.length; _++) {
                        g[_].action(this.activeCamera)
                    }
                    this.postProcessManager && !e._multiviewTexture && this.postProcessManager._finalizeFrame(e.isIntermediate), this._renderTargets.reset(), this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)
                }
            }, t.prototype._processSubCameras = function(e) {
                if (e.cameraRigMode === $e.RIG_MODE_NONE || e.outputRenderTarget && e.outputRenderTarget.getViewCount() > 1 && this.getEngine().getCaps().multiview) this._renderForCamera(e);
                else {
                    if (e._useMultiviewToSingleView) this._renderMultiviewToSingleView(e);
                    else
                        for (var t = 0; t < e._rigCameras.length; t++) this._renderForCamera(e._rigCameras[t], e);
                    this._activeCamera = e, this.setTransformMatrix(this._activeCamera.getViewMatrix(), this._activeCamera.getProjectionMatrix())
                }
            }, t.prototype._checkIntersections = function() {
                for (var e = 0; e < this._meshesForIntersections.length; e++) {
                    var t = this._meshesForIntersections.data[e];
                    if (t.actionManager)
                        for (var i = 0; t.actionManager && i < t.actionManager.actions.length; i++) {
                            var n = t.actionManager.actions[i];
                            if (n.trigger === k.ACTION_OnIntersectionEnterTrigger || n.trigger === k.ACTION_OnIntersectionExitTrigger) {
                                var r = n.getTriggerParameter(),
                                    o = r instanceof Je ? r : r.mesh,
                                    s = o.intersectsMesh(t, r.usePreciseIntersection),
                                    a = t._intersectionsInProgress.indexOf(o);
                                s && -1 === a ? n.trigger === k.ACTION_OnIntersectionEnterTrigger ? (n._executeCurrent(ot.CreateNew(t, void 0, o)), t._intersectionsInProgress.push(o)) : n.trigger === k.ACTION_OnIntersectionExitTrigger && t._intersectionsInProgress.push(o) : !s && a > -1 && (n.trigger === k.ACTION_OnIntersectionExitTrigger && n._executeCurrent(ot.CreateNew(t, void 0, o)), t.actionManager.hasSpecificTrigger(k.ACTION_OnIntersectionExitTrigger, (function(e) {
                                    var t = e instanceof Je ? e : e.mesh;
                                    return o === t
                                })) && n.trigger !== k.ACTION_OnIntersectionExitTrigger || t._intersectionsInProgress.splice(a, 1))
                            }
                        }
                }
            }, t.prototype._advancePhysicsEngineStep = function(e) {}, t.prototype._animate = function() {}, t.prototype.animate = function() {
                if (this._engine.isDeterministicLockStep()) {
                    var e = Math.max(t.MinDeltaTime, Math.min(this._engine.getDeltaTime(), t.MaxDeltaTime)) + this._timeAccumulator,
                        i = this.getDeterministicFrameTime(),
                        n = 0,
                        r = this._engine.getLockstepMaxSteps(),
                        o = Math.floor(e / 60);
                    o = Math.min(o, r);
                    do {
                        this.onBeforeStepObservable.notifyObservers(this), this._animationRatio = .06 * i, this._animate(), this.onAfterAnimationsObservable.notifyObservers(this), this._advancePhysicsEngineStep(i), this.onAfterStepObservable.notifyObservers(this), this._currentStepId++, n++, e -= i
                    } while (e > 0 && n < o);
                    this._timeAccumulator = e < 0 ? 0 : e
                } else {
                    e = this.useConstantAnimationDeltaTime ? 16 : Math.max(t.MinDeltaTime, Math.min(this._engine.getDeltaTime(), t.MaxDeltaTime));
                    this._animationRatio = .06 * e, this._animate(), this.onAfterAnimationsObservable.notifyObservers(this), this._advancePhysicsEngineStep(e)
                }
            }, t.prototype.render = function(e, t) {
                if (void 0 === e && (e = !0), void 0 === t && (t = !1), !this.isDisposed) {
                    this._frameId++, this._registerTransientComponents(), this._activeParticles.fetchNewFrame(), this._totalVertices.fetchNewFrame(), this._activeIndices.fetchNewFrame(), this._activeBones.fetchNewFrame(), this._meshesForIntersections.reset(), this.resetCachedMaterial(), this.onBeforeAnimationsObservable.notifyObservers(this), this.actionManager && this.actionManager.processTrigger(k.ACTION_OnEveryFrameTrigger), t || this.animate();
                    for (var i = 0, n = this._beforeCameraUpdateStage; i < n.length; i++) {
                        n[i].action()
                    }
                    if (e)
                        if (this.activeCameras.length > 0)
                            for (var r = 0; r < this.activeCameras.length; r++) {
                                var o = this.activeCameras[r];
                                if (o.update(), o.cameraRigMode !== $e.RIG_MODE_NONE)
                                    for (var s = 0; s < o._rigCameras.length; s++) o._rigCameras[s].update()
                            } else if (this.activeCamera && (this.activeCamera.update(), this.activeCamera.cameraRigMode !== $e.RIG_MODE_NONE))
                                for (s = 0; s < this.activeCamera._rigCameras.length; s++) this.activeCamera._rigCameras[s].update();
                    this.onBeforeRenderObservable.notifyObservers(this), this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);
                    var a = this.getEngine(),
                        u = this.activeCamera;
                    if (this.renderTargetsEnabled) {
                        K.StartPerformanceCounter("Custom render targets", this.customRenderTargets.length > 0), this._intermediateRendering = !0;
                        for (var h = 0; h < this.customRenderTargets.length; h++) {
                            var l = this.customRenderTargets[h];
                            if (l._shouldRender()) {
                                if (this._renderId++, this.activeCamera = l.activeCamera || this.activeCamera, !this.activeCamera) throw new Error("Active camera not set");
                                a.setViewport(this.activeCamera.viewport), this.updateTransformMatrix(), l.render(u !== this.activeCamera, this.dumpNextRenderTargets)
                            }
                        }
                        K.EndPerformanceCounter("Custom render targets", this.customRenderTargets.length > 0), this._intermediateRendering = !1, this._renderId++
                    }
                    this.activeCamera = u, this._bindFrameBuffer(), this.onAfterRenderTargetsRenderObservable.notifyObservers(this);
                    for (var c = 0, d = this._beforeClearStage; c < d.length; c++) {
                        d[c].action()
                    }(this.autoClearDepthAndStencil || this.autoClear) && this._engine.clear(this.clearColor, this.autoClear || this.forceWireframe || this.forcePointsCloud, this.autoClearDepthAndStencil, this.autoClearDepthAndStencil);
                    for (var f = 0, p = this._gatherRenderTargetsStage; f < p.length; f++) {
                        p[f].action(this._renderTargets)
                    }
                    if (this.activeCameras.length > 0)
                        for (r = 0; r < this.activeCameras.length; r++) r > 0 && this._engine.clear(null, !1, !0, !0), this._processSubCameras(this.activeCameras[r]);
                    else {
                        if (!this.activeCamera) throw new Error("No camera defined");
                        this._processSubCameras(this.activeCamera)
                    }
                    this._checkIntersections();
                    for (var _ = 0, g = this._afterRenderStage; _ < g.length; _++) {
                        g[_].action()
                    }
                    if (this.afterRender && this.afterRender(), this.onAfterRenderObservable.notifyObservers(this), this._toBeDisposed.length) {
                        for (s = 0; s < this._toBeDisposed.length; s++) {
                            var m = this._toBeDisposed[s];
                            m && m.dispose()
                        }
                        this._toBeDisposed = []
                    }
                    this.dumpNextRenderTargets && (this.dumpNextRenderTargets = !1), this._activeBones.addCount(0, !0), this._activeIndices.addCount(0, !0), this._activeParticles.addCount(0, !0)
                }
            }, t.prototype.freezeMaterials = function() {
                for (var e = 0; e < this.materials.length; e++) this.materials[e].freeze()
            }, t.prototype.unfreezeMaterials = function() {
                for (var e = 0; e < this.materials.length; e++) this.materials[e].unfreeze()
            }, t.prototype.dispose = function() {
                this.beforeRender = null, this.afterRender = null, this.skeletons = [], this.morphTargetManagers = [], this._transientComponents = [], this._isReadyForMeshStage.clear(), this._beforeEvaluateActiveMeshStage.clear(), this._evaluateSubMeshStage.clear(), this._activeMeshStage.clear(), this._cameraDrawRenderTargetStage.clear(), this._beforeCameraDrawStage.clear(), this._beforeRenderTargetDrawStage.clear(), this._beforeRenderingGroupDrawStage.clear(), this._beforeRenderingMeshStage.clear(), this._afterRenderingMeshStage.clear(), this._afterRenderingGroupDrawStage.clear(), this._afterCameraDrawStage.clear(), this._afterRenderTargetDrawStage.clear(), this._afterRenderStage.clear(), this._beforeCameraUpdateStage.clear(), this._beforeClearStage.clear(), this._gatherRenderTargetsStage.clear(), this._gatherActiveCameraRenderTargetsStage.clear(), this._pointerMoveStage.clear(), this._pointerDownStage.clear(), this._pointerUpStage.clear();
                for (var e = 0, t = this._components; e < t.length; e++) {
                    t[e].dispose()
                }
                this.importedMeshesFiles = new Array, this.stopAllAnimations && this.stopAllAnimations(), this.resetCachedMaterial(), this.activeCamera && (this.activeCamera._activeMeshes.dispose(), this.activeCamera = null), this._activeMeshes.dispose(), this._renderingManager.dispose(), this._processedMaterials.dispose(), this._activeParticleSystems.dispose(), this._activeSkeletons.dispose(), this._softwareSkinnedMeshes.dispose(), this._renderTargets.dispose(), this._registeredForLateAnimationBindings.dispose(), this._meshesForIntersections.dispose(), this._toBeDisposed = [];
                for (var i = 0, n = this._activeRequests; i < n.length; i++) {
                    n[i].abort()
                }
                this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this.onBeforeRenderObservable.clear(), this.onAfterRenderObservable.clear(), this.onBeforeRenderTargetsRenderObservable.clear(), this.onAfterRenderTargetsRenderObservable.clear(), this.onAfterStepObservable.clear(), this.onBeforeStepObservable.clear(), this.onBeforeActiveMeshesEvaluationObservable.clear(), this.onAfterActiveMeshesEvaluationObservable.clear(), this.onBeforeParticlesRenderingObservable.clear(), this.onAfterParticlesRenderingObservable.clear(), this.onBeforeDrawPhaseObservable.clear(), this.onAfterDrawPhaseObservable.clear(), this.onBeforeAnimationsObservable.clear(), this.onAfterAnimationsObservable.clear(), this.onDataLoadedObservable.clear(), this.onBeforeRenderingGroupObservable.clear(), this.onAfterRenderingGroupObservable.clear(), this.onMeshImportedObservable.clear(), this.onBeforeCameraRenderObservable.clear(), this.onAfterCameraRenderObservable.clear(), this.onReadyObservable.clear(), this.onNewCameraAddedObservable.clear(), this.onCameraRemovedObservable.clear(), this.onNewLightAddedObservable.clear(), this.onLightRemovedObservable.clear(), this.onNewGeometryAddedObservable.clear(), this.onGeometryRemovedObservable.clear(), this.onNewTransformNodeAddedObservable.clear(), this.onTransformNodeRemovedObservable.clear(), this.onNewMeshAddedObservable.clear(), this.onMeshRemovedObservable.clear(), this.onNewSkeletonAddedObservable.clear(), this.onSkeletonRemovedObservable.clear(), this.onNewMaterialAddedObservable.clear(), this.onMaterialRemovedObservable.clear(), this.onNewTextureAddedObservable.clear(), this.onTextureRemovedObservable.clear(), this.onPrePointerObservable.clear(), this.onPointerObservable.clear(), this.onPreKeyboardObservable.clear(), this.onKeyboardObservable.clear(), this.onActiveCameraChanged.clear(), this.detachControl();
                var r, o = this._engine.getRenderingCanvas();
                if (o)
                    for (r = 0; r < this.cameras.length; r++) this.cameras[r].detachControl(o);
                for (; this.animationGroups.length;) this.animationGroups[0].dispose();
                for (; this.lights.length;) this.lights[0].dispose();
                for (; this.meshes.length;) this.meshes[0].dispose(!0);
                for (; this.transformNodes.length;) this.transformNodes[0].dispose(!0);
                for (; this.cameras.length;) this.cameras[0].dispose();
                for (this._defaultMaterial && this._defaultMaterial.dispose(); this.multiMaterials.length;) this.multiMaterials[0].dispose();
                for (; this.materials.length;) this.materials[0].dispose();
                for (; this.particleSystems.length;) this.particleSystems[0].dispose();
                for (; this.postProcesses.length;) this.postProcesses[0].dispose();
                for (; this.textures.length;) this.textures[0].dispose();
                this._sceneUbo.dispose(), this._multiviewSceneUbo && this._multiviewSceneUbo.dispose(), this.postProcessManager.dispose(), (r = this._engine.scenes.indexOf(this)) > -1 && this._engine.scenes.splice(r, 1), this._engine.wipeCaches(!0), this._isDisposed = !0
            }, Object.defineProperty(t.prototype, "isDisposed", {
                get: function() {
                    return this._isDisposed
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.clearCachedVertexData = function() {
                for (var e = 0; e < this.meshes.length; e++) {
                    var t = this.meshes[e].geometry;
                    if (t)
                        for (var i in t._indices = [], t._vertexBuffers) t._vertexBuffers.hasOwnProperty(i) && (t._vertexBuffers[i]._buffer._data = null)
                }
            }, t.prototype.cleanCachedTextureBuffer = function() {
                for (var e = 0, t = this.textures; e < t.length; e++) {
                    var i = t[e];
                    i._buffer && (i._buffer = null)
                }
            }, t.prototype.getWorldExtends = function(e) {
                var t = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE),
                    i = new b(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE);
                return e = e || function() {
                    return !0
                }, this.meshes.filter(e).forEach((function(e) {
                    if (e.computeWorldMatrix(!0), e.subMeshes && 0 !== e.subMeshes.length && !e.infiniteDistance) {
                        var n = e.getBoundingInfo(),
                            r = n.boundingBox.minimumWorld,
                            o = n.boundingBox.maximumWorld;
                        K.CheckExtends(r, t, i), K.CheckExtends(o, t, i)
                    }
                })), {
                    min: t,
                    max: i
                }
            }, t.prototype.createPickingRay = function(e, t, i, n, r) {
                throw void 0 === r && (r = !1), X.WarnImport("Ray")
            }, t.prototype.createPickingRayToRef = function(e, t, i, n, r, o) {
                throw void 0 === o && (o = !1), X.WarnImport("Ray")
            }, t.prototype.createPickingRayInCameraSpace = function(e, t, i) {
                throw X.WarnImport("Ray")
            }, t.prototype.createPickingRayInCameraSpaceToRef = function(e, t, i, n) {
                throw X.WarnImport("Ray")
            }, t.prototype.pick = function(e, t, i, n, r, o) {
                var s = new Ke;
                return s._pickingUnavailable = !0, s
            }, t.prototype.pickWithRay = function(e, t, i, n) {
                throw X.WarnImport("Ray")
            }, t.prototype.multiPick = function(e, t, i, n, r) {
                throw X.WarnImport("Ray")
            }, t.prototype.multiPickWithRay = function(e, t, i) {
                throw X.WarnImport("Ray")
            }, t.prototype.setPointerOverMesh = function(e) {
                this._inputManager.setPointerOverMesh(e)
            }, t.prototype.getPointerOverMesh = function() {
                return this._inputManager.getPointerOverMesh()
            }, t.prototype._rebuildGeometries = function() {
                for (var e = 0, t = this.geometries; e < t.length; e++) {
                    t[e]._rebuild()
                }
                for (var i = 0, n = this.meshes; i < n.length; i++) {
                    n[i]._rebuild()
                }
                this.postProcessManager && this.postProcessManager._rebuild();
                for (var r = 0, o = this._components; r < o.length; r++) {
                    o[r].rebuild()
                }
                for (var s = 0, a = this.particleSystems; s < a.length; s++) {
                    a[s].rebuild()
                }
            }, t.prototype._rebuildTextures = function() {
                for (var e = 0, t = this.textures; e < t.length; e++) {
                    t[e]._rebuild()
                }
                this.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag)
            }, t.prototype._getByTags = function(e, t, i) {
                if (void 0 === t) return e;
                var n = [];
                for (var r in i = i || function(e) {}, e) {
                    var o = e[r];
                    re && re.MatchesQuery(o, t) && (n.push(o), i(o))
                }
                return n
            }, t.prototype.getMeshesByTags = function(e, t) {
                return this._getByTags(this.meshes, e, t)
            }, t.prototype.getCamerasByTags = function(e, t) {
                return this._getByTags(this.cameras, e, t)
            }, t.prototype.getLightsByTags = function(e, t) {
                return this._getByTags(this.lights, e, t)
            }, t.prototype.getMaterialByTags = function(e, t) {
                return this._getByTags(this.materials, e, t).concat(this._getByTags(this.multiMaterials, e, t))
            }, t.prototype.setRenderingOrder = function(e, t, i, n) {
                void 0 === t && (t = null), void 0 === i && (i = null), void 0 === n && (n = null), this._renderingManager.setRenderingOrder(e, t, i, n)
            }, t.prototype.setRenderingAutoClearDepthStencil = function(e, t, i, n) {
                void 0 === i && (i = !0), void 0 === n && (n = !0), this._renderingManager.setRenderingAutoClearDepthStencil(e, t, i, n)
            }, t.prototype.getAutoClearDepthStencilSetup = function(e) {
                return this._renderingManager.getAutoClearDepthStencilSetup(e)
            }, Object.defineProperty(t.prototype, "blockMaterialDirtyMechanism", {
                get: function() {
                    return this._blockMaterialDirtyMechanism
                },
                set: function(e) {
                    this._blockMaterialDirtyMechanism !== e && (this._blockMaterialDirtyMechanism = e, e || this.markAllMaterialsAsDirty(k.MATERIAL_AllDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.markAllMaterialsAsDirty = function(e, t) {
                if (!this._blockMaterialDirtyMechanism)
                    for (var i = 0, n = this.materials; i < n.length; i++) {
                        var r = n[i];
                        t && !t(r) || r.markAsDirty(e)
                    }
            }, t.prototype._loadFile = function(e, t, i, n, r, o) {
                var s = this,
                    a = K.LoadFile(e, t, i, n ? this.offlineProvider : void 0, r, o);
                return this._activeRequests.push(a), a.onCompleteObservable.add((function(e) {
                    s._activeRequests.splice(s._activeRequests.indexOf(e), 1)
                })), a
            }, t.prototype._loadFileAsync = function(e, t, i) {
                var n = this;
                return new Promise((function(r, o) {
                    n._loadFile(e, (function(e) {
                        r(e)
                    }), void 0, t, i, (function(e, t) {
                        o(t)
                    }))
                }))
            }, t._uniqueIdCounter = 0, t.FOGMODE_NONE = 0, t.FOGMODE_EXP = 1, t.FOGMODE_EXP2 = 2, t.FOGMODE_LINEAR = 3, t.MinDeltaTime = 1, t.MaxDeltaTime = 1e3, t
        }(et),
        At = function(e) {
            function t(t, i, n, r) {
                void 0 === r && (r = !0);
                var o = e.call(this, t, i, n, r) || this;
                return o.cameraDirection = new b(0, 0, 0), o.cameraRotation = new T(0, 0), o.updateUpVectorFromRotation = !1, o._tmpQuaternion = new M, o.rotation = new b(0, 0, 0), o.speed = 2, o.noRotationConstraint = !1, o.lockedTarget = null, o._currentTarget = b.Zero(), o._initialFocalDistance = 1, o._viewMatrix = R.Zero(), o._camMatrix = R.Zero(), o._cameraTransformMatrix = R.Zero(), o._cameraRotationMatrix = R.Zero(), o._referencePoint = new b(0, 0, 1), o._transformedReferencePoint = b.Zero(), o._globalCurrentTarget = b.Zero(), o._globalCurrentUpVector = b.Zero(), o._defaultUp = b.Up(), o._cachedRotationZ = 0, o._cachedQuaternionRotationZ = 0, o
            }
            var i;
            return r(t, e), t.prototype.getFrontPosition = function(e) {
                this.getWorldMatrix();
                var t = this.getTarget().subtract(this.position);
                return t.normalize(), t.scaleInPlace(e), this.globalPosition.add(t)
            }, t.prototype._getLockedTargetPosition = function() {
                return this.lockedTarget ? (this.lockedTarget.absolutePosition && this.lockedTarget.computeWorldMatrix(), this.lockedTarget.absolutePosition || this.lockedTarget) : null
            }, t.prototype.storeState = function() {
                return this._storedPosition = this.position.clone(), this._storedRotation = this.rotation.clone(), this.rotationQuaternion && (this._storedRotationQuaternion = this.rotationQuaternion.clone()), e.prototype.storeState.call(this)
            }, t.prototype._restoreStateValues = function() {
                return !!e.prototype._restoreStateValues.call(this) && (this.position = this._storedPosition.clone(), this.rotation = this._storedRotation.clone(), this.rotationQuaternion && (this.rotationQuaternion = this._storedRotationQuaternion.clone()), this.cameraDirection.copyFromFloats(0, 0, 0), this.cameraRotation.copyFromFloats(0, 0), !0)
            }, t.prototype._initCache = function() {
                e.prototype._initCache.call(this), this._cache.lockedTarget = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.rotation = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.rotationQuaternion = new M(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE)
            }, t.prototype._updateCache = function(t) {
                t || e.prototype._updateCache.call(this);
                var i = this._getLockedTargetPosition();
                i ? this._cache.lockedTarget ? this._cache.lockedTarget.copyFrom(i) : this._cache.lockedTarget = i.clone() : this._cache.lockedTarget = null, this._cache.rotation.copyFrom(this.rotation), this.rotationQuaternion && this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)
            }, t.prototype._isSynchronizedViewMatrix = function() {
                if (!e.prototype._isSynchronizedViewMatrix.call(this)) return !1;
                var t = this._getLockedTargetPosition();
                return (this._cache.lockedTarget ? this._cache.lockedTarget.equals(t) : !t) && (this.rotationQuaternion ? this.rotationQuaternion.equals(this._cache.rotationQuaternion) : this._cache.rotation.equals(this.rotation))
            }, t.prototype._computeLocalCameraSpeed = function() {
                var e = this.getEngine();
                return this.speed * Math.sqrt(e.getDeltaTime() / (100 * e.getFps()))
            }, t.prototype.setTarget = function(e) {
                this.upVector.normalize(), this._initialFocalDistance = e.subtract(this.position).length(), this.position.z === e.z && (this.position.z += .001), R.LookAtLHToRef(this.position, e, this._defaultUp, this._camMatrix), this._camMatrix.invert(), this.rotation.x = Math.atan(this._camMatrix.m[6] / this._camMatrix.m[10]);
                var t = e.subtract(this.position);
                t.x >= 0 ? this.rotation.y = -Math.atan(t.z / t.x) + Math.PI / 2 : this.rotation.y = -Math.atan(t.z / t.x) - Math.PI / 2, this.rotation.z = 0, isNaN(this.rotation.x) && (this.rotation.x = 0), isNaN(this.rotation.y) && (this.rotation.y = 0), isNaN(this.rotation.z) && (this.rotation.z = 0), this.rotationQuaternion && M.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this.rotationQuaternion)
            }, t.prototype.getTarget = function() {
                return this._currentTarget
            }, t.prototype._decideIfNeedsToMove = function() {
                return Math.abs(this.cameraDirection.x) > 0 || Math.abs(this.cameraDirection.y) > 0 || Math.abs(this.cameraDirection.z) > 0
            }, t.prototype._updatePosition = function() {
                if (this.parent) return this.parent.getWorldMatrix().invertToRef(N.Matrix[0]), b.TransformNormalToRef(this.cameraDirection, N.Matrix[0], N.Vector3[0]), void this.position.addInPlace(N.Vector3[0]);
                this.position.addInPlace(this.cameraDirection)
            }, t.prototype._checkInputs = function() {
                var t = this._decideIfNeedsToMove(),
                    i = Math.abs(this.cameraRotation.x) > 0 || Math.abs(this.cameraRotation.y) > 0;
                if (t && this._updatePosition(), i) {
                    if (this.rotation.x += this.cameraRotation.x, this.rotation.y += this.cameraRotation.y, this.rotationQuaternion) this.rotation.lengthSquared() && M.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this.rotationQuaternion);
                    if (!this.noRotationConstraint) {
                        var n = Math.PI / 2 * .95;
                        this.rotation.x > n && (this.rotation.x = n), this.rotation.x < -n && (this.rotation.x = -n)
                    }
                }
                t && (Math.abs(this.cameraDirection.x) < .001 * this.speed && (this.cameraDirection.x = 0), Math.abs(this.cameraDirection.y) < .001 * this.speed && (this.cameraDirection.y = 0), Math.abs(this.cameraDirection.z) < .001 * this.speed && (this.cameraDirection.z = 0), this.cameraDirection.scaleInPlace(this.inertia)), i && (Math.abs(this.cameraRotation.x) < .001 * this.speed && (this.cameraRotation.x = 0), Math.abs(this.cameraRotation.y) < .001 * this.speed && (this.cameraRotation.y = 0), this.cameraRotation.scaleInPlace(this.inertia)), e.prototype._checkInputs.call(this)
            }, t.prototype._updateCameraRotationMatrix = function() {
                this.rotationQuaternion ? this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix) : R.RotationYawPitchRollToRef(this.rotation.y, this.rotation.x, this.rotation.z, this._cameraRotationMatrix)
            }, t.prototype._rotateUpVectorWithCameraRotationMatrix = function() {
                return b.TransformNormalToRef(this._defaultUp, this._cameraRotationMatrix, this.upVector), this
            }, t.prototype._getViewMatrix = function() {
                return this.lockedTarget && this.setTarget(this._getLockedTargetPosition()), this._updateCameraRotationMatrix(), this.rotationQuaternion && this._cachedQuaternionRotationZ != this.rotationQuaternion.z ? (this._rotateUpVectorWithCameraRotationMatrix(), this._cachedQuaternionRotationZ = this.rotationQuaternion.z) : this._cachedRotationZ != this.rotation.z && (this._rotateUpVectorWithCameraRotationMatrix(), this._cachedRotationZ = this.rotation.z), b.TransformCoordinatesToRef(this._referencePoint, this._cameraRotationMatrix, this._transformedReferencePoint), this.position.addToRef(this._transformedReferencePoint, this._currentTarget), this.updateUpVectorFromRotation && (this.rotationQuaternion ? S.Y.rotateByQuaternionToRef(this.rotationQuaternion, this.upVector) : (M.FromEulerVectorToRef(this.rotation, this._tmpQuaternion), S.Y.rotateByQuaternionToRef(this._tmpQuaternion, this.upVector))), this._computeViewMatrix(this.position, this._currentTarget, this.upVector), this._viewMatrix
            }, t.prototype._computeViewMatrix = function(e, t, i) {
                if (this.parent) {
                    var n = this.parent.getWorldMatrix();
                    b.TransformCoordinatesToRef(e, n, this._globalPosition), b.TransformCoordinatesToRef(t, n, this._globalCurrentTarget), b.TransformNormalToRef(i, n, this._globalCurrentUpVector), this._markSyncedWithParent()
                } else this._globalPosition.copyFrom(e), this._globalCurrentTarget.copyFrom(t), this._globalCurrentUpVector.copyFrom(i);
                this.getScene().useRightHandedSystem ? R.LookAtRHToRef(this._globalPosition, this._globalCurrentTarget, this._globalCurrentUpVector, this._viewMatrix) : R.LookAtLHToRef(this._globalPosition, this._globalCurrentTarget, this._globalCurrentUpVector, this._viewMatrix)
            }, t.prototype.createRigCamera = function(e, i) {
                if (this.cameraRigMode !== $e.RIG_MODE_NONE) {
                    var n = new t(e, this.position.clone(), this.getScene());
                    return this.cameraRigMode !== $e.RIG_MODE_VR && this.cameraRigMode !== $e.RIG_MODE_WEBVR || (this.rotationQuaternion || (this.rotationQuaternion = new M), n._cameraRigParams = {}, n.rotationQuaternion = new M), n
                }
                return null
            }, t.prototype._updateRigCameras = function() {
                var t = this._rigCameras[0],
                    i = this._rigCameras[1];
                switch (this.computeWorldMatrix(), this.cameraRigMode) {
                    case $e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                    case $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                    case $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                    case $e.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                        var n = this.cameraRigMode === $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED ? 1 : -1,
                            r = this.cameraRigMode === $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED ? -1 : 1;
                        this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle * n, t), this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle * r, i);
                        break;
                    case $e.RIG_MODE_VR:
                        t.rotationQuaternion ? (t.rotationQuaternion.copyFrom(this.rotationQuaternion), i.rotationQuaternion.copyFrom(this.rotationQuaternion)) : (t.rotation.copyFrom(this.rotation), i.rotation.copyFrom(this.rotation)), t.position.copyFrom(this.position), i.position.copyFrom(this.position)
                }
                e.prototype._updateRigCameras.call(this)
            }, t.prototype._getRigCamPositionAndTarget = function(e, i) {
                this.getTarget().subtractToRef(this.position, t._TargetFocalPoint), t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);
                var n = t._TargetFocalPoint.addInPlace(this.position);
                R.TranslationToRef(-n.x, -n.y, -n.z, t._TargetTransformMatrix), t._TargetTransformMatrix.multiplyToRef(R.RotationY(e), t._RigCamTransformMatrix), R.TranslationToRef(n.x, n.y, n.z, t._TargetTransformMatrix), t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix, t._RigCamTransformMatrix), b.TransformCoordinatesToRef(this.position, t._RigCamTransformMatrix, i.position), i.setTarget(n)
            }, t.prototype.getClassName = function() {
                return "TargetCamera"
            }, t._RigCamTransformMatrix = new R, t._TargetTransformMatrix = new R, t._TargetFocalPoint = new b, s([_e()], t.prototype, "rotation", void 0), s([ce()], t.prototype, "speed", void 0), s([(i = "lockedTargetId", he(6, i))], t.prototype, "lockedTarget", void 0), t
        }($e),
        Mt = {},
        Rt = function() {
            function e(e) {
                this.attached = {}, this.camera = e, this.checkInputs = function() {}
            }
            return e.prototype.add = function(e) {
                var t = e.getSimpleName();
                this.attached[t] ? V.Warn("camera input of type " + t + " already exists on camera") : (this.attached[t] = e, e.camera = this.camera, e.checkInputs && (this.checkInputs = this._addCheckInputs(e.checkInputs.bind(e))), this.attachedElement && e.attachControl(this.attachedElement))
            }, e.prototype.remove = function(e) {
                for (var t in this.attached) {
                    var i = this.attached[t];
                    i === e && (i.detachControl(this.attachedElement), i.camera = null, delete this.attached[t], this.rebuildInputCheck())
                }
            }, e.prototype.removeByType = function(e) {
                for (var t in this.attached) {
                    var i = this.attached[t];
                    i.getClassName() === e && (i.detachControl(this.attachedElement), i.camera = null, delete this.attached[t], this.rebuildInputCheck())
                }
            }, e.prototype._addCheckInputs = function(e) {
                var t = this.checkInputs;
                return function() {
                    t(), e()
                }
            }, e.prototype.attachInput = function(e) {
                this.attachedElement && e.attachControl(this.attachedElement, this.noPreventDefault)
            }, e.prototype.attachElement = function(e, t) {
                if (void 0 === t && (t = !1), !this.attachedElement)
                    for (var i in t = !$e.ForceAttachControlToAlwaysPreventDefault && t, this.attachedElement = e, this.noPreventDefault = t, this.attached) this.attached[i].attachControl(e, t)
            }, e.prototype.detachElement = function(e, t) {
                if (void 0 === t && (t = !1), this.attachedElement === e) {
                    for (var i in this.attached) this.attached[i].detachControl(e), t && (this.attached[i].camera = null);
                    this.attachedElement = null
                }
            }, e.prototype.rebuildInputCheck = function() {
                for (var e in this.checkInputs = function() {}, this.attached) {
                    var t = this.attached[e];
                    t.checkInputs && (this.checkInputs = this._addCheckInputs(t.checkInputs.bind(t)))
                }
            }, e.prototype.clear = function() {
                this.attachedElement && this.detachElement(this.attachedElement, !0), this.attached = {}, this.attachedElement = null, this.checkInputs = function() {}
            }, e.prototype.serialize = function(e) {
                var t = {};
                for (var i in this.attached) {
                    var n = this.attached[i],
                        r = me.Serialize(n);
                    t[n.getClassName()] = r
                }
                e.inputsmgr = t
            }, e.prototype.parse = function(e) {
                var t = e.inputsmgr;
                if (t)
                    for (var i in this.clear(), t) {
                        if (o = Mt[i]) {
                            var n = t[i],
                                r = me.Parse((function() {
                                    return new o
                                }), n, null);
                            this.add(r)
                        }
                    } else
                        for (var i in this.attached) {
                            var o;
                            if (o = Mt[this.attached[i].getClassName()]) {
                                r = me.Parse((function() {
                                    return new o
                                }), e, null);
                                this.remove(this.attached[i]), this.add(r)
                            }
                        }
            }, e
        }(),
        xt = function() {
            function e() {
                this.keysUp = [38], this.keysDown = [40], this.keysLeft = [37], this.keysRight = [39], this._keys = new Array
            }
            return e.prototype.attachControl = function(e, t) {
                var i = this;
                this._onCanvasBlurObserver || (this._scene = this.camera.getScene(), this._engine = this._scene.getEngine(), this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add((function() {
                    i._keys = []
                })), this._onKeyboardObserver = this._scene.onKeyboardObservable.add((function(e) {
                    var n, r = e.event;
                    r.metaKey || (e.type === mt.KEYDOWN ? -1 === i.keysUp.indexOf(r.keyCode) && -1 === i.keysDown.indexOf(r.keyCode) && -1 === i.keysLeft.indexOf(r.keyCode) && -1 === i.keysRight.indexOf(r.keyCode) || (-1 === (n = i._keys.indexOf(r.keyCode)) && i._keys.push(r.keyCode), t || r.preventDefault()) : -1 === i.keysUp.indexOf(r.keyCode) && -1 === i.keysDown.indexOf(r.keyCode) && -1 === i.keysLeft.indexOf(r.keyCode) && -1 === i.keysRight.indexOf(r.keyCode) || ((n = i._keys.indexOf(r.keyCode)) >= 0 && i._keys.splice(n, 1), t || r.preventDefault()))
                })))
            }, e.prototype.detachControl = function(e) {
                this._scene && (this._onKeyboardObserver && this._scene.onKeyboardObservable.remove(this._onKeyboardObserver), this._onCanvasBlurObserver && this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver), this._onKeyboardObserver = null, this._onCanvasBlurObserver = null), this._keys = []
            }, e.prototype.checkInputs = function() {
                if (this._onKeyboardObserver)
                    for (var e = this.camera, t = 0; t < this._keys.length; t++) {
                        var i = this._keys[t],
                            n = e._computeLocalCameraSpeed(); - 1 !== this.keysLeft.indexOf(i) ? e._localDirection.copyFromFloats(-n, 0, 0) : -1 !== this.keysUp.indexOf(i) ? e._localDirection.copyFromFloats(0, 0, n) : -1 !== this.keysRight.indexOf(i) ? e._localDirection.copyFromFloats(n, 0, 0) : -1 !== this.keysDown.indexOf(i) && e._localDirection.copyFromFloats(0, 0, -n), e.getScene().useRightHandedSystem && (e._localDirection.z *= -1), e.getViewMatrix().invertToRef(e._cameraTransformMatrix), b.TransformNormalToRef(e._localDirection, e._cameraTransformMatrix, e._transformedDirection), e.cameraDirection.addInPlace(e._transformedDirection)
                    }
            }, e.prototype.getClassName = function() {
                return "FreeCameraKeyboardMoveInput"
            }, e.prototype._onLostFocus = function() {
                this._keys = []
            }, e.prototype.getSimpleName = function() {
                return "keyboard"
            }, s([ce()], e.prototype, "keysUp", void 0), s([ce()], e.prototype, "keysDown", void 0), s([ce()], e.prototype, "keysLeft", void 0), s([ce()], e.prototype, "keysRight", void 0), e
        }();
    Mt.FreeCameraKeyboardMoveInput = xt;
    var Pt = function() {
        function e(e) {
            void 0 === e && (e = !0), this.touchEnabled = e, this.buttons = [0, 1, 2], this.angularSensibility = 2e3, this.previousPosition = null, this.onPointerMovedObservable = new l, this._allowCameraRotation = !0
        }
        return e.prototype.attachControl = function(e, t) {
            var i = this,
                n = this.camera.getEngine();
            this._pointerInput || (this._pointerInput = function(r) {
                var o = r.event;
                if (!n.isInVRExclusivePointerMode && (i.touchEnabled || "touch" !== o.pointerType) && (r.type === dt.POINTERMOVE || -1 !== i.buttons.indexOf(o.button))) {
                    var s = o.srcElement || o.target;
                    if (r.type === dt.POINTERDOWN && s) {
                        try {
                            s.setPointerCapture(o.pointerId)
                        } catch (e) {}
                        i.previousPosition = {
                            x: o.clientX,
                            y: o.clientY
                        }, t || (o.preventDefault(), e.focus())
                    } else if (r.type === dt.POINTERUP && s) {
                        try {
                            s.releasePointerCapture(o.pointerId)
                        } catch (e) {}
                        i.previousPosition = null, t || o.preventDefault()
                    } else if (r.type === dt.POINTERMOVE) {
                        if (!i.previousPosition || n.isPointerLock) return;
                        var a = o.clientX - i.previousPosition.x,
                            u = o.clientY - i.previousPosition.y;
                        i.camera.getScene().useRightHandedSystem && (a *= -1), i.camera.parent && i.camera.parent._getWorldMatrixDeterminant() < 0 && (a *= -1), i._allowCameraRotation && (i.camera.cameraRotation.y += a / i.angularSensibility, i.camera.cameraRotation.x += u / i.angularSensibility), i.onPointerMovedObservable.notifyObservers({
                            offsetX: a,
                            offsetY: u
                        }), i.previousPosition = {
                            x: o.clientX,
                            y: o.clientY
                        }, t || o.preventDefault()
                    }
                }
            }), this._onMouseMove = function(e) {
                if (n.isPointerLock && !n.isInVRExclusivePointerMode) {
                    var r = e.movementX || e.mozMovementX || e.webkitMovementX || e.msMovementX || 0;
                    i.camera.getScene().useRightHandedSystem && (r *= -1), i.camera.parent && i.camera.parent._getWorldMatrixDeterminant() < 0 && (r *= -1), i.camera.cameraRotation.y += r / i.angularSensibility;
                    var o = e.movementY || e.mozMovementY || e.webkitMovementY || e.msMovementY || 0;
                    i.camera.cameraRotation.x += o / i.angularSensibility, i.previousPosition = null, t || e.preventDefault()
                }
            }, this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, dt.POINTERDOWN | dt.POINTERUP | dt.POINTERMOVE), e.addEventListener("mousemove", this._onMouseMove, !1), e.addEventListener("contextmenu", this.onContextMenu.bind(this), !1)
        }, e.prototype.onContextMenu = function(e) {
            e.preventDefault()
        }, e.prototype.detachControl = function(e) {
            this._observer && e && (this.camera.getScene().onPointerObservable.remove(this._observer), this._onMouseMove && e.removeEventListener("mousemove", this._onMouseMove), this.onContextMenu && e.removeEventListener("contextmenu", this.onContextMenu), this.onPointerMovedObservable && this.onPointerMovedObservable.clear(), this._observer = null, this._onMouseMove = null, this.previousPosition = null)
        }, e.prototype.getClassName = function() {
            return "FreeCameraMouseInput"
        }, e.prototype.getSimpleName = function() {
            return "mouse"
        }, s([ce()], e.prototype, "buttons", void 0), s([ce()], e.prototype, "angularSensibility", void 0), e
    }();
    Mt.FreeCameraMouseInput = Pt;
    var It = function() {
        function e() {
            this.touchAngularSensibility = 2e5, this.touchMoveSensibility = 250, this._offsetX = null, this._offsetY = null, this._pointerPressed = new Array
        }
        return e.prototype.attachControl = function(e, t) {
            var i = this,
                n = null;
            void 0 === this._pointerInput && (this._onLostFocus = function() {
                i._offsetX = null, i._offsetY = null
            }, this._pointerInput = function(e) {
                var r = e.event;
                if ("mouse" !== r.pointerType)
                    if (e.type === dt.POINTERDOWN) {
                        if (t || r.preventDefault(), i._pointerPressed.push(r.pointerId), 1 !== i._pointerPressed.length) return;
                        n = {
                            x: r.clientX,
                            y: r.clientY
                        }
                    } else if (e.type === dt.POINTERUP) {
                    if (t || r.preventDefault(), -1 === (o = i._pointerPressed.indexOf(r.pointerId))) return;
                    if (i._pointerPressed.splice(o, 1), 0 != o) return;
                    n = null, i._offsetX = null, i._offsetY = null
                } else if (e.type === dt.POINTERMOVE) {
                    if (t || r.preventDefault(), !n) return;
                    var o;
                    if (0 != (o = i._pointerPressed.indexOf(r.pointerId))) return;
                    i._offsetX = r.clientX - n.x, i._offsetY = -(r.clientY - n.y)
                }
            }), this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, dt.POINTERDOWN | dt.POINTERUP | dt.POINTERMOVE), this._onLostFocus && e.addEventListener("blur", this._onLostFocus)
        }, e.prototype.detachControl = function(e) {
            this._pointerInput && e && (this._observer && (this.camera.getScene().onPointerObservable.remove(this._observer), this._observer = null), this._onLostFocus && (e.removeEventListener("blur", this._onLostFocus), this._onLostFocus = null), this._pointerPressed = [], this._offsetX = null, this._offsetY = null)
        }, e.prototype.checkInputs = function() {
            if (this._offsetX && this._offsetY) {
                var e = this.camera;
                if (e.cameraRotation.y += this._offsetX / this.touchAngularSensibility, this._pointerPressed.length > 1) e.cameraRotation.x += -this._offsetY / this.touchAngularSensibility;
                else {
                    var t = e._computeLocalCameraSpeed(),
                        i = new b(0, 0, t * this._offsetY / this.touchMoveSensibility);
                    R.RotationYawPitchRollToRef(e.rotation.y, e.rotation.x, 0, e._cameraRotationMatrix), e.cameraDirection.addInPlace(b.TransformCoordinates(i, e._cameraRotationMatrix))
                }
            }
        }, e.prototype.getClassName = function() {
            return "FreeCameraTouchInput"
        }, e.prototype.getSimpleName = function() {
            return "touch"
        }, s([ce()], e.prototype, "touchAngularSensibility", void 0), s([ce()], e.prototype, "touchMoveSensibility", void 0), e
    }();
    Mt.FreeCameraTouchInput = It;
    var Ct = function(e) {
            function t(t) {
                var i = e.call(this, t) || this;
                return i._mouseInput = null, i
            }
            return r(t, e), t.prototype.addKeyboard = function() {
                return this.add(new xt), this
            }, t.prototype.addMouse = function(e) {
                return void 0 === e && (e = !0), this._mouseInput || (this._mouseInput = new Pt(e), this.add(this._mouseInput)), this
            }, t.prototype.removeMouse = function() {
                return this._mouseInput && this.remove(this._mouseInput), this
            }, t.prototype.addTouch = function() {
                return this.add(new It), this
            }, t.prototype.clear = function() {
                e.prototype.clear.call(this), this._mouseInput = null
            }, t
        }(Rt),
        St = function(e) {
            function t(t, i, n, r) {
                void 0 === r && (r = !0);
                var o = e.call(this, t, i, n, r) || this;
                return o.ellipsoid = new b(.5, 1, .5), o.ellipsoidOffset = new b(0, 0, 0), o.checkCollisions = !1, o.applyGravity = !1, o._needMoveForGravity = !1, o._oldPosition = b.Zero(), o._diffPosition = b.Zero(), o._newPosition = b.Zero(), o._collisionMask = -1, o._onCollisionPositionChange = function(e, t, i) {
                    void 0 === i && (i = null);
                    var n;
                    n = t, o._newPosition.copyFrom(n), o._newPosition.subtractToRef(o._oldPosition, o._diffPosition), o._diffPosition.length() > ze.CollisionsEpsilon && (o.position.addInPlace(o._diffPosition), o.onCollide && i && o.onCollide(i))
                }, o.inputs = new Ct(o), o.inputs.addKeyboard().addMouse(), o
            }
            return r(t, e), Object.defineProperty(t.prototype, "angularSensibility", {
                get: function() {
                    var e = this.inputs.attached.mouse;
                    return e ? e.angularSensibility : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.mouse;
                    t && (t.angularSensibility = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysUp", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysUp : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysUp = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysDown", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysDown : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysDown = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysLeft", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysLeft : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysLeft = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysRight", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysRight : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysRight = e)
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.attachControl = function(e, t) {
                this.inputs.attachElement(e, t)
            }, t.prototype.detachControl = function(e) {
                this.inputs.detachElement(e), this.cameraDirection = new b(0, 0, 0), this.cameraRotation = new T(0, 0)
            }, Object.defineProperty(t.prototype, "collisionMask", {
                get: function() {
                    return this._collisionMask
                },
                set: function(e) {
                    this._collisionMask = isNaN(e) ? -1 : e
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._collideWithWorld = function(e) {
                (this.parent ? b.TransformCoordinates(this.position, this.parent.getWorldMatrix()) : this.position).subtractFromFloatsToRef(0, this.ellipsoid.y, 0, this._oldPosition), this._oldPosition.addInPlace(this.ellipsoidOffset);
                var t = this.getScene().collisionCoordinator;
                this._collider || (this._collider = t.createCollider()), this._collider._radius = this.ellipsoid, this._collider.collisionMask = this._collisionMask;
                var i = e;
                this.applyGravity && (i = e.add(this.getScene().gravity)), t.getNewPosition(this._oldPosition, i, this._collider, 3, null, this._onCollisionPositionChange, this.uniqueId)
            }, t.prototype._checkInputs = function() {
                this._localDirection || (this._localDirection = b.Zero(), this._transformedDirection = b.Zero()), this.inputs.checkInputs(), e.prototype._checkInputs.call(this)
            }, t.prototype._decideIfNeedsToMove = function() {
                return this._needMoveForGravity || Math.abs(this.cameraDirection.x) > 0 || Math.abs(this.cameraDirection.y) > 0 || Math.abs(this.cameraDirection.z) > 0
            }, t.prototype._updatePosition = function() {
                this.checkCollisions && this.getScene().collisionsEnabled ? this._collideWithWorld(this.cameraDirection) : e.prototype._updatePosition.call(this)
            }, t.prototype.dispose = function() {
                this.inputs.clear(), e.prototype.dispose.call(this)
            }, t.prototype.getClassName = function() {
                return "FreeCamera"
            }, s([_e()], t.prototype, "ellipsoid", void 0), s([_e()], t.prototype, "ellipsoidOffset", void 0), s([ce()], t.prototype, "checkCollisions", void 0), s([ce()], t.prototype, "applyGravity", void 0), t
        }(At),
        Ot = function() {
            function e() {}
            return Object.defineProperty(e, "ForceFullSceneLoadingForIncremental", {
                get: function() {
                    return e._ForceFullSceneLoadingForIncremental
                },
                set: function(t) {
                    e._ForceFullSceneLoadingForIncremental = t
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ShowLoadingScreen", {
                get: function() {
                    return e._ShowLoadingScreen
                },
                set: function(t) {
                    e._ShowLoadingScreen = t
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "loggingLevel", {
                get: function() {
                    return e._loggingLevel
                },
                set: function(t) {
                    e._loggingLevel = t
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "CleanBoneMatrixWeights", {
                get: function() {
                    return e._CleanBoneMatrixWeights
                },
                set: function(t) {
                    e._CleanBoneMatrixWeights = t
                },
                enumerable: !0,
                configurable: !0
            }), e._ForceFullSceneLoadingForIncremental = !1, e._ShowLoadingScreen = !0, e._CleanBoneMatrixWeights = !1, e._loggingLevel = k.SCENELOADER_NO_LOGGING, e
        }(),
        Dt = function() {
            function e(e, t, i, n, r) {
                void 0 === n && (n = !1), void 0 === r && (r = null), this.delayLoadState = k.DELAYLOADSTATE_NONE, this._totalVertices = 0, this._isDisposed = !1, this._indexBufferIsUpdatable = !1, this.id = e, this.uniqueId = t.getUniqueId(), this._engine = t.getEngine(), this._meshes = [], this._scene = t, this._vertexBuffers = {}, this._indices = [], this._updatable = n, i ? this.setAllVerticesData(i, n) : (this._totalVertices = 0, this._indices = []), this._engine.getCaps().vertexArrayObject && (this._vertexArrayObjects = {}), r && (this.applyToMesh(r), r.computeWorldMatrix(!0))
            }
            return Object.defineProperty(e.prototype, "boundingBias", {
                get: function() {
                    return this._boundingBias
                },
                set: function(e) {
                    this._boundingBias ? this._boundingBias.copyFrom(e) : this._boundingBias = e.clone(), this._updateBoundingInfo(!0, null)
                },
                enumerable: !0,
                configurable: !0
            }), e.CreateGeometryForMesh = function(t) {
                var i = new e(e.RandomId(), t.getScene());
                return i.applyToMesh(t), i
            }, Object.defineProperty(e.prototype, "extend", {
                get: function() {
                    return this._extend
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getScene = function() {
                return this._scene
            }, e.prototype.getEngine = function() {
                return this._engine
            }, e.prototype.isReady = function() {
                return this.delayLoadState === k.DELAYLOADSTATE_LOADED || this.delayLoadState === k.DELAYLOADSTATE_NONE
            }, Object.defineProperty(e.prototype, "doNotSerialize", {
                get: function() {
                    for (var e = 0; e < this._meshes.length; e++)
                        if (!this._meshes[e].doNotSerialize) return !1;
                    return !0
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._rebuild = function() {
                for (var e in this._vertexArrayObjects && (this._vertexArrayObjects = {}), 0 !== this._meshes.length && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices)), this._vertexBuffers) {
                    this._vertexBuffers[e]._rebuild()
                }
            }, e.prototype.setAllVerticesData = function(e, t) {
                e.applyToGeometry(this, t), this.notifyUpdate()
            }, e.prototype.setVerticesData = function(e, t, i, n) {
                void 0 === i && (i = !1);
                var r = new Te(this._engine, t, e, i, 0 === this._meshes.length, n);
                this.setVerticesBuffer(r)
            }, e.prototype.removeVerticesData = function(e) {
                this._vertexBuffers[e] && (this._vertexBuffers[e].dispose(), delete this._vertexBuffers[e])
            }, e.prototype.setVerticesBuffer = function(e, t) {
                void 0 === t && (t = null);
                var i = e.getKind();
                if (this._vertexBuffers[i] && this._vertexBuffers[i].dispose(), this._vertexBuffers[i] = e, i === Te.PositionKind) {
                    var n = e.getData();
                    null != t ? this._totalVertices = t : null != n && (this._totalVertices = n.length / (e.byteStride / 4)), this._updateExtend(n), this._resetPointsArrayCache();
                    for (var r = this._meshes, o = r.length, s = 0; s < o; s++) {
                        var a = r[s];
                        a._boundingInfo = new Ie(this._extend.minimum, this._extend.maximum), a._createGlobalSubMesh(!1), a.computeWorldMatrix(!0)
                    }
                }
                this.notifyUpdate(i), this._vertexArrayObjects && (this._disposeVertexArrayObjects(), this._vertexArrayObjects = {})
            }, e.prototype.updateVerticesDataDirectly = function(e, t, i, n) {
                void 0 === n && (n = !1);
                var r = this.getVertexBuffer(e);
                r && (r.updateDirectly(t, i, n), this.notifyUpdate(e))
            }, e.prototype.updateVerticesData = function(e, t, i) {
                void 0 === i && (i = !1);
                var n = this.getVertexBuffer(e);
                n && (n.update(t), e === Te.PositionKind && this._updateBoundingInfo(i, t), this.notifyUpdate(e))
            }, e.prototype._updateBoundingInfo = function(e, t) {
                if (e && this._updateExtend(t), this._resetPointsArrayCache(), e)
                    for (var i = 0, n = this._meshes; i < n.length; i++) {
                        var r = n[i];
                        r._boundingInfo ? r._boundingInfo.reConstruct(this._extend.minimum, this._extend.maximum) : r._boundingInfo = new Ie(this._extend.minimum, this._extend.maximum);
                        for (var o = 0, s = r.subMeshes; o < s.length; o++) {
                            s[o].refreshBoundingInfo()
                        }
                    }
            }, e.prototype._bind = function(e, t) {
                if (e) {
                    void 0 === t && (t = this._indexBuffer);
                    var i = this.getVertexBuffers();
                    i && (t == this._indexBuffer && this._vertexArrayObjects ? (this._vertexArrayObjects[e.key] || (this._vertexArrayObjects[e.key] = this._engine.recordVertexArrayObject(i, t, e)), this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key], t)) : this._engine.bindBuffers(i, t, e))
                }
            }, e.prototype.getTotalVertices = function() {
                return this.isReady() ? this._totalVertices : 0
            }, e.prototype.getVerticesData = function(e, t, i) {
                var n = this.getVertexBuffer(e);
                if (!n) return null;
                var r = n.getData();
                if (!r) return null;
                var o = n.getSize() * Te.GetTypeByteLength(n.type),
                    s = this._totalVertices * n.getSize();
                if (n.type !== Te.FLOAT || n.byteStride !== o) {
                    var a = [];
                    return n.forEach(s, (function(e) {
                        return a.push(e)
                    })), a
                }
                if (!(r instanceof Array || r instanceof Float32Array) || 0 !== n.byteOffset || r.length !== s) {
                    if (r instanceof Array) {
                        var u = n.byteOffset / 4;
                        return K.Slice(r, u, u + s)
                    }
                    if (r instanceof ArrayBuffer) return new Float32Array(r, n.byteOffset, s);
                    u = r.byteOffset + n.byteOffset;
                    if (i || t && 1 !== this._meshes.length) {
                        var h = new Float32Array(s),
                            l = new Float32Array(r.buffer, u, s);
                        return h.set(l), h
                    }
                    return new Float32Array(r.buffer, u, s)
                }
                return i || t && 1 !== this._meshes.length ? K.Slice(r) : r
            }, e.prototype.isVertexBufferUpdatable = function(e) {
                var t = this._vertexBuffers[e];
                return !!t && t.isUpdatable()
            }, e.prototype.getVertexBuffer = function(e) {
                return this.isReady() ? this._vertexBuffers[e] : null
            }, e.prototype.getVertexBuffers = function() {
                return this.isReady() ? this._vertexBuffers : null
            }, e.prototype.isVerticesDataPresent = function(e) {
                return this._vertexBuffers ? void 0 !== this._vertexBuffers[e] : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e)
            }, e.prototype.getVerticesDataKinds = function() {
                var e, t = [];
                if (!this._vertexBuffers && this._delayInfo)
                    for (e in this._delayInfo) t.push(e);
                else
                    for (e in this._vertexBuffers) t.push(e);
                return t
            }, e.prototype.updateIndices = function(e, t, i) {
                if (void 0 === i && (i = !1), this._indexBuffer)
                    if (this._indexBufferIsUpdatable) {
                        var n = e.length !== this._indices.length;
                        if (i || (this._indices = e.slice()), this._engine.updateDynamicIndexBuffer(this._indexBuffer, e, t), n)
                            for (var r = 0, o = this._meshes; r < o.length; r++) {
                                o[r]._createGlobalSubMesh(!0)
                            }
                    } else this.setIndices(e, null, !0)
            }, e.prototype.setIndices = function(e, t, i) {
                void 0 === t && (t = null), void 0 === i && (i = !1), this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer), this._disposeVertexArrayObjects(), this._indices = e, this._indexBufferIsUpdatable = i, 0 !== this._meshes.length && this._indices && (this._indexBuffer = this._engine.createIndexBuffer(this._indices, i)), null != t && (this._totalVertices = t);
                for (var n = 0, r = this._meshes; n < r.length; n++) {
                    r[n]._createGlobalSubMesh(!0)
                }
                this.notifyUpdate()
            }, e.prototype.getTotalIndices = function() {
                return this.isReady() ? this._indices.length : 0
            }, e.prototype.getIndices = function(e, t) {
                if (!this.isReady()) return null;
                var i = this._indices;
                if (t || e && 1 !== this._meshes.length) {
                    for (var n = i.length, r = [], o = 0; o < n; o++) r.push(i[o]);
                    return r
                }
                return i
            }, e.prototype.getIndexBuffer = function() {
                return this.isReady() ? this._indexBuffer : null
            }, e.prototype._releaseVertexArrayObject = function(e) {
                void 0 === e && (e = null), e && this._vertexArrayObjects && this._vertexArrayObjects[e.key] && (this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]), delete this._vertexArrayObjects[e.key])
            }, e.prototype.releaseForMesh = function(e, t) {
                var i = this._meshes,
                    n = i.indexOf(e); - 1 !== n && (i.splice(n, 1), e._geometry = null, 0 === i.length && t && this.dispose())
            }, e.prototype.applyToMesh = function(e) {
                if (e._geometry !== this) {
                    var t = e._geometry;
                    t && t.releaseForMesh(e);
                    var i = this._meshes;
                    e._geometry = this, this._scene.pushGeometry(this), i.push(e), this.isReady() ? this._applyToMesh(e) : e._boundingInfo = this._boundingInfo
                }
            }, e.prototype._updateExtend = function(e) {
                void 0 === e && (e = null), e || (e = this.getVerticesData(Te.PositionKind)), this._extend = K.ExtractMinAndMax(e, 0, this._totalVertices, this.boundingBias, 3)
            }, e.prototype._applyToMesh = function(e) {
                var t = this._meshes.length;
                for (var i in this._vertexBuffers) {
                    1 === t && this._vertexBuffers[i].create();
                    var n = this._vertexBuffers[i].getBuffer();
                    n && (n.references = t), i === Te.PositionKind && (this._extend || this._updateExtend(), e._boundingInfo = new Ie(this._extend.minimum, this._extend.maximum), e._createGlobalSubMesh(!1), e._updateBoundingInfo())
                }
                1 === t && this._indices && this._indices.length > 0 && (this._indexBuffer = this._engine.createIndexBuffer(this._indices)), this._indexBuffer && (this._indexBuffer.references = t), e._syncGeometryWithMorphTargetManager(), e.synchronizeInstances()
            }, e.prototype.notifyUpdate = function(e) {
                this.onGeometryUpdated && this.onGeometryUpdated(this, e);
                for (var t = 0, i = this._meshes; t < i.length; t++) {
                    i[t]._markSubMeshesAsAttributesDirty()
                }
            }, e.prototype.load = function(e, t) {
                this.delayLoadState !== k.DELAYLOADSTATE_LOADING && (this.isReady() ? t && t() : (this.delayLoadState = k.DELAYLOADSTATE_LOADING, this._queueLoad(e, t)))
            }, e.prototype._queueLoad = function(e, t) {
                var i = this;
                this.delayLoadingFile && (e._addPendingData(this), e._loadFile(this.delayLoadingFile, (function(n) {
                    if (i._delayLoadingFunction) {
                        i._delayLoadingFunction(JSON.parse(n), i), i.delayLoadState = k.DELAYLOADSTATE_LOADED, i._delayInfo = [], e._removePendingData(i);
                        for (var r = i._meshes, o = r.length, s = 0; s < o; s++) i._applyToMesh(r[s]);
                        t && t()
                    }
                }), void 0, !0))
            }, e.prototype.toLeftHanded = function() {
                var e = this.getIndices(!1);
                if (null != e && e.length > 0) {
                    for (var t = 0; t < e.length; t += 3) {
                        var i = e[t + 0];
                        e[t + 0] = e[t + 2], e[t + 2] = i
                    }
                    this.setIndices(e)
                }
                var n = this.getVerticesData(Te.PositionKind, !1);
                if (null != n && n.length > 0) {
                    for (t = 0; t < n.length; t += 3) n[t + 2] = -n[t + 2];
                    this.setVerticesData(Te.PositionKind, n, !1)
                }
                var r = this.getVerticesData(Te.NormalKind, !1);
                if (null != r && r.length > 0) {
                    for (t = 0; t < r.length; t += 3) r[t + 2] = -r[t + 2];
                    this.setVerticesData(Te.NormalKind, r, !1)
                }
            }, e.prototype._resetPointsArrayCache = function() {
                this._positions = null
            }, e.prototype._generatePointsArray = function() {
                if (this._positions) return !0;
                var e = this.getVerticesData(Te.PositionKind);
                if (!e || 0 === e.length) return !1;
                this._positions = [];
                for (var t = 0; t < e.length; t += 3) this._positions.push(b.FromArray(e, t));
                return !0
            }, e.prototype.isDisposed = function() {
                return this._isDisposed
            }, e.prototype._disposeVertexArrayObjects = function() {
                if (this._vertexArrayObjects) {
                    for (var e in this._vertexArrayObjects) this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);
                    this._vertexArrayObjects = {}
                }
            }, e.prototype.dispose = function() {
                var e, t = this._meshes,
                    i = t.length;
                for (e = 0; e < i; e++) this.releaseForMesh(t[e]);
                for (var n in this._meshes = [], this._disposeVertexArrayObjects(), this._vertexBuffers) this._vertexBuffers[n].dispose();
                this._vertexBuffers = {}, this._totalVertices = 0, this._indexBuffer && this._engine._releaseBuffer(this._indexBuffer), this._indexBuffer = null, this._indices = [], this.delayLoadState = k.DELAYLOADSTATE_NONE, this.delayLoadingFile = null, this._delayLoadingFunction = null, this._delayInfo = [], this._boundingInfo = null, this._scene.removeGeometry(this), this._isDisposed = !0
            }, e.prototype.copy = function(t) {
                var i = new Ye;
                i.indices = [];
                var n = this.getIndices();
                if (n)
                    for (var r = 0; r < n.length; r++) i.indices.push(n[r]);
                var o, s = !1,
                    a = !1;
                for (o in this._vertexBuffers) {
                    var u = this.getVerticesData(o);
                    if (u && (u instanceof Float32Array ? i.set(new Float32Array(u), o) : i.set(u.slice(0), o), !a)) {
                        var h = this.getVertexBuffer(o);
                        h && (a = !(s = h.isUpdatable()))
                    }
                }
                var l = new e(t, this._scene, i, s);
                for (o in l.delayLoadState = this.delayLoadState, l.delayLoadingFile = this.delayLoadingFile, l._delayLoadingFunction = this._delayLoadingFunction, this._delayInfo) l._delayInfo = l._delayInfo || [], l._delayInfo.push(o);
                return l._boundingInfo = new Ie(this._extend.minimum, this._extend.maximum), l
            }, e.prototype.serialize = function() {
                var e = {};
                return e.id = this.id, e.updatable = this._updatable, re && re.HasTags(this) && (e.tags = re.GetTags(this)), e
            }, e.prototype.toNumberArray = function(e) {
                return Array.isArray(e) ? e : Array.prototype.slice.call(e)
            }, e.prototype.serializeVerticeData = function() {
                var e = this.serialize();
                return this.isVerticesDataPresent(Te.PositionKind) && (e.positions = this.toNumberArray(this.getVerticesData(Te.PositionKind)), this.isVertexBufferUpdatable(Te.PositionKind) && (e.positions._updatable = !0)), this.isVerticesDataPresent(Te.NormalKind) && (e.normals = this.toNumberArray(this.getVerticesData(Te.NormalKind)), this.isVertexBufferUpdatable(Te.NormalKind) && (e.normals._updatable = !0)), this.isVerticesDataPresent(Te.TangentKind) && (e.tangets = this.toNumberArray(this.getVerticesData(Te.TangentKind)), this.isVertexBufferUpdatable(Te.TangentKind) && (e.tangets._updatable = !0)), this.isVerticesDataPresent(Te.UVKind) && (e.uvs = this.toNumberArray(this.getVerticesData(Te.UVKind)), this.isVertexBufferUpdatable(Te.UVKind) && (e.uvs._updatable = !0)), this.isVerticesDataPresent(Te.UV2Kind) && (e.uv2s = this.toNumberArray(this.getVerticesData(Te.UV2Kind)), this.isVertexBufferUpdatable(Te.UV2Kind) && (e.uv2s._updatable = !0)), this.isVerticesDataPresent(Te.UV3Kind) && (e.uv3s = this.toNumberArray(this.getVerticesData(Te.UV3Kind)), this.isVertexBufferUpdatable(Te.UV3Kind) && (e.uv3s._updatable = !0)), this.isVerticesDataPresent(Te.UV4Kind) && (e.uv4s = this.toNumberArray(this.getVerticesData(Te.UV4Kind)), this.isVertexBufferUpdatable(Te.UV4Kind) && (e.uv4s._updatable = !0)), this.isVerticesDataPresent(Te.UV5Kind) && (e.uv5s = this.toNumberArray(this.getVerticesData(Te.UV5Kind)), this.isVertexBufferUpdatable(Te.UV5Kind) && (e.uv5s._updatable = !0)), this.isVerticesDataPresent(Te.UV6Kind) && (e.uv6s = this.toNumberArray(this.getVerticesData(Te.UV6Kind)), this.isVertexBufferUpdatable(Te.UV6Kind) && (e.uv6s._updatable = !0)), this.isVerticesDataPresent(Te.ColorKind) && (e.colors = this.toNumberArray(this.getVerticesData(Te.ColorKind)), this.isVertexBufferUpdatable(Te.ColorKind) && (e.colors._updatable = !0)), this.isVerticesDataPresent(Te.MatricesIndicesKind) && (e.matricesIndices = this.toNumberArray(this.getVerticesData(Te.MatricesIndicesKind)), e.matricesIndices._isExpanded = !0, this.isVertexBufferUpdatable(Te.MatricesIndicesKind) && (e.matricesIndices._updatable = !0)), this.isVerticesDataPresent(Te.MatricesWeightsKind) && (e.matricesWeights = this.toNumberArray(this.getVerticesData(Te.MatricesWeightsKind)), this.isVertexBufferUpdatable(Te.MatricesWeightsKind) && (e.matricesWeights._updatable = !0)), e.indices = this.toNumberArray(this.getIndices()), e
            }, e.ExtractFromMesh = function(e, t) {
                var i = e._geometry;
                return i ? i.copy(t) : null
            }, e.RandomId = function() {
                return K.RandomId()
            }, e._ImportGeometry = function(t, i) {
                var n = i.getScene(),
                    r = t.geometryId;
                if (r) {
                    var o = n.getGeometryByID(r);
                    o && o.applyToMesh(i)
                } else if (t instanceof ArrayBuffer) {
                    var s = i._binaryInfo;
                    if (s.positionsAttrDesc && s.positionsAttrDesc.count > 0) {
                        var a = new Float32Array(t, s.positionsAttrDesc.offset, s.positionsAttrDesc.count);
                        i.setVerticesData(Te.PositionKind, a, !1)
                    }
                    if (s.normalsAttrDesc && s.normalsAttrDesc.count > 0) {
                        var u = new Float32Array(t, s.normalsAttrDesc.offset, s.normalsAttrDesc.count);
                        i.setVerticesData(Te.NormalKind, u, !1)
                    }
                    if (s.tangetsAttrDesc && s.tangetsAttrDesc.count > 0) {
                        var h = new Float32Array(t, s.tangetsAttrDesc.offset, s.tangetsAttrDesc.count);
                        i.setVerticesData(Te.TangentKind, h, !1)
                    }
                    if (s.uvsAttrDesc && s.uvsAttrDesc.count > 0) {
                        var l = new Float32Array(t, s.uvsAttrDesc.offset, s.uvsAttrDesc.count);
                        i.setVerticesData(Te.UVKind, l, !1)
                    }
                    if (s.uvs2AttrDesc && s.uvs2AttrDesc.count > 0) {
                        var c = new Float32Array(t, s.uvs2AttrDesc.offset, s.uvs2AttrDesc.count);
                        i.setVerticesData(Te.UV2Kind, c, !1)
                    }
                    if (s.uvs3AttrDesc && s.uvs3AttrDesc.count > 0) {
                        var d = new Float32Array(t, s.uvs3AttrDesc.offset, s.uvs3AttrDesc.count);
                        i.setVerticesData(Te.UV3Kind, d, !1)
                    }
                    if (s.uvs4AttrDesc && s.uvs4AttrDesc.count > 0) {
                        var f = new Float32Array(t, s.uvs4AttrDesc.offset, s.uvs4AttrDesc.count);
                        i.setVerticesData(Te.UV4Kind, f, !1)
                    }
                    if (s.uvs5AttrDesc && s.uvs5AttrDesc.count > 0) {
                        var p = new Float32Array(t, s.uvs5AttrDesc.offset, s.uvs5AttrDesc.count);
                        i.setVerticesData(Te.UV5Kind, p, !1)
                    }
                    if (s.uvs6AttrDesc && s.uvs6AttrDesc.count > 0) {
                        var _ = new Float32Array(t, s.uvs6AttrDesc.offset, s.uvs6AttrDesc.count);
                        i.setVerticesData(Te.UV6Kind, _, !1)
                    }
                    if (s.colorsAttrDesc && s.colorsAttrDesc.count > 0) {
                        var g = new Float32Array(t, s.colorsAttrDesc.offset, s.colorsAttrDesc.count);
                        i.setVerticesData(Te.ColorKind, g, !1, s.colorsAttrDesc.stride)
                    }
                    if (s.matricesIndicesAttrDesc && s.matricesIndicesAttrDesc.count > 0) {
                        for (var m = new Int32Array(t, s.matricesIndicesAttrDesc.offset, s.matricesIndicesAttrDesc.count), v = [], T = 0; T < m.length; T++) {
                            var b = m[T];
                            v.push(255 & b), v.push((65280 & b) >> 8), v.push((16711680 & b) >> 16), v.push(b >> 24)
                        }
                        i.setVerticesData(Te.MatricesIndicesKind, v, !1)
                    }
                    if (s.matricesWeightsAttrDesc && s.matricesWeightsAttrDesc.count > 0) {
                        var E = new Float32Array(t, s.matricesWeightsAttrDesc.offset, s.matricesWeightsAttrDesc.count);
                        i.setVerticesData(Te.MatricesWeightsKind, E, !1)
                    }
                    if (s.indicesAttrDesc && s.indicesAttrDesc.count > 0) {
                        var A = new Int32Array(t, s.indicesAttrDesc.offset, s.indicesAttrDesc.count);
                        i.setIndices(A, null)
                    }
                    if (s.subMeshesAttrDesc && s.subMeshesAttrDesc.count > 0) {
                        var M = new Int32Array(t, s.subMeshesAttrDesc.offset, 5 * s.subMeshesAttrDesc.count);
                        i.subMeshes = [];
                        for (T = 0; T < s.subMeshesAttrDesc.count; T++) {
                            var R = M[5 * T + 0],
                                x = M[5 * T + 1],
                                P = M[5 * T + 2],
                                I = M[5 * T + 3],
                                C = M[5 * T + 4];
                            Se.AddToMesh(R, x, P, I, C, i)
                        }
                    }
                } else if (t.positions && t.normals && t.indices) {
                    if (i.setVerticesData(Te.PositionKind, t.positions, t.positions._updatable), i.setVerticesData(Te.NormalKind, t.normals, t.normals._updatable), t.tangents && i.setVerticesData(Te.TangentKind, t.tangents, t.tangents._updatable), t.uvs && i.setVerticesData(Te.UVKind, t.uvs, t.uvs._updatable), t.uvs2 && i.setVerticesData(Te.UV2Kind, t.uvs2, t.uvs2._updatable), t.uvs3 && i.setVerticesData(Te.UV3Kind, t.uvs3, t.uvs3._updatable), t.uvs4 && i.setVerticesData(Te.UV4Kind, t.uvs4, t.uvs4._updatable), t.uvs5 && i.setVerticesData(Te.UV5Kind, t.uvs5, t.uvs5._updatable), t.uvs6 && i.setVerticesData(Te.UV6Kind, t.uvs6, t.uvs6._updatable), t.colors && i.setVerticesData(Te.ColorKind, y.CheckColors4(t.colors, t.positions.length / 3), t.colors._updatable), t.matricesIndices)
                        if (t.matricesIndices._isExpanded) delete t.matricesIndices._isExpanded, i.setVerticesData(Te.MatricesIndicesKind, t.matricesIndices, t.matricesIndices._updatable);
                        else {
                            for (v = [], T = 0; T < t.matricesIndices.length; T++) {
                                var S = t.matricesIndices[T];
                                v.push(255 & S), v.push((65280 & S) >> 8), v.push((16711680 & S) >> 16), v.push(S >> 24)
                            }
                            i.setVerticesData(Te.MatricesIndicesKind, v, t.matricesIndices._updatable)
                        }
                    if (t.matricesIndicesExtra)
                        if (t.matricesIndicesExtra._isExpanded) delete t.matricesIndices._isExpanded, i.setVerticesData(Te.MatricesIndicesExtraKind, t.matricesIndicesExtra, t.matricesIndicesExtra._updatable);
                        else {
                            for (v = [], T = 0; T < t.matricesIndicesExtra.length; T++) {
                                S = t.matricesIndicesExtra[T];
                                v.push(255 & S), v.push((65280 & S) >> 8), v.push((16711680 & S) >> 16), v.push(S >> 24)
                            }
                            i.setVerticesData(Te.MatricesIndicesExtraKind, v, t.matricesIndicesExtra._updatable)
                        }
                    t.matricesWeights && (e._CleanMatricesWeights(t, i), i.setVerticesData(Te.MatricesWeightsKind, t.matricesWeights, t.matricesWeights._updatable)), t.matricesWeightsExtra && i.setVerticesData(Te.MatricesWeightsExtraKind, t.matricesWeightsExtra, t.matricesWeights._updatable), i.setIndices(t.indices, null)
                }
                if (t.subMeshes) {
                    i.subMeshes = [];
                    for (var O = 0; O < t.subMeshes.length; O++) {
                        var D = t.subMeshes[O];
                        Se.AddToMesh(D.materialIndex, D.verticesStart, D.verticesCount, D.indexStart, D.indexCount, i)
                    }
                }
                i._shouldGenerateFlatShading && (i.convertToFlatShadedMesh(), delete i._shouldGenerateFlatShading), i.computeWorldMatrix(!0), n.onMeshImportedObservable.notifyObservers(i)
            }, e._CleanMatricesWeights = function(e, t) {
                if (Ot.CleanBoneMatrixWeights) {
                    var i = 0;
                    if (e.skeletonId > -1) {
                        var n = t.getScene().getLastSkeletonByID(e.skeletonId);
                        if (n) {
                            i = n.bones.length;
                            for (var r = t.getVerticesData(Te.MatricesIndicesKind), o = t.getVerticesData(Te.MatricesIndicesExtraKind), s = e.matricesWeights, a = e.matricesWeightsExtra, u = e.numBoneInfluencer, h = s.length, l = 0; l < h; l += 4) {
                                for (var c = 0, d = -1, f = 0; f < 4; f++) {
                                    c += p = s[l + f], p < .001 && d < 0 && (d = f)
                                }
                                if (a)
                                    for (f = 0; f < 4; f++) {
                                        var p;
                                        c += p = a[l + f], p < .001 && d < 0 && (d = f + 4)
                                    }
                                if ((d < 0 || d > u - 1) && (d = u - 1), c > .001) {
                                    var _ = 1 / c;
                                    for (f = 0; f < 4; f++) s[l + f] *= _;
                                    if (a)
                                        for (f = 0; f < 4; f++) a[l + f] *= _
                                } else d >= 4 ? (a[l + d - 4] = 1 - c, o[l + d - 4] = i) : (s[l + d] = 1 - c, r[l + d] = i)
                            }
                            t.setVerticesData(Te.MatricesIndicesKind, r), e.matricesWeightsExtra && t.setVerticesData(Te.MatricesIndicesExtraKind, o)
                        }
                    }
                }
            }, e.Parse = function(t, i, n) {
                if (i.getGeometryByID(t.id)) return null;
                var r = new e(t.id, i, void 0, t.updatable);
                return re && re.AddTagsTo(r, t.tags), t.delayLoadingFile ? (r.delayLoadState = k.DELAYLOADSTATE_NOTLOADED, r.delayLoadingFile = n + t.delayLoadingFile, r._boundingInfo = new Ie(b.FromArray(t.boundingBoxMinimum), b.FromArray(t.boundingBoxMaximum)), r._delayInfo = [], t.hasUVs && r._delayInfo.push(Te.UVKind), t.hasUVs2 && r._delayInfo.push(Te.UV2Kind), t.hasUVs3 && r._delayInfo.push(Te.UV3Kind), t.hasUVs4 && r._delayInfo.push(Te.UV4Kind), t.hasUVs5 && r._delayInfo.push(Te.UV5Kind), t.hasUVs6 && r._delayInfo.push(Te.UV6Kind), t.hasColors && r._delayInfo.push(Te.ColorKind), t.hasMatricesIndices && r._delayInfo.push(Te.MatricesIndicesKind), t.hasMatricesWeights && r._delayInfo.push(Te.MatricesWeightsKind), r._delayLoadingFunction = Ye.ImportVertexData) : Ye.ImportVertexData(t, r), i.pushGeometry(r, !0), r
            }, e
        }(),
        wt = function(e) {
            function t(t, i) {
                var n = e.call(this, t, i, !0) || this;
                return i.multiMaterials.push(n), n.subMaterials = new Array, n._storeEffectOnSubMeshes = !0, n
            }
            return r(t, e), Object.defineProperty(t.prototype, "subMaterials", {
                get: function() {
                    return this._subMaterials
                },
                set: function(e) {
                    this._subMaterials = e, this._hookArray(e)
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getChildren = function() {
                return this.subMaterials
            }, t.prototype._hookArray = function(e) {
                var t = this,
                    i = e.push;
                e.push = function() {
                    for (var n = [], r = 0; r < arguments.length; r++) n[r] = arguments[r];
                    var o = i.apply(e, n);
                    return t._markAllSubMeshesAsTexturesDirty(), o
                };
                var n = e.splice;
                e.splice = function(i, r) {
                    var o = n.apply(e, [i, r]);
                    return t._markAllSubMeshesAsTexturesDirty(), o
                }
            }, t.prototype.getSubMaterial = function(e) {
                return e < 0 || e >= this.subMaterials.length ? this.getScene().defaultMaterial : this.subMaterials[e]
            }, t.prototype.getActiveTextures = function() {
                var t;
                return (t = e.prototype.getActiveTextures.call(this)).concat.apply(t, this.subMaterials.map((function(e) {
                    return e ? e.getActiveTextures() : []
                })))
            }, t.prototype.getClassName = function() {
                return "MultiMaterial"
            }, t.prototype.isReadyForSubMesh = function(e, t, i) {
                for (var n = 0; n < this.subMaterials.length; n++) {
                    var r = this.subMaterials[n];
                    if (r) {
                        if (r._storeEffectOnSubMeshes) {
                            if (!r.isReadyForSubMesh(e, t, i)) return !1;
                            continue
                        }
                        if (!r.isReady(e)) return !1
                    }
                }
                return !0
            }, t.prototype.clone = function(e, i) {
                for (var n = new t(e, this.getScene()), r = 0; r < this.subMaterials.length; r++) {
                    var o = null,
                        s = this.subMaterials[r];
                    o = i && s ? s.clone(e + "-" + s.name) : this.subMaterials[r], n.subMaterials.push(o)
                }
                return n
            }, t.prototype.serialize = function() {
                var e = {};
                e.name = this.name, e.id = this.id, re && (e.tags = re.GetTags(this)), e.materials = [];
                for (var t = 0; t < this.subMaterials.length; t++) {
                    var i = this.subMaterials[t];
                    i ? e.materials.push(i.id) : e.materials.push(null)
                }
                return e
            }, t.prototype.dispose = function(t, i, n) {
                var r = this.getScene();
                if (r) {
                    if (n)
                        for (var o = 0; o < this.subMaterials.length; o++) {
                            var s = this.subMaterials[o];
                            s && s.dispose(t, i)
                        }(o = r.multiMaterials.indexOf(this)) >= 0 && r.multiMaterials.splice(o, 1), e.prototype.dispose.call(this, t, i)
                }
            }, t.ParseMultiMaterial = function(e, i) {
                var n = new t(e.name, i);
                n.id = e.id, re && re.AddTagsTo(n, e.tags);
                for (var r = 0; r < e.materials.length; r++) {
                    var o = e.materials[r];
                    o ? n.subMaterials.push(i.getMaterialByID(o)) : n.subMaterials.push(null)
                }
                return n
            }, t
        }(De);
    G.RegisteredTypes["BABYLON.MultiMaterial"] = wt;
    var Lt, Ft = function(e, t) {
            this.distance = e, this.mesh = t
        },
        Nt = function() {},
        Ut = function() {
            this.visibleInstances = {}, this.batchCache = new Bt, this.instancesBufferSize = 2048
        },
        Bt = function() {
            this.mustReturn = !1, this.visibleInstances = new Array, this.renderSelf = new Array, this.hardwareInstancedRendering = new Array
        },
        kt = function() {
            this._areNormalsFrozen = !1, this._source = null, this.meshMap = null, this._preActivateId = -1, this._LODLevels = new Array, this._morphTargetManager = null
        },
        Vt = function(e) {
            function t(i, n, r, o, s, a) {
                void 0 === n && (n = null), void 0 === r && (r = null), void 0 === o && (o = null), void 0 === a && (a = !0);
                var u = e.call(this, i, n) || this;
                if (u._internalMeshDataInfo = new kt, u.delayLoadState = k.DELAYLOADSTATE_NONE, u.instances = new Array, u._creationDataStorage = null, u._geometry = null, u._instanceDataStorage = new Ut, u._effectiveMaterial = null, u._shouldGenerateFlatShading = !1, u._originalBuilderSideOrientation = t.DEFAULTSIDE, u.overrideMaterialSideOrientation = null, n = u.getScene(), o) {
                    if (o._geometry && o._geometry.applyToMesh(u), W.DeepCopy(o, u, ["name", "material", "skeleton", "instances", "parent", "uniqueId", "source", "metadata", "hasLODLevels", "geometry", "isBlocked", "areNormalsFrozen", "onBeforeDrawObservable", "onBeforeRenderObservable", "onAfterRenderObservable", "onBeforeDraw", "onAfterWorldMatrixUpdateObservable", "onCollideObservable", "onCollisionPositionChangeObservable", "onRebuildObservable", "onDisposeObservable"], ["_poseMatrix"]), u._internalMeshDataInfo._source = o, n.useClonedMeshhMap && (o._internalMeshDataInfo.meshMap || (o._internalMeshDataInfo.meshMap = {}), o._internalMeshDataInfo.meshMap[u.uniqueId] = u), u._originalBuilderSideOrientation = o._originalBuilderSideOrientation, u._creationDataStorage = o._creationDataStorage, o._ranges) {
                        var h = o._ranges;
                        for (var i in h) h.hasOwnProperty(i) && h[i] && u.createAnimationRange(i, h[i].from, h[i].to)
                    }
                    var l;
                    if (o.metadata && o.metadata.clone ? u.metadata = o.metadata.clone() : u.metadata = o.metadata, re && re.HasTags(o) && re.AddTagsTo(u, re.GetTags(o, !0)), u.parent = o.parent, u.setPivotMatrix(o.getPivotMatrix()), u.id = i + "." + o.id, u.material = o.material, !s)
                        for (var c = o.getDescendants(!0), d = 0; d < c.length; d++) {
                            var f = c[d];
                            f.clone && f.clone(i + "." + f.name, u)
                        }
                    if (n.getPhysicsEngine) {
                        var p = n.getPhysicsEngine();
                        if (a && p) {
                            var _ = p.getImpostorForPhysicsObject(o);
                            _ && (u.physicsImpostor = _.clone(u))
                        }
                    }
                    for (l = 0; l < n.particleSystems.length; l++) {
                        var g = n.particleSystems[l];
                        g.emitter === o && g.clone(g.name, u)
                    }
                    u.refreshBoundingInfo(), u.computeWorldMatrix(!0)
                }
                return null !== r && (u.parent = r), u._instanceDataStorage.hardwareInstancedRendering = u.getEngine().getCaps().instancedArrays, u
            }
            return r(t, e), t._GetDefaultSideOrientation = function(e) {
                return e || t.FRONTSIDE
            }, Object.defineProperty(t.prototype, "onBeforeRenderObservable", {
                get: function() {
                    return this._internalMeshDataInfo._onBeforeRenderObservable || (this._internalMeshDataInfo._onBeforeRenderObservable = new l), this._internalMeshDataInfo._onBeforeRenderObservable
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "onBeforeBindObservable", {
                get: function() {
                    return this._internalMeshDataInfo._onBeforeBindObservable || (this._internalMeshDataInfo._onBeforeBindObservable = new l), this._internalMeshDataInfo._onBeforeBindObservable
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "onAfterRenderObservable", {
                get: function() {
                    return this._internalMeshDataInfo._onAfterRenderObservable || (this._internalMeshDataInfo._onAfterRenderObservable = new l), this._internalMeshDataInfo._onAfterRenderObservable
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "onBeforeDrawObservable", {
                get: function() {
                    return this._internalMeshDataInfo._onBeforeDrawObservable || (this._internalMeshDataInfo._onBeforeDrawObservable = new l), this._internalMeshDataInfo._onBeforeDrawObservable
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "onBeforeDraw", {
                set: function(e) {
                    this._onBeforeDrawObserver && this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver), this._onBeforeDrawObserver = this.onBeforeDrawObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "morphTargetManager", {
                get: function() {
                    return this._internalMeshDataInfo._morphTargetManager
                },
                set: function(e) {
                    this._internalMeshDataInfo._morphTargetManager !== e && (this._internalMeshDataInfo._morphTargetManager = e, this._syncGeometryWithMorphTargetManager())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "source", {
                get: function() {
                    return this._internalMeshDataInfo._source
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "isUnIndexed", {
                get: function() {
                    return this._unIndexed
                },
                set: function(e) {
                    this._unIndexed !== e && (this._unIndexed = e, this._markSubMeshesAsAttributesDirty())
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getClassName = function() {
                return "Mesh"
            }, Object.defineProperty(t.prototype, "_isMesh", {
                get: function() {
                    return !0
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.toString = function(t) {
                var i = e.prototype.toString.call(this, t);
                if (i += ", n vertices: " + this.getTotalVertices(), i += ", parent: " + (this._waitingParentId ? this._waitingParentId : this.parent ? this.parent.name : "NONE"), this.animations)
                    for (var n = 0; n < this.animations.length; n++) i += ", animation[0]: " + this.animations[n].toString(t);
                if (t)
                    if (this._geometry) {
                        var r = this.getIndices(),
                            o = this.getVerticesData(Te.PositionKind);
                        o && r && (i += ", flat shading: " + (o.length / 3 === r.length ? "YES" : "NO"))
                    } else i += ", flat shading: UNKNOWN";
                return i
            }, t.prototype._unBindEffect = function() {
                e.prototype._unBindEffect.call(this);
                for (var t = 0, i = this.instances; t < i.length; t++) {
                    i[t]._unBindEffect()
                }
            }, Object.defineProperty(t.prototype, "hasLODLevels", {
                get: function() {
                    return this._internalMeshDataInfo._LODLevels.length > 0
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getLODLevels = function() {
                return this._internalMeshDataInfo._LODLevels
            }, t.prototype._sortLODLevels = function() {
                this._internalMeshDataInfo._LODLevels.sort((function(e, t) {
                    return e.distance < t.distance ? 1 : e.distance > t.distance ? -1 : 0
                }))
            }, t.prototype.addLODLevel = function(e, t) {
                if (t && t._masterMesh) return V.Warn("You cannot use a mesh as LOD level twice"), this;
                var i = new Ft(e, t);
                return this._internalMeshDataInfo._LODLevels.push(i), t && (t._masterMesh = this), this._sortLODLevels(), this
            }, t.prototype.getLODLevelAtDistance = function(e) {
                for (var t = this._internalMeshDataInfo, i = 0; i < t._LODLevels.length; i++) {
                    var n = t._LODLevels[i];
                    if (n.distance === e) return n.mesh
                }
                return null
            }, t.prototype.removeLODLevel = function(e) {
                for (var t = this._internalMeshDataInfo, i = 0; i < t._LODLevels.length; i++) t._LODLevels[i].mesh === e && (t._LODLevels.splice(i, 1), e && (e._masterMesh = null));
                return this._sortLODLevels(), this
            }, t.prototype.getLOD = function(e, t) {
                var i, n = this._internalMeshDataInfo;
                if (!n._LODLevels || 0 === n._LODLevels.length) return this;
                t ? i = t : i = this.getBoundingInfo().boundingSphere;
                var r = i.centerWorld.subtract(e.globalPosition).length();
                if (n._LODLevels[n._LODLevels.length - 1].distance > r) return this.onLODLevelSelection && this.onLODLevelSelection(r, this, n._LODLevels[n._LODLevels.length - 1].mesh), this;
                for (var o = 0; o < n._LODLevels.length; o++) {
                    var s = n._LODLevels[o];
                    if (s.distance < r) return s.mesh && (s.mesh._preActivate(), s.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)), this.onLODLevelSelection && this.onLODLevelSelection(r, this, s.mesh), s.mesh
                }
                return this.onLODLevelSelection && this.onLODLevelSelection(r, this, this), this
            }, Object.defineProperty(t.prototype, "geometry", {
                get: function() {
                    return this._geometry
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getTotalVertices = function() {
                return null === this._geometry || void 0 === this._geometry ? 0 : this._geometry.getTotalVertices()
            }, t.prototype.getVerticesData = function(e, t, i) {
                return this._geometry ? this._geometry.getVerticesData(e, t, i) : null
            }, t.prototype.getVertexBuffer = function(e) {
                return this._geometry ? this._geometry.getVertexBuffer(e) : null
            }, t.prototype.isVerticesDataPresent = function(e) {
                return this._geometry ? this._geometry.isVerticesDataPresent(e) : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e)
            }, t.prototype.isVertexBufferUpdatable = function(e) {
                return this._geometry ? this._geometry.isVertexBufferUpdatable(e) : !!this._delayInfo && -1 !== this._delayInfo.indexOf(e)
            }, t.prototype.getVerticesDataKinds = function() {
                if (!this._geometry) {
                    var e = new Array;
                    return this._delayInfo && this._delayInfo.forEach((function(t) {
                        e.push(t)
                    })), e
                }
                return this._geometry.getVerticesDataKinds()
            }, t.prototype.getTotalIndices = function() {
                return this._geometry ? this._geometry.getTotalIndices() : 0
            }, t.prototype.getIndices = function(e, t) {
                return this._geometry ? this._geometry.getIndices(e, t) : []
            }, Object.defineProperty(t.prototype, "isBlocked", {
                get: function() {
                    return null !== this._masterMesh && void 0 !== this._masterMesh
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.isReady = function(t, i) {
                if (void 0 === t && (t = !1), void 0 === i && (i = !1), this.delayLoadState === k.DELAYLOADSTATE_LOADING) return !1;
                if (!e.prototype.isReady.call(this, t)) return !1;
                if (!this.subMeshes || 0 === this.subMeshes.length) return !0;
                if (!t) return !0;
                var n = this.getEngine(),
                    r = this.getScene(),
                    o = i || n.getCaps().instancedArrays && this.instances.length > 0;
                this.computeWorldMatrix();
                var s = this.material || r.defaultMaterial;
                if (s)
                    if (s._storeEffectOnSubMeshes)
                        for (var a = 0, u = this.subMeshes; a < u.length; a++) {
                            var h = (_ = u[a]).getMaterial();
                            if (h)
                                if (h._storeEffectOnSubMeshes) {
                                    if (!h.isReadyForSubMesh(this, _, o)) return !1
                                } else if (!h.isReady(this, o)) return !1
                        } else if (!s.isReady(this, o)) return !1;
                for (var l = 0, c = this.lightSources; l < c.length; l++) {
                    var d = c[l].getShadowGenerator();
                    if (d)
                        for (var f = 0, p = this.subMeshes; f < p.length; f++) {
                            var _ = p[f];
                            if (!d.isReady(_, o)) return !1
                        }
                }
                for (var g = 0, m = this._internalMeshDataInfo._LODLevels; g < m.length; g++) {
                    var v = m[g];
                    if (v.mesh && !v.mesh.isReady(o)) return !1
                }
                return !0
            }, Object.defineProperty(t.prototype, "areNormalsFrozen", {
                get: function() {
                    return this._internalMeshDataInfo._areNormalsFrozen
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.freezeNormals = function() {
                return this._internalMeshDataInfo._areNormalsFrozen = !0, this
            }, t.prototype.unfreezeNormals = function() {
                return this._internalMeshDataInfo._areNormalsFrozen = !1, this
            }, Object.defineProperty(t.prototype, "overridenInstanceCount", {
                set: function(e) {
                    this._instanceDataStorage.overridenInstanceCount = e
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._preActivate = function() {
                var e = this._internalMeshDataInfo,
                    t = this.getScene().getRenderId();
                return e._preActivateId === t ? this : (e._preActivateId = t, this._instanceDataStorage.visibleInstances = null, this)
            }, t.prototype._preActivateForIntermediateRendering = function(e) {
                return this._instanceDataStorage.visibleInstances && (this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId = e), this
            }, t.prototype._registerInstanceForRenderId = function(e, t) {
                return this._instanceDataStorage.visibleInstances || (this._instanceDataStorage.visibleInstances = {
                    defaultRenderId: t,
                    selfDefaultRenderId: this._renderId
                }), this._instanceDataStorage.visibleInstances[t] || (this._instanceDataStorage.visibleInstances[t] = new Array), this._instanceDataStorage.visibleInstances[t].push(e), this
            }, t.prototype.refreshBoundingInfo = function(e) {
                if (void 0 === e && (e = !1), this._boundingInfo && this._boundingInfo.isLocked) return this;
                var t = this.geometry ? this.geometry.boundingBias : null;
                return this._refreshBoundingInfo(this._getPositionData(e), t), this
            }, t.prototype._createGlobalSubMesh = function(e) {
                var t = this.getTotalVertices();
                if (!t || !this.getIndices()) return null;
                if (this.subMeshes && this.subMeshes.length > 0) {
                    var i = this.getIndices();
                    if (!i) return null;
                    var n = i.length,
                        r = !1;
                    if (e) r = !0;
                    else
                        for (var o = 0, s = this.subMeshes; o < s.length; o++) {
                            var a = s[o];
                            if (a.indexStart + a.indexCount >= n) {
                                r = !0;
                                break
                            }
                            if (a.verticesStart + a.verticesCount >= t) {
                                r = !0;
                                break
                            }
                        }
                    if (!r) return this.subMeshes[0]
                }
                return this.releaseSubMeshes(), new Se(0, 0, t, 0, this.getTotalIndices(), this)
            }, t.prototype.subdivide = function(e) {
                if (!(e < 1)) {
                    for (var t = this.getTotalIndices(), i = t / e | 0, n = 0; i % 3 != 0;) i++;
                    this.releaseSubMeshes();
                    for (var r = 0; r < e && !(n >= t); r++) Se.CreateFromIndices(0, n, Math.min(i, t - n), this), n += i;
                    this.synchronizeInstances()
                }
            }, t.prototype.setVerticesData = function(e, t, i, n) {
                if (void 0 === i && (i = !1), this._geometry) this._geometry.setVerticesData(e, t, i, n);
                else {
                    var r = new Ye;
                    r.set(t, e);
                    var o = this.getScene();
                    new Dt(Dt.RandomId(), o, r, i, this)
                }
                return this
            }, t.prototype.markVerticesDataAsUpdatable = function(e, t) {
                void 0 === t && (t = !0);
                var i = this.getVertexBuffer(e);
                i && i.isUpdatable() !== t && this.setVerticesData(e, this.getVerticesData(e), t)
            }, t.prototype.setVerticesBuffer = function(e) {
                return this._geometry || (this._geometry = Dt.CreateGeometryForMesh(this)), this._geometry.setVerticesBuffer(e), this
            }, t.prototype.updateVerticesData = function(e, t, i, n) {
                return this._geometry ? (n ? (this.makeGeometryUnique(), this.updateVerticesData(e, t, i, !1)) : this._geometry.updateVerticesData(e, t, i), this) : this
            }, t.prototype.updateMeshPositions = function(e, t) {
                void 0 === t && (t = !0);
                var i = this.getVerticesData(Te.PositionKind);
                if (!i) return this;
                if (e(i), this.updateVerticesData(Te.PositionKind, i, !1, !1), t) {
                    var n = this.getIndices(),
                        r = this.getVerticesData(Te.NormalKind);
                    if (!r) return this;
                    Ye.ComputeNormals(i, n, r), this.updateVerticesData(Te.NormalKind, r, !1, !1)
                }
                return this
            }, t.prototype.makeGeometryUnique = function() {
                if (!this._geometry) return this;
                var e = this._geometry,
                    t = this._geometry.copy(Dt.RandomId());
                return e.releaseForMesh(this, !0), t.applyToMesh(this), this
            }, t.prototype.setIndices = function(e, t, i) {
                if (void 0 === t && (t = null), void 0 === i && (i = !1), this._geometry) this._geometry.setIndices(e, t, i);
                else {
                    var n = new Ye;
                    n.indices = e;
                    var r = this.getScene();
                    new Dt(Dt.RandomId(), r, n, i, this)
                }
                return this
            }, t.prototype.updateIndices = function(e, t, i) {
                return void 0 === i && (i = !1), this._geometry ? (this._geometry.updateIndices(e, t, i), this) : this
            }, t.prototype.toLeftHanded = function() {
                return this._geometry ? (this._geometry.toLeftHanded(), this) : this
            }, t.prototype._bind = function(e, t, i) {
                if (!this._geometry) return this;
                var n, r = this.getScene().getEngine();
                if (this._unIndexed) n = null;
                else switch (i) {
                    case De.PointFillMode:
                        n = null;
                        break;
                    case De.WireFrameFillMode:
                        n = e._getLinesIndexBuffer(this.getIndices(), r);
                        break;
                    default:
                    case De.TriangleFillMode:
                        n = this._geometry.getIndexBuffer()
                }
                return this._geometry._bind(t, n), this
            }, t.prototype._draw = function(e, t, i) {
                if (!this._geometry || !this._geometry.getVertexBuffers() || !this._unIndexed && !this._geometry.getIndexBuffer()) return this;
                this._internalMeshDataInfo._onBeforeDrawObservable && this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);
                var n = this.getScene().getEngine();
                return this._unIndexed || t == De.PointFillMode ? n.drawArraysType(t, e.verticesStart, e.verticesCount, i) : t == De.WireFrameFillMode ? n.drawElementsType(t, 0, e._linesIndexCount, i) : n.drawElementsType(t, e.indexStart, e.indexCount, i), this
            }, t.prototype.registerBeforeRender = function(e) {
                return this.onBeforeRenderObservable.add(e), this
            }, t.prototype.unregisterBeforeRender = function(e) {
                return this.onBeforeRenderObservable.removeCallback(e), this
            }, t.prototype.registerAfterRender = function(e) {
                return this.onAfterRenderObservable.add(e), this
            }, t.prototype.unregisterAfterRender = function(e) {
                return this.onAfterRenderObservable.removeCallback(e), this
            }, t.prototype._getInstancesRenderList = function(e) {
                if (this._instanceDataStorage.isFrozen && this._instanceDataStorage.previousBatch) return this._instanceDataStorage.previousBatch;
                var t = this.getScene(),
                    i = t._isInIntermediateRendering(),
                    n = i ? this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate : this._internalAbstractMeshDataInfo._onlyForInstances,
                    r = this._instanceDataStorage.batchCache;
                if (r.mustReturn = !1, r.renderSelf[e] = !n && this.isEnabled() && this.isVisible, r.visibleInstances[e] = null, this._instanceDataStorage.visibleInstances) {
                    var o = this._instanceDataStorage.visibleInstances,
                        s = t.getRenderId(),
                        a = i ? o.intermediateDefaultRenderId : o.defaultRenderId;
                    r.visibleInstances[e] = o[s], !r.visibleInstances[e] && a && (r.visibleInstances[e] = o[a])
                }
                return r.hardwareInstancedRendering[e] = this._instanceDataStorage.hardwareInstancedRendering && null !== r.visibleInstances[e] && void 0 !== r.visibleInstances[e], this._instanceDataStorage.previousBatch = r, r
            }, t.prototype._renderWithInstances = function(e, t, i, n, r) {
                var o = i.visibleInstances[e._id];
                if (!o) return this;
                for (var s = this._instanceDataStorage, a = s.instancesBufferSize, u = s.instancesBuffer, h = 16 * (o.length + 1) * 4; s.instancesBufferSize < h;) s.instancesBufferSize *= 2;
                s.instancesData && a == s.instancesBufferSize || (s.instancesData = new Float32Array(s.instancesBufferSize / 4));
                var l = 0,
                    c = 0,
                    d = this._effectiveMesh.getWorldMatrix();
                if (i.renderSelf[e._id] && (d.copyToArray(s.instancesData, l), l += 16, c++), o)
                    for (var f = 0; f < o.length; f++) {
                        o[f].getWorldMatrix().copyToArray(s.instancesData, l), l += 16, c++
                    }
                return u && a == s.instancesBufferSize ? u.updateDirectly(s.instancesData, 0, c) : (u && u.dispose(), u = new ye(r, s.instancesData, !0, 16, !1, !0), s.instancesBuffer = u, this.setVerticesBuffer(u.createVertexBuffer("world0", 0, 4)), this.setVerticesBuffer(u.createVertexBuffer("world1", 4, 4)), this.setVerticesBuffer(u.createVertexBuffer("world2", 8, 4)), this.setVerticesBuffer(u.createVertexBuffer("world3", 12, 4))), this._bind(e, n, t), this._draw(e, t, c), r.unbindInstanceAttributes(), this
            }, t.prototype._processRendering = function(e, t, i, n, r, o, s) {
                var a = this.getScene().getEngine();
                if (r) this._renderWithInstances(e, i, n, t, a);
                else {
                    n.renderSelf[e._id] && (o && o(!1, this._effectiveMesh.getWorldMatrix(), s), this._draw(e, i, this._instanceDataStorage.overridenInstanceCount));
                    var u = n.visibleInstances[e._id];
                    if (u)
                        for (var h = 0; h < u.length; h++) {
                            var l = u[h].getWorldMatrix();
                            o && o(!0, l, s), this._draw(e, i)
                        }
                }
                return this
            }, t.prototype._freeze = function() {
                if (this._instanceDataStorage.isFrozen = !0, this.subMeshes)
                    for (var e = 0; e < this.subMeshes.length; e++) this._getInstancesRenderList(e)
            }, t.prototype._unFreeze = function() {
                this._instanceDataStorage.isFrozen = !1
            }, t.prototype.render = function(e, t) {
                var i = this.getScene();
                if (i._isInIntermediateRendering() ? this._internalAbstractMeshDataInfo._isActiveIntermediate = !1 : this._internalAbstractMeshDataInfo._isActive = !1, this._checkOcclusionQuery()) return this;
                var n = this._getInstancesRenderList(e._id);
                if (n.mustReturn) return this;
                if (!this._geometry || !this._geometry.getVertexBuffers() || !this._unIndexed && !this._geometry.getIndexBuffer()) return this;
                this._internalMeshDataInfo._onBeforeRenderObservable && this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);
                var r, o = i.getEngine(),
                    s = n.hardwareInstancedRendering[e._id],
                    a = this._instanceDataStorage,
                    u = e.getMaterial();
                if (!u) return this;
                if (!a.isFrozen || !this._effectiveMaterial || this._effectiveMaterial !== u)
                    if (this._effectiveMaterial = u, this._effectiveMaterial._storeEffectOnSubMeshes) {
                        if (!this._effectiveMaterial.isReadyForSubMesh(this, e, s)) return this
                    } else if (!this._effectiveMaterial.isReady(this, s)) return this;
                t && o.setAlphaMode(this._effectiveMaterial.alphaMode);
                for (var h = 0, l = i._beforeRenderingMeshStage; h < l.length; h++) {
                    l[h].action(this, e, n)
                }
                if (!(r = this._effectiveMaterial._storeEffectOnSubMeshes ? e.effect : this._effectiveMaterial.getEffect())) return this;
                var c, d = this._effectiveMesh;
                a.isFrozen ? c = a.sideOrientation : (null == (c = this.overrideMaterialSideOrientation) && (c = this._effectiveMaterial.sideOrientation, d._getWorldMatrixDeterminant() < 0 && (c = c === De.ClockWiseSideOrientation ? De.CounterClockWiseSideOrientation : De.ClockWiseSideOrientation)), a.sideOrientation = c);
                var f = this._effectiveMaterial._preBind(r, c);
                this._effectiveMaterial.forceDepthWrite && o.setDepthWrite(!0);
                var p = i.forcePointsCloud ? De.PointFillMode : i.forceWireframe ? De.WireFrameFillMode : this._effectiveMaterial.fillMode;
                this._internalMeshDataInfo._onBeforeBindObservable && this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this), s || this._bind(e, r, p);
                var _ = d.getWorldMatrix();
                this._effectiveMaterial._storeEffectOnSubMeshes ? this._effectiveMaterial.bindForSubMesh(_, this, e) : this._effectiveMaterial.bind(_, this), !this._effectiveMaterial.backFaceCulling && this._effectiveMaterial.separateCullingPass && (o.setState(!0, this._effectiveMaterial.zOffset, !1, !f), this._processRendering(e, r, p, n, s, this._onBeforeDraw, this._effectiveMaterial), o.setState(!0, this._effectiveMaterial.zOffset, !1, f)), this._processRendering(e, r, p, n, s, this._onBeforeDraw, this._effectiveMaterial), this._effectiveMaterial.unbind();
                for (var g = 0, m = i._afterRenderingMeshStage; g < m.length; g++) {
                    m[g].action(this, e, n)
                }
                return this._internalMeshDataInfo._onAfterRenderObservable && this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this), this
            }, t.prototype._onBeforeDraw = function(e, t, i) {
                e && i && i.bindOnlyWorldMatrix(t)
            }, t.prototype.cleanMatrixWeights = function() {
                this.isVerticesDataPresent(Te.MatricesWeightsKind) && (this.isVerticesDataPresent(Te.MatricesWeightsExtraKind) ? this.normalizeSkinWeightsAndExtra() : this.normalizeSkinFourWeights())
            }, t.prototype.normalizeSkinFourWeights = function() {
                for (var e = this.getVerticesData(Te.MatricesWeightsKind), t = e.length, i = 0; i < t; i += 4) {
                    var n = e[i] + e[i + 1] + e[i + 2] + e[i + 3];
                    if (0 === n) e[i] = 1;
                    else {
                        var r = 1 / n;
                        e[i] *= r, e[i + 1] *= r, e[i + 2] *= r, e[i + 3] *= r
                    }
                }
                this.setVerticesData(Te.MatricesWeightsKind, e)
            }, t.prototype.normalizeSkinWeightsAndExtra = function() {
                for (var e = this.getVerticesData(Te.MatricesWeightsExtraKind), t = this.getVerticesData(Te.MatricesWeightsKind), i = t.length, n = 0; n < i; n += 4) {
                    var r = t[n] + t[n + 1] + t[n + 2] + t[n + 3];
                    if (0 === (r += e[n] + e[n + 1] + e[n + 2] + e[n + 3])) t[n] = 1;
                    else {
                        var o = 1 / r;
                        t[n] *= o, t[n + 1] *= o, t[n + 2] *= o, t[n + 3] *= o, e[n] *= o, e[n + 1] *= o, e[n + 2] *= o, e[n + 3] *= o
                    }
                }
                this.setVerticesData(Te.MatricesWeightsKind, t), this.setVerticesData(Te.MatricesWeightsKind, e)
            }, t.prototype.validateSkinning = function() {
                var e = this.getVerticesData(Te.MatricesWeightsExtraKind),
                    t = this.getVerticesData(Te.MatricesWeightsKind);
                if (null === t || null == this.skeleton) return {
                    skinned: !1,
                    valid: !0,
                    report: "not skinned"
                };
                for (var i = t.length, n = 0, r = 0, o = 0, s = 0, a = null === e ? 4 : 8, u = new Array, h = 0; h <= a; h++) u[h] = 0;
                for (h = 0; h < i; h += 4) {
                    for (var l = t[h], c = l, d = 0 === c ? 0 : 1, f = 1; f < a; f++) {
                        var p = f < 4 ? t[h + f] : e[h + f - 4];
                        p > l && n++, 0 !== p && d++, c += p, l = p
                    }
                    if (u[d]++, d > o && (o = d), 0 === c) r++;
                    else {
                        var _ = 1 / c,
                            g = 0;
                        for (f = 0; f < a; f++) g += f < 4 ? Math.abs(t[h + f] - t[h + f] * _) : Math.abs(e[h + f - 4] - e[h + f - 4] * _);
                        g > .001 && s++
                    }
                }
                var m = this.skeleton.bones.length,
                    v = this.getVerticesData(Te.MatricesIndicesKind),
                    y = this.getVerticesData(Te.MatricesIndicesExtraKind),
                    T = 0;
                for (h = 0; h < i; h++)
                    for (f = 0; f < a; f++) {
                        var b = f < 4 ? v[f] : y[f - 4];
                        (b >= m || b < 0) && T++
                    }
                return {
                    skinned: !0,
                    valid: 0 === r && 0 === s && 0 === T,
                    report: "Number of Weights = " + i / 4 + "\nMaximum influences = " + o + "\nMissing Weights = " + r + "\nNot Sorted = " + n + "\nNot Normalized = " + s + "\nWeightCounts = [" + u + "]\nNumber of bones = " + m + "\nBad Bone Indices = " + T
                }
            }, t.prototype._checkDelayState = function() {
                var e = this.getScene();
                return this._geometry ? this._geometry.load(e) : this.delayLoadState === k.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = k.DELAYLOADSTATE_LOADING, this._queueLoad(e)), this
            }, t.prototype._queueLoad = function(e) {
                var t = this;
                e._addPendingData(this);
                var i = -1 !== this.delayLoadingFile.indexOf(".babylonbinarymeshdata");
                return K.LoadFile(this.delayLoadingFile, (function(i) {
                    i instanceof ArrayBuffer ? t._delayLoadingFunction(i, t) : t._delayLoadingFunction(JSON.parse(i), t), t.instances.forEach((function(e) {
                        e.refreshBoundingInfo(), e._syncSubMeshes()
                    })), t.delayLoadState = k.DELAYLOADSTATE_LOADED, e._removePendingData(t)
                }), (function() {}), e.offlineProvider, i), this
            }, t.prototype.isInFrustum = function(t) {
                return this.delayLoadState !== k.DELAYLOADSTATE_LOADING && (!!e.prototype.isInFrustum.call(this, t) && (this._checkDelayState(), !0))
            }, t.prototype.setMaterialByID = function(e) {
                var t, i = this.getScene().materials;
                for (t = i.length - 1; t > -1; t--)
                    if (i[t].id === e) return this.material = i[t], this;
                var n = this.getScene().multiMaterials;
                for (t = n.length - 1; t > -1; t--)
                    if (n[t].id === e) return this.material = n[t], this;
                return this
            }, t.prototype.getAnimatables = function() {
                var e = new Array;
                return this.material && e.push(this.material), this.skeleton && e.push(this.skeleton), e
            }, t.prototype.bakeTransformIntoVertices = function(e) {
                if (!this.isVerticesDataPresent(Te.PositionKind)) return this;
                var t = this.subMeshes.splice(0);
                this._resetPointsArrayCache();
                var i, n = this.getVerticesData(Te.PositionKind),
                    r = new Array;
                for (i = 0; i < n.length; i += 3) b.TransformCoordinates(b.FromArray(n, i), e).toArray(r, i);
                if (this.setVerticesData(Te.PositionKind, r, this.getVertexBuffer(Te.PositionKind).isUpdatable()), this.isVerticesDataPresent(Te.NormalKind)) {
                    for (n = this.getVerticesData(Te.NormalKind), r = [], i = 0; i < n.length; i += 3) b.TransformNormal(b.FromArray(n, i), e).normalize().toArray(r, i);
                    this.setVerticesData(Te.NormalKind, r, this.getVertexBuffer(Te.NormalKind).isUpdatable())
                }
                return e.m[0] * e.m[5] * e.m[10] < 0 && this.flipFaces(), this.releaseSubMeshes(), this.subMeshes = t, this
            }, t.prototype.bakeCurrentTransformIntoVertices = function() {
                return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)), this.scaling.copyFromFloats(1, 1, 1), this.position.copyFromFloats(0, 0, 0), this.rotation.copyFromFloats(0, 0, 0), this.rotationQuaternion && (this.rotationQuaternion = M.Identity()), this._worldMatrix = R.Identity(), this
            }, Object.defineProperty(t.prototype, "_positions", {
                get: function() {
                    return this._geometry ? this._geometry._positions : null
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._resetPointsArrayCache = function() {
                return this._geometry && this._geometry._resetPointsArrayCache(), this
            }, t.prototype._generatePointsArray = function() {
                return !!this._geometry && this._geometry._generatePointsArray()
            }, t.prototype.clone = function(e, i, n, r) {
                return void 0 === e && (e = ""), void 0 === r && (r = !0), new t(e, this.getScene(), i, this, n, r)
            }, t.prototype.dispose = function(t, i) {
                void 0 === i && (i = !1), this.morphTargetManager = null, this._geometry && this._geometry.releaseForMesh(this, !0);
                var n = this._internalMeshDataInfo;
                if (n._onBeforeDrawObservable && n._onBeforeDrawObservable.clear(), n._onBeforeBindObservable && n._onBeforeBindObservable.clear(), n._onBeforeRenderObservable && n._onBeforeRenderObservable.clear(), n._onAfterRenderObservable && n._onAfterRenderObservable.clear(), this._scene.useClonedMeshhMap) {
                    if (n.meshMap)
                        for (var r in n.meshMap) {
                            (a = n.meshMap[r]) && (a._internalMeshDataInfo._source = null, n.meshMap[r] = void 0)
                        }
                    n._source && n._source._internalMeshDataInfo.meshMap && (n._source._internalMeshDataInfo.meshMap[this.uniqueId] = void 0)
                } else
                    for (var o = 0, s = this.getScene().meshes; o < s.length; o++) {
                        var a;
                        (a = s[o])._internalMeshDataInfo && a._internalMeshDataInfo._source && a._internalMeshDataInfo._source === this && (a._internalMeshDataInfo._source = null)
                    }
                for (n._source = null, this._instanceDataStorage.instancesBuffer && (this._instanceDataStorage.instancesBuffer.dispose(), this._instanceDataStorage.instancesBuffer = null); this.instances.length;) this.instances[0].dispose();
                e.prototype.dispose.call(this, t, i)
            }, t.prototype.applyDisplacementMap = function(e, t, i, n, r, o, s) {
                var a = this;
                void 0 === s && (s = !1);
                var u = this.getScene();
                return K.LoadImage(e, (function(e) {
                    var u = document.createElement("canvas"),
                        h = u.getContext("2d"),
                        l = e.width,
                        c = e.height;
                    u.width = l, u.height = c, h.drawImage(e, 0, 0);
                    var d = h.getImageData(0, 0, l, c).data;
                    a.applyDisplacementMapFromBuffer(d, l, c, t, i, r, o, s), n && n(a)
                }), (function() {}), u.offlineProvider), this
            }, t.prototype.applyDisplacementMapFromBuffer = function(e, t, i, n, r, o, s, a) {
                if (void 0 === a && (a = !1), !this.isVerticesDataPresent(Te.PositionKind) || !this.isVerticesDataPresent(Te.NormalKind) || !this.isVerticesDataPresent(Te.UVKind)) return V.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"), this;
                var u = this.getVerticesData(Te.PositionKind, !0, !0),
                    h = this.getVerticesData(Te.NormalKind),
                    l = this.getVerticesData(Te.UVKind),
                    c = b.Zero(),
                    d = b.Zero(),
                    f = T.Zero();
                o = o || T.Zero(), s = s || new T(1, 1);
                for (var p = 0; p < u.length; p += 3) {
                    b.FromArrayToRef(u, p, c), b.FromArrayToRef(h, p, d), T.FromArrayToRef(l, p / 3 * 2, f);
                    var _ = 4 * ((Math.abs(f.x * s.x + o.x) * t % t | 0) + (Math.abs(f.y * s.y + o.y) * i % i | 0) * t),
                        g = .3 * (e[_] / 255) + .59 * (e[_ + 1] / 255) + .11 * (e[_ + 2] / 255);
                    d.normalize(), d.scaleInPlace(n + (r - n) * g), (c = c.add(d)).toArray(u, p)
                }
                return Ye.ComputeNormals(u, this.getIndices(), h), a ? (this.setVerticesData(Te.PositionKind, u), this.setVerticesData(Te.NormalKind, h)) : (this.updateVerticesData(Te.PositionKind, u), this.updateVerticesData(Te.NormalKind, h)), this
            }, t.prototype.convertToFlatShadedMesh = function() {
                var e, t, i = this.getVerticesDataKinds(),
                    n = {},
                    r = {},
                    o = {},
                    s = !1;
                for (e = 0; e < i.length; e++) {
                    t = i[e];
                    var a = this.getVertexBuffer(t);
                    t !== Te.NormalKind ? (n[t] = a, r[t] = n[t].getData(), o[t] = []) : (s = a.isUpdatable(), i.splice(e, 1), e--)
                }
                var u, h = this.subMeshes.slice(0),
                    l = this.getIndices(),
                    c = this.getTotalIndices();
                for (u = 0; u < c; u++) {
                    var d = l[u];
                    for (e = 0; e < i.length; e++)
                        for (var f = n[t = i[e]].getStrideSize(), p = 0; p < f; p++) o[t].push(r[t][d * f + p])
                }
                var _ = [],
                    g = o[Te.PositionKind];
                for (u = 0; u < c; u += 3) {
                    l[u] = u, l[u + 1] = u + 1, l[u + 2] = u + 2;
                    for (var m = b.FromArray(g, 3 * u), v = b.FromArray(g, 3 * (u + 1)), y = b.FromArray(g, 3 * (u + 2)), T = m.subtract(v), E = y.subtract(v), A = b.Normalize(b.Cross(T, E)), M = 0; M < 3; M++) _.push(A.x), _.push(A.y), _.push(A.z)
                }
                for (this.setIndices(l), this.setVerticesData(Te.NormalKind, _, s), e = 0; e < i.length; e++) t = i[e], this.setVerticesData(t, o[t], n[t].isUpdatable());
                this.releaseSubMeshes();
                for (var R = 0; R < h.length; R++) {
                    var x = h[R];
                    Se.AddToMesh(x.materialIndex, x.indexStart, x.indexCount, x.indexStart, x.indexCount, this)
                }
                return this.synchronizeInstances(), this
            }, t.prototype.convertToUnIndexedMesh = function() {
                var e, t, i = this.getVerticesDataKinds(),
                    n = {},
                    r = {},
                    o = {};
                for (e = 0; e < i.length; e++) {
                    t = i[e];
                    var s = this.getVertexBuffer(t);
                    n[t] = s, r[t] = n[t].getData(), o[t] = []
                }
                var a, u = this.subMeshes.slice(0),
                    h = this.getIndices(),
                    l = this.getTotalIndices();
                for (a = 0; a < l; a++) {
                    var c = h[a];
                    for (e = 0; e < i.length; e++)
                        for (var d = n[t = i[e]].getStrideSize(), f = 0; f < d; f++) o[t].push(r[t][c * d + f])
                }
                for (a = 0; a < l; a += 3) h[a] = a, h[a + 1] = a + 1, h[a + 2] = a + 2;
                for (this.setIndices(h), e = 0; e < i.length; e++) t = i[e], this.setVerticesData(t, o[t], n[t].isUpdatable());
                this.releaseSubMeshes();
                for (var p = 0; p < u.length; p++) {
                    var _ = u[p];
                    Se.AddToMesh(_.materialIndex, _.indexStart, _.indexCount, _.indexStart, _.indexCount, this)
                }
                return this._unIndexed = !0, this.synchronizeInstances(), this
            }, t.prototype.flipFaces = function(e) {
                void 0 === e && (e = !1);
                var t, i, n = Ye.ExtractFromMesh(this);
                if (e && this.isVerticesDataPresent(Te.NormalKind) && n.normals)
                    for (t = 0; t < n.normals.length; t++) n.normals[t] *= -1;
                if (n.indices)
                    for (t = 0; t < n.indices.length; t += 3) i = n.indices[t + 1], n.indices[t + 1] = n.indices[t + 2], n.indices[t + 2] = i;
                return n.applyToMesh(this), this
            }, t.prototype.increaseVertices = function(e) {
                var t = Ye.ExtractFromMesh(this),
                    i = t.uvs,
                    n = t.indices,
                    r = t.positions,
                    o = t.normals;
                if (null === n || null === r || null === o || null === i) V.Warn("VertexData contains null entries");
                else {
                    for (var s, a, u = e + 1, h = new Array, l = 0; l < u + 1; l++) h[l] = new Array;
                    var c, d = new b(0, 0, 0),
                        f = new b(0, 0, 0),
                        p = new T(0, 0),
                        _ = new Array,
                        g = new Array,
                        m = new Array,
                        v = r.length,
                        y = i.length;
                    for (l = 0; l < n.length; l += 3) {
                        g[0] = n[l], g[1] = n[l + 1], g[2] = n[l + 2];
                        for (var E = 0; E < 3; E++)
                            if (s = g[E], a = g[(E + 1) % 3], void 0 === m[s] && void 0 === m[a] ? (m[s] = new Array, m[a] = new Array) : (void 0 === m[s] && (m[s] = new Array), void 0 === m[a] && (m[a] = new Array)), void 0 === m[s][a] && void 0 === m[a][s]) {
                                m[s][a] = [], d.x = (r[3 * a] - r[3 * s]) / u, d.y = (r[3 * a + 1] - r[3 * s + 1]) / u, d.z = (r[3 * a + 2] - r[3 * s + 2]) / u, f.x = (o[3 * a] - o[3 * s]) / u, f.y = (o[3 * a + 1] - o[3 * s + 1]) / u, f.z = (o[3 * a + 2] - o[3 * s + 2]) / u, p.x = (i[2 * a] - i[2 * s]) / u, p.y = (i[2 * a + 1] - i[2 * s + 1]) / u, m[s][a].push(s);
                                for (var A = 1; A < u; A++) m[s][a].push(r.length / 3), r[v] = r[3 * s] + A * d.x, o[v++] = o[3 * s] + A * f.x, r[v] = r[3 * s + 1] + A * d.y, o[v++] = o[3 * s + 1] + A * f.y, r[v] = r[3 * s + 2] + A * d.z, o[v++] = o[3 * s + 2] + A * f.z, i[y++] = i[2 * s] + A * p.x, i[y++] = i[2 * s + 1] + A * p.y;
                                m[s][a].push(a), m[a][s] = new Array, c = m[s][a].length;
                                for (var M = 0; M < c; M++) m[a][s][M] = m[s][a][c - 1 - M]
                            }
                        h[0][0] = n[l], h[1][0] = m[n[l]][n[l + 1]][1], h[1][1] = m[n[l]][n[l + 2]][1];
                        for (A = 2; A < u; A++) {
                            h[A][0] = m[n[l]][n[l + 1]][A], h[A][A] = m[n[l]][n[l + 2]][A], d.x = (r[3 * h[A][A]] - r[3 * h[A][0]]) / A, d.y = (r[3 * h[A][A] + 1] - r[3 * h[A][0] + 1]) / A, d.z = (r[3 * h[A][A] + 2] - r[3 * h[A][0] + 2]) / A, f.x = (o[3 * h[A][A]] - o[3 * h[A][0]]) / A, f.y = (o[3 * h[A][A] + 1] - o[3 * h[A][0] + 1]) / A, f.z = (o[3 * h[A][A] + 2] - o[3 * h[A][0] + 2]) / A, p.x = (i[2 * h[A][A]] - i[2 * h[A][0]]) / A, p.y = (i[2 * h[A][A] + 1] - i[2 * h[A][0] + 1]) / A;
                            for (E = 1; E < A; E++) h[A][E] = r.length / 3, r[v] = r[3 * h[A][0]] + E * d.x, o[v++] = o[3 * h[A][0]] + E * f.x, r[v] = r[3 * h[A][0] + 1] + E * d.y, o[v++] = o[3 * h[A][0] + 1] + E * f.y, r[v] = r[3 * h[A][0] + 2] + E * d.z, o[v++] = o[3 * h[A][0] + 2] + E * f.z, i[y++] = i[2 * h[A][0]] + E * p.x, i[y++] = i[2 * h[A][0] + 1] + E * p.y
                        }
                        h[u] = m[n[l + 1]][n[l + 2]], _.push(h[0][0], h[1][0], h[1][1]);
                        for (A = 1; A < u; A++) {
                            for (E = 0; E < A; E++) _.push(h[A][E], h[A + 1][E], h[A + 1][E + 1]), _.push(h[A][E], h[A + 1][E + 1], h[A][E + 1]);
                            _.push(h[A][E], h[A + 1][E], h[A + 1][E + 1])
                        }
                    }
                    t.indices = _, t.applyToMesh(this)
                }
            }, t.prototype.forceSharedVertices = function() {
                var e = Ye.ExtractFromMesh(this),
                    t = e.uvs,
                    i = e.indices,
                    n = e.positions,
                    r = e.normals;
                if (null === i || null === n || null === r || null === t) V.Warn("VertexData contains null entries");
                else {
                    for (var o, s, a = new Array, u = new Array, h = new Array, l = new Array, c = 0, d = new Array, f = 0; f < i.length; f += 3) {
                        s = [i[f], i[f + 1], i[f + 2]], l = new Array;
                        for (var p = 0; p < 3; p++) {
                            l[p] = "";
                            for (var _ = 0; _ < 3; _++) Math.abs(n[3 * s[p] + _]) < 1e-8 && (n[3 * s[p] + _] = 0), l[p] += n[3 * s[p] + _] + "|";
                            l[p] = l[p].slice(0, -1)
                        }
                        if (l[0] != l[1] && l[0] != l[2] && l[1] != l[2])
                            for (p = 0; p < 3; p++) {
                                if ((o = d.indexOf(l[p])) < 0) {
                                    d.push(l[p]), o = c++;
                                    for (_ = 0; _ < 3; _++) a.push(n[3 * s[p] + _]);
                                    for (_ = 0; _ < 2; _++) h.push(t[2 * s[p] + _])
                                }
                                u.push(o)
                            }
                    }
                    var g = new Array;
                    Ye.ComputeNormals(a, u, g), e.positions = a, e.indices = u, e.normals = g, e.uvs = h, e.applyToMesh(this)
                }
            }, t._instancedMeshFactory = function(e, t) {
                throw X.WarnImport("InstancedMesh")
            }, t._PhysicsImpostorParser = function(e, t, i) {
                throw X.WarnImport("PhysicsImpostor")
            }, t.prototype.createInstance = function(e) {
                return t._instancedMeshFactory(e, this)
            }, t.prototype.synchronizeInstances = function() {
                for (var e = 0; e < this.instances.length; e++) {
                    this.instances[e]._syncSubMeshes()
                }
                return this
            }, t.prototype.optimizeIndices = function(e) {
                var t = this,
                    i = this.getIndices(),
                    n = this.getVerticesData(Te.PositionKind);
                if (!n || !i) return this;
                for (var r = new Array, o = 0; o < n.length; o += 3) r.push(b.FromArray(n, o));
                var s = new Array;
                return Q.SyncAsyncForLoop(r.length, 40, (function(e) {
                    for (var t = r.length - 1 - e, i = r[t], n = 0; n < t; ++n) {
                        var o = r[n];
                        if (i.equals(o)) {
                            s[t] = n;
                            break
                        }
                    }
                }), (function() {
                    for (var n = 0; n < i.length; ++n) i[n] = s[i[n]] || i[n];
                    var r = t.subMeshes.slice(0);
                    t.setIndices(i), t.subMeshes = r, e && e(t)
                })), this
            }, t.prototype.serialize = function(e) {
                e.name = this.name, e.id = this.id, e.type = this.getClassName(), re && re.HasTags(this) && (e.tags = re.GetTags(this)), e.position = this.position.asArray(), this.rotationQuaternion ? e.rotationQuaternion = this.rotationQuaternion.asArray() : this.rotation && (e.rotation = this.rotation.asArray()), e.scaling = this.scaling.asArray(), this._postMultiplyPivotMatrix ? e.pivotMatrix = this.getPivotMatrix().asArray() : e.localMatrix = this.getPivotMatrix().asArray(), e.isEnabled = this.isEnabled(!1), e.isVisible = this.isVisible, e.infiniteDistance = this.infiniteDistance, e.pickable = this.isPickable, e.receiveShadows = this.receiveShadows, e.billboardMode = this.billboardMode, e.visibility = this.visibility, e.checkCollisions = this.checkCollisions, e.isBlocker = this.isBlocker, this.parent && (e.parentId = this.parent.id), e.isUnIndexed = this.isUnIndexed;
                var t = this._geometry;
                if (t) {
                    var i = t.id;
                    e.geometryId = i, e.subMeshes = [];
                    for (var n = 0; n < this.subMeshes.length; n++) {
                        var r = this.subMeshes[n];
                        e.subMeshes.push({
                            materialIndex: r.materialIndex,
                            verticesStart: r.verticesStart,
                            verticesCount: r.verticesCount,
                            indexStart: r.indexStart,
                            indexCount: r.indexCount
                        })
                    }
                }
                if (this.material ? e.materialId = this.material.id : this.material = null, this.morphTargetManager && (e.morphTargetManagerId = this.morphTargetManager.uniqueId), this.skeleton && (e.skeletonId = this.skeleton.id), this.getScene()._getComponent(lt.NAME_PHYSICSENGINE)) {
                    var o = this.getPhysicsImpostor();
                    o && (e.physicsMass = o.getParam("mass"), e.physicsFriction = o.getParam("friction"), e.physicsRestitution = o.getParam("mass"), e.physicsImpostor = o.type)
                }
                this.metadata && (e.metadata = this.metadata), e.instances = [];
                for (var s = 0; s < this.instances.length; s++) {
                    var a = this.instances[s];
                    if (!a.doNotSerialize) {
                        var u = {
                            name: a.name,
                            id: a.id,
                            position: a.position.asArray(),
                            scaling: a.scaling.asArray()
                        };
                        a.parent && (u.parentId = a.parent.id), a.rotationQuaternion ? u.rotationQuaternion = a.rotationQuaternion.asArray() : a.rotation && (u.rotation = a.rotation.asArray()), e.instances.push(u), me.AppendSerializedAnimations(a, u), u.ranges = a.serializeAnimationRanges()
                    }
                }
                me.AppendSerializedAnimations(this, e), e.ranges = this.serializeAnimationRanges(), e.layerMask = this.layerMask, e.alphaIndex = this.alphaIndex, e.hasVertexAlpha = this.hasVertexAlpha, e.overlayAlpha = this.overlayAlpha, e.overlayColor = this.overlayColor.asArray(), e.renderOverlay = this.renderOverlay, e.applyFog = this.applyFog, this.actionManager && (e.actions = this.actionManager.serialize(this.name))
            }, t.prototype._syncGeometryWithMorphTargetManager = function() {
                if (this.geometry) {
                    this._markSubMeshesAsAttributesDirty();
                    var e = this._internalMeshDataInfo._morphTargetManager;
                    if (e && e.vertexCount) {
                        if (e.vertexCount !== this.getTotalVertices()) return V.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."), void(this.morphTargetManager = null);
                        for (var t = 0; t < e.numInfluencers; t++) {
                            var i = e.getActiveTarget(t),
                                n = i.getPositions();
                            if (!n) return void V.Error("Invalid morph target. Target must have positions.");
                            this.geometry.setVerticesData(Te.PositionKind + t, n, !1, 3);
                            var r = i.getNormals();
                            r && this.geometry.setVerticesData(Te.NormalKind + t, r, !1, 3);
                            var o = i.getTangents();
                            o && this.geometry.setVerticesData(Te.TangentKind + t, o, !1, 3)
                        }
                    } else
                        for (t = 0; this.geometry.isVerticesDataPresent(Te.PositionKind + t);) this.geometry.removeVerticesData(Te.PositionKind + t), this.geometry.isVerticesDataPresent(Te.NormalKind + t) && this.geometry.removeVerticesData(Te.NormalKind + t), this.geometry.isVerticesDataPresent(Te.TangentKind + t) && this.geometry.removeVerticesData(Te.TangentKind + t), t++
                }
            }, t.Parse = function(e, i, n) {
                var r;
                if ((r = e.type && "GroundMesh" === e.type ? t._GroundMeshParser(e, i) : new t(e.name, i)).id = e.id, re && re.AddTagsTo(r, e.tags), r.position = b.FromArray(e.position), void 0 !== e.metadata && (r.metadata = e.metadata), e.rotationQuaternion ? r.rotationQuaternion = M.FromArray(e.rotationQuaternion) : e.rotation && (r.rotation = b.FromArray(e.rotation)), r.scaling = b.FromArray(e.scaling), e.localMatrix ? r.setPreTransformMatrix(R.FromArray(e.localMatrix)) : e.pivotMatrix && r.setPivotMatrix(R.FromArray(e.pivotMatrix)), r.setEnabled(e.isEnabled), r.isVisible = e.isVisible, r.infiniteDistance = e.infiniteDistance, r.showBoundingBox = e.showBoundingBox, r.showSubMeshesBoundingBox = e.showSubMeshesBoundingBox, void 0 !== e.applyFog && (r.applyFog = e.applyFog), void 0 !== e.pickable && (r.isPickable = e.pickable), void 0 !== e.alphaIndex && (r.alphaIndex = e.alphaIndex), r.receiveShadows = e.receiveShadows, r.billboardMode = e.billboardMode, void 0 !== e.visibility && (r.visibility = e.visibility), r.checkCollisions = e.checkCollisions, void 0 !== e.isBlocker && (r.isBlocker = e.isBlocker), r._shouldGenerateFlatShading = e.useFlatShading, e.freezeWorldMatrix && (r._waitingData.freezeWorldMatrix = e.freezeWorldMatrix), e.parentId && (r._waitingParentId = e.parentId), void 0 !== e.actions && (r._waitingData.actions = e.actions), void 0 !== e.overlayAlpha && (r.overlayAlpha = e.overlayAlpha), void 0 !== e.overlayColor && (r.overlayColor = v.FromArray(e.overlayColor)), void 0 !== e.renderOverlay && (r.renderOverlay = e.renderOverlay), r.isUnIndexed = !!e.isUnIndexed, r.hasVertexAlpha = e.hasVertexAlpha, e.delayLoadingFile ? (r.delayLoadState = k.DELAYLOADSTATE_NOTLOADED, r.delayLoadingFile = n + e.delayLoadingFile, r._boundingInfo = new Ie(b.FromArray(e.boundingBoxMinimum), b.FromArray(e.boundingBoxMaximum)), e._binaryInfo && (r._binaryInfo = e._binaryInfo), r._delayInfo = [], e.hasUVs && r._delayInfo.push(Te.UVKind), e.hasUVs2 && r._delayInfo.push(Te.UV2Kind), e.hasUVs3 && r._delayInfo.push(Te.UV3Kind), e.hasUVs4 && r._delayInfo.push(Te.UV4Kind), e.hasUVs5 && r._delayInfo.push(Te.UV5Kind), e.hasUVs6 && r._delayInfo.push(Te.UV6Kind), e.hasColors && r._delayInfo.push(Te.ColorKind), e.hasMatricesIndices && r._delayInfo.push(Te.MatricesIndicesKind), e.hasMatricesWeights && r._delayInfo.push(Te.MatricesWeightsKind), r._delayLoadingFunction = Dt._ImportGeometry, Ot.ForceFullSceneLoadingForIncremental && r._checkDelayState()) : Dt._ImportGeometry(e, r), e.materialId ? r.setMaterialByID(e.materialId) : r.material = null, e.morphTargetManagerId > -1 && (r.morphTargetManager = i.getMorphTargetManagerById(e.morphTargetManagerId)), e.skeletonId > -1 && (r.skeleton = i.getLastSkeletonByID(e.skeletonId), e.numBoneInfluencers && (r.numBoneInfluencers = e.numBoneInfluencers)), e.animations) {
                    for (var o = 0; o < e.animations.length; o++) {
                        var s = e.animations[o];
                        (l = G.GetClass("BABYLON.Animation")) && r.animations.push(l.Parse(s))
                    }
                    He.ParseAnimationRanges(r, e, i)
                }
                if (e.autoAnimate && i.beginAnimation(r, e.autoAnimateFrom, e.autoAnimateTo, e.autoAnimateLoop, e.autoAnimateSpeed || 1), e.layerMask && !isNaN(e.layerMask) ? r.layerMask = Math.abs(parseInt(e.layerMask)) : r.layerMask = 268435455, e.physicsImpostor && t._PhysicsImpostorParser(i, r, e), e.lodMeshIds && (r._waitingData.lods = {
                        ids: e.lodMeshIds,
                        distances: e.lodDistances ? e.lodDistances : null,
                        coverages: e.lodCoverages ? e.lodCoverages : null
                    }), e.instances)
                    for (var a = 0; a < e.instances.length; a++) {
                        var u = e.instances[a],
                            h = r.createInstance(u.name);
                        if (u.id && (h.id = u.id), re && (u.tags ? re.AddTagsTo(h, u.tags) : re.AddTagsTo(h, e.tags)), h.position = b.FromArray(u.position), void 0 !== u.metadata && (h.metadata = u.metadata), u.parentId && (h._waitingParentId = u.parentId), u.rotationQuaternion ? h.rotationQuaternion = M.FromArray(u.rotationQuaternion) : u.rotation && (h.rotation = b.FromArray(u.rotation)), h.scaling = b.FromArray(u.scaling), null != u.checkCollisions && null != u.checkCollisions && (h.checkCollisions = u.checkCollisions), null != u.pickable && null != u.pickable && (h.isPickable = u.pickable), null != u.showBoundingBox && null != u.showBoundingBox && (h.showBoundingBox = u.showBoundingBox), null != u.showSubMeshesBoundingBox && null != u.showSubMeshesBoundingBox && (h.showSubMeshesBoundingBox = u.showSubMeshesBoundingBox), null != u.alphaIndex && null != u.showSubMeshesBoundingBox && (h.alphaIndex = u.alphaIndex), u.physicsImpostor && t._PhysicsImpostorParser(i, h, u), u.animations) {
                            for (o = 0; o < u.animations.length; o++) {
                                var l;
                                s = u.animations[o], (l = G.GetClass("BABYLON.Animation")) && h.animations.push(l.Parse(s))
                            }
                            He.ParseAnimationRanges(h, u, i), u.autoAnimate && i.beginAnimation(h, u.autoAnimateFrom, u.autoAnimateTo, u.autoAnimateLoop, u.autoAnimateSpeed || 1)
                        }
                    }
                return r
            }, t.CreateRibbon = function(e, t, i, n, r, o, s, a, u) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateDisc = function(e, t, i, n, r, o) {
                throw void 0 === n && (n = null), X.WarnImport("MeshBuilder")
            }, t.CreateBox = function(e, t, i, n, r) {
                throw void 0 === i && (i = null), X.WarnImport("MeshBuilder")
            }, t.CreateSphere = function(e, t, i, n, r, o) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateHemisphere = function(e, t, i, n) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateCylinder = function(e, t, i, n, r, o, s, a, u) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateTorus = function(e, t, i, n, r, o, s) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateTorusKnot = function(e, t, i, n, r, o, s, a, u, h) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateLines = function(e, t, i, n, r) {
                throw void 0 === i && (i = null), void 0 === n && (n = !1), void 0 === r && (r = null), X.WarnImport("MeshBuilder")
            }, t.CreateDashedLines = function(e, t, i, n, r, o, s, a) {
                throw void 0 === o && (o = null), X.WarnImport("MeshBuilder")
            }, t.CreatePolygon = function(e, t, i, n, r, o, s) {
                throw void 0 === s && (s = earcut), X.WarnImport("MeshBuilder")
            }, t.ExtrudePolygon = function(e, t, i, n, r, o, s, a) {
                throw void 0 === a && (a = earcut), X.WarnImport("MeshBuilder")
            }, t.ExtrudeShape = function(e, t, i, n, r, o, s, a, u, h) {
                throw void 0 === s && (s = null), X.WarnImport("MeshBuilder")
            }, t.ExtrudeShapeCustom = function(e, t, i, n, r, o, s, a, u, h, l, c) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateLathe = function(e, t, i, n, r, o, s) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreatePlane = function(e, t, i, n, r) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateGround = function(e, t, i, n, r, o) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateTiledGround = function(e, t, i, n, r, o, s, a, u) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateGroundFromHeightMap = function(e, t, i, n, r, o, s, a, u, h, l) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateTube = function(e, t, i, n, r, o, s, a, u, h) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreatePolyhedron = function(e, t, i) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateIcoSphere = function(e, t, i) {
                throw X.WarnImport("MeshBuilder")
            }, t.CreateDecal = function(e, t, i, n, r, o) {
                throw X.WarnImport("MeshBuilder")
            }, t.prototype.setPositionsForCPUSkinning = function() {
                var e = this._internalMeshDataInfo;
                if (!e._sourcePositions) {
                    var t = this.getVerticesData(Te.PositionKind);
                    if (!t) return e._sourcePositions;
                    e._sourcePositions = new Float32Array(t), this.isVertexBufferUpdatable(Te.PositionKind) || this.setVerticesData(Te.PositionKind, t, !0)
                }
                return e._sourcePositions
            }, t.prototype.setNormalsForCPUSkinning = function() {
                var e = this._internalMeshDataInfo;
                if (!e._sourceNormals) {
                    var t = this.getVerticesData(Te.NormalKind);
                    if (!t) return e._sourceNormals;
                    e._sourceNormals = new Float32Array(t), this.isVertexBufferUpdatable(Te.NormalKind) || this.setVerticesData(Te.NormalKind, t, !0)
                }
                return e._sourceNormals
            }, t.prototype.applySkeleton = function(e) {
                if (!this.geometry) return this;
                if (this.geometry._softwareSkinningFrameId == this.getScene().getFrameId()) return this;
                if (this.geometry._softwareSkinningFrameId = this.getScene().getFrameId(), !this.isVerticesDataPresent(Te.PositionKind)) return this;
                if (!this.isVerticesDataPresent(Te.NormalKind)) return this;
                if (!this.isVerticesDataPresent(Te.MatricesIndicesKind)) return this;
                if (!this.isVerticesDataPresent(Te.MatricesWeightsKind)) return this;
                var t = this._internalMeshDataInfo;
                if (!t._sourcePositions) {
                    var i = this.subMeshes.slice();
                    this.setPositionsForCPUSkinning(), this.subMeshes = i
                }
                t._sourceNormals || this.setNormalsForCPUSkinning();
                var n = this.getVerticesData(Te.PositionKind);
                if (!n) return this;
                n instanceof Float32Array || (n = new Float32Array(n));
                var r = this.getVerticesData(Te.NormalKind);
                if (!r) return this;
                r instanceof Float32Array || (r = new Float32Array(r));
                var o = this.getVerticesData(Te.MatricesIndicesKind),
                    s = this.getVerticesData(Te.MatricesWeightsKind);
                if (!s || !o) return this;
                for (var a, u = this.numBoneInfluencers > 4, h = u ? this.getVerticesData(Te.MatricesIndicesExtraKind) : null, l = u ? this.getVerticesData(Te.MatricesWeightsExtraKind) : null, c = e.getTransformMatrices(this), d = b.Zero(), f = new R, p = new R, _ = 0, g = 0; g < n.length; g += 3, _ += 4) {
                    var m;
                    for (a = 0; a < 4; a++)(m = s[_ + a]) > 0 && (R.FromFloat32ArrayToRefScaled(c, Math.floor(16 * o[_ + a]), m, p), f.addToSelf(p));
                    if (u)
                        for (a = 0; a < 4; a++)(m = l[_ + a]) > 0 && (R.FromFloat32ArrayToRefScaled(c, Math.floor(16 * h[_ + a]), m, p), f.addToSelf(p));
                    b.TransformCoordinatesFromFloatsToRef(t._sourcePositions[g], t._sourcePositions[g + 1], t._sourcePositions[g + 2], f, d), d.toArray(n, g), b.TransformNormalFromFloatsToRef(t._sourceNormals[g], t._sourceNormals[g + 1], t._sourceNormals[g + 2], f, d), d.toArray(r, g), f.reset()
                }
                return this.updateVerticesData(Te.PositionKind, n), this.updateVerticesData(Te.NormalKind, r), this
            }, t.MinMax = function(e) {
                var t = null,
                    i = null;
                return e.forEach((function(e) {
                    var n = e.getBoundingInfo().boundingBox;
                    t && i ? (t.minimizeInPlace(n.minimumWorld), i.maximizeInPlace(n.maximumWorld)) : (t = n.minimumWorld, i = n.maximumWorld)
                })), t && i ? {
                    min: t,
                    max: i
                } : {
                    min: b.Zero(),
                    max: b.Zero()
                }
            }, t.Center = function(e) {
                var i = e instanceof Array ? t.MinMax(e) : e;
                return b.Center(i.min, i.max)
            }, t.MergeMeshes = function(e, i, n, r, o, s) {
                var a;
                if (void 0 === i && (i = !0), !n) {
                    var u = 0;
                    for (a = 0; a < e.length; a++)
                        if (e[a] && (u += e[a].getTotalVertices()) > 65536) return V.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"), null
                }
                if (s) {
                    var h, l, c = null;
                    o = !1
                }
                var d, f = new Array,
                    p = new Array,
                    _ = null,
                    g = new Array,
                    m = null;
                for (a = 0; a < e.length; a++)
                    if (e[a]) {
                        var v = e[a];
                        if (v.isAnInstance) return V.Warn("Cannot merge instance meshes."), null;
                        var y = v.computeWorldMatrix(!0);
                        if ((d = Ye.ExtractFromMesh(v, !0, !0)).transform(y), _ ? _.merge(d, n) : (_ = d, m = v), o && g.push(v.getTotalIndices()), s)
                            if (v.material) {
                                var T = v.material;
                                if (T instanceof wt) {
                                    for (l = 0; l < T.subMaterials.length; l++) f.indexOf(T.subMaterials[l]) < 0 && f.push(T.subMaterials[l]);
                                    for (h = 0; h < v.subMeshes.length; h++) p.push(f.indexOf(T.subMaterials[v.subMeshes[h].materialIndex])), g.push(v.subMeshes[h].indexCount)
                                } else
                                    for (f.indexOf(T) < 0 && f.push(T), h = 0; h < v.subMeshes.length; h++) p.push(f.indexOf(T)), g.push(v.subMeshes[h].indexCount)
                            } else
                                for (h = 0; h < v.subMeshes.length; h++) p.push(0), g.push(v.subMeshes[h].indexCount)
                    }
                if (m = m, r || (r = new t(m.name + "_merged", m.getScene())), _.applyToMesh(r), r.checkCollisions = m.checkCollisions, i)
                    for (a = 0; a < e.length; a++) e[a] && e[a].dispose();
                if (o || s) {
                    r.releaseSubMeshes(), a = 0;
                    for (var b = 0; a < g.length;) Se.CreateFromIndices(0, b, g[a], r), b += g[a], a++
                }
                if (s) {
                    for ((c = new wt(m.name + "_merged", m.getScene())).subMaterials = f, h = 0; h < r.subMeshes.length; h++) r.subMeshes[h].materialIndex = p[h];
                    r.material = c
                } else r.material = m.material;
                return r
            }, t.prototype.addInstance = function(e) {
                e._indexInSourceMeshInstanceArray = this.instances.length, this.instances.push(e)
            }, t.prototype.removeInstance = function(e) {
                var t = e._indexInSourceMeshInstanceArray;
                if (-1 != t) {
                    if (t !== this.instances.length - 1) {
                        var i = this.instances[this.instances.length - 1];
                        this.instances[t] = i, i._indexInSourceMeshInstanceArray = t
                    }
                    e._indexInSourceMeshInstanceArray = -1, this.instances.pop()
                }
            }, t.FRONTSIDE = Ye.FRONTSIDE, t.BACKSIDE = Ye.BACKSIDE, t.DOUBLESIDE = Ye.DOUBLESIDE, t.DEFAULTSIDE = Ye.DEFAULTSIDE, t.NO_CAP = 0, t.CAP_START = 1, t.CAP_END = 2, t.CAP_ALL = 3, t._GroundMeshParser = function(e, t) {
                throw X.WarnImport("GroundMesh")
            }, t
        }(Je),
        Gt = function() {
            function e() {
                this._zoomStopsAnimation = !1, this._idleRotationSpeed = .05, this._idleRotationWaitTime = 2e3, this._idleRotationSpinupTime = 2e3, this._isPointerDown = !1, this._lastFrameTime = null, this._lastInteractionTime = -1 / 0, this._cameraRotationSpeed = 0, this._lastFrameRadius = 0
            }
            return Object.defineProperty(e.prototype, "name", {
                get: function() {
                    return "AutoRotation"
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "zoomStopsAnimation", {
                get: function() {
                    return this._zoomStopsAnimation
                },
                set: function(e) {
                    this._zoomStopsAnimation = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "idleRotationSpeed", {
                get: function() {
                    return this._idleRotationSpeed
                },
                set: function(e) {
                    this._idleRotationSpeed = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "idleRotationWaitTime", {
                get: function() {
                    return this._idleRotationWaitTime
                },
                set: function(e) {
                    this._idleRotationWaitTime = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "idleRotationSpinupTime", {
                get: function() {
                    return this._idleRotationSpinupTime
                },
                set: function(e) {
                    this._idleRotationSpinupTime = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "rotationInProgress", {
                get: function() {
                    return Math.abs(this._cameraRotationSpeed) > 0
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.init = function() {}, e.prototype.attach = function(e) {
                var t = this;
                this._attachedCamera = e;
                var i = this._attachedCamera.getScene();
                this._onPrePointerObservableObserver = i.onPrePointerObservable.add((function(e) {
                    e.type !== dt.POINTERDOWN ? e.type === dt.POINTERUP && (t._isPointerDown = !1) : t._isPointerDown = !0
                })), this._onAfterCheckInputsObserver = e.onAfterCheckInputsObservable.add((function() {
                    var e = d.Now,
                        i = 0;
                    null != t._lastFrameTime && (i = e - t._lastFrameTime), t._lastFrameTime = e, t._applyUserInteraction();
                    var n = e - t._lastInteractionTime - t._idleRotationWaitTime,
                        r = Math.max(Math.min(n / t._idleRotationSpinupTime, 1), 0);
                    t._cameraRotationSpeed = t._idleRotationSpeed * r, t._attachedCamera && (t._attachedCamera.alpha -= t._cameraRotationSpeed * (i / 1e3))
                }))
            }, e.prototype.detach = function() {
                if (this._attachedCamera) {
                    var e = this._attachedCamera.getScene();
                    this._onPrePointerObservableObserver && e.onPrePointerObservable.remove(this._onPrePointerObservableObserver), this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver), this._attachedCamera = null
                }
            }, e.prototype._userIsZooming = function() {
                return !!this._attachedCamera && 0 !== this._attachedCamera.inertialRadiusOffset
            }, e.prototype._shouldAnimationStopForInteraction = function() {
                if (!this._attachedCamera) return !1;
                var e = !1;
                return this._lastFrameRadius === this._attachedCamera.radius && 0 !== this._attachedCamera.inertialRadiusOffset && (e = !0), this._lastFrameRadius = this._attachedCamera.radius, this._zoomStopsAnimation ? e : this._userIsZooming()
            }, e.prototype._applyUserInteraction = function() {
                this._userIsMoving() && !this._shouldAnimationStopForInteraction() && (this._lastInteractionTime = d.Now)
            }, e.prototype._userIsMoving = function() {
                return !!this._attachedCamera && (0 !== this._attachedCamera.inertialAlphaOffset || 0 !== this._attachedCamera.inertialBetaOffset || 0 !== this._attachedCamera.inertialRadiusOffset || 0 !== this._attachedCamera.inertialPanningX || 0 !== this._attachedCamera.inertialPanningY || this._isPointerDown)
            }, e
        }(),
        zt = function() {
            function e() {
                this._easingMode = e.EASINGMODE_EASEIN
            }
            return e.prototype.setEasingMode = function(e) {
                var t = Math.min(Math.max(e, 0), 2);
                this._easingMode = t
            }, e.prototype.getEasingMode = function() {
                return this._easingMode
            }, e.prototype.easeInCore = function(e) {
                throw new Error("You must implement this method")
            }, e.prototype.ease = function(t) {
                switch (this._easingMode) {
                    case e.EASINGMODE_EASEIN:
                        return this.easeInCore(t);
                    case e.EASINGMODE_EASEOUT:
                        return 1 - this.easeInCore(1 - t)
                }
                return t >= .5 ? .5 * (1 - this.easeInCore(2 * (1 - t))) + .5 : .5 * this.easeInCore(2 * t)
            }, e.EASINGMODE_EASEIN = 0, e.EASINGMODE_EASEOUT = 1, e.EASINGMODE_EASEINOUT = 2, e
        }(),
        Wt = (function(e) {
            function t() {
                return null !== e && e.apply(this, arguments) || this
            }
            r(t, e), t.prototype.easeInCore = function(e) {
                return e = Math.max(0, Math.min(1, e)), 1 - Math.sqrt(1 - e * e)
            }
        }(zt), function(e) {
            function t(t) {
                void 0 === t && (t = 1);
                var i = e.call(this) || this;
                return i.amplitude = t, i
            }
            return r(t, e), t.prototype.easeInCore = function(e) {
                var t = Math.max(0, this.amplitude);
                return Math.pow(e, 3) - e * t * Math.sin(3.141592653589793 * e)
            }, t
        }(zt)),
        Xt = (function(e) {
            function t(t, i) {
                void 0 === t && (t = 3), void 0 === i && (i = 2);
                var n = e.call(this) || this;
                return n.bounces = t, n.bounciness = i, n
            }
            r(t, e), t.prototype.easeInCore = function(e) {
                var t = Math.max(0, this.bounces),
                    i = this.bounciness;
                i <= 1 && (i = 1.001);
                var n = Math.pow(i, t),
                    r = 1 - i,
                    o = (1 - n) / r + .5 * n,
                    s = e * o,
                    a = Math.log(-s * (1 - i) + 1) / Math.log(i),
                    u = Math.floor(a),
                    h = u + 1,
                    l = (1 - Math.pow(i, u)) / (r * o),
                    c = .5 * (l + (1 - Math.pow(i, h)) / (r * o)),
                    d = e - c,
                    f = c - l;
                return -Math.pow(1 / i, t - u) / (f * f) * (d - f) * (d + f)
            }
        }(zt), function(e) {
            function t() {
                return null !== e && e.apply(this, arguments) || this
            }
            r(t, e), t.prototype.easeInCore = function(e) {
                return e * e * e
            }
        }(zt), function(e) {
            function t(t, i) {
                void 0 === t && (t = 3), void 0 === i && (i = 3);
                var n = e.call(this) || this;
                return n.oscillations = t, n.springiness = i, n
            }
            r(t, e), t.prototype.easeInCore = function(e) {
                var t = Math.max(0, this.oscillations),
                    i = Math.max(0, this.springiness);
                return (0 == i ? e : (Math.exp(i * e) - 1) / (Math.exp(i) - 1)) * Math.sin((6.283185307179586 * t + 1.5707963267948966) * e)
            }
        }(zt), function(e) {
            function t(t) {
                void 0 === t && (t = 2);
                var i = e.call(this) || this;
                return i.exponent = t, i
            }
            return r(t, e), t.prototype.easeInCore = function(e) {
                return this.exponent <= 0 ? e : (Math.exp(this.exponent * e) - 1) / (Math.exp(this.exponent) - 1)
            }, t
        }(zt));
    (function(e) {
        function t(t) {
            void 0 === t && (t = 2);
            var i = e.call(this) || this;
            return i.power = t, i
        }
        r(t, e), t.prototype.easeInCore = function(e) {
            var t = Math.max(0, this.power);
            return Math.pow(e, t)
        }
    })(zt),
    function(e) {
        function t() {
            return null !== e && e.apply(this, arguments) || this
        }
        r(t, e), t.prototype.easeInCore = function(e) {
            return e * e
        }
    }(zt),
    function(e) {
        function t() {
            return null !== e && e.apply(this, arguments) || this
        }
        r(t, e), t.prototype.easeInCore = function(e) {
            return e * e * e * e
        }
    }(zt),
    function(e) {
        function t() {
            return null !== e && e.apply(this, arguments) || this
        }
        r(t, e), t.prototype.easeInCore = function(e) {
            return e * e * e * e * e
        }
    }(zt),
    function(e) {
        function t() {
            return null !== e && e.apply(this, arguments) || this
        }
        r(t, e), t.prototype.easeInCore = function(e) {
            return 1 - Math.sin(1.5707963267948966 * (1 - e))
        }
    }(zt),
    function(e) {
        function t(t, i, n, r) {
            void 0 === t && (t = 0), void 0 === i && (i = 0), void 0 === n && (n = 1), void 0 === r && (r = 1);
            var o = e.call(this) || this;
            return o.x1 = t, o.y1 = i, o.x2 = n, o.y2 = r, o
        }
        r(t, e), t.prototype.easeInCore = function(e) {
            return O.Interpolate(e, this.x1, this.y1, this.x2, this.y2)
        }
    }(zt);
    ! function(e) {
        e[e.STEP = 1] = "STEP"
    }(Lt || (Lt = {}));
    var Ht = function() {
            function e(e, t, i) {
                this.name = e, this.from = t, this.to = i
            }
            return e.prototype.clone = function() {
                return new e(this.name, this.from, this.to)
            }, e
        }(),
        jt = function() {
            function e(t, i, n, r, o, s) {
                this.name = t, this.targetProperty = i, this.framePerSecond = n, this.dataType = r, this.loopMode = o, this.enableBlending = s, this._runtimeAnimations = new Array, this._events = new Array, this.blendingSpeed = .01, this._ranges = {}, this.targetPropertyPath = i.split("."), this.dataType = r, this.loopMode = void 0 === o ? e.ANIMATIONLOOPMODE_CYCLE : o
            }
            return e._PrepareAnimation = function(t, i, n, r, o, s, a, u) {
                var h = void 0;
                if (!isNaN(parseFloat(o)) && isFinite(o) ? h = e.ANIMATIONTYPE_FLOAT : o instanceof M ? h = e.ANIMATIONTYPE_QUATERNION : o instanceof b ? h = e.ANIMATIONTYPE_VECTOR3 : o instanceof T ? h = e.ANIMATIONTYPE_VECTOR2 : o instanceof v ? h = e.ANIMATIONTYPE_COLOR3 : o instanceof A && (h = e.ANIMATIONTYPE_SIZE), null == h) return null;
                var l = new e(t, i, n, h, a),
                    c = [{
                        frame: 0,
                        value: o
                    }, {
                        frame: r,
                        value: s
                    }];
                return l.setKeys(c), void 0 !== u && l.setEasingFunction(u), l
            }, e.CreateAnimation = function(t, i, n, r) {
                var o = new e(t + "Animation", t, n, i, e.ANIMATIONLOOPMODE_CONSTANT);
                return o.setEasingFunction(r), o
            }, e.CreateAndStartAnimation = function(t, i, n, r, o, s, a, u, h, l) {
                var c = e._PrepareAnimation(t, n, r, o, s, a, u, h);
                return c ? i.getScene().beginDirectAnimation(i, [c], 0, o, 1 === c.loopMode, 1, l) : null
            }, e.CreateAndStartHierarchyAnimation = function(t, i, n, r, o, s, a, u, h, l, c) {
                var d = e._PrepareAnimation(t, r, o, s, a, u, h, l);
                return d ? i.getScene().beginDirectHierarchyAnimation(i, n, [d], 0, s, 1 === d.loopMode, 1, c) : null
            }, e.CreateMergeAndStartAnimation = function(t, i, n, r, o, s, a, u, h, l) {
                var c = e._PrepareAnimation(t, n, r, o, s, a, u, h);
                return c ? (i.animations.push(c), i.getScene().beginAnimation(i, 0, o, 1 === c.loopMode, 1, l)) : null
            }, e.TransitionTo = function(e, t, i, n, r, o, s, a) {
                if (void 0 === a && (a = null), s <= 0) return i[e] = t, a && a(), null;
                var u = r * (s / 1e3);
                o.setKeys([{
                    frame: 0,
                    value: i[e].clone ? i[e].clone() : i[e]
                }, {
                    frame: u,
                    value: t
                }]), i.animations || (i.animations = []), i.animations.push(o);
                var h = n.beginAnimation(i, 0, u, !1);
                return h.onAnimationEnd = a, h
            }, Object.defineProperty(e.prototype, "runtimeAnimations", {
                get: function() {
                    return this._runtimeAnimations
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "hasRunningRuntimeAnimations", {
                get: function() {
                    for (var e = 0, t = this._runtimeAnimations; e < t.length; e++) {
                        if (!t[e].isStopped) return !0
                    }
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.toString = function(e) {
                var t = "Name: " + this.name + ", property: " + this.targetProperty;
                if (t += ", datatype: " + ["Float", "Vector3", "Quaternion", "Matrix", "Color3", "Vector2"][this.dataType], t += ", nKeys: " + (this._keys ? this._keys.length : "none"), t += ", nRanges: " + (this._ranges ? Object.keys(this._ranges).length : "none"), e) {
                    t += ", Ranges: {";
                    var i = !0;
                    for (var n in this._ranges) i && (t += ", ", i = !1), t += n;
                    t += "}"
                }
                return t
            }, e.prototype.addEvent = function(e) {
                this._events.push(e)
            }, e.prototype.removeEvents = function(e) {
                for (var t = 0; t < this._events.length; t++) this._events[t].frame === e && (this._events.splice(t, 1), t--)
            }, e.prototype.getEvents = function() {
                return this._events
            }, e.prototype.createRange = function(e, t, i) {
                this._ranges[e] || (this._ranges[e] = new Ht(e, t, i))
            }, e.prototype.deleteRange = function(e, t) {
                void 0 === t && (t = !0);
                var i = this._ranges[e];
                if (i) {
                    if (t)
                        for (var n = i.from, r = i.to, o = this._keys.length - 1; o >= 0; o--) this._keys[o].frame >= n && this._keys[o].frame <= r && this._keys.splice(o, 1);
                    this._ranges[e] = null
                }
            }, e.prototype.getRange = function(e) {
                return this._ranges[e]
            }, e.prototype.getKeys = function() {
                return this._keys
            }, e.prototype.getHighestFrame = function() {
                for (var e = 0, t = 0, i = this._keys.length; t < i; t++) e < this._keys[t].frame && (e = this._keys[t].frame);
                return e
            }, e.prototype.getEasingFunction = function() {
                return this._easingFunction
            }, e.prototype.setEasingFunction = function(e) {
                this._easingFunction = e
            }, e.prototype.floatInterpolateFunction = function(e, t, i) {
                return m.Lerp(e, t, i)
            }, e.prototype.floatInterpolateFunctionWithTangents = function(e, t, i, n, r) {
                return m.Hermite(e, t, i, n, r)
            }, e.prototype.quaternionInterpolateFunction = function(e, t, i) {
                return M.Slerp(e, t, i)
            }, e.prototype.quaternionInterpolateFunctionWithTangents = function(e, t, i, n, r) {
                return M.Hermite(e, t, i, n, r).normalize()
            }, e.prototype.vector3InterpolateFunction = function(e, t, i) {
                return b.Lerp(e, t, i)
            }, e.prototype.vector3InterpolateFunctionWithTangents = function(e, t, i, n, r) {
                return b.Hermite(e, t, i, n, r)
            }, e.prototype.vector2InterpolateFunction = function(e, t, i) {
                return T.Lerp(e, t, i)
            }, e.prototype.vector2InterpolateFunctionWithTangents = function(e, t, i, n, r) {
                return T.Hermite(e, t, i, n, r)
            }, e.prototype.sizeInterpolateFunction = function(e, t, i) {
                return A.Lerp(e, t, i)
            }, e.prototype.color3InterpolateFunction = function(e, t, i) {
                return v.Lerp(e, t, i)
            }, e.prototype._getKeyValue = function(e) {
                return "function" == typeof e ? e() : e
            }, e.prototype._interpolate = function(t, i) {
                if (i.loopMode === e.ANIMATIONLOOPMODE_CONSTANT && i.repeatCount > 0) return i.highLimitValue.clone ? i.highLimitValue.clone() : i.highLimitValue;
                var n = this._keys;
                if (1 === n.length) return this._getKeyValue(n[0].value);
                var r = i.key;
                if (n[r].frame >= t)
                    for (; r - 1 >= 0 && n[r].frame >= t;) r--;
                for (var o = r; o < n.length; o++) {
                    var s = n[o + 1];
                    if (s.frame >= t) {
                        i.key = o;
                        var a = n[o],
                            u = this._getKeyValue(a.value);
                        if (a.interpolation === Lt.STEP) return u;
                        var h = this._getKeyValue(s.value),
                            l = void 0 !== a.outTangent && void 0 !== s.inTangent,
                            c = s.frame - a.frame,
                            d = (t - a.frame) / c,
                            f = this.getEasingFunction();
                        switch (null != f && (d = f.ease(d)), this.dataType) {
                            case e.ANIMATIONTYPE_FLOAT:
                                var p = l ? this.floatInterpolateFunctionWithTangents(u, a.outTangent * c, h, s.inTangent * c, d) : this.floatInterpolateFunction(u, h, d);
                                switch (i.loopMode) {
                                    case e.ANIMATIONLOOPMODE_CYCLE:
                                    case e.ANIMATIONLOOPMODE_CONSTANT:
                                        return p;
                                    case e.ANIMATIONLOOPMODE_RELATIVE:
                                        return i.offsetValue * i.repeatCount + p
                                }
                                break;
                            case e.ANIMATIONTYPE_QUATERNION:
                                var _ = l ? this.quaternionInterpolateFunctionWithTangents(u, a.outTangent.scale(c), h, s.inTangent.scale(c), d) : this.quaternionInterpolateFunction(u, h, d);
                                switch (i.loopMode) {
                                    case e.ANIMATIONLOOPMODE_CYCLE:
                                    case e.ANIMATIONLOOPMODE_CONSTANT:
                                        return _;
                                    case e.ANIMATIONLOOPMODE_RELATIVE:
                                        return _.addInPlace(i.offsetValue.scale(i.repeatCount))
                                }
                                return _;
                            case e.ANIMATIONTYPE_VECTOR3:
                                var g = l ? this.vector3InterpolateFunctionWithTangents(u, a.outTangent.scale(c), h, s.inTangent.scale(c), d) : this.vector3InterpolateFunction(u, h, d);
                                switch (i.loopMode) {
                                    case e.ANIMATIONLOOPMODE_CYCLE:
                                    case e.ANIMATIONLOOPMODE_CONSTANT:
                                        return g;
                                    case e.ANIMATIONLOOPMODE_RELATIVE:
                                        return g.add(i.offsetValue.scale(i.repeatCount))
                                }
                            case e.ANIMATIONTYPE_VECTOR2:
                                var m = l ? this.vector2InterpolateFunctionWithTangents(u, a.outTangent.scale(c), h, s.inTangent.scale(c), d) : this.vector2InterpolateFunction(u, h, d);
                                switch (i.loopMode) {
                                    case e.ANIMATIONLOOPMODE_CYCLE:
                                    case e.ANIMATIONLOOPMODE_CONSTANT:
                                        return m;
                                    case e.ANIMATIONLOOPMODE_RELATIVE:
                                        return m.add(i.offsetValue.scale(i.repeatCount))
                                }
                            case e.ANIMATIONTYPE_SIZE:
                                switch (i.loopMode) {
                                    case e.ANIMATIONLOOPMODE_CYCLE:
                                    case e.ANIMATIONLOOPMODE_CONSTANT:
                                        return this.sizeInterpolateFunction(u, h, d);
                                    case e.ANIMATIONLOOPMODE_RELATIVE:
                                        return this.sizeInterpolateFunction(u, h, d).add(i.offsetValue.scale(i.repeatCount))
                                }
                            case e.ANIMATIONTYPE_COLOR3:
                                switch (i.loopMode) {
                                    case e.ANIMATIONLOOPMODE_CYCLE:
                                    case e.ANIMATIONLOOPMODE_CONSTANT:
                                        return this.color3InterpolateFunction(u, h, d);
                                    case e.ANIMATIONLOOPMODE_RELATIVE:
                                        return this.color3InterpolateFunction(u, h, d).add(i.offsetValue.scale(i.repeatCount))
                                }
                            case e.ANIMATIONTYPE_MATRIX:
                                switch (i.loopMode) {
                                    case e.ANIMATIONLOOPMODE_CYCLE:
                                    case e.ANIMATIONLOOPMODE_CONSTANT:
                                        if (e.AllowMatricesInterpolation) return this.matrixInterpolateFunction(u, h, d, i.workValue);
                                    case e.ANIMATIONLOOPMODE_RELATIVE:
                                        return u
                                }
                        }
                        break
                    }
                }
                return this._getKeyValue(n[n.length - 1].value)
            }, e.prototype.matrixInterpolateFunction = function(t, i, n, r) {
                return e.AllowMatrixDecomposeForInterpolation ? r ? (R.DecomposeLerpToRef(t, i, n, r), r) : R.DecomposeLerp(t, i, n) : r ? (R.LerpToRef(t, i, n, r), r) : R.Lerp(t, i, n)
            }, e.prototype.clone = function() {
                var t = new e(this.name, this.targetPropertyPath.join("."), this.framePerSecond, this.dataType, this.loopMode);
                if (t.enableBlending = this.enableBlending, t.blendingSpeed = this.blendingSpeed, this._keys && t.setKeys(this._keys), this._ranges)
                    for (var i in t._ranges = {}, this._ranges) {
                        var n = this._ranges[i];
                        n && (t._ranges[i] = n.clone())
                    }
                return t
            }, e.prototype.setKeys = function(e) {
                this._keys = e.slice(0)
            }, e.prototype.serialize = function() {
                var t = {};
                t.name = this.name, t.property = this.targetProperty, t.framePerSecond = this.framePerSecond, t.dataType = this.dataType, t.loopBehavior = this.loopMode, t.enableBlending = this.enableBlending, t.blendingSpeed = this.blendingSpeed;
                var i = this.dataType;
                t.keys = [];
                for (var n = this.getKeys(), r = 0; r < n.length; r++) {
                    var o = n[r],
                        s = {};
                    switch (s.frame = o.frame, i) {
                        case e.ANIMATIONTYPE_FLOAT:
                            s.values = [o.value];
                            break;
                        case e.ANIMATIONTYPE_QUATERNION:
                        case e.ANIMATIONTYPE_MATRIX:
                        case e.ANIMATIONTYPE_VECTOR3:
                        case e.ANIMATIONTYPE_COLOR3:
                            s.values = o.value.asArray()
                    }
                    t.keys.push(s)
                }
                for (var a in t.ranges = [], this._ranges) {
                    var u = this._ranges[a];
                    if (u) {
                        var h = {};
                        h.name = a, h.from = u.from, h.to = u.to, t.ranges.push(h)
                    }
                }
                return t
            }, Object.defineProperty(e, "ANIMATIONTYPE_FLOAT", {
                get: function() {
                    return e._ANIMATIONTYPE_FLOAT
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONTYPE_VECTOR3", {
                get: function() {
                    return e._ANIMATIONTYPE_VECTOR3
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONTYPE_VECTOR2", {
                get: function() {
                    return e._ANIMATIONTYPE_VECTOR2
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONTYPE_SIZE", {
                get: function() {
                    return e._ANIMATIONTYPE_SIZE
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONTYPE_QUATERNION", {
                get: function() {
                    return e._ANIMATIONTYPE_QUATERNION
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONTYPE_MATRIX", {
                get: function() {
                    return e._ANIMATIONTYPE_MATRIX
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONTYPE_COLOR3", {
                get: function() {
                    return e._ANIMATIONTYPE_COLOR3
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONLOOPMODE_RELATIVE", {
                get: function() {
                    return e._ANIMATIONLOOPMODE_RELATIVE
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONLOOPMODE_CYCLE", {
                get: function() {
                    return e._ANIMATIONLOOPMODE_CYCLE
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ANIMATIONLOOPMODE_CONSTANT", {
                get: function() {
                    return e._ANIMATIONLOOPMODE_CONSTANT
                },
                enumerable: !0,
                configurable: !0
            }), e._UniversalLerp = function(e, t, i) {
                var n = e.constructor;
                return n.Lerp ? n.Lerp(e, t, i) : n.Slerp ? n.Slerp(e, t, i) : e.toFixed ? e * (1 - i) + i * t : t
            }, e.Parse = function(t) {
                var i, n, r = new e(t.name, t.property, t.framePerSecond, t.dataType, t.loopBehavior),
                    o = t.dataType,
                    s = [];
                for (t.enableBlending && (r.enableBlending = t.enableBlending), t.blendingSpeed && (r.blendingSpeed = t.blendingSpeed), n = 0; n < t.keys.length; n++) {
                    var a, u, h = t.keys[n];
                    switch (o) {
                        case e.ANIMATIONTYPE_FLOAT:
                            i = h.values[0], h.values.length >= 1 && (a = h.values[1]), h.values.length >= 2 && (u = h.values[2]);
                            break;
                        case e.ANIMATIONTYPE_QUATERNION:
                            if (i = M.FromArray(h.values), h.values.length >= 8) {
                                var l = M.FromArray(h.values.slice(4, 8));
                                l.equals(M.Zero()) || (a = l)
                            }
                            if (h.values.length >= 12) {
                                var c = M.FromArray(h.values.slice(8, 12));
                                c.equals(M.Zero()) || (u = c)
                            }
                            break;
                        case e.ANIMATIONTYPE_MATRIX:
                            i = R.FromArray(h.values);
                            break;
                        case e.ANIMATIONTYPE_COLOR3:
                            i = v.FromArray(h.values);
                            break;
                        case e.ANIMATIONTYPE_VECTOR3:
                        default:
                            i = b.FromArray(h.values)
                    }
                    var d = {};
                    d.frame = h.frame, d.value = i, null != a && (d.inTangent = a), null != u && (d.outTangent = u), s.push(d)
                }
                if (r.setKeys(s), t.ranges)
                    for (n = 0; n < t.ranges.length; n++) i = t.ranges[n], r.createRange(i.name, i.from, i.to);
                return r
            }, e.AppendSerializedAnimations = function(e, t) {
                me.AppendSerializedAnimations(e, t)
            }, e.AllowMatricesInterpolation = !1, e.AllowMatrixDecomposeForInterpolation = !0, e._ANIMATIONTYPE_FLOAT = 0, e._ANIMATIONTYPE_VECTOR3 = 1, e._ANIMATIONTYPE_QUATERNION = 2, e._ANIMATIONTYPE_MATRIX = 3, e._ANIMATIONTYPE_COLOR3 = 4, e._ANIMATIONTYPE_VECTOR2 = 5, e._ANIMATIONTYPE_SIZE = 6, e._ANIMATIONLOOPMODE_RELATIVE = 0, e._ANIMATIONLOOPMODE_CYCLE = 1, e._ANIMATIONLOOPMODE_CONSTANT = 2, e
        }();
    G.RegisteredTypes["BABYLON.Animation"] = jt, He._AnimationRangeFactory = function(e, t, i) {
        return new Ht(e, t, i)
    };
    var Yt = function() {
            function e() {
                this.transitionDuration = 450, this.lowerRadiusTransitionRange = 2, this.upperRadiusTransitionRange = -2, this._autoTransitionRange = !1, this._radiusIsAnimating = !1, this._radiusBounceTransition = null, this._animatables = new Array
            }
            return Object.defineProperty(e.prototype, "name", {
                get: function() {
                    return "Bouncing"
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "autoTransitionRange", {
                get: function() {
                    return this._autoTransitionRange
                },
                set: function(e) {
                    var t = this;
                    if (this._autoTransitionRange !== e) {
                        this._autoTransitionRange = e;
                        var i = this._attachedCamera;
                        i && (e ? this._onMeshTargetChangedObserver = i.onMeshTargetChangedObservable.add((function(e) {
                            if (e) {
                                e.computeWorldMatrix(!0);
                                var i = e.getBoundingInfo().diagonalLength;
                                t.lowerRadiusTransitionRange = .05 * i, t.upperRadiusTransitionRange = .05 * i
                            }
                        })) : this._onMeshTargetChangedObserver && i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))
                    }
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.init = function() {}, e.prototype.attach = function(e) {
                var t = this;
                this._attachedCamera = e, this._onAfterCheckInputsObserver = e.onAfterCheckInputsObservable.add((function() {
                    t._attachedCamera && (t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit) && t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange), t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit) && t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))
                }))
            }, e.prototype.detach = function() {
                this._attachedCamera && (this._onAfterCheckInputsObserver && this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver), this._onMeshTargetChangedObserver && this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver), this._attachedCamera = null)
            }, e.prototype._isRadiusAtLimit = function(e) {
                return !!this._attachedCamera && (this._attachedCamera.radius === e && !this._radiusIsAnimating)
            }, e.prototype._applyBoundRadiusAnimation = function(t) {
                var i = this;
                if (this._attachedCamera) {
                    this._radiusBounceTransition || (e.EasingFunction.setEasingMode(e.EasingMode), this._radiusBounceTransition = jt.CreateAnimation("radius", jt.ANIMATIONTYPE_FLOAT, 60, e.EasingFunction)), this._cachedWheelPrecision = this._attachedCamera.wheelPrecision, this._attachedCamera.wheelPrecision = 1 / 0, this._attachedCamera.inertialRadiusOffset = 0, this.stopAllAnimations(), this._radiusIsAnimating = !0;
                    var n = jt.TransitionTo("radius", this._attachedCamera.radius + t, this._attachedCamera, this._attachedCamera.getScene(), 60, this._radiusBounceTransition, this.transitionDuration, (function() {
                        return i._clearAnimationLocks()
                    }));
                    n && this._animatables.push(n)
                }
            }, e.prototype._clearAnimationLocks = function() {
                this._radiusIsAnimating = !1, this._attachedCamera && (this._attachedCamera.wheelPrecision = this._cachedWheelPrecision)
            }, e.prototype.stopAllAnimations = function() {
                for (this._attachedCamera && (this._attachedCamera.animations = []); this._animatables.length;) this._animatables[0].onAnimationEnd = null, this._animatables[0].stop(), this._animatables.shift()
            }, e.EasingFunction = new Wt(.3), e.EasingMode = zt.EASINGMODE_EASEOUT, e
        }(),
        Kt = function() {
            function e() {
                this._mode = e.FitFrustumSidesMode, this._radiusScale = 1, this._positionScale = .5, this._defaultElevation = .3, this._elevationReturnTime = 1500, this._elevationReturnWaitTime = 1e3, this._zoomStopsAnimation = !1, this._framingTime = 1500, this.autoCorrectCameraLimitsAndSensibility = !0, this._isPointerDown = !1, this._lastInteractionTime = -1 / 0, this._animatables = new Array, this._betaIsAnimating = !1
            }
            return Object.defineProperty(e.prototype, "name", {
                get: function() {
                    return "Framing"
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "mode", {
                get: function() {
                    return this._mode
                },
                set: function(e) {
                    this._mode = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "radiusScale", {
                get: function() {
                    return this._radiusScale
                },
                set: function(e) {
                    this._radiusScale = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "positionScale", {
                get: function() {
                    return this._positionScale
                },
                set: function(e) {
                    this._positionScale = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "defaultElevation", {
                get: function() {
                    return this._defaultElevation
                },
                set: function(e) {
                    this._defaultElevation = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "elevationReturnTime", {
                get: function() {
                    return this._elevationReturnTime
                },
                set: function(e) {
                    this._elevationReturnTime = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "elevationReturnWaitTime", {
                get: function() {
                    return this._elevationReturnWaitTime
                },
                set: function(e) {
                    this._elevationReturnWaitTime = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "zoomStopsAnimation", {
                get: function() {
                    return this._zoomStopsAnimation
                },
                set: function(e) {
                    this._zoomStopsAnimation = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "framingTime", {
                get: function() {
                    return this._framingTime
                },
                set: function(e) {
                    this._framingTime = e
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.init = function() {}, e.prototype.attach = function(t) {
                var i = this;
                this._attachedCamera = t;
                var n = this._attachedCamera.getScene();
                e.EasingFunction.setEasingMode(e.EasingMode), this._onPrePointerObservableObserver = n.onPrePointerObservable.add((function(e) {
                    e.type !== dt.POINTERDOWN ? e.type === dt.POINTERUP && (i._isPointerDown = !1) : i._isPointerDown = !0
                })), this._onMeshTargetChangedObserver = t.onMeshTargetChangedObservable.add((function(e) {
                    e && i.zoomOnMesh(e)
                })), this._onAfterCheckInputsObserver = t.onAfterCheckInputsObservable.add((function() {
                    i._applyUserInteraction(), i._maintainCameraAboveGround()
                }))
            }, e.prototype.detach = function() {
                if (this._attachedCamera) {
                    var e = this._attachedCamera.getScene();
                    this._onPrePointerObservableObserver && e.onPrePointerObservable.remove(this._onPrePointerObservableObserver), this._onAfterCheckInputsObserver && this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver), this._onMeshTargetChangedObserver && this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver), this._attachedCamera = null
                }
            }, e.prototype.zoomOnMesh = function(e, t, i) {
                void 0 === t && (t = !1), void 0 === i && (i = null), e.computeWorldMatrix(!0);
                var n = e.getBoundingInfo().boundingBox;
                this.zoomOnBoundingInfo(n.minimumWorld, n.maximumWorld, t, i)
            }, e.prototype.zoomOnMeshHierarchy = function(e, t, i) {
                void 0 === t && (t = !1), void 0 === i && (i = null), e.computeWorldMatrix(!0);
                var n = e.getHierarchyBoundingVectors(!0);
                this.zoomOnBoundingInfo(n.min, n.max, t, i)
            }, e.prototype.zoomOnMeshesHierarchy = function(e, t, i) {
                void 0 === t && (t = !1), void 0 === i && (i = null);
                for (var n = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), r = new b(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE), o = 0; o < e.length; o++) {
                    var s = e[o].getHierarchyBoundingVectors(!0);
                    K.CheckExtends(s.min, n, r), K.CheckExtends(s.max, n, r)
                }
                this.zoomOnBoundingInfo(n, r, t, i)
            }, e.prototype.zoomOnBoundingInfo = function(t, i, n, r) {
                var o, s = this;
                if (void 0 === n && (n = !1), void 0 === r && (r = null), this._attachedCamera) {
                    var a = t.y,
                        u = a + (i.y - a) * this._positionScale,
                        h = i.subtract(t).scale(.5);
                    if (n) o = new b(0, u, 0);
                    else {
                        var l = t.add(h);
                        o = new b(l.x, u, l.z)
                    }
                    this._vectorTransition || (this._vectorTransition = jt.CreateAnimation("target", jt.ANIMATIONTYPE_VECTOR3, 60, e.EasingFunction)), this._betaIsAnimating = !0;
                    var c = jt.TransitionTo("target", o, this._attachedCamera, this._attachedCamera.getScene(), 60, this._vectorTransition, this._framingTime);
                    c && this._animatables.push(c);
                    var d = 0;
                    if (this._mode === e.FitFrustumSidesMode) {
                        var f = this._calculateLowerRadiusFromModelBoundingSphere(t, i);
                        this.autoCorrectCameraLimitsAndSensibility && (this._attachedCamera.lowerRadiusLimit = h.length() + this._attachedCamera.minZ), d = f
                    } else this._mode === e.IgnoreBoundsSizeMode && (d = this._calculateLowerRadiusFromModelBoundingSphere(t, i), this.autoCorrectCameraLimitsAndSensibility && null === this._attachedCamera.lowerRadiusLimit && (this._attachedCamera.lowerRadiusLimit = this._attachedCamera.minZ));
                    if (this.autoCorrectCameraLimitsAndSensibility) {
                        var p = i.subtract(t).length();
                        this._attachedCamera.panningSensibility = 5e3 / p, this._attachedCamera.wheelPrecision = 100 / d
                    }
                    this._radiusTransition || (this._radiusTransition = jt.CreateAnimation("radius", jt.ANIMATIONTYPE_FLOAT, 60, e.EasingFunction)), (c = jt.TransitionTo("radius", d, this._attachedCamera, this._attachedCamera.getScene(), 60, this._radiusTransition, this._framingTime, (function() {
                        s.stopAllAnimations(), r && r(), s._attachedCamera && s._attachedCamera.useInputToRestoreState && s._attachedCamera.storeState()
                    }))) && this._animatables.push(c)
                }
            }, e.prototype._calculateLowerRadiusFromModelBoundingSphere = function(t, i) {
                var n = i.subtract(t).length(),
                    r = this._getFrustumSlope(),
                    o = .5 * n * this._radiusScale,
                    s = o * Math.sqrt(1 + 1 / (r.x * r.x)),
                    a = o * Math.sqrt(1 + 1 / (r.y * r.y)),
                    u = Math.max(s, a),
                    h = this._attachedCamera;
                return h ? (h.lowerRadiusLimit && this._mode === e.IgnoreBoundsSizeMode && (u = u < h.lowerRadiusLimit ? h.lowerRadiusLimit : u), h.upperRadiusLimit && (u = u > h.upperRadiusLimit ? h.upperRadiusLimit : u), u) : 0
            }, e.prototype._maintainCameraAboveGround = function() {
                var t = this;
                if (!(this._elevationReturnTime < 0)) {
                    var i = d.Now - this._lastInteractionTime,
                        n = .5 * Math.PI - this._defaultElevation,
                        r = .5 * Math.PI;
                    if (this._attachedCamera && !this._betaIsAnimating && this._attachedCamera.beta > r && i >= this._elevationReturnWaitTime) {
                        this._betaIsAnimating = !0, this.stopAllAnimations(), this._betaTransition || (this._betaTransition = jt.CreateAnimation("beta", jt.ANIMATIONTYPE_FLOAT, 60, e.EasingFunction));
                        var o = jt.TransitionTo("beta", n, this._attachedCamera, this._attachedCamera.getScene(), 60, this._betaTransition, this._elevationReturnTime, (function() {
                            t._clearAnimationLocks(), t.stopAllAnimations()
                        }));
                        o && this._animatables.push(o)
                    }
                }
            }, e.prototype._getFrustumSlope = function() {
                var e = this._attachedCamera;
                if (!e) return T.Zero();
                var t = e.getScene().getEngine().getAspectRatio(e),
                    i = Math.tan(e.fov / 2);
                return new T(i * t, i)
            }, e.prototype._clearAnimationLocks = function() {
                this._betaIsAnimating = !1
            }, e.prototype._applyUserInteraction = function() {
                this.isUserIsMoving && (this._lastInteractionTime = d.Now, this.stopAllAnimations(), this._clearAnimationLocks())
            }, e.prototype.stopAllAnimations = function() {
                for (this._attachedCamera && (this._attachedCamera.animations = []); this._animatables.length;) this._animatables[0] && (this._animatables[0].onAnimationEnd = null, this._animatables[0].stop()), this._animatables.shift()
            }, Object.defineProperty(e.prototype, "isUserIsMoving", {
                get: function() {
                    return !!this._attachedCamera && (0 !== this._attachedCamera.inertialAlphaOffset || 0 !== this._attachedCamera.inertialBetaOffset || 0 !== this._attachedCamera.inertialRadiusOffset || 0 !== this._attachedCamera.inertialPanningX || 0 !== this._attachedCamera.inertialPanningY || this._isPointerDown)
                },
                enumerable: !0,
                configurable: !0
            }), e.EasingFunction = new Xt, e.EasingMode = zt.EASINGMODE_EASEINOUT, e.IgnoreBoundsSizeMode = 0, e.FitFrustumSidesMode = 1, e
        }(),
        qt = function(e) {
            function t() {
                var t = null !== e && e.apply(this, arguments) || this;
                return t.buttons = [0, 1, 2], t.angularSensibilityX = 1e3, t.angularSensibilityY = 1e3, t.pinchPrecision = 12, t.pinchDeltaPercentage = 0, t.panningSensibility = 1e3, t.multiTouchPanning = !0, t.multiTouchPanAndZoom = !0, t.pinchInwards = !0, t._isPanClick = !1, t._twoFingerActivityCount = 0, t._isPinching = !1, t
            }
            return r(t, e), t.prototype.getClassName = function() {
                return "ArcRotateCameraPointersInput"
            }, t.prototype.onTouch = function(e, t, i) {
                0 !== this.panningSensibility && (this._ctrlKey && this.camera._useCtrlForPanning || this._isPanClick) ? (this.camera.inertialPanningX += -t / this.panningSensibility, this.camera.inertialPanningY += i / this.panningSensibility) : (this.camera.inertialAlphaOffset -= t / this.angularSensibilityX, this.camera.inertialBetaOffset -= i / this.angularSensibilityY)
            }, t.prototype.onDoubleTap = function(e) {
                this.camera.useInputToRestoreState && this.camera.restoreState()
            }, t.prototype.onMultiTouch = function(e, t, i, n, r, o) {
                if (!(0 === i && null === r || 0 === n && null === o)) {
                    var s = this.pinchInwards ? 1 : -1;
                    if (this.multiTouchPanAndZoom) {
                        if (this.pinchDeltaPercentage ? this.camera.inertialRadiusOffset += .001 * (n - i) * this.camera.radius * this.pinchDeltaPercentage : this.camera.inertialRadiusOffset += (n - i) / (this.pinchPrecision * s * (this.angularSensibilityX + this.angularSensibilityY) / 2), 0 !== this.panningSensibility && r && o) {
                            var a = o.x - r.x,
                                u = o.y - r.y;
                            this.camera.inertialPanningX += -a / this.panningSensibility, this.camera.inertialPanningY += u / this.panningSensibility
                        }
                    } else {
                        this._twoFingerActivityCount++;
                        var h = Math.sqrt(i),
                            l = Math.sqrt(n);
                        if (this._isPinching || this._twoFingerActivityCount < 20 && Math.abs(l - h) > this.camera.pinchToPanMaxDistance) this.pinchDeltaPercentage ? this.camera.inertialRadiusOffset += .001 * (n - i) * this.camera.radius * this.pinchDeltaPercentage : this.camera.inertialRadiusOffset += (n - i) / (this.pinchPrecision * s * (this.angularSensibilityX + this.angularSensibilityY) / 2), this._isPinching = !0;
                        else if (0 !== this.panningSensibility && this.multiTouchPanning && o && r) {
                            a = o.x - r.x, u = o.y - r.y;
                            this.camera.inertialPanningX += -a / this.panningSensibility, this.camera.inertialPanningY += u / this.panningSensibility
                        }
                    }
                }
            }, t.prototype.onButtonDown = function(e) {
                this._isPanClick = e.button === this.camera._panningMouseButton
            }, t.prototype.onButtonUp = function(e) {
                this._twoFingerActivityCount = 0, this._isPinching = !1
            }, t.prototype.onLostFocus = function() {
                this._isPanClick = !1, this._twoFingerActivityCount = 0, this._isPinching = !1
            }, s([ce()], t.prototype, "buttons", void 0), s([ce()], t.prototype, "angularSensibilityX", void 0), s([ce()], t.prototype, "angularSensibilityY", void 0), s([ce()], t.prototype, "pinchPrecision", void 0), s([ce()], t.prototype, "pinchDeltaPercentage", void 0), s([ce()], t.prototype, "panningSensibility", void 0), s([ce()], t.prototype, "multiTouchPanning", void 0), s([ce()], t.prototype, "multiTouchPanAndZoom", void 0), t
        }(function() {
            function e() {
                this.buttons = [0, 1, 2]
            }
            return e.prototype.attachControl = function(e, t) {
                var i = this,
                    n = this.camera.getEngine(),
                    r = 0,
                    o = null;
                this.pointA = null, this.pointB = null, this._altKey = !1, this._ctrlKey = !1, this._metaKey = !1, this._shiftKey = !1, this._buttonsPressed = 0, this._pointerInput = function(s, a) {
                    var u = s.event,
                        h = "touch" === u.pointerType;
                    if (!n.isInVRExclusivePointerMode && (s.type === dt.POINTERMOVE || -1 !== i.buttons.indexOf(u.button))) {
                        var l = u.srcElement || u.target;
                        if (i._altKey = u.altKey, i._ctrlKey = u.ctrlKey, i._metaKey = u.metaKey, i._shiftKey = u.shiftKey, i._buttonsPressed = u.buttons, n.isPointerLock) {
                            var c = u.movementX || u.mozMovementX || u.webkitMovementX || u.msMovementX || 0,
                                d = u.movementY || u.mozMovementY || u.webkitMovementY || u.msMovementY || 0;
                            i.onTouch(null, c, d), i.pointA = null, i.pointB = null
                        } else if (s.type === dt.POINTERDOWN && l) {
                            try {
                                l.setPointerCapture(u.pointerId)
                            } catch (e) {}
                            null === i.pointA ? i.pointA = {
                                x: u.clientX,
                                y: u.clientY,
                                pointerId: u.pointerId,
                                type: u.pointerType
                            } : null === i.pointB && (i.pointB = {
                                x: u.clientX,
                                y: u.clientY,
                                pointerId: u.pointerId,
                                type: u.pointerType
                            }), i.onButtonDown(u), t || (u.preventDefault(), e.focus())
                        } else if (s.type === dt.POINTERDOUBLETAP) i.onDoubleTap(u.pointerType);
                        else if (s.type === dt.POINTERUP && l) {
                            try {
                                l.releasePointerCapture(u.pointerId)
                            } catch (e) {}
                            h || (i.pointB = null), n._badOS ? i.pointA = i.pointB = null : i.pointB && i.pointA && i.pointA.pointerId == u.pointerId ? (i.pointA = i.pointB, i.pointB = null) : i.pointA && i.pointB && i.pointB.pointerId == u.pointerId ? i.pointB = null : i.pointA = i.pointB = null, (0 !== r || o) && (i.onMultiTouch(i.pointA, i.pointB, r, 0, o, null), r = 0, o = null), i.onButtonUp(u), t || u.preventDefault()
                        } else if (s.type === dt.POINTERMOVE)
                            if (t || u.preventDefault(), i.pointA && null === i.pointB) {
                                c = u.clientX - i.pointA.x, d = u.clientY - i.pointA.y;
                                i.onTouch(i.pointA, c, d), i.pointA.x = u.clientX, i.pointA.y = u.clientY
                            } else if (i.pointA && i.pointB) {
                            var f = i.pointA.pointerId === u.pointerId ? i.pointA : i.pointB;
                            f.x = u.clientX, f.y = u.clientY;
                            var p = i.pointA.x - i.pointB.x,
                                _ = i.pointA.y - i.pointB.y,
                                g = p * p + _ * _,
                                m = {
                                    x: (i.pointA.x + i.pointB.x) / 2,
                                    y: (i.pointA.y + i.pointB.y) / 2,
                                    pointerId: u.pointerId,
                                    type: s.type
                                };
                            i.onMultiTouch(i.pointA, i.pointB, r, g, o, m), o = m, r = g
                        }
                    }
                }, this._observer = this.camera.getScene().onPointerObservable.add(this._pointerInput, dt.POINTERDOWN | dt.POINTERUP | dt.POINTERMOVE), this._onLostFocus = function() {
                    i.pointA = i.pointB = null, r = 0, o = null, i.onLostFocus()
                }, e.addEventListener("contextmenu", this.onContextMenu.bind(this), !1), K.RegisterTopRootEvents([{
                    name: "blur",
                    handler: this._onLostFocus
                }])
            }, e.prototype.detachControl = function(e) {
                this._onLostFocus && K.UnregisterTopRootEvents([{
                    name: "blur",
                    handler: this._onLostFocus
                }]), e && this._observer && (this.camera.getScene().onPointerObservable.remove(this._observer), this._observer = null, this.onContextMenu && e.removeEventListener("contextmenu", this.onContextMenu), this._onLostFocus = null), this._altKey = !1, this._ctrlKey = !1, this._metaKey = !1, this._shiftKey = !1, this._buttonsPressed = 0
            }, e.prototype.getClassName = function() {
                return "BaseCameraPointersInput"
            }, e.prototype.getSimpleName = function() {
                return "pointers"
            }, e.prototype.onDoubleTap = function(e) {}, e.prototype.onTouch = function(e, t, i) {}, e.prototype.onMultiTouch = function(e, t, i, n, r, o) {}, e.prototype.onContextMenu = function(e) {
                e.preventDefault()
            }, e.prototype.onButtonDown = function(e) {}, e.prototype.onButtonUp = function(e) {}, e.prototype.onLostFocus = function() {}, s([ce()], e.prototype, "buttons", void 0), e
        }());
    Mt.ArcRotateCameraPointersInput = qt;
    var Zt = function() {
        function e() {
            this.keysUp = [38], this.keysDown = [40], this.keysLeft = [37], this.keysRight = [39], this.keysReset = [220], this.panningSensibility = 50, this.zoomingSensibility = 25, this.useAltToZoom = !0, this.angularSpeed = .01, this._keys = new Array
        }
        return e.prototype.attachControl = function(e, t) {
            var i = this;
            this._onCanvasBlurObserver || (this._scene = this.camera.getScene(), this._engine = this._scene.getEngine(), this._onCanvasBlurObserver = this._engine.onCanvasBlurObservable.add((function() {
                i._keys = []
            })), this._onKeyboardObserver = this._scene.onKeyboardObservable.add((function(e) {
                var n, r = e.event;
                r.metaKey || (e.type === mt.KEYDOWN ? (i._ctrlPressed = r.ctrlKey, i._altPressed = r.altKey, (-1 !== i.keysUp.indexOf(r.keyCode) || -1 !== i.keysDown.indexOf(r.keyCode) || -1 !== i.keysLeft.indexOf(r.keyCode) || -1 !== i.keysRight.indexOf(r.keyCode) || -1 !== i.keysReset.indexOf(r.keyCode)) && (-1 === (n = i._keys.indexOf(r.keyCode)) && i._keys.push(r.keyCode), r.preventDefault && (t || r.preventDefault()))) : -1 === i.keysUp.indexOf(r.keyCode) && -1 === i.keysDown.indexOf(r.keyCode) && -1 === i.keysLeft.indexOf(r.keyCode) && -1 === i.keysRight.indexOf(r.keyCode) && -1 === i.keysReset.indexOf(r.keyCode) || ((n = i._keys.indexOf(r.keyCode)) >= 0 && i._keys.splice(n, 1), r.preventDefault && (t || r.preventDefault())))
            })))
        }, e.prototype.detachControl = function(e) {
            this._scene && (this._onKeyboardObserver && this._scene.onKeyboardObservable.remove(this._onKeyboardObserver), this._onCanvasBlurObserver && this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver), this._onKeyboardObserver = null, this._onCanvasBlurObserver = null), this._keys = []
        }, e.prototype.checkInputs = function() {
            if (this._onKeyboardObserver)
                for (var e = this.camera, t = 0; t < this._keys.length; t++) {
                    var i = this._keys[t]; - 1 !== this.keysLeft.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningX -= 1 / this.panningSensibility : e.inertialAlphaOffset -= this.angularSpeed : -1 !== this.keysUp.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningY += 1 / this.panningSensibility : this._altPressed && this.useAltToZoom ? e.inertialRadiusOffset += 1 / this.zoomingSensibility : e.inertialBetaOffset -= this.angularSpeed : -1 !== this.keysRight.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningX += 1 / this.panningSensibility : e.inertialAlphaOffset += this.angularSpeed : -1 !== this.keysDown.indexOf(i) ? this._ctrlPressed && this.camera._useCtrlForPanning ? e.inertialPanningY -= 1 / this.panningSensibility : this._altPressed && this.useAltToZoom ? e.inertialRadiusOffset -= 1 / this.zoomingSensibility : e.inertialBetaOffset += this.angularSpeed : -1 !== this.keysReset.indexOf(i) && e.useInputToRestoreState && e.restoreState()
                }
        }, e.prototype.getClassName = function() {
            return "ArcRotateCameraKeyboardMoveInput"
        }, e.prototype.getSimpleName = function() {
            return "keyboard"
        }, s([ce()], e.prototype, "keysUp", void 0), s([ce()], e.prototype, "keysDown", void 0), s([ce()], e.prototype, "keysLeft", void 0), s([ce()], e.prototype, "keysRight", void 0), s([ce()], e.prototype, "keysReset", void 0), s([ce()], e.prototype, "panningSensibility", void 0), s([ce()], e.prototype, "zoomingSensibility", void 0), s([ce()], e.prototype, "useAltToZoom", void 0), s([ce()], e.prototype, "angularSpeed", void 0), e
    }();
    Mt.ArcRotateCameraKeyboardMoveInput = Zt;
    var Qt = function() {
        function e() {
            this.wheelPrecision = 3, this.wheelDeltaPercentage = 0
        }
        return e.prototype.computeDeltaFromMouseWheelLegacyEvent = function(e, t) {
            var i = .01 * e.wheelDelta * this.wheelDeltaPercentage * t;
            return e.wheelDelta > 0 ? i / (1 + this.wheelDeltaPercentage) : i * (1 + this.wheelDeltaPercentage)
        }, e.prototype.attachControl = function(e, t) {
            var i = this;
            this._wheel = function(e, n) {
                if (e.type === dt.POINTERWHEEL) {
                    var r = e.event,
                        o = 0,
                        s = r;
                    if (s.wheelDelta)
                        if (i.wheelDeltaPercentage) {
                            if ((o = i.computeDeltaFromMouseWheelLegacyEvent(s, i.camera.radius)) > 0) {
                                for (var a = i.camera.radius, u = i.camera.inertialRadiusOffset + o, h = 0; h < 20 && Math.abs(u) > .001; h++) a -= u, u *= i.camera.inertia;
                                a = m.Clamp(a, 0, Number.MAX_VALUE), o = i.computeDeltaFromMouseWheelLegacyEvent(s, a)
                            }
                        } else o = s.wheelDelta / (40 * i.wheelPrecision);
                    else o = -(r.deltaY || r.detail) / i.wheelPrecision;
                    o && (i.camera.inertialRadiusOffset += o), r.preventDefault && (t || r.preventDefault())
                }
            }, this._observer = this.camera.getScene().onPointerObservable.add(this._wheel, dt.POINTERWHEEL)
        }, e.prototype.detachControl = function(e) {
            this._observer && e && (this.camera.getScene().onPointerObservable.remove(this._observer), this._observer = null, this._wheel = null)
        }, e.prototype.getClassName = function() {
            return "ArcRotateCameraMouseWheelInput"
        }, e.prototype.getSimpleName = function() {
            return "mousewheel"
        }, s([ce()], e.prototype, "wheelPrecision", void 0), s([ce()], e.prototype, "wheelDeltaPercentage", void 0), e
    }();
    Mt.ArcRotateCameraMouseWheelInput = Qt;
    var Jt = function(e) {
        function t(t) {
            return e.call(this, t) || this
        }
        return r(t, e), t.prototype.addMouseWheel = function() {
            return this.add(new Qt), this
        }, t.prototype.addPointers = function() {
            return this.add(new qt), this
        }, t.prototype.addKeyboard = function() {
            return this.add(new Zt), this
        }, t
    }(Rt);
    He.AddNodeConstructor("ArcRotateCamera", (function(e, t) {
        return function() {
            return new $t(e, 0, 0, 1, b.Zero(), t)
        }
    }));
    var $t = function(e) {
            function t(t, i, n, r, o, s, a) {
                void 0 === a && (a = !0);
                var u = e.call(this, t, b.Zero(), s, a) || this;
                return u._upVector = b.Up(), u.inertialAlphaOffset = 0, u.inertialBetaOffset = 0, u.inertialRadiusOffset = 0, u.lowerAlphaLimit = null, u.upperAlphaLimit = null, u.lowerBetaLimit = .01, u.upperBetaLimit = Math.PI - .01, u.lowerRadiusLimit = null, u.upperRadiusLimit = null, u.inertialPanningX = 0, u.inertialPanningY = 0, u.pinchToPanMaxDistance = 20, u.panningDistanceLimit = null, u.panningOriginTarget = b.Zero(), u.panningInertia = .9, u.zoomOnFactor = 1, u.targetScreenOffset = T.Zero(), u.allowUpsideDown = !0, u.useInputToRestoreState = !0, u._viewMatrix = new R, u.panningAxis = new b(1, 1, 0), u.onMeshTargetChangedObservable = new l, u.checkCollisions = !1, u.collisionRadius = new b(.5, .5, .5), u._previousPosition = b.Zero(), u._collisionVelocity = b.Zero(), u._newPosition = b.Zero(), u._computationVector = b.Zero(), u._onCollisionPositionChange = function(e, t, i) {
                    void 0 === i && (i = null), i ? (u.setPosition(t), u.onCollide && u.onCollide(i)) : u._previousPosition.copyFrom(u._position);
                    var n = Math.cos(u.alpha),
                        r = Math.sin(u.alpha),
                        o = Math.cos(u.beta),
                        s = Math.sin(u.beta);
                    0 === s && (s = 1e-4);
                    var a = u._getTargetPosition();
                    u._computationVector.copyFromFloats(u.radius * n * s, u.radius * o, u.radius * r * s), a.addToRef(u._computationVector, u._newPosition), u._position.copyFrom(u._newPosition);
                    var h = u.upVector;
                    u.allowUpsideDown && u.beta < 0 && (h = (h = h.clone()).negate()), u._computeViewMatrix(u._position, a, h), u._viewMatrix.addAtIndex(12, u.targetScreenOffset.x), u._viewMatrix.addAtIndex(13, u.targetScreenOffset.y), u._collisionTriggered = !1
                }, u._target = b.Zero(), o && u.setTarget(o), u.alpha = i, u.beta = n, u.radius = r, u.getViewMatrix(), u.inputs = new Jt(u), u.inputs.addKeyboard().addMouseWheel().addPointers(), u
            }
            return r(t, e), Object.defineProperty(t.prototype, "target", {
                get: function() {
                    return this._target
                },
                set: function(e) {
                    this.setTarget(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "position", {
                get: function() {
                    return this._position
                },
                set: function(e) {
                    this.setPosition(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "upVector", {
                get: function() {
                    return this._upVector
                },
                set: function(e) {
                    this._upToYMatrix || (this._YToUpMatrix = new R, this._upToYMatrix = new R, this._upVector = b.Zero()), e.normalize(), this._upVector.copyFrom(e), this.setMatUp()
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.setMatUp = function() {
                R.RotationAlignToRef(b.UpReadOnly, this._upVector, this._YToUpMatrix), R.RotationAlignToRef(this._upVector, b.UpReadOnly, this._upToYMatrix)
            }, Object.defineProperty(t.prototype, "angularSensibilityX", {
                get: function() {
                    var e = this.inputs.attached.pointers;
                    return e ? e.angularSensibilityX : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.pointers;
                    t && (t.angularSensibilityX = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "angularSensibilityY", {
                get: function() {
                    var e = this.inputs.attached.pointers;
                    return e ? e.angularSensibilityY : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.pointers;
                    t && (t.angularSensibilityY = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "pinchPrecision", {
                get: function() {
                    var e = this.inputs.attached.pointers;
                    return e ? e.pinchPrecision : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.pointers;
                    t && (t.pinchPrecision = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "pinchDeltaPercentage", {
                get: function() {
                    var e = this.inputs.attached.pointers;
                    return e ? e.pinchDeltaPercentage : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.pointers;
                    t && (t.pinchDeltaPercentage = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "panningSensibility", {
                get: function() {
                    var e = this.inputs.attached.pointers;
                    return e ? e.panningSensibility : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.pointers;
                    t && (t.panningSensibility = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysUp", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysUp : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysUp = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysDown", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysDown : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysDown = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysLeft", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysLeft : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysLeft = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "keysRight", {
                get: function() {
                    var e = this.inputs.attached.keyboard;
                    return e ? e.keysRight : []
                },
                set: function(e) {
                    var t = this.inputs.attached.keyboard;
                    t && (t.keysRight = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "wheelPrecision", {
                get: function() {
                    var e = this.inputs.attached.mousewheel;
                    return e ? e.wheelPrecision : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.mousewheel;
                    t && (t.wheelPrecision = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "wheelDeltaPercentage", {
                get: function() {
                    var e = this.inputs.attached.mousewheel;
                    return e ? e.wheelDeltaPercentage : 0
                },
                set: function(e) {
                    var t = this.inputs.attached.mousewheel;
                    t && (t.wheelDeltaPercentage = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "bouncingBehavior", {
                get: function() {
                    return this._bouncingBehavior
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "useBouncingBehavior", {
                get: function() {
                    return null != this._bouncingBehavior
                },
                set: function(e) {
                    e !== this.useBouncingBehavior && (e ? (this._bouncingBehavior = new Yt, this.addBehavior(this._bouncingBehavior)) : this._bouncingBehavior && (this.removeBehavior(this._bouncingBehavior), this._bouncingBehavior = null))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "framingBehavior", {
                get: function() {
                    return this._framingBehavior
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "useFramingBehavior", {
                get: function() {
                    return null != this._framingBehavior
                },
                set: function(e) {
                    e !== this.useFramingBehavior && (e ? (this._framingBehavior = new Kt, this.addBehavior(this._framingBehavior)) : this._framingBehavior && (this.removeBehavior(this._framingBehavior), this._framingBehavior = null))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "autoRotationBehavior", {
                get: function() {
                    return this._autoRotationBehavior
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "useAutoRotationBehavior", {
                get: function() {
                    return null != this._autoRotationBehavior
                },
                set: function(e) {
                    e !== this.useAutoRotationBehavior && (e ? (this._autoRotationBehavior = new Gt, this.addBehavior(this._autoRotationBehavior)) : this._autoRotationBehavior && (this.removeBehavior(this._autoRotationBehavior), this._autoRotationBehavior = null))
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._initCache = function() {
                e.prototype._initCache.call(this), this._cache._target = new b(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), this._cache.alpha = void 0, this._cache.beta = void 0, this._cache.radius = void 0, this._cache.targetScreenOffset = T.Zero()
            }, t.prototype._updateCache = function(t) {
                t || e.prototype._updateCache.call(this), this._cache._target.copyFrom(this._getTargetPosition()), this._cache.alpha = this.alpha, this._cache.beta = this.beta, this._cache.radius = this.radius, this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)
            }, t.prototype._getTargetPosition = function() {
                if (this._targetHost && this._targetHost.getAbsolutePosition) {
                    var e = this._targetHost.absolutePosition;
                    this._targetBoundingCenter ? e.addToRef(this._targetBoundingCenter, this._target) : this._target.copyFrom(e)
                }
                var t = this._getLockedTargetPosition();
                return t || this._target
            }, t.prototype.storeState = function() {
                return this._storedAlpha = this.alpha, this._storedBeta = this.beta, this._storedRadius = this.radius, this._storedTarget = this._getTargetPosition().clone(), e.prototype.storeState.call(this)
            }, t.prototype._restoreStateValues = function() {
                return !!e.prototype._restoreStateValues.call(this) && (this.alpha = this._storedAlpha, this.beta = this._storedBeta, this.radius = this._storedRadius, this.setTarget(this._storedTarget.clone()), this.inertialAlphaOffset = 0, this.inertialBetaOffset = 0, this.inertialRadiusOffset = 0, this.inertialPanningX = 0, this.inertialPanningY = 0, !0)
            }, t.prototype._isSynchronizedViewMatrix = function() {
                return !!e.prototype._isSynchronizedViewMatrix.call(this) && (this._cache._target.equals(this._getTargetPosition()) && this._cache.alpha === this.alpha && this._cache.beta === this.beta && this._cache.radius === this.radius && this._cache.targetScreenOffset.equals(this.targetScreenOffset))
            }, t.prototype.attachControl = function(e, t, i, n) {
                var r = this;
                void 0 === i && (i = !0), void 0 === n && (n = 2), this._useCtrlForPanning = i, this._panningMouseButton = n, this.inputs.attachElement(e, t), this._reset = function() {
                    r.inertialAlphaOffset = 0, r.inertialBetaOffset = 0, r.inertialRadiusOffset = 0, r.inertialPanningX = 0, r.inertialPanningY = 0
                }
            }, t.prototype.detachControl = function(e) {
                this.inputs.detachElement(e), this._reset && this._reset()
            }, t.prototype._checkInputs = function() {
                if (!this._collisionTriggered) {
                    if (this.inputs.checkInputs(), 0 !== this.inertialAlphaOffset || 0 !== this.inertialBetaOffset || 0 !== this.inertialRadiusOffset) {
                        var t = this.inertialAlphaOffset;
                        this.beta <= 0 && (t *= -1), this.getScene().useRightHandedSystem && (t *= -1), this.parent && this.parent._getWorldMatrixDeterminant() < 0 && (t *= -1), this.alpha += t, this.beta += this.inertialBetaOffset, this.radius -= this.inertialRadiusOffset, this.inertialAlphaOffset *= this.inertia, this.inertialBetaOffset *= this.inertia, this.inertialRadiusOffset *= this.inertia, Math.abs(this.inertialAlphaOffset) < .001 && (this.inertialAlphaOffset = 0), Math.abs(this.inertialBetaOffset) < .001 && (this.inertialBetaOffset = 0), Math.abs(this.inertialRadiusOffset) < .001 * this.speed && (this.inertialRadiusOffset = 0)
                    }
                    if (0 !== this.inertialPanningX || 0 !== this.inertialPanningY) {
                        if (this._localDirection || (this._localDirection = b.Zero(), this._transformedDirection = b.Zero()), this._localDirection.copyFromFloats(this.inertialPanningX, this.inertialPanningY, this.inertialPanningY), this._localDirection.multiplyInPlace(this.panningAxis), this._viewMatrix.invertToRef(this._cameraTransformMatrix), b.TransformNormalToRef(this._localDirection, this._cameraTransformMatrix, this._transformedDirection), this.panningAxis.y || (this._transformedDirection.y = 0), !this._targetHost)
                            if (this.panningDistanceLimit) this._transformedDirection.addInPlace(this._target), b.DistanceSquared(this._transformedDirection, this.panningOriginTarget) <= this.panningDistanceLimit * this.panningDistanceLimit && this._target.copyFrom(this._transformedDirection);
                            else this._target.addInPlace(this._transformedDirection);
                        this.inertialPanningX *= this.panningInertia, this.inertialPanningY *= this.panningInertia, Math.abs(this.inertialPanningX) < .001 * this.speed && (this.inertialPanningX = 0), Math.abs(this.inertialPanningY) < .001 * this.speed && (this.inertialPanningY = 0)
                    }
                    this._checkLimits(), e.prototype._checkInputs.call(this)
                }
            }, t.prototype._checkLimits = function() {
                null === this.lowerBetaLimit || void 0 === this.lowerBetaLimit ? this.allowUpsideDown && this.beta > Math.PI && (this.beta = this.beta - 2 * Math.PI) : this.beta < this.lowerBetaLimit && (this.beta = this.lowerBetaLimit), null === this.upperBetaLimit || void 0 === this.upperBetaLimit ? this.allowUpsideDown && this.beta < -Math.PI && (this.beta = this.beta + 2 * Math.PI) : this.beta > this.upperBetaLimit && (this.beta = this.upperBetaLimit), null !== this.lowerAlphaLimit && this.alpha < this.lowerAlphaLimit && (this.alpha = this.lowerAlphaLimit), null !== this.upperAlphaLimit && this.alpha > this.upperAlphaLimit && (this.alpha = this.upperAlphaLimit), null !== this.lowerRadiusLimit && this.radius < this.lowerRadiusLimit && (this.radius = this.lowerRadiusLimit, this.inertialRadiusOffset = 0), null !== this.upperRadiusLimit && this.radius > this.upperRadiusLimit && (this.radius = this.upperRadiusLimit, this.inertialRadiusOffset = 0)
            }, t.prototype.rebuildAnglesAndRadius = function() {
                this._position.subtractToRef(this._getTargetPosition(), this._computationVector), 0 === this._upVector.x && 1 === this._upVector.y && 0 === this._upVector.z || b.TransformCoordinatesToRef(this._computationVector, this._upToYMatrix, this._computationVector), this.radius = this._computationVector.length(), 0 === this.radius && (this.radius = 1e-4), 0 === this._computationVector.x && 0 === this._computationVector.z ? this.alpha = Math.PI / 2 : this.alpha = Math.acos(this._computationVector.x / Math.sqrt(Math.pow(this._computationVector.x, 2) + Math.pow(this._computationVector.z, 2))), this._computationVector.z < 0 && (this.alpha = 2 * Math.PI - this.alpha), this.beta = Math.acos(this._computationVector.y / this.radius), this._checkLimits()
            }, t.prototype.setPosition = function(e) {
                this._position.equals(e) || (this._position.copyFrom(e), this.rebuildAnglesAndRadius())
            }, t.prototype.setTarget = function(e, t, i) {
                if (void 0 === t && (t = !1), void 0 === i && (i = !1), e.getBoundingInfo) this._targetBoundingCenter = t ? e.getBoundingInfo().boundingBox.centerWorld.clone() : null, e.computeWorldMatrix(), this._targetHost = e, this._target = this._getTargetPosition(), this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);
                else {
                    var n = e,
                        r = this._getTargetPosition();
                    if (r && !i && r.equals(n)) return;
                    this._targetHost = null, this._target = n, this._targetBoundingCenter = null, this.onMeshTargetChangedObservable.notifyObservers(null)
                }
                this.rebuildAnglesAndRadius()
            }, t.prototype._getViewMatrix = function() {
                var e = Math.cos(this.alpha),
                    t = Math.sin(this.alpha),
                    i = Math.cos(this.beta),
                    n = Math.sin(this.beta);
                0 === n && (n = 1e-4);
                var r = this._getTargetPosition();
                if (this._computationVector.copyFromFloats(this.radius * e * n, this.radius * i, this.radius * t * n), 0 === this._upVector.x && 1 === this._upVector.y && 0 === this._upVector.z || b.TransformCoordinatesToRef(this._computationVector, this._YToUpMatrix, this._computationVector), r.addToRef(this._computationVector, this._newPosition), this.getScene().collisionsEnabled && this.checkCollisions) {
                    var o = this.getScene().collisionCoordinator;
                    this._collider || (this._collider = o.createCollider()), this._collider._radius = this.collisionRadius, this._newPosition.subtractToRef(this._position, this._collisionVelocity), this._collisionTriggered = !0, o.getNewPosition(this._position, this._collisionVelocity, this._collider, 3, null, this._onCollisionPositionChange, this.uniqueId)
                } else {
                    this._position.copyFrom(this._newPosition);
                    var s = this.upVector;
                    this.allowUpsideDown && n < 0 && (s = (s = s.clone()).negate()), this._computeViewMatrix(this._position, r, s), this._viewMatrix.addAtIndex(12, this.targetScreenOffset.x), this._viewMatrix.addAtIndex(13, this.targetScreenOffset.y)
                }
                return this._currentTarget = r, this._viewMatrix
            }, t.prototype.zoomOn = function(e, t) {
                void 0 === t && (t = !1), e = e || this.getScene().meshes;
                var i = Vt.MinMax(e),
                    n = b.Distance(i.min, i.max);
                this.radius = n * this.zoomOnFactor, this.focusOn({
                    min: i.min,
                    max: i.max,
                    distance: n
                }, t)
            }, t.prototype.focusOn = function(e, t) {
                var i, n;
                if (void 0 === t && (t = !1), void 0 === e.min) {
                    var r = e || this.getScene().meshes;
                    i = Vt.MinMax(r), n = b.Distance(i.min, i.max)
                } else {
                    i = e, n = e.distance
                }
                this._target = Vt.Center(i), t || (this.maxZ = 2 * n)
            }, t.prototype.createRigCamera = function(e, i) {
                var n = 0;
                switch (this.cameraRigMode) {
                    case $e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                    case $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                    case $e.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                    case $e.RIG_MODE_VR:
                        n = this._cameraRigParams.stereoHalfAngle * (0 === i ? 1 : -1);
                        break;
                    case $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                        n = this._cameraRigParams.stereoHalfAngle * (0 === i ? -1 : 1)
                }
                var r = new t(e, this.alpha + n, this.beta, this.radius, this._target, this.getScene());
                return r._cameraRigParams = {}, r
            }, t.prototype._updateRigCameras = function() {
                var t = this._rigCameras[0],
                    i = this._rigCameras[1];
                switch (t.beta = i.beta = this.beta, this.cameraRigMode) {
                    case $e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:
                    case $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:
                    case $e.RIG_MODE_STEREOSCOPIC_OVERUNDER:
                    case $e.RIG_MODE_VR:
                        t.alpha = this.alpha - this._cameraRigParams.stereoHalfAngle, i.alpha = this.alpha + this._cameraRigParams.stereoHalfAngle;
                        break;
                    case $e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:
                        t.alpha = this.alpha + this._cameraRigParams.stereoHalfAngle, i.alpha = this.alpha - this._cameraRigParams.stereoHalfAngle
                }
                e.prototype._updateRigCameras.call(this)
            }, t.prototype.dispose = function() {
                this.inputs.clear(), e.prototype.dispose.call(this)
            }, t.prototype.getClassName = function() {
                return "ArcRotateCamera"
            }, s([ce()], t.prototype, "alpha", void 0), s([ce()], t.prototype, "beta", void 0), s([ce()], t.prototype, "radius", void 0), s([_e("target")], t.prototype, "_target", void 0), s([_e("upVector")], t.prototype, "_upVector", void 0), s([ce()], t.prototype, "inertialAlphaOffset", void 0), s([ce()], t.prototype, "inertialBetaOffset", void 0), s([ce()], t.prototype, "inertialRadiusOffset", void 0), s([ce()], t.prototype, "lowerAlphaLimit", void 0), s([ce()], t.prototype, "upperAlphaLimit", void 0), s([ce()], t.prototype, "lowerBetaLimit", void 0), s([ce()], t.prototype, "upperBetaLimit", void 0), s([ce()], t.prototype, "lowerRadiusLimit", void 0), s([ce()], t.prototype, "upperRadiusLimit", void 0), s([ce()], t.prototype, "inertialPanningX", void 0), s([ce()], t.prototype, "inertialPanningY", void 0), s([ce()], t.prototype, "pinchToPanMaxDistance", void 0), s([ce()], t.prototype, "panningDistanceLimit", void 0), s([_e()], t.prototype, "panningOriginTarget", void 0), s([ce()], t.prototype, "panningInertia", void 0), s([ce()], t.prototype, "zoomOnFactor", void 0), s([ce()], t.prototype, "targetScreenOffset", void 0), s([ce()], t.prototype, "allowUpsideDown", void 0), s([ce()], t.prototype, "useInputToRestoreState", void 0), t
        }(At),
        ei = function() {
            function e(e, t) {
                this.triggerOptions = e, this.onBeforeExecuteObservable = new l, e.parameter ? (this.trigger = e.trigger, this._triggerParameter = e.parameter) : e.trigger ? this.trigger = e.trigger : this.trigger = e, this._nextActiveAction = this, this._condition = t
            }
            return e.prototype._prepare = function() {}, e.prototype.getTriggerParameter = function() {
                return this._triggerParameter
            }, e.prototype._executeCurrent = function(e) {
                if (this._nextActiveAction._condition) {
                    var t = this._nextActiveAction._condition,
                        i = this._actionManager.getScene().getRenderId();
                    if (t._evaluationId === i) {
                        if (!t._currentResult) return
                    } else {
                        if (t._evaluationId = i, !t.isValid()) return void(t._currentResult = !1);
                        t._currentResult = !0
                    }
                }
                this.onBeforeExecuteObservable.notifyObservers(this), this._nextActiveAction.execute(e), this.skipToNextActiveAction()
            }, e.prototype.execute = function(e) {}, e.prototype.skipToNextActiveAction = function() {
                this._nextActiveAction._child ? (this._nextActiveAction._child._actionManager || (this._nextActiveAction._child._actionManager = this._actionManager), this._nextActiveAction = this._nextActiveAction._child) : this._nextActiveAction = this
            }, e.prototype.then = function(e) {
                return this._child = e, e._actionManager = this._actionManager, e._prepare(), e
            }, e.prototype._getProperty = function(e) {
                return this._actionManager._getProperty(e)
            }, e.prototype._getEffectiveTarget = function(e, t) {
                return this._actionManager._getEffectiveTarget(e, t)
            }, e.prototype.serialize = function(e) {}, e.prototype._serialize = function(e, t) {
                var i = {
                    type: 1,
                    children: [],
                    name: e.name,
                    properties: e.properties || []
                };
                if (this._child && this._child.serialize(i), this._condition) {
                    var n = this._condition.serialize();
                    return n.children.push(i), t && t.children.push(n), n
                }
                return t && t.children.push(i), i
            }, e._SerializeValueAsString = function(e) {
                return "number" == typeof e ? e.toString() : "boolean" == typeof e ? e ? "true" : "false" : e instanceof T ? e.x + ", " + e.y : e instanceof b ? e.x + ", " + e.y + ", " + e.z : e instanceof v ? e.r + ", " + e.g + ", " + e.b : e instanceof y ? e.r + ", " + e.g + ", " + e.b + ", " + e.a : e
            }, e._GetTargetProperty = function(e) {
                return {
                    name: "target",
                    targetType: e._isMesh ? "MeshProperties" : e._isLight ? "LightProperties" : e._isCamera ? "CameraProperties" : "SceneProperties",
                    value: e._isScene ? "Scene" : e.name
                }
            }, e
        }();
    G.RegisteredTypes["BABYLON.Action"] = ei;
    var ti = function() {
            function e(e) {
                this._actionManager = e
            }
            return e.prototype.isValid = function() {
                return !0
            }, e.prototype._getProperty = function(e) {
                return this._actionManager._getProperty(e)
            }, e.prototype._getEffectiveTarget = function(e, t) {
                return this._actionManager._getEffectiveTarget(e, t)
            }, e.prototype.serialize = function() {}, e.prototype._serialize = function(e) {
                return {
                    type: 2,
                    children: [],
                    name: e.name,
                    properties: e.properties
                }
            }, e
        }(),
        ii = function(e) {
            function t(i, n, r, o, s) {
                void 0 === s && (s = t.IsEqual);
                var a = e.call(this, i) || this;
                return a.propertyPath = r, a.value = o, a.operator = s, a._target = n, a._effectiveTarget = a._getEffectiveTarget(n, a.propertyPath), a._property = a._getProperty(a.propertyPath), a
            }
            return r(t, e), Object.defineProperty(t, "IsEqual", {
                get: function() {
                    return t._IsEqual
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "IsDifferent", {
                get: function() {
                    return t._IsDifferent
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "IsGreater", {
                get: function() {
                    return t._IsGreater
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "IsLesser", {
                get: function() {
                    return t._IsLesser
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.isValid = function() {
                switch (this.operator) {
                    case t.IsGreater:
                        return this._effectiveTarget[this._property] > this.value;
                    case t.IsLesser:
                        return this._effectiveTarget[this._property] < this.value;
                    case t.IsEqual:
                    case t.IsDifferent:
                        var e;
                        return e = this.value.equals ? this.value.equals(this._effectiveTarget[this._property]) : this.value === this._effectiveTarget[this._property], this.operator === t.IsEqual ? e : !e
                }
                return !1
            }, t.prototype.serialize = function() {
                return this._serialize({
                    name: "ValueCondition",
                    properties: [ei._GetTargetProperty(this._target), {
                        name: "propertyPath",
                        value: this.propertyPath
                    }, {
                        name: "value",
                        value: ei._SerializeValueAsString(this.value)
                    }, {
                        name: "operator",
                        value: t.GetOperatorName(this.operator)
                    }]
                })
            }, t.GetOperatorName = function(e) {
                switch (e) {
                    case t._IsEqual:
                        return "IsEqual";
                    case t._IsDifferent:
                        return "IsDifferent";
                    case t._IsGreater:
                        return "IsGreater";
                    case t._IsLesser:
                        return "IsLesser";
                    default:
                        return ""
                }
            }, t._IsEqual = 0, t._IsDifferent = 1, t._IsGreater = 2, t._IsLesser = 3, t
        }(ti),
        ni = function(e) {
            function t(t, i) {
                var n = e.call(this, t) || this;
                return n.predicate = i, n
            }
            return r(t, e), t.prototype.isValid = function() {
                return this.predicate()
            }, t
        }(ti),
        ri = function(e) {
            function t(t, i, n) {
                var r = e.call(this, t) || this;
                return r.value = n, r._target = i, r
            }
            return r(t, e), t.prototype.isValid = function() {
                return this._target.state === this.value
            }, t.prototype.serialize = function() {
                return this._serialize({
                    name: "StateCondition",
                    properties: [ei._GetTargetProperty(this._target), {
                        name: "value",
                        value: this.value
                    }]
                })
            }, t
        }(ti);
    G.RegisteredTypes["BABYLON.ValueCondition"] = ii, G.RegisteredTypes["BABYLON.PredicateCondition"] = ni, G.RegisteredTypes["BABYLON.StateCondition"] = ri;
    ! function(e) {
        function t(t, i, n, r) {
            var o = e.call(this, t, r) || this;
            return o.propertyPath = n, o._target = o._effectiveTarget = i, o
        }
        r(t, e), t.prototype._prepare = function() {
            this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath)
        }, t.prototype.execute = function() {
            this._effectiveTarget[this._property] = !this._effectiveTarget[this._property]
        }, t.prototype.serialize = function(t) {
            return e.prototype._serialize.call(this, {
                name: "SwitchBooleanAction",
                properties: [ei._GetTargetProperty(this._target), {
                    name: "propertyPath",
                    value: this.propertyPath
                }]
            }, t)
        }
    }(ei);
    var oi = function(e) {
            function t(t, i, n, r) {
                var o = e.call(this, t, r) || this;
                return o.value = n, o._target = i, o
            }
            return r(t, e), t.prototype.execute = function() {
                this._target.state = this.value
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "SetStateAction",
                    properties: [ei._GetTargetProperty(this._target), {
                        name: "value",
                        value: this.value
                    }]
                }, t)
            }, t
        }(ei),
        si = function(e) {
            function t(t, i, n, r, o) {
                var s = e.call(this, t, o) || this;
                return s.propertyPath = n, s.value = r, s._target = s._effectiveTarget = i, s
            }
            return r(t, e), t.prototype._prepare = function() {
                this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath)
            }, t.prototype.execute = function() {
                this._effectiveTarget[this._property] = this.value, this._target.markAsDirty && this._target.markAsDirty(this._property)
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "SetValueAction",
                    properties: [ei._GetTargetProperty(this._target), {
                        name: "propertyPath",
                        value: this.propertyPath
                    }, {
                        name: "value",
                        value: ei._SerializeValueAsString(this.value)
                    }]
                }, t)
            }, t
        }(ei),
        ai = function(e) {
            function t(t, i, n, r, o) {
                var s = e.call(this, t, o) || this;
                return s.propertyPath = n, s.value = r, s._target = s._effectiveTarget = i, s
            }
            return r(t, e), t.prototype._prepare = function() {
                this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath), "number" != typeof this._effectiveTarget[this._property] && V.Warn("Warning: IncrementValueAction can only be used with number values")
            }, t.prototype.execute = function() {
                this._effectiveTarget[this._property] += this.value, this._target.markAsDirty && this._target.markAsDirty(this._property)
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "IncrementValueAction",
                    properties: [ei._GetTargetProperty(this._target), {
                        name: "propertyPath",
                        value: this.propertyPath
                    }, {
                        name: "value",
                        value: ei._SerializeValueAsString(this.value)
                    }]
                }, t)
            }, t
        }(ei),
        ui = function(e) {
            function t(t, i, n, r, o, s) {
                var a = e.call(this, t, s) || this;
                return a.from = n, a.to = r, a.loop = o, a._target = i, a
            }
            return r(t, e), t.prototype._prepare = function() {}, t.prototype.execute = function() {
                this._actionManager.getScene().beginAnimation(this._target, this.from, this.to, this.loop)
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "PlayAnimationAction",
                    properties: [ei._GetTargetProperty(this._target), {
                        name: "from",
                        value: String(this.from)
                    }, {
                        name: "to",
                        value: String(this.to)
                    }, {
                        name: "loop",
                        value: ei._SerializeValueAsString(this.loop) || !1
                    }]
                }, t)
            }, t
        }(ei),
        hi = function(e) {
            function t(t, i, n) {
                var r = e.call(this, t, n) || this;
                return r._target = i, r
            }
            return r(t, e), t.prototype._prepare = function() {}, t.prototype.execute = function() {
                this._actionManager.getScene().stopAnimation(this._target)
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "StopAnimationAction",
                    properties: [ei._GetTargetProperty(this._target)]
                }, t)
            }, t
        }(ei),
        li = function(e) {
            function t(t, i) {
                return void 0 === t && (t = k.ACTION_NothingTrigger), e.call(this, t, i) || this
            }
            return r(t, e), t.prototype.execute = function() {}, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "DoNothingAction",
                    properties: []
                }, t)
            }, t
        }(ei),
        ci = (function(e) {
            function t(t, i, n) {
                var r = e.call(this, t, n) || this;
                return r.children = i, r
            }
            r(t, e), t.prototype._prepare = function() {
                for (var e = 0; e < this.children.length; e++) this.children[e]._actionManager = this._actionManager, this.children[e]._prepare()
            }, t.prototype.execute = function(e) {
                for (var t = 0; t < this.children.length; t++) this.children[t].execute(e)
            }, t.prototype.serialize = function(t) {
                for (var i = e.prototype._serialize.call(this, {
                        name: "CombineAction",
                        properties: [],
                        combine: []
                    }, t), n = 0; n < this.children.length; n++) i.combine.push(this.children[n].serialize(null));
                return i
            }
        }(ei), function(e) {
            function t(t, i, n) {
                var r = e.call(this, t, n) || this;
                return r.func = i, r
            }
            return r(t, e), t.prototype.execute = function(e) {
                this.func(e)
            }, t
        }(ei)),
        di = function(e) {
            function t(t, i, n, r) {
                var o = e.call(this, t, r) || this;
                return o._target = i, o._parent = n, o
            }
            return r(t, e), t.prototype._prepare = function() {}, t.prototype.execute = function() {
                if (this._target.parent !== this._parent) {
                    var e = this._parent.getWorldMatrix().clone();
                    e.invert(), this._target.position = b.TransformCoordinates(this._target.position, e), this._target.parent = this._parent
                }
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "SetParentAction",
                    properties: [ei._GetTargetProperty(this._target), ei._GetTargetProperty(this._parent)]
                }, t)
            }, t
        }(ei);
    G.RegisteredTypes["BABYLON.SetParentAction"] = di, G.RegisteredTypes["BABYLON.ExecuteCodeAction"] = ci, G.RegisteredTypes["BABYLON.DoNothingAction"] = li, G.RegisteredTypes["BABYLON.StopAnimationAction"] = hi, G.RegisteredTypes["BABYLON.PlayAnimationAction"] = ui, G.RegisteredTypes["BABYLON.IncrementValueAction"] = ai, G.RegisteredTypes["BABYLON.SetValueAction"] = si, G.RegisteredTypes["BABYLON.SetStateAction"] = oi, G.RegisteredTypes["BABYLON.SetParentAction"] = di;
    var fi = function(e) {
            function t(t) {
                var i = e.call(this) || this;
                return i._scene = t || ve.LastCreatedScene, t.actionManagers.push(i), i
            }
            return r(t, e), t.prototype.dispose = function() {
                for (var e = this._scene.actionManagers.indexOf(this), i = 0; i < this.actions.length; i++) {
                    var n = this.actions[i];
                    t.Triggers[n.trigger]--, 0 === t.Triggers[n.trigger] && delete t.Triggers[n.trigger]
                }
                e > -1 && this._scene.actionManagers.splice(e, 1)
            }, t.prototype.getScene = function() {
                return this._scene
            }, t.prototype.hasSpecificTriggers = function(e) {
                for (var t = 0; t < this.actions.length; t++) {
                    var i = this.actions[t];
                    if (e.indexOf(i.trigger) > -1) return !0
                }
                return !1
            }, t.prototype.hasSpecificTriggers2 = function(e, t) {
                for (var i = 0; i < this.actions.length; i++) {
                    var n = this.actions[i];
                    if (e == n.trigger || t == n.trigger) return !0
                }
                return !1
            }, t.prototype.hasSpecificTrigger = function(e, t) {
                for (var i = 0; i < this.actions.length; i++) {
                    var n = this.actions[i];
                    if (n.trigger === e) {
                        if (!t) return !0;
                        if (t(n.getTriggerParameter())) return !0
                    }
                }
                return !1
            }, Object.defineProperty(t.prototype, "hasPointerTriggers", {
                get: function() {
                    for (var e = 0; e < this.actions.length; e++) {
                        var i = this.actions[e];
                        if (i.trigger >= t.OnPickTrigger && i.trigger <= t.OnPointerOutTrigger) return !0
                    }
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "hasPickTriggers", {
                get: function() {
                    for (var e = 0; e < this.actions.length; e++) {
                        var i = this.actions[e];
                        if (i.trigger >= t.OnPickTrigger && i.trigger <= t.OnPickUpTrigger) return !0
                    }
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.registerAction = function(e) {
                return e.trigger === t.OnEveryFrameTrigger && this.getScene().actionManager !== this ? (V.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"), null) : (this.actions.push(e), t.Triggers[e.trigger] ? t.Triggers[e.trigger]++ : t.Triggers[e.trigger] = 1, e._actionManager = this, e._prepare(), e)
            }, t.prototype.unregisterAction = function(e) {
                var i = this.actions.indexOf(e);
                return -1 !== i && (this.actions.splice(i, 1), t.Triggers[e.trigger] -= 1, 0 === t.Triggers[e.trigger] && delete t.Triggers[e.trigger], delete e._actionManager, !0)
            }, t.prototype.processTrigger = function(e, i) {
                for (var n = 0; n < this.actions.length; n++) {
                    var r = this.actions[n];
                    if (r.trigger === e) {
                        if (i && (e === t.OnKeyUpTrigger || e === t.OnKeyDownTrigger)) {
                            var o = r.getTriggerParameter();
                            if (o && o !== i.sourceEvent.keyCode) {
                                if (!o.toLowerCase) continue;
                                var s = o.toLowerCase();
                                if (s !== i.sourceEvent.key) {
                                    var a = i.sourceEvent.charCode ? i.sourceEvent.charCode : i.sourceEvent.keyCode;
                                    if (String.fromCharCode(a).toLowerCase() !== s) continue
                                }
                            }
                        }
                        r._executeCurrent(i)
                    }
                }
            }, t.prototype._getEffectiveTarget = function(e, t) {
                for (var i = t.split("."), n = 0; n < i.length - 1; n++) e = e[i[n]];
                return e
            }, t.prototype._getProperty = function(e) {
                var t = e.split(".");
                return t[t.length - 1]
            }, t.prototype.serialize = function(e) {
                for (var i = {
                        children: new Array,
                        name: e,
                        type: 3,
                        properties: new Array
                    }, n = 0; n < this.actions.length; n++) {
                    var r = {
                            type: 0,
                            children: new Array,
                            name: t.GetTriggerName(this.actions[n].trigger),
                            properties: new Array
                        },
                        o = this.actions[n].triggerOptions;
                    if (o && "number" != typeof o)
                        if (o.parameter instanceof Node) r.properties.push(ei._GetTargetProperty(o.parameter));
                        else {
                            var s = {};
                            W.DeepCopy(o.parameter, s, ["mesh"]), o.parameter && o.parameter.mesh && (s._meshId = o.parameter.mesh.id), r.properties.push({
                                name: "parameter",
                                targetType: null,
                                value: s
                            })
                        }
                    this.actions[n].serialize(r), i.children.push(r)
                }
                return i
            }, t.Parse = function(e, i, n) {
                var r = new t(n);
                null === i ? n.actionManager = r : i.actionManager = r;
                for (var o = function(e, t, i, n) {
                        if (null === n) {
                            var r = parseFloat(t);
                            return "true" === t || "false" === t ? "true" === t : isNaN(r) ? t : r
                        }
                        for (var o = n.split("."), s = t.split(","), a = 0; a < o.length; a++) i = i[o[a]];
                        if ("boolean" == typeof i) return "true" === s[0];
                        if ("string" == typeof i) return s[0];
                        var u = new Array;
                        for (a = 0; a < s.length; a++) u.push(parseFloat(s[a]));
                        return i instanceof b ? b.FromArray(u) : i instanceof E ? E.FromArray(u) : i instanceof v ? v.FromArray(u) : i instanceof y ? y.FromArray(u) : parseFloat(s[0])
                    }, s = function(e, i, a, u, h) {
                        if (void 0 === h && (h = null), !e.detached) {
                            var l = new Array,
                                c = null,
                                d = null,
                                f = e.combine && e.combine.length > 0;
                            if (2 === e.type ? l.push(r) : l.push(i), f) {
                                for (var p = new Array, _ = 0; _ < e.combine.length; _++) s(e.combine[_], t.NothingTrigger, a, u, p);
                                l.push(p)
                            } else
                                for (var g = 0; g < e.properties.length; g++) {
                                    var m = e.properties[g].value,
                                        v = e.properties[g].name,
                                        y = e.properties[g].targetType;
                                    "target" === v ? m = c = null !== y && "SceneProperties" === y ? n : n.getNodeByName(m) : "parent" === v ? m = n.getNodeByName(m) : "sound" === v ? n.getSoundByName && (m = n.getSoundByName(m)) : "propertyPath" !== v ? m = 2 === e.type && "operator" === v ? ii[m] : o(0, m, c, "value" === v ? d : null) : d = m, l.push(m)
                                }
                            if (null === h ? l.push(a) : l.push(null), "InterpolateValueAction" === e.name) {
                                var T = l[l.length - 2];
                                l[l.length - 1] = T, l[l.length - 2] = a
                            }
                            var b = function(e, t) {
                                var i = G.GetClass("BABYLON." + e);
                                if (i) {
                                    var n = Object.create(i.prototype);
                                    return n.constructor.apply(n, t), n
                                }
                            }(e.name, l);
                            if (b instanceof ti && null !== a) {
                                var E = new li(i, a);
                                u ? u.then(E) : r.registerAction(E), u = E
                            }
                            null === h ? b instanceof ti ? (a = b, b = u) : (a = null, u ? u.then(b) : r.registerAction(b)) : h.push(b);
                            for (g = 0; g < e.children.length; g++) s(e.children[g], i, a, b, null)
                        }
                    }, a = 0; a < e.children.length; a++) {
                    var u, h = e.children[a];
                    if (h.properties.length > 0) {
                        var l = h.properties[0].value,
                            c = null === h.properties[0].targetType ? l : n.getMeshByName(l);
                        c._meshId && (c.mesh = n.getMeshByID(c._meshId)), u = {
                            trigger: t[h.name],
                            parameter: c
                        }
                    } else u = t[h.name];
                    for (var d = 0; d < h.children.length; d++) h.detached || s(h.children[d], u, null, null)
                }
            }, t.GetTriggerName = function(e) {
                switch (e) {
                    case 0:
                        return "NothingTrigger";
                    case 1:
                        return "OnPickTrigger";
                    case 2:
                        return "OnLeftPickTrigger";
                    case 3:
                        return "OnRightPickTrigger";
                    case 4:
                        return "OnCenterPickTrigger";
                    case 5:
                        return "OnPickDownTrigger";
                    case 6:
                        return "OnPickUpTrigger";
                    case 7:
                        return "OnLongPressTrigger";
                    case 8:
                        return "OnPointerOverTrigger";
                    case 9:
                        return "OnPointerOutTrigger";
                    case 10:
                        return "OnEveryFrameTrigger";
                    case 11:
                        return "OnIntersectionEnterTrigger";
                    case 12:
                        return "OnIntersectionExitTrigger";
                    case 13:
                        return "OnKeyDownTrigger";
                    case 14:
                        return "OnKeyUpTrigger";
                    case 15:
                        return "OnPickOutTrigger";
                    default:
                        return ""
                }
            }, t.NothingTrigger = k.ACTION_NothingTrigger, t.OnPickTrigger = k.ACTION_OnPickTrigger, t.OnLeftPickTrigger = k.ACTION_OnLeftPickTrigger, t.OnRightPickTrigger = k.ACTION_OnRightPickTrigger, t.OnCenterPickTrigger = k.ACTION_OnCenterPickTrigger, t.OnPickDownTrigger = k.ACTION_OnPickDownTrigger, t.OnDoublePickTrigger = k.ACTION_OnDoublePickTrigger, t.OnPickUpTrigger = k.ACTION_OnPickUpTrigger, t.OnPickOutTrigger = k.ACTION_OnPickOutTrigger, t.OnLongPressTrigger = k.ACTION_OnLongPressTrigger, t.OnPointerOverTrigger = k.ACTION_OnPointerOverTrigger, t.OnPointerOutTrigger = k.ACTION_OnPointerOutTrigger, t.OnEveryFrameTrigger = k.ACTION_OnEveryFrameTrigger, t.OnIntersectionEnterTrigger = k.ACTION_OnIntersectionEnterTrigger, t.OnIntersectionExitTrigger = k.ACTION_OnIntersectionExitTrigger, t.OnKeyDownTrigger = k.ACTION_OnKeyDownTrigger, t.OnKeyUpTrigger = 15, t
        }(gt),
        pi = (function(e) {
            function t(t, i, n) {
                var r = e.call(this, t, n) || this;
                return r._sound = i, r
            }
            r(t, e), t.prototype._prepare = function() {}, t.prototype.execute = function() {
                void 0 !== this._sound && this._sound.play()
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "PlaySoundAction",
                    properties: [{
                        name: "sound",
                        value: this._sound.name
                    }]
                }, t)
            }
        }(ei), function(e) {
            function t(t, i, n) {
                var r = e.call(this, t, n) || this;
                return r._sound = i, r
            }
            return r(t, e), t.prototype._prepare = function() {}, t.prototype.execute = function() {
                void 0 !== this._sound && this._sound.stop()
            }, t.prototype.serialize = function(t) {
                return e.prototype._serialize.call(this, {
                    name: "StopSoundAction",
                    properties: [{
                        name: "sound",
                        value: this._sound.name
                    }]
                }, t)
            }, t
        }(ei));
    G.RegisteredTypes["BABYLON.PlaySoundAction"] = pi, G.RegisteredTypes["BABYLON.StopSoundAction"] = pi;
    var _i = function(e) {
        function t(t, i, n, r, o, s, a, u) {
            void 0 === o && (o = 1e3);
            var h = e.call(this, t, s) || this;
            return h.duration = 1e3, h.onInterpolationDoneObservable = new l, h.propertyPath = n, h.value = r, h.duration = o, h.stopOtherAnimations = a, h.onInterpolationDone = u, h._target = h._effectiveTarget = i, h
        }
        return r(t, e), t.prototype._prepare = function() {
            this._effectiveTarget = this._getEffectiveTarget(this._effectiveTarget, this.propertyPath), this._property = this._getProperty(this.propertyPath)
        }, t.prototype.execute = function() {
            var e, t = this,
                i = this._actionManager.getScene(),
                n = [{
                    frame: 0,
                    value: this._effectiveTarget[this._property]
                }, {
                    frame: 100,
                    value: this.value
                }];
            if ("number" == typeof this.value) e = jt.ANIMATIONTYPE_FLOAT;
            else if (this.value instanceof v) e = jt.ANIMATIONTYPE_COLOR3;
            else if (this.value instanceof b) e = jt.ANIMATIONTYPE_VECTOR3;
            else if (this.value instanceof R) e = jt.ANIMATIONTYPE_MATRIX;
            else {
                if (!(this.value instanceof M)) return void V.Warn("InterpolateValueAction: Unsupported type (" + typeof this.value + ")");
                e = jt.ANIMATIONTYPE_QUATERNION
            }
            var r = new jt("InterpolateValueAction", this._property, 1e3 / this.duration * 100, e, jt.ANIMATIONLOOPMODE_CONSTANT);
            r.setKeys(n), this.stopOtherAnimations && i.stopAnimation(this._effectiveTarget);
            i.beginDirectAnimation(this._effectiveTarget, [r], 0, 100, !1, 1, (function() {
                t.onInterpolationDoneObservable.notifyObservers(t), t.onInterpolationDone && t.onInterpolationDone()
            }))
        }, t.prototype.serialize = function(t) {
            return e.prototype._serialize.call(this, {
                name: "InterpolateValueAction",
                properties: [ei._GetTargetProperty(this._target), {
                    name: "propertyPath",
                    value: this.propertyPath
                }, {
                    name: "value",
                    value: ei._SerializeValueAsString(this.value)
                }, {
                    name: "duration",
                    value: ei._SerializeValueAsString(this.duration)
                }, {
                    name: "stopOtherAnimations",
                    value: ei._SerializeValueAsString(this.stopOtherAnimations) || !1
                }]
            }, t)
        }, t
    }(ei);
    G.RegisteredTypes["BABYLON.InterpolateValueAction"] = _i;
    var gi = [Math.sqrt(1 / (4 * Math.PI)), -Math.sqrt(3 / (4 * Math.PI)), Math.sqrt(3 / (4 * Math.PI)), -Math.sqrt(3 / (4 * Math.PI)), Math.sqrt(15 / (4 * Math.PI)), -Math.sqrt(15 / (4 * Math.PI)), Math.sqrt(5 / (16 * Math.PI)), -Math.sqrt(15 / (4 * Math.PI)), Math.sqrt(15 / (16 * Math.PI))],
        mi = [function(e) {
            return 1
        }, function(e) {
            return e.y
        }, function(e) {
            return e.z
        }, function(e) {
            return e.x
        }, function(e) {
            return e.x * e.y
        }, function(e) {
            return e.y * e.z
        }, function(e) {
            return 3 * e.z * e.z - 1
        }, function(e) {
            return e.x * e.z
        }, function(e) {
            return e.x * e.x - e.y * e.y
        }],
        vi = function(e, t) {
            return gi[e] * mi[e](t)
        },
        yi = [Math.PI, 2 * Math.PI / 3, 2 * Math.PI / 3, 2 * Math.PI / 3, Math.PI / 4, Math.PI / 4, Math.PI / 4, Math.PI / 4, Math.PI / 4],
        Ti = function() {
            function e() {
                this.preScaled = !1, this.l00 = b.Zero(), this.l1_1 = b.Zero(), this.l10 = b.Zero(), this.l11 = b.Zero(), this.l2_2 = b.Zero(), this.l2_1 = b.Zero(), this.l20 = b.Zero(), this.l21 = b.Zero(), this.l22 = b.Zero()
            }
            return e.prototype.addLight = function(e, t, i) {
                var n = new b(t.r, t.g, t.b).scale(i);
                this.l00 = this.l00.add(n.scale(vi(0, e))), this.l1_1 = this.l1_1.add(n.scale(vi(1, e))), this.l10 = this.l10.add(n.scale(vi(2, e))), this.l11 = this.l11.add(n.scale(vi(3, e))), this.l2_2 = this.l2_2.add(n.scale(vi(4, e))), this.l2_1 = this.l2_1.add(n.scale(vi(5, e))), this.l20 = this.l20.add(n.scale(vi(6, e))), this.l21 = this.l21.add(n.scale(vi(7, e))), this.l22 = this.l22.add(n.scale(vi(8, e)))
            }, e.prototype.scaleInPlace = function(e) {
                this.l00.scaleInPlace(e), this.l1_1.scaleInPlace(e), this.l10.scaleInPlace(e), this.l11.scaleInPlace(e), this.l2_2.scaleInPlace(e), this.l2_1.scaleInPlace(e), this.l20.scaleInPlace(e), this.l21.scaleInPlace(e), this.l22.scaleInPlace(e)
            }, e.prototype.convertIncidentRadianceToIrradiance = function() {
                this.l00.scaleInPlace(yi[0]), this.l1_1.scaleInPlace(yi[1]), this.l10.scaleInPlace(yi[2]), this.l11.scaleInPlace(yi[3]), this.l2_2.scaleInPlace(yi[4]), this.l2_1.scaleInPlace(yi[5]), this.l20.scaleInPlace(yi[6]), this.l21.scaleInPlace(yi[7]), this.l22.scaleInPlace(yi[8])
            }, e.prototype.convertIrradianceToLambertianRadiance = function() {
                this.scaleInPlace(1 / Math.PI)
            }, e.prototype.preScaleForRendering = function() {
                this.preScaled = !0, this.l00.scaleInPlace(gi[0]), this.l1_1.scaleInPlace(gi[1]), this.l10.scaleInPlace(gi[2]), this.l11.scaleInPlace(gi[3]), this.l2_2.scaleInPlace(gi[4]), this.l2_1.scaleInPlace(gi[5]), this.l20.scaleInPlace(gi[6]), this.l21.scaleInPlace(gi[7]), this.l22.scaleInPlace(gi[8])
            }, e.FromArray = function(t) {
                var i = new e;
                return b.FromArrayToRef(t[0], 0, i.l00), b.FromArrayToRef(t[1], 0, i.l1_1), b.FromArrayToRef(t[2], 0, i.l10), b.FromArrayToRef(t[3], 0, i.l11), b.FromArrayToRef(t[4], 0, i.l2_2), b.FromArrayToRef(t[5], 0, i.l2_1), b.FromArrayToRef(t[6], 0, i.l20), b.FromArrayToRef(t[7], 0, i.l21), b.FromArrayToRef(t[8], 0, i.l22), i
            }, e.FromPolynomial = function(t) {
                var i = new e;
                return i.l00 = t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)), i.l1_1 = t.y.scale(.977204), i.l10 = t.z.scale(.977204), i.l11 = t.x.scale(.977204), i.l2_2 = t.xy.scale(1.16538), i.l2_1 = t.yz.scale(1.16538), i.l20 = t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)), i.l21 = t.zx.scale(1.16538), i.l22 = t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)), i.l1_1.scaleInPlace(-1), i.l11.scaleInPlace(-1), i.l2_1.scaleInPlace(-1), i.l21.scaleInPlace(-1), i.scaleInPlace(Math.PI), i
            }, e
        }(),
        bi = function() {
            function e() {
                this.x = b.Zero(), this.y = b.Zero(), this.z = b.Zero(), this.xx = b.Zero(), this.yy = b.Zero(), this.zz = b.Zero(), this.xy = b.Zero(), this.yz = b.Zero(), this.zx = b.Zero()
            }
            return Object.defineProperty(e.prototype, "preScaledHarmonics", {
                get: function() {
                    return this._harmonics || (this._harmonics = Ti.FromPolynomial(this)), this._harmonics.preScaled || this._harmonics.preScaleForRendering(), this._harmonics
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.addAmbient = function(e) {
                var t = new b(e.r, e.g, e.b);
                this.xx = this.xx.add(t), this.yy = this.yy.add(t), this.zz = this.zz.add(t)
            }, e.prototype.scaleInPlace = function(e) {
                this.x.scaleInPlace(e), this.y.scaleInPlace(e), this.z.scaleInPlace(e), this.xx.scaleInPlace(e), this.yy.scaleInPlace(e), this.zz.scaleInPlace(e), this.yz.scaleInPlace(e), this.zx.scaleInPlace(e), this.xy.scaleInPlace(e)
            }, e.FromHarmonics = function(t) {
                var i = new e;
                return i._harmonics = t, i.x = t.l11.scale(1.02333).scale(-1), i.y = t.l1_1.scale(1.02333).scale(-1), i.z = t.l10.scale(1.02333), i.xx = t.l00.scale(.886277).subtract(t.l20.scale(.247708)).add(t.l22.scale(.429043)), i.yy = t.l00.scale(.886277).subtract(t.l20.scale(.247708)).subtract(t.l22.scale(.429043)), i.zz = t.l00.scale(.886277).add(t.l20.scale(.495417)), i.yz = t.l2_1.scale(.858086).scale(-1), i.zx = t.l21.scale(.858086).scale(-1), i.xy = t.l2_2.scale(.858086), i.scaleInPlace(1 / Math.PI), i
            }, e.FromArray = function(t) {
                var i = new e;
                return b.FromArrayToRef(t[0], 0, i.x), b.FromArrayToRef(t[1], 0, i.y), b.FromArrayToRef(t[2], 0, i.z), b.FromArrayToRef(t[3], 0, i.xx), b.FromArrayToRef(t[4], 0, i.yy), b.FromArrayToRef(t[5], 0, i.zz), b.FromArrayToRef(t[6], 0, i.yz), b.FromArrayToRef(t[7], 0, i.zx), b.FromArrayToRef(t[8], 0, i.xy), i
            }, e
        }(),
        Ei = function(e, t, i, n) {
            this.name = e, this.worldAxisForNormal = t, this.worldAxisForFileX = i, this.worldAxisForFileY = n
        },
        Ai = function() {
            function e() {}
            return e.ConvertCubeMapTextureToSphericalPolynomial = function(e) {
                if (!e.isCube) return null;
                var t, i, n = e.getSize().width,
                    r = e.readPixels(0),
                    o = e.readPixels(1);
                e.isRenderTarget ? (t = e.readPixels(3), i = e.readPixels(2)) : (t = e.readPixels(2), i = e.readPixels(3));
                var s = e.readPixels(4),
                    a = e.readPixels(5),
                    u = e.gammaSpace,
                    h = k.TEXTUREFORMAT_RGBA,
                    l = k.TEXTURETYPE_UNSIGNED_INT;
                e.textureType && e.textureType !== k.TEXTURETYPE_UNSIGNED_INT && (l = k.TEXTURETYPE_FLOAT);
                var c = {
                    size: n,
                    right: r,
                    left: o,
                    up: t,
                    down: i,
                    front: s,
                    back: a,
                    format: h,
                    type: l,
                    gammaSpace: u
                };
                return this.ConvertCubeMapToSphericalPolynomial(c)
            }, e.ConvertCubeMapToSphericalPolynomial = function(e) {
                for (var t = new Ti, i = 0, n = 2 / e.size, r = n, o = .5 * n - 1, s = 0; s < 6; s++)
                    for (var a = this.FileFaces[s], u = e[a.name], h = o, l = e.format === k.TEXTUREFORMAT_RGBA ? 4 : 3, c = 0; c < e.size; c++) {
                        for (var d = o, f = 0; f < e.size; f++) {
                            var p = a.worldAxisForFileX.scale(d).add(a.worldAxisForFileY.scale(h)).add(a.worldAxisForNormal);
                            p.normalize();
                            var _ = Math.pow(1 + d * d + h * h, -1.5),
                                g = u[c * e.size * l + f * l + 0],
                                y = u[c * e.size * l + f * l + 1],
                                T = u[c * e.size * l + f * l + 2];
                            e.type === k.TEXTURETYPE_UNSIGNED_INT && (g /= 255, y /= 255, T /= 255), e.gammaSpace && (g = Math.pow(m.Clamp(g), 2.2), y = Math.pow(m.Clamp(y), 2.2), T = Math.pow(m.Clamp(T), 2.2));
                            var b = new v(g, y, T);
                            t.addLight(p, b, _), i += _, d += n
                        }
                        h += r
                    }
                var E = 6 * (4 * Math.PI) / 6 / i;
                return t.scaleInPlace(E), t.convertIncidentRadianceToIrradiance(), t.convertIrradianceToLambertianRadiance(), bi.FromHarmonics(t)
            }, e.FileFaces = [new Ei("right", new b(1, 0, 0), new b(0, 0, -1), new b(0, -1, 0)), new Ei("left", new b(-1, 0, 0), new b(0, 0, 1), new b(0, -1, 0)), new Ei("up", new b(0, 1, 0), new b(1, 0, 0), new b(0, 0, 1)), new Ei("down", new b(0, -1, 0), new b(1, 0, 0), new b(0, 0, -1)), new Ei("front", new b(0, 0, 1), new b(1, 0, 0), new b(0, -1, 0)), new Ei("back", new b(0, 0, -1), new b(-1, 0, 0), new b(0, -1, 0))], e
        }(),
        Mi = function() {
            function e(t) {
                this.metadata = null, this.reservedDataStore = null, this._hasAlpha = !1, this.getAlphaFromRGB = !1, this.level = 1, this.coordinatesIndex = 0, this._coordinatesMode = k.TEXTURE_EXPLICIT_MODE, this.wrapU = k.TEXTURE_WRAP_ADDRESSMODE, this.wrapV = k.TEXTURE_WRAP_ADDRESSMODE, this.wrapR = k.TEXTURE_WRAP_ADDRESSMODE, this.anisotropicFilteringLevel = e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL, this.gammaSpace = !0, this.invertZ = !1, this.lodLevelInAlpha = !1, this.isRenderTarget = !1, this.animations = new Array, this.onDisposeObservable = new l, this._onDisposeObserver = null, this.delayLoadState = k.DELAYLOADSTATE_NONE, this._scene = null, this._texture = null, this._uid = null, this._cachedSize = A.Zero(), this._scene = t || ve.LastCreatedScene, this._scene && (this.uniqueId = this._scene.getUniqueId(), this._scene.addTexture(this)), this._uid = null
            }
            return Object.defineProperty(e.prototype, "hasAlpha", {
                get: function() {
                    return this._hasAlpha
                },
                set: function(e) {
                    this._hasAlpha !== e && (this._hasAlpha = e, this._scene && this._scene.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag | k.MATERIAL_MiscDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "coordinatesMode", {
                get: function() {
                    return this._coordinatesMode
                },
                set: function(e) {
                    this._coordinatesMode !== e && (this._coordinatesMode = e, this._scene && this._scene.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isCube", {
                get: function() {
                    return !!this._texture && this._texture.isCube
                },
                set: function(e) {
                    this._texture && (this._texture.isCube = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "is3D", {
                get: function() {
                    return !!this._texture && this._texture.is3D
                },
                set: function(e) {
                    this._texture && (this._texture.is3D = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isRGBD", {
                get: function() {
                    return null != this._texture && this._texture._isRGBD
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "noMipmap", {
                get: function() {
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "lodGenerationOffset", {
                get: function() {
                    return this._texture ? this._texture._lodGenerationOffset : 0
                },
                set: function(e) {
                    this._texture && (this._texture._lodGenerationOffset = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "lodGenerationScale", {
                get: function() {
                    return this._texture ? this._texture._lodGenerationScale : 0
                },
                set: function(e) {
                    this._texture && (this._texture._lodGenerationScale = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "uid", {
                get: function() {
                    return this._uid || (this._uid = K.RandomId()), this._uid
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.toString = function() {
                return this.name
            }, e.prototype.getClassName = function() {
                return "BaseTexture"
            }, Object.defineProperty(e.prototype, "onDispose", {
                set: function(e) {
                    this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isBlocking", {
                get: function() {
                    return !0
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getScene = function() {
                return this._scene
            }, e.prototype.getTextureMatrix = function() {
                return R.IdentityReadOnly
            }, e.prototype.getReflectionTextureMatrix = function() {
                return R.IdentityReadOnly
            }, e.prototype.getInternalTexture = function() {
                return this._texture
            }, e.prototype.isReadyOrNotBlocking = function() {
                return !this.isBlocking || this.isReady()
            }, e.prototype.isReady = function() {
                return this.delayLoadState === k.DELAYLOADSTATE_NOTLOADED ? (this.delayLoad(), !1) : !!this._texture && this._texture.isReady
            }, e.prototype.getSize = function() {
                if (this._texture) {
                    if (this._texture.width) return this._cachedSize.width = this._texture.width, this._cachedSize.height = this._texture.height, this._cachedSize;
                    if (this._texture._size) return this._cachedSize.width = this._texture._size, this._cachedSize.height = this._texture._size, this._cachedSize
                }
                return this._cachedSize
            }, e.prototype.getBaseSize = function() {
                return this.isReady() && this._texture ? this._texture._size ? new A(this._texture._size, this._texture._size) : new A(this._texture.baseWidth, this._texture.baseHeight) : A.Zero()
            }, e.prototype.updateSamplingMode = function(e) {
                if (this._texture) {
                    var t = this.getScene();
                    t && t.getEngine().updateTextureSamplingMode(e, this._texture)
                }
            }, e.prototype.scale = function(e) {}, Object.defineProperty(e.prototype, "canRescale", {
                get: function() {
                    return !1
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._getFromCache = function(e, t, i, n) {
                if (!this._scene) return null;
                for (var r = this._scene.getEngine().getLoadedTexturesCache(), o = 0; o < r.length; o++) {
                    var s = r[o];
                    if (!(void 0 !== n && n !== s.invertY || s.url !== e || s.generateMipMaps !== !t || i && i !== s.samplingMode)) return s.incrementReferences(), s
                }
                return null
            }, e.prototype._rebuild = function() {}, e.prototype.delayLoad = function() {}, e.prototype.clone = function() {
                return null
            }, Object.defineProperty(e.prototype, "textureType", {
                get: function() {
                    return this._texture && void 0 !== this._texture.type ? this._texture.type : k.TEXTURETYPE_UNSIGNED_INT
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "textureFormat", {
                get: function() {
                    return this._texture && void 0 !== this._texture.format ? this._texture.format : k.TEXTUREFORMAT_RGBA
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.readPixels = function(e, t, i) {
                if (void 0 === e && (e = 0), void 0 === t && (t = 0), void 0 === i && (i = null), !this._texture) return null;
                var n = this.getSize(),
                    r = n.width,
                    o = n.height,
                    s = this.getScene();
                if (!s) return null;
                var a = s.getEngine();
                return 0 != t && (r /= Math.pow(2, t), o /= Math.pow(2, t), r = Math.round(r), o = Math.round(o)), this._texture.isCube ? a._readTexturePixels(this._texture, r, o, e, t, i) : a._readTexturePixels(this._texture, r, o, -1, t, i)
            }, e.prototype.releaseInternalTexture = function() {
                this._texture && (this._texture.dispose(), this._texture = null)
            }, Object.defineProperty(e.prototype, "sphericalPolynomial", {
                get: function() {
                    return this._texture && Ai && this.isReady() ? (this._texture._sphericalPolynomial || (this._texture._sphericalPolynomial = Ai.ConvertCubeMapTextureToSphericalPolynomial(this)), this._texture._sphericalPolynomial) : null
                },
                set: function(e) {
                    this._texture && (this._texture._sphericalPolynomial = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "_lodTextureHigh", {
                get: function() {
                    return this._texture ? this._texture._lodTextureHigh : null
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "_lodTextureMid", {
                get: function() {
                    return this._texture ? this._texture._lodTextureMid : null
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "_lodTextureLow", {
                get: function() {
                    return this._texture ? this._texture._lodTextureLow : null
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.dispose = function() {
                if (this._scene) {
                    this._scene.stopAnimation && this._scene.stopAnimation(this), this._scene._removePendingData(this);
                    var e = this._scene.textures.indexOf(this);
                    e >= 0 && this._scene.textures.splice(e, 1), this._scene.onTextureRemovedObservable.notifyObservers(this), void 0 !== this._texture && (this.releaseInternalTexture(), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear())
                }
            }, e.prototype.serialize = function() {
                if (!this.name) return null;
                var e = me.Serialize(this);
                return me.AppendSerializedAnimations(this, e), e
            }, e.WhenAllReady = function(e, t) {
                var i = e.length;
                if (0 !== i)
                    for (var n, r, o = function() {
                            if ((n = e[s]).isReady()) 0 == --i && t();
                            else {
                                r = n.onLoadObservable;
                                var o = function() {
                                    r.removeCallback(o), 0 == --i && t()
                                };
                                r.add(o)
                            }
                        }, s = 0; s < e.length; s++) o();
                else t()
            }, e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL = 4, s([ce()], e.prototype, "uniqueId", void 0), s([ce()], e.prototype, "name", void 0), s([ce()], e.prototype, "metadata", void 0), s([ce("hasAlpha")], e.prototype, "_hasAlpha", void 0), s([ce()], e.prototype, "getAlphaFromRGB", void 0), s([ce()], e.prototype, "level", void 0), s([ce()], e.prototype, "coordinatesIndex", void 0), s([ce("coordinatesMode")], e.prototype, "_coordinatesMode", void 0), s([ce()], e.prototype, "wrapU", void 0), s([ce()], e.prototype, "wrapV", void 0), s([ce()], e.prototype, "wrapR", void 0), s([ce()], e.prototype, "anisotropicFilteringLevel", void 0), s([ce()], e.prototype, "isCube", null), s([ce()], e.prototype, "is3D", null), s([ce()], e.prototype, "gammaSpace", void 0), s([ce()], e.prototype, "invertZ", void 0), s([ce()], e.prototype, "lodLevelInAlpha", void 0), s([ce()], e.prototype, "lodGenerationOffset", null), s([ce()], e.prototype, "lodGenerationScale", null), s([ce()], e.prototype, "isRenderTarget", void 0), e
        }(),
        Ri = function(e) {
            function t(i, n, r, o, s, a, u, h, c, d) {
                void 0 === r && (r = !1), void 0 === o && (o = !0), void 0 === s && (s = t.TRILINEAR_SAMPLINGMODE), void 0 === a && (a = null), void 0 === u && (u = null), void 0 === h && (h = null), void 0 === c && (c = !1);
                var f = e.call(this, n) || this;
                if (f.url = null, f.uOffset = 0, f.vOffset = 0, f.uScale = 1, f.vScale = 1, f.uAng = 0, f.vAng = 0, f.wAng = 0, f.uRotationCenter = .5, f.vRotationCenter = .5, f.wRotationCenter = .5, f.inspectableCustomProperties = null, f._noMipmap = !1, f._invertY = !1, f._rowGenerationMatrix = null, f._cachedTextureMatrix = null, f._projectionModeMatrix = null, f._t0 = null, f._t1 = null, f._t2 = null, f._cachedUOffset = -1, f._cachedVOffset = -1, f._cachedUScale = 0, f._cachedVScale = 0, f._cachedUAng = -1, f._cachedVAng = -1, f._cachedWAng = -1, f._cachedProjectionMatrixId = -1, f._cachedCoordinatesMode = -1, f._initialSamplingMode = t.BILINEAR_SAMPLINGMODE, f._buffer = null, f._deleteBuffer = !1, f._format = null, f._delayedOnLoad = null, f._delayedOnError = null, f.onLoadObservable = new l, f._isBlocking = !0, f.name = i || "", f.url = i, f._noMipmap = r, f._invertY = o, f._initialSamplingMode = s, f._buffer = h, f._deleteBuffer = c, d && (f._format = d), !(n = f.getScene())) return f;
                n.getEngine().onBeforeTextureInitObservable.notifyObservers(f);
                var p = function() {
                    f._texture && f._texture._invertVScale && (f.vScale = -1), f.onLoadObservable.hasObservers() && f.onLoadObservable.notifyObservers(f), a && a(), !f.isBlocking && n && n.resetCachedMaterial()
                };
                return f.url ? (f._texture = f._getFromCache(f.url, r, s, o), f._texture ? f._texture.isReady ? K.SetImmediate((function() {
                    return p()
                })) : f._texture.onLoadedObservable.add(p) : n.useDelayedTextureLoading ? (f.delayLoadState = k.DELAYLOADSTATE_NOTLOADED, f._delayedOnLoad = p, f._delayedOnError = u) : (f._texture = n.getEngine().createTexture(f.url, r, o, n, s, p, u, f._buffer, void 0, f._format), c && delete f._buffer), f) : (f._delayedOnLoad = p, f._delayedOnError = u, f)
            }
            return r(t, e), Object.defineProperty(t.prototype, "noMipmap", {
                get: function() {
                    return this._noMipmap
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "isBlocking", {
                get: function() {
                    return this._isBlocking
                },
                set: function(e) {
                    this._isBlocking = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "samplingMode", {
                get: function() {
                    return this._texture ? this._texture.samplingMode : this._initialSamplingMode
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "invertY", {
                get: function() {
                    return this._invertY
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.updateURL = function(e, t, i) {
                void 0 === t && (t = null), this.url && (this.releaseInternalTexture(), this.getScene().markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag)), this.url = e, this._buffer = t, this.delayLoadState = k.DELAYLOADSTATE_NOTLOADED, i && (this._delayedOnLoad = i), this.delayLoad()
            }, t.prototype.delayLoad = function() {
                if (this.delayLoadState === k.DELAYLOADSTATE_NOTLOADED) {
                    var e = this.getScene();
                    e && (this.delayLoadState = k.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap, this.samplingMode, this._invertY), this._texture ? this._delayedOnLoad && (this._texture.isReady ? K.SetImmediate(this._delayedOnLoad) : this._texture.onLoadedObservable.add(this._delayedOnLoad)) : (this._texture = e.getEngine().createTexture(this.url, this._noMipmap, this._invertY, e, this.samplingMode, this._delayedOnLoad, this._delayedOnError, this._buffer, null, this._format), this._deleteBuffer && delete this._buffer), this._delayedOnLoad = null, this._delayedOnError = null)
                }
            }, t.prototype._prepareRowForTextureGeneration = function(e, t, i, n) {
                e *= this.uScale, t *= this.vScale, e -= this.uRotationCenter * this.uScale, t -= this.vRotationCenter * this.vScale, i -= this.wRotationCenter, b.TransformCoordinatesFromFloatsToRef(e, t, i, this._rowGenerationMatrix, n), n.x += this.uRotationCenter * this.uScale + this.uOffset, n.y += this.vRotationCenter * this.vScale + this.vOffset, n.z += this.wRotationCenter
            }, t.prototype.getTextureMatrix = function() {
                var e = this;
                if (this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.uAng === this._cachedUAng && this.vAng === this._cachedVAng && this.wAng === this._cachedWAng) return this._cachedTextureMatrix;
                this._cachedUOffset = this.uOffset, this._cachedVOffset = this.vOffset, this._cachedUScale = this.uScale, this._cachedVScale = this.vScale, this._cachedUAng = this.uAng, this._cachedVAng = this.vAng, this._cachedWAng = this.wAng, this._cachedTextureMatrix || (this._cachedTextureMatrix = R.Zero(), this._rowGenerationMatrix = new R, this._t0 = b.Zero(), this._t1 = b.Zero(), this._t2 = b.Zero()), R.RotationYawPitchRollToRef(this.vAng, this.uAng, this.wAng, this._rowGenerationMatrix), this._prepareRowForTextureGeneration(0, 0, 0, this._t0), this._prepareRowForTextureGeneration(1, 0, 0, this._t1), this._prepareRowForTextureGeneration(0, 1, 0, this._t2), this._t1.subtractInPlace(this._t0), this._t2.subtractInPlace(this._t0), R.FromValuesToRef(this._t1.x, this._t1.y, this._t1.z, 0, this._t2.x, this._t2.y, this._t2.z, 0, this._t0.x, this._t0.y, this._t0.z, 0, 0, 0, 0, 1, this._cachedTextureMatrix);
                var t = this.getScene();
                return t ? (t.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag, (function(t) {
                    return t.hasTexture(e)
                })), this._cachedTextureMatrix) : this._cachedTextureMatrix
            }, t.prototype.getReflectionTextureMatrix = function() {
                var e = this,
                    i = this.getScene();
                if (!i) return this._cachedTextureMatrix;
                if (this.uOffset === this._cachedUOffset && this.vOffset === this._cachedVOffset && this.uScale === this._cachedUScale && this.vScale === this._cachedVScale && this.coordinatesMode === this._cachedCoordinatesMode) {
                    if (this.coordinatesMode !== t.PROJECTION_MODE) return this._cachedTextureMatrix;
                    if (this._cachedProjectionMatrixId === i.getProjectionMatrix().updateFlag) return this._cachedTextureMatrix
                }
                switch (this._cachedTextureMatrix || (this._cachedTextureMatrix = R.Zero()), this._projectionModeMatrix || (this._projectionModeMatrix = R.Zero()), this._cachedUOffset = this.uOffset, this._cachedVOffset = this.vOffset, this._cachedUScale = this.uScale, this._cachedVScale = this.vScale, this._cachedCoordinatesMode = this.coordinatesMode, this.coordinatesMode) {
                    case t.PLANAR_MODE:
                        R.IdentityToRef(this._cachedTextureMatrix), this._cachedTextureMatrix[0] = this.uScale, this._cachedTextureMatrix[5] = this.vScale, this._cachedTextureMatrix[12] = this.uOffset, this._cachedTextureMatrix[13] = this.vOffset;
                        break;
                    case t.PROJECTION_MODE:
                        R.FromValuesToRef(.5, 0, 0, 0, 0, -.5, 0, 0, 0, 0, 0, 0, .5, .5, 1, 1, this._projectionModeMatrix);
                        var n = i.getProjectionMatrix();
                        this._cachedProjectionMatrixId = n.updateFlag, n.multiplyToRef(this._projectionModeMatrix, this._cachedTextureMatrix);
                        break;
                    default:
                        R.IdentityToRef(this._cachedTextureMatrix)
                }
                return i.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag, (function(t) {
                    return -1 !== t.getActiveTextures().indexOf(e)
                })), this._cachedTextureMatrix
            }, t.prototype.clone = function() {
                var e = this;
                return me.Clone((function() {
                    return new t(e._texture ? e._texture.url : null, e.getScene(), e._noMipmap, e._invertY, e.samplingMode, void 0, void 0, e._texture ? e._texture._buffer : void 0)
                }), this)
            }, t.prototype.serialize = function() {
                var t = e.prototype.serialize.call(this);
                return "string" == typeof this._buffer && "data:" === this._buffer.substr(0, 5) && (t.base64String = this._buffer, t.name = t.name.replace("data:", "")), t.invertY = this._invertY, t.samplingMode = this.samplingMode, t
            }, t.prototype.getClassName = function() {
                return "Texture"
            }, t.prototype.dispose = function() {
                e.prototype.dispose.call(this), this.onLoadObservable.clear(), this._delayedOnLoad = null, this._delayedOnError = null
            }, t.Parse = function(e, i, n) {
                if (e.customType) {
                    var r = K.Instantiate(e.customType).Parse(e, i, n);
                    return e.samplingMode && r.updateSamplingMode && r._samplingMode && r._samplingMode !== e.samplingMode && r.updateSamplingMode(e.samplingMode), r
                }
                if (e.isCube && !e.isRenderTarget) return t._CubeTextureParser(e, i, n);
                if (!e.name && !e.isRenderTarget) return null;
                var o = me.Parse((function() {
                    var r, o = !0;
                    if (e.noMipmap && (o = !1), e.mirrorPlane) {
                        var s = t._CreateMirror(e.name, e.renderTargetSize, i, o);
                        return s._waitingRenderList = e.renderList, s.mirrorPlane = x.FromArray(e.mirrorPlane), s
                    }
                    if (e.isRenderTarget) {
                        var a = null;
                        if (e.isCube) {
                            if (i.reflectionProbes)
                                for (var u = 0; u < i.reflectionProbes.length; u++) {
                                    var h = i.reflectionProbes[u];
                                    if (h.name === e.name) return h.cubeTexture
                                }
                        } else(a = t._CreateRenderTargetTexture(e.name, e.renderTargetSize, i, o))._waitingRenderList = e.renderList;
                        return a
                    }
                    if (e.base64String) r = t.CreateFromBase64String(e.base64String, e.name, i, !o);
                    else {
                        var l = n + e.name;
                        t.UseSerializedUrlIfAny && e.url && (l = e.url), r = new t(l, i, !o, e.invertY)
                    }
                    return r
                }), e, i);
                if (e.samplingMode) {
                    var s = e.samplingMode;
                    o && o.samplingMode !== s && o.updateSamplingMode(s)
                }
                if (o && e.animations)
                    for (var a = 0; a < e.animations.length; a++) {
                        var u = e.animations[a],
                            h = G.GetClass("BABYLON.Animation");
                        h && o.animations.push(h.Parse(u))
                    }
                return o
            }, t.CreateFromBase64String = function(e, i, n, r, o, s, a, u, h) {
                return void 0 === s && (s = t.TRILINEAR_SAMPLINGMODE), void 0 === a && (a = null), void 0 === u && (u = null), void 0 === h && (h = k.TEXTUREFORMAT_RGBA), new t("data:" + i, n, r, o, s, a, u, e, !1, h)
            }, t.LoadFromDataString = function(e, i, n, r, o, s, a, u, h, l) {
                return void 0 === r && (r = !1), void 0 === o && (o = !1), void 0 === s && (s = !0), void 0 === a && (a = t.TRILINEAR_SAMPLINGMODE), void 0 === u && (u = null), void 0 === h && (h = null), void 0 === l && (l = k.TEXTUREFORMAT_RGBA), "data:" !== e.substr(0, 5) && (e = "data:" + e), new t(e, n, o, s, a, u, h, i, r, l)
            }, t._CubeTextureParser = function(e, t, i) {
                throw X.WarnImport("CubeTexture")
            }, t._CreateMirror = function(e, t, i, n) {
                throw X.WarnImport("MirrorTexture")
            }, t._CreateRenderTargetTexture = function(e, t, i, n) {
                throw X.WarnImport("RenderTargetTexture")
            }, t.NEAREST_SAMPLINGMODE = k.TEXTURE_NEAREST_SAMPLINGMODE, t.NEAREST_NEAREST_MIPLINEAR = k.TEXTURE_NEAREST_NEAREST_MIPLINEAR, t.BILINEAR_SAMPLINGMODE = k.TEXTURE_BILINEAR_SAMPLINGMODE, t.LINEAR_LINEAR_MIPNEAREST = k.TEXTURE_LINEAR_LINEAR_MIPNEAREST, t.TRILINEAR_SAMPLINGMODE = k.TEXTURE_TRILINEAR_SAMPLINGMODE, t.LINEAR_LINEAR_MIPLINEAR = k.TEXTURE_LINEAR_LINEAR_MIPLINEAR, t.NEAREST_NEAREST_MIPNEAREST = k.TEXTURE_NEAREST_NEAREST_MIPNEAREST, t.NEAREST_LINEAR_MIPNEAREST = k.TEXTURE_NEAREST_LINEAR_MIPNEAREST, t.NEAREST_LINEAR_MIPLINEAR = k.TEXTURE_NEAREST_LINEAR_MIPLINEAR, t.NEAREST_LINEAR = k.TEXTURE_NEAREST_LINEAR, t.NEAREST_NEAREST = k.TEXTURE_NEAREST_NEAREST, t.LINEAR_NEAREST_MIPNEAREST = k.TEXTURE_LINEAR_NEAREST_MIPNEAREST, t.LINEAR_NEAREST_MIPLINEAR = k.TEXTURE_LINEAR_NEAREST_MIPLINEAR, t.LINEAR_LINEAR = k.TEXTURE_LINEAR_LINEAR, t.LINEAR_NEAREST = k.TEXTURE_LINEAR_NEAREST, t.EXPLICIT_MODE = k.TEXTURE_EXPLICIT_MODE, t.SPHERICAL_MODE = k.TEXTURE_SPHERICAL_MODE, t.PLANAR_MODE = k.TEXTURE_PLANAR_MODE, t.CUBIC_MODE = k.TEXTURE_CUBIC_MODE, t.PROJECTION_MODE = k.TEXTURE_PROJECTION_MODE, t.SKYBOX_MODE = k.TEXTURE_SKYBOX_MODE, t.INVCUBIC_MODE = k.TEXTURE_INVCUBIC_MODE, t.EQUIRECTANGULAR_MODE = k.TEXTURE_EQUIRECTANGULAR_MODE, t.FIXED_EQUIRECTANGULAR_MODE = k.TEXTURE_FIXED_EQUIRECTANGULAR_MODE, t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE = k.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE, t.CLAMP_ADDRESSMODE = k.TEXTURE_CLAMP_ADDRESSMODE, t.WRAP_ADDRESSMODE = k.TEXTURE_WRAP_ADDRESSMODE, t.MIRROR_ADDRESSMODE = k.TEXTURE_MIRROR_ADDRESSMODE, t.UseSerializedUrlIfAny = !1, s([ce()], t.prototype, "url", void 0), s([ce()], t.prototype, "uOffset", void 0), s([ce()], t.prototype, "vOffset", void 0), s([ce()], t.prototype, "uScale", void 0), s([ce()], t.prototype, "vScale", void 0), s([ce()], t.prototype, "uAng", void 0), s([ce()], t.prototype, "vAng", void 0), s([ce()], t.prototype, "wAng", void 0), s([ce()], t.prototype, "uRotationCenter", void 0), s([ce()], t.prototype, "vRotationCenter", void 0), s([ce()], t.prototype, "wRotationCenter", void 0), s([ce()], t.prototype, "isBlocking", null), t
        }(Mi);
    me._TextureParser = Ri.Parse;
    var xi = function() {
            function e() {}
            return e.BindEyePosition = function(e, t) {
                if (t._forcedViewPosition) e.setVector3("vEyePosition", t._forcedViewPosition);
                else {
                    var i = t.activeCamera.globalPosition;
                    i || (i = t.activeCamera.devicePosition), e.setVector3("vEyePosition", t._mirroredCameraPosition ? t._mirroredCameraPosition : i)
                }
            }, e.PrepareDefinesForMergedUV = function(e, t, i) {
                t._needUVs = !0, t[i] = !0, e.getTextureMatrix().isIdentityAs3x2() ? (t[i + "DIRECTUV"] = e.coordinatesIndex + 1, 0 === e.coordinatesIndex ? t.MAINUV1 = !0 : t.MAINUV2 = !0) : t[i + "DIRECTUV"] = 0
            }, e.BindTextureMatrix = function(e, t, i) {
                var n = e.getTextureMatrix();
                n.isIdentityAs3x2() || t.updateMatrix(i + "Matrix", n)
            }, e.PrepareDefinesForMisc = function(e, t, i, n, r, o, s) {
                s._areMiscDirty && (s.LOGARITHMICDEPTH = i, s.POINTSIZE = n, s.FOG = t.fogEnabled && e.applyFog && t.fogMode !== Et.FOGMODE_NONE && r, s.NONUNIFORMSCALING = e.nonUniformScaling, s.ALPHATEST = o)
            }, e.PrepareDefinesForFrameBoundValues = function(e, t, i, n, r) {
                void 0 === r && (r = null);
                var o, s, a, u, h = !1;
                o = null == r ? void 0 !== e.clipPlane && null !== e.clipPlane : r, s = null == r ? void 0 !== e.clipPlane2 && null !== e.clipPlane2 : r, a = null == r ? void 0 !== e.clipPlane3 && null !== e.clipPlane3 : r, u = null == r ? void 0 !== e.clipPlane4 && null !== e.clipPlane4 : r, i.CLIPPLANE !== o && (i.CLIPPLANE = o, h = !0), i.CLIPPLANE2 !== s && (i.CLIPPLANE2 = s, h = !0), i.CLIPPLANE3 !== a && (i.CLIPPLANE3 = a, h = !0), i.CLIPPLANE4 !== u && (i.CLIPPLANE4 = u, h = !0), i.DEPTHPREPASS !== !t.getColorWrite() && (i.DEPTHPREPASS = !i.DEPTHPREPASS, h = !0), i.INSTANCES !== n && (i.INSTANCES = n, h = !0), h && i.markAsUnprocessed()
            }, e.PrepareDefinesForAttributes = function(e, t, i, n, r, o) {
                if (void 0 === r && (r = !1), void 0 === o && (o = !0), !t._areAttributesDirty && t._needNormals === t._normals && t._needUVs === t._uvs) return !1;
                if (t._normals = t._needNormals, t._uvs = t._needUVs, t.NORMAL = t._needNormals && e.isVerticesDataPresent(Te.NormalKind), t._needNormals && e.isVerticesDataPresent(Te.TangentKind) && (t.TANGENT = !0), t._needUVs ? (t.UV1 = e.isVerticesDataPresent(Te.UVKind), t.UV2 = e.isVerticesDataPresent(Te.UV2Kind)) : (t.UV1 = !1, t.UV2 = !1), i) {
                    var s = e.useVertexColors && e.isVerticesDataPresent(Te.ColorKind);
                    t.VERTEXCOLOR = s, t.VERTEXALPHA = e.hasVertexAlpha && s && o
                }
                if (n)
                    if (e.useBones && e.computeBonesUsingShaders && e.skeleton) {
                        t.NUM_BONE_INFLUENCERS = e.numBoneInfluencers;
                        var a = void 0 !== t.BONETEXTURE;
                        e.skeleton.isUsingTextureForMatrices && a ? t.BONETEXTURE = !0 : (t.BonesPerMesh = e.skeleton.bones.length + 1, t.BONETEXTURE = !a && void 0)
                    } else t.NUM_BONE_INFLUENCERS = 0, t.BonesPerMesh = 0;
                if (r) {
                    var u = e.morphTargetManager;
                    u ? (t.MORPHTARGETS_TANGENT = u.supportsTangents && t.TANGENT, t.MORPHTARGETS_NORMAL = u.supportsNormals && t.NORMAL, t.MORPHTARGETS = u.numInfluencers > 0, t.NUM_MORPH_INFLUENCERS = u.numInfluencers) : (t.MORPHTARGETS_TANGENT = !1, t.MORPHTARGETS_NORMAL = !1, t.MORPHTARGETS = !1, t.NUM_MORPH_INFLUENCERS = 0)
                }
                return !0
            }, e.PrepareDefinesForMultiview = function(e, t) {
                if (e.activeCamera) {
                    var i = t.MULTIVIEW;
                    t.MULTIVIEW = null !== e.activeCamera.outputRenderTarget && e.activeCamera.outputRenderTarget.getViewCount() > 1, t.MULTIVIEW != i && t.markAsUnprocessed()
                }
            }, e.PrepareDefinesForLights = function(e, t, i, n, r, o) {
                if (void 0 === r && (r = 4), void 0 === o && (o = !1), !i._areLightsDirty) return i._needNormals;
                var s = 0,
                    a = !1,
                    u = !1,
                    h = !1,
                    l = !1,
                    c = !1;
                if (e.lightsEnabled && !o)
                    for (var d = 0, f = t.lightSources; d < f.length; d++) {
                        var p = f[d];
                        switch (a = !0, void 0 === i["LIGHT" + s] && (u = !0), i["LIGHT" + s] = !0, i["SPOTLIGHT" + s] = !1, i["HEMILIGHT" + s] = !1, i["POINTLIGHT" + s] = !1, i["DIRLIGHT" + s] = !1, p.prepareLightSpecificDefines(i, s), i["LIGHT_FALLOFF_PHYSICAL" + s] = !1, i["LIGHT_FALLOFF_GLTF" + s] = !1, i["LIGHT_FALLOFF_STANDARD" + s] = !1, p.falloffType) {
                            case rt.FALLOFF_GLTF:
                                i["LIGHT_FALLOFF_GLTF" + s] = !0;
                                break;
                            case rt.FALLOFF_PHYSICAL:
                                i["LIGHT_FALLOFF_PHYSICAL" + s] = !0;
                                break;
                            case rt.FALLOFF_STANDARD:
                                i["LIGHT_FALLOFF_STANDARD" + s] = !0
                        }
                        if (n && !p.specular.equalsFloats(0, 0, 0) && (c = !0), i["SHADOW" + s] = !1, i["SHADOWPCF" + s] = !1, i["SHADOWPCSS" + s] = !1, i["SHADOWPOISSON" + s] = !1, i["SHADOWESM" + s] = !1, i["SHADOWCUBE" + s] = !1, i["SHADOWLOWQUALITY" + s] = !1, i["SHADOWMEDIUMQUALITY" + s] = !1, t && t.receiveShadows && e.shadowsEnabled && p.shadowEnabled) {
                            var _ = p.getShadowGenerator();
                            if (_) {
                                var g = _.getShadowMap();
                                g && g.renderList && g.renderList.length > 0 && (l = !0, _.prepareDefines(i, s))
                            }
                        }
                        if (p.lightmapMode != rt.LIGHTMAP_DEFAULT ? (h = !0, i["LIGHTMAPEXCLUDED" + s] = !0, i["LIGHTMAPNOSPECULAR" + s] = p.lightmapMode == rt.LIGHTMAP_SHADOWSONLY) : (i["LIGHTMAPEXCLUDED" + s] = !1, i["LIGHTMAPNOSPECULAR" + s] = !1), ++s === r) break
                    }
                i.SPECULARTERM = c, i.SHADOWS = l;
                for (var m = s; m < r; m++) void 0 !== i["LIGHT" + m] && (i["LIGHT" + m] = !1, i["HEMILIGHT" + m] = !1, i["POINTLIGHT" + m] = !1, i["DIRLIGHT" + m] = !1, i["SPOTLIGHT" + m] = !1, i["SHADOW" + m] = !1, i["SHADOWPCF" + m] = !1, i["SHADOWPCSS" + m] = !1, i["SHADOWPOISSON" + m] = !1, i["SHADOWESM" + m] = !1, i["SHADOWCUBE" + m] = !1, i["SHADOWLOWQUALITY" + m] = !1, i["SHADOWMEDIUMQUALITY" + m] = !1);
                var v = e.getEngine().getCaps();
                return void 0 === i.SHADOWFLOAT && (u = !0), i.SHADOWFLOAT = l && (v.textureFloatRender && v.textureFloatLinearFiltering || v.textureHalfFloatRender && v.textureHalfFloatLinearFiltering), i.LIGHTMAPEXCLUDED = h, u && i.rebuild(), a
            }, e.PrepareUniformsAndSamplersList = function(e, t, i, n) {
                var r;
                void 0 === n && (n = 4);
                var o = null;
                if (e.uniformsNames) {
                    var s = e;
                    r = s.uniformsNames, o = s.uniformBuffersNames, t = s.samplers, i = s.defines, n = s.maxSimultaneousLights
                } else r = e, t || (t = []);
                for (var a = 0; a < n && i["LIGHT" + a]; a++) r.push("vLightData" + a, "vLightDiffuse" + a, "vLightSpecular" + a, "vLightDirection" + a, "vLightFalloff" + a, "vLightGround" + a, "lightMatrix" + a, "shadowsInfo" + a, "depthValues" + a), o && o.push("Light" + a), t.push("shadowSampler" + a), t.push("depthSampler" + a), i["PROJECTEDLIGHTTEXTURE" + a] && (t.push("projectionLightSampler" + a), r.push("textureProjectionMatrix" + a));
                i.NUM_MORPH_INFLUENCERS && r.push("morphTargetInfluences")
            }, e.HandleFallbacksForShadows = function(e, t, i, n) {
                void 0 === i && (i = 4), void 0 === n && (n = 0);
                for (var r = 0, o = 0; o < i && e["LIGHT" + o]; o++) o > 0 && (r = n + o, t.addFallback(r, "LIGHT" + o)), e.SHADOWS || (e["SHADOW" + o] && t.addFallback(n, "SHADOW" + o), e["SHADOWPCF" + o] && t.addFallback(n, "SHADOWPCF" + o), e["SHADOWPCSS" + o] && t.addFallback(n, "SHADOWPCSS" + o), e["SHADOWPOISSON" + o] && t.addFallback(n, "SHADOWPOISSON" + o), e["SHADOWESM" + o] && t.addFallback(n, "SHADOWESM" + o));
                return r++
            }, e.PrepareAttributesForMorphTargets = function(e, t, i) {
                var n = i.NUM_MORPH_INFLUENCERS;
                if (n > 0 && ve.LastCreatedEngine)
                    for (var r = ve.LastCreatedEngine.getCaps().maxVertexAttribs, o = t.morphTargetManager, s = o && o.supportsNormals && i.NORMAL, a = o && o.supportsTangents && i.TANGENT, u = 0; u < n; u++) e.push(Te.PositionKind + u), s && e.push(Te.NormalKind + u), a && e.push(Te.TangentKind + u), e.length > r && V.Error("Cannot add more vertex attributes for mesh " + t.name)
            }, e.PrepareAttributesForBones = function(e, t, i, n) {
                i.NUM_BONE_INFLUENCERS > 0 && (n.addCPUSkinningFallback(0, t), e.push(Te.MatricesIndicesKind), e.push(Te.MatricesWeightsKind), i.NUM_BONE_INFLUENCERS > 4 && (e.push(Te.MatricesIndicesExtraKind), e.push(Te.MatricesWeightsExtraKind)))
            }, e.PrepareAttributesForInstances = function(e, t) {
                t.INSTANCES && (e.push("world0"), e.push("world1"), e.push("world2"), e.push("world3"))
            }, e.BindLightShadow = function(e, t, i, n) {
                if (e.shadowEnabled && t.receiveShadows) {
                    var r = e.getShadowGenerator();
                    r && r.bindShadowLight(i, n)
                }
            }, e.BindLightProperties = function(e, t, i) {
                e.transferToEffect(t, i + "")
            }, e.BindLights = function(t, i, n, r, o, s) {
                void 0 === o && (o = 4), void 0 === s && (s = !1);
                for (var a = Math.min(i.lightSources.length, o), u = 0; u < a; u++) {
                    var h = i.lightSources[u],
                        l = u.toString(),
                        c = h.getScaledIntensity();
                    h._uniformBuffer.bindToEffect(n, "Light" + u), e.BindLightProperties(h, n, u), h.diffuse.scaleToRef(c, N.Color3[0]), h._uniformBuffer.updateColor4("vLightDiffuse", N.Color3[0], s ? h.radius : h.range, l), r.SPECULARTERM && (h.specular.scaleToRef(c, N.Color3[1]), h._uniformBuffer.updateColor3("vLightSpecular", N.Color3[1], l)), t.shadowsEnabled && this.BindLightShadow(h, i, l, n), h._uniformBuffer.update()
                }
            }, e.BindFogParameters = function(e, t, i, n) {
                void 0 === n && (n = !1), e.fogEnabled && t.applyFog && e.fogMode !== Et.FOGMODE_NONE && (i.setFloat4("vFogInfos", e.fogMode, e.fogStart, e.fogEnd, e.fogDensity), n ? (e.fogColor.toLinearSpaceToRef(this._tempFogColor), i.setColor3("vFogColor", this._tempFogColor)) : i.setColor3("vFogColor", e.fogColor))
            }, e.BindBonesParameters = function(e, t) {
                if (t && e && (e.computeBonesUsingShaders && t._bonesComputationForcedToCPU && (e.computeBonesUsingShaders = !1), e.useBones && e.computeBonesUsingShaders && e.skeleton)) {
                    var i = e.skeleton;
                    if (i.isUsingTextureForMatrices && t.getUniformIndex("boneTextureWidth") > -1) {
                        var n = i.getTransformMatrixTexture();
                        t.setTexture("boneSampler", n), t.setFloat("boneTextureWidth", 4 * (i.bones.length + 1))
                    } else {
                        var r = i.getTransformMatrices(e);
                        r && t.setMatrices("mBones", r)
                    }
                }
            }, e.BindMorphTargetParameters = function(e, t) {
                var i = e.morphTargetManager;
                e && i && t.setFloatArray("morphTargetInfluences", i.influences)
            }, e.BindLogDepth = function(e, t, i) {
                e.LOGARITHMICDEPTH && t.setFloat("logarithmicDepthConstant", 2 / (Math.log(i.activeCamera.maxZ + 1) / Math.LN2))
            }, e.BindClipPlane = function(e, t) {
                if (t.clipPlane) {
                    var i = t.clipPlane;
                    e.setFloat4("vClipPlane", i.normal.x, i.normal.y, i.normal.z, i.d)
                }
                if (t.clipPlane2) {
                    i = t.clipPlane2;
                    e.setFloat4("vClipPlane2", i.normal.x, i.normal.y, i.normal.z, i.d)
                }
                if (t.clipPlane3) {
                    i = t.clipPlane3;
                    e.setFloat4("vClipPlane3", i.normal.x, i.normal.y, i.normal.z, i.d)
                }
                if (t.clipPlane4) {
                    i = t.clipPlane4;
                    e.setFloat4("vClipPlane4", i.normal.x, i.normal.y, i.normal.z, i.d)
                }
            }, e._tempFogColor = v.Black(), e
        }(),
        Pi = function(e) {
            function t(t, i, n, r) {
                void 0 === r && (r = {});
                var s = e.call(this, t, i) || this;
                return s._textures = {}, s._textureArrays = {}, s._floats = {}, s._ints = {}, s._floatsArrays = {}, s._colors3 = {}, s._colors3Arrays = {}, s._colors4 = {}, s._vectors2 = {}, s._vectors3 = {}, s._vectors4 = {}, s._matrices = {}, s._matrices3x3 = {}, s._matrices2x2 = {}, s._vectors2Arrays = {}, s._vectors3Arrays = {}, s._cachedWorldViewMatrix = new R, s._shaderPath = n, s._options = o({
                    needAlphaBlending: !1,
                    needAlphaTesting: !1,
                    attributes: ["position", "normal", "uv"],
                    uniforms: ["worldViewProjection"],
                    uniformBuffers: [],
                    samplers: [],
                    defines: []
                }, r), s
            }
            return r(t, e), Object.defineProperty(t.prototype, "options", {
                get: function() {
                    return this._options
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getClassName = function() {
                return "ShaderMaterial"
            }, t.prototype.needAlphaBlending = function() {
                return this.alpha < 1 || this._options.needAlphaBlending
            }, t.prototype.needAlphaTesting = function() {
                return this._options.needAlphaTesting
            }, t.prototype._checkUniform = function(e) {
                -1 === this._options.uniforms.indexOf(e) && this._options.uniforms.push(e)
            }, t.prototype.setTexture = function(e, t) {
                return -1 === this._options.samplers.indexOf(e) && this._options.samplers.push(e), this._textures[e] = t, this
            }, t.prototype.setTextureArray = function(e, t) {
                return -1 === this._options.samplers.indexOf(e) && this._options.samplers.push(e), this._checkUniform(e), this._textureArrays[e] = t, this
            }, t.prototype.setFloat = function(e, t) {
                return this._checkUniform(e), this._floats[e] = t, this
            }, t.prototype.setInt = function(e, t) {
                return this._checkUniform(e), this._ints[e] = t, this
            }, t.prototype.setFloats = function(e, t) {
                return this._checkUniform(e), this._floatsArrays[e] = t, this
            }, t.prototype.setColor3 = function(e, t) {
                return this._checkUniform(e), this._colors3[e] = t, this
            }, t.prototype.setColor3Array = function(e, t) {
                return this._checkUniform(e), this._colors3Arrays[e] = t.reduce((function(e, t) {
                    return t.toArray(e, e.length), e
                }), []), this
            }, t.prototype.setColor4 = function(e, t) {
                return this._checkUniform(e), this._colors4[e] = t, this
            }, t.prototype.setVector2 = function(e, t) {
                return this._checkUniform(e), this._vectors2[e] = t, this
            }, t.prototype.setVector3 = function(e, t) {
                return this._checkUniform(e), this._vectors3[e] = t, this
            }, t.prototype.setVector4 = function(e, t) {
                return this._checkUniform(e), this._vectors4[e] = t, this
            }, t.prototype.setMatrix = function(e, t) {
                return this._checkUniform(e), this._matrices[e] = t, this
            }, t.prototype.setMatrix3x3 = function(e, t) {
                return this._checkUniform(e), this._matrices3x3[e] = t, this
            }, t.prototype.setMatrix2x2 = function(e, t) {
                return this._checkUniform(e), this._matrices2x2[e] = t, this
            }, t.prototype.setArray2 = function(e, t) {
                return this._checkUniform(e), this._vectors2Arrays[e] = t, this
            }, t.prototype.setArray3 = function(e, t) {
                return this._checkUniform(e), this._vectors3Arrays[e] = t, this
            }, t.prototype._checkCache = function(e, t) {
                return !e || (this._effect && this._effect.defines.indexOf("#define INSTANCES"), !1)
            }, t.prototype.isReadyForSubMesh = function(e, t, i) {
                return this.isReady(e, i)
            }, t.prototype.isReady = function(e, t) {
                var i = this.getScene(),
                    n = i.getEngine();
                if (!this.checkReadyOnEveryCall && this._renderId === i.getRenderId() && this._checkCache(e, t)) return !0;
                for (var r = [], o = [], s = new te, a = 0; a < this._options.defines.length; a++) r.push(this._options.defines[a]);
                for (a = 0; a < this._options.attributes.length; a++) o.push(this._options.attributes[a]);
                if (e && e.isVerticesDataPresent(Te.ColorKind) && (o.push(Te.ColorKind), r.push("#define VERTEXCOLOR")), t && (r.push("#define INSTANCES"), xi.PrepareAttributesForInstances(o, r)), e && e.useBones && e.computeBonesUsingShaders && e.skeleton) {
                    o.push(Te.MatricesIndicesKind), o.push(Te.MatricesWeightsKind), e.numBoneInfluencers > 4 && (o.push(Te.MatricesIndicesExtraKind), o.push(Te.MatricesWeightsExtraKind));
                    var u = e.skeleton;
                    r.push("#define NUM_BONE_INFLUENCERS " + e.numBoneInfluencers), s.addCPUSkinningFallback(0, e), u.isUsingTextureForMatrices ? (r.push("#define BONETEXTURE"), -1 === this._options.uniforms.indexOf("boneTextureWidth") && this._options.uniforms.push("boneTextureWidth"), -1 === this._options.samplers.indexOf("boneSampler") && this._options.samplers.push("boneSampler")) : (r.push("#define BonesPerMesh " + (u.bones.length + 1)), -1 === this._options.uniforms.indexOf("mBones") && this._options.uniforms.push("mBones"))
                } else r.push("#define NUM_BONE_INFLUENCERS 0");
                for (var h in this._textures)
                    if (!this._textures[h].isReady()) return !1;
                e && this._shouldTurnAlphaTestOn(e) && r.push("#define ALPHATEST");
                var l = this._effect,
                    c = r.join("\n");
                return this._effect = n.createEffect(this._shaderPath, {
                    attributes: o,
                    uniformsNames: this._options.uniforms,
                    uniformBuffersNames: this._options.uniformBuffers,
                    samplers: this._options.samplers,
                    defines: c,
                    fallbacks: s,
                    onCompiled: this.onCompiled,
                    onError: this.onError
                }, n), !!this._effect.isReady() && (l !== this._effect && i.resetCachedMaterial(), this._renderId = i.getRenderId(), !0)
            }, t.prototype.bindOnlyWorldMatrix = function(e) {
                var t = this.getScene();
                this._effect && (-1 !== this._options.uniforms.indexOf("world") && this._effect.setMatrix("world", e), -1 !== this._options.uniforms.indexOf("worldView") && (e.multiplyToRef(t.getViewMatrix(), this._cachedWorldViewMatrix), this._effect.setMatrix("worldView", this._cachedWorldViewMatrix)), -1 !== this._options.uniforms.indexOf("worldViewProjection") && this._effect.setMatrix("worldViewProjection", e.multiply(t.getTransformMatrix())))
            }, t.prototype.bind = function(e, t) {
                if (this.bindOnlyWorldMatrix(e), this._effect && this.getScene().getCachedMaterial() !== this) {
                    var i;
                    for (i in -1 !== this._options.uniforms.indexOf("view") && this._effect.setMatrix("view", this.getScene().getViewMatrix()), -1 !== this._options.uniforms.indexOf("projection") && this._effect.setMatrix("projection", this.getScene().getProjectionMatrix()), -1 !== this._options.uniforms.indexOf("viewProjection") && this._effect.setMatrix("viewProjection", this.getScene().getTransformMatrix()), xi.BindBonesParameters(t, this._effect), this._textures) this._effect.setTexture(i, this._textures[i]);
                    for (i in this._textureArrays) this._effect.setTextureArray(i, this._textureArrays[i]);
                    for (i in this._ints) this._effect.setInt(i, this._ints[i]);
                    for (i in this._floats) this._effect.setFloat(i, this._floats[i]);
                    for (i in this._floatsArrays) this._effect.setArray(i, this._floatsArrays[i]);
                    for (i in this._colors3) this._effect.setColor3(i, this._colors3[i]);
                    for (i in this._colors3Arrays) this._effect.setArray3(i, this._colors3Arrays[i]);
                    for (i in this._colors4) {
                        var n = this._colors4[i];
                        this._effect.setFloat4(i, n.r, n.g, n.b, n.a)
                    }
                    for (i in this._vectors2) this._effect.setVector2(i, this._vectors2[i]);
                    for (i in this._vectors3) this._effect.setVector3(i, this._vectors3[i]);
                    for (i in this._vectors4) this._effect.setVector4(i, this._vectors4[i]);
                    for (i in this._matrices) this._effect.setMatrix(i, this._matrices[i]);
                    for (i in this._matrices3x3) this._effect.setMatrix3x3(i, this._matrices3x3[i]);
                    for (i in this._matrices2x2) this._effect.setMatrix2x2(i, this._matrices2x2[i]);
                    for (i in this._vectors2Arrays) this._effect.setArray2(i, this._vectors2Arrays[i]);
                    for (i in this._vectors3Arrays) this._effect.setArray3(i, this._vectors3Arrays[i])
                }
                this._afterBind(t)
            }, t.prototype.getActiveTextures = function() {
                var t = e.prototype.getActiveTextures.call(this);
                for (var i in this._textures) t.push(this._textures[i]);
                for (var i in this._textureArrays)
                    for (var n = this._textureArrays[i], r = 0; r < n.length; r++) t.push(n[r]);
                return t
            }, t.prototype.hasTexture = function(t) {
                if (e.prototype.hasTexture.call(this, t)) return !0;
                for (var i in this._textures)
                    if (this._textures[i] === t) return !0;
                for (var i in this._textureArrays)
                    for (var n = this._textureArrays[i], r = 0; r < n.length; r++)
                        if (n[r] === t) return !0;
                return !1
            }, t.prototype.clone = function(e) {
                return new t(e, this.getScene(), this._shaderPath, this._options)
            }, t.prototype.dispose = function(t, i, n) {
                if (i) {
                    var r;
                    for (r in this._textures) this._textures[r].dispose();
                    for (r in this._textureArrays)
                        for (var o = this._textureArrays[r], s = 0; s < o.length; s++) o[s].dispose()
                }
                this._textures = {}, e.prototype.dispose.call(this, t, i, n)
            }, t.prototype.serialize = function() {
                var e, t = me.Serialize(this);
                for (e in t.customType = "BABYLON.ShaderMaterial", t.options = this._options, t.shaderPath = this._shaderPath, t.textures = {}, this._textures) t.textures[e] = this._textures[e].serialize();
                for (e in t.textureArrays = {}, this._textureArrays) {
                    t.textureArrays[e] = [];
                    for (var i = this._textureArrays[e], n = 0; n < i.length; n++) t.textureArrays[e].push(i[n].serialize())
                }
                for (e in t.floats = {}, this._floats) t.floats[e] = this._floats[e];
                for (e in t.FloatArrays = {}, this._floatsArrays) t.FloatArrays[e] = this._floatsArrays[e];
                for (e in t.colors3 = {}, this._colors3) t.colors3[e] = this._colors3[e].asArray();
                for (e in t.colors3Arrays = {}, this._colors3Arrays) t.colors3Arrays[e] = this._colors3Arrays[e];
                for (e in t.colors4 = {}, this._colors4) t.colors4[e] = this._colors4[e].asArray();
                for (e in t.vectors2 = {}, this._vectors2) t.vectors2[e] = this._vectors2[e].asArray();
                for (e in t.vectors3 = {}, this._vectors3) t.vectors3[e] = this._vectors3[e].asArray();
                for (e in t.vectors4 = {}, this._vectors4) t.vectors4[e] = this._vectors4[e].asArray();
                for (e in t.matrices = {}, this._matrices) t.matrices[e] = this._matrices[e].asArray();
                for (e in t.matrices3x3 = {}, this._matrices3x3) t.matrices3x3[e] = this._matrices3x3[e];
                for (e in t.matrices2x2 = {}, this._matrices2x2) t.matrices2x2[e] = this._matrices2x2[e];
                for (e in t.vectors2Arrays = {}, this._vectors2Arrays) t.vectors2Arrays[e] = this._vectors2Arrays[e];
                for (e in t.vectors3Arrays = {}, this._vectors3Arrays) t.vectors3Arrays[e] = this._vectors3Arrays[e];
                return t
            }, t.Parse = function(e, i, n) {
                var r, o = me.Parse((function() {
                    return new t(e.name, i, e.shaderPath, e.options)
                }), e, i, n);
                for (r in e.textures) o.setTexture(r, Ri.Parse(e.textures[r], i, n));
                for (r in e.textureArrays) {
                    for (var s = e.textureArrays[r], a = new Array, u = 0; u < s.length; u++) a.push(Ri.Parse(s[u], i, n));
                    o.setTextureArray(r, a)
                }
                for (r in e.floats) o.setFloat(r, e.floats[r]);
                for (r in e.floatsArrays) o.setFloats(r, e.floatsArrays[r]);
                for (r in e.colors3) o.setColor3(r, v.FromArray(e.colors3[r]));
                for (r in e.colors3Arrays) {
                    var h = e.colors3Arrays[r].reduce((function(e, t, i) {
                        return i % 3 == 0 ? e.push([t]) : e[e.length - 1].push(t), e
                    }), []).map((function(e) {
                        return v.FromArray(e)
                    }));
                    o.setColor3Array(r, h)
                }
                for (r in e.colors4) o.setColor4(r, y.FromArray(e.colors4[r]));
                for (r in e.vectors2) o.setVector2(r, T.FromArray(e.vectors2[r]));
                for (r in e.vectors3) o.setVector3(r, b.FromArray(e.vectors3[r]));
                for (r in e.vectors4) o.setVector4(r, E.FromArray(e.vectors4[r]));
                for (r in e.matrices) o.setMatrix(r, R.FromArray(e.matrices[r]));
                for (r in e.matrices3x3) o.setMatrix3x3(r, e.matrices3x3[r]);
                for (r in e.matrices2x2) o.setMatrix2x2(r, e.matrices2x2[r]);
                for (r in e.vectors2Arrays) o.setArray2(r, e.vectors2Arrays[r]);
                for (r in e.vectors3Arrays) o.setArray3(r, e.vectors3Arrays[r]);
                return o
            }, t
        }(De);
    G.RegisteredTypes["BABYLON.ShaderMaterial"] = Pi;
    var Ii = function() {
        function e(e, t, i) {
            void 0 === i && (i = Number.MAX_VALUE), this.origin = e, this.direction = t, this.length = i
        }
        return e.prototype.intersectsBoxMinMax = function(t, i, n) {
            void 0 === n && (n = 0);
            var r, o, s, a, u = e.TmpVector3[0].copyFromFloats(t.x - n, t.y - n, t.z - n),
                h = e.TmpVector3[1].copyFromFloats(i.x + n, i.y + n, i.z + n),
                l = 0,
                c = Number.MAX_VALUE;
            if (Math.abs(this.direction.x) < 1e-7) {
                if (this.origin.x < u.x || this.origin.x > h.x) return !1
            } else if (r = 1 / this.direction.x, o = (u.x - this.origin.x) * r, (s = (h.x - this.origin.x) * r) === -1 / 0 && (s = 1 / 0), o > s && (a = o, o = s, s = a), (l = Math.max(o, l)) > (c = Math.min(s, c))) return !1;
            if (Math.abs(this.direction.y) < 1e-7) {
                if (this.origin.y < u.y || this.origin.y > h.y) return !1
            } else if (r = 1 / this.direction.y, o = (u.y - this.origin.y) * r, (s = (h.y - this.origin.y) * r) === -1 / 0 && (s = 1 / 0), o > s && (a = o, o = s, s = a), (l = Math.max(o, l)) > (c = Math.min(s, c))) return !1;
            if (Math.abs(this.direction.z) < 1e-7) {
                if (this.origin.z < u.z || this.origin.z > h.z) return !1
            } else if (r = 1 / this.direction.z, o = (u.z - this.origin.z) * r, (s = (h.z - this.origin.z) * r) === -1 / 0 && (s = 1 / 0), o > s && (a = o, o = s, s = a), (l = Math.max(o, l)) > (c = Math.min(s, c))) return !1;
            return !0
        }, e.prototype.intersectsBox = function(e, t) {
            return void 0 === t && (t = 0), this.intersectsBoxMinMax(e.minimum, e.maximum, t)
        }, e.prototype.intersectsSphere = function(e, t) {
            void 0 === t && (t = 0);
            var i = e.center.x - this.origin.x,
                n = e.center.y - this.origin.y,
                r = e.center.z - this.origin.z,
                o = i * i + n * n + r * r,
                s = e.radius + t,
                a = s * s;
            if (o <= a) return !0;
            var u = i * this.direction.x + n * this.direction.y + r * this.direction.z;
            return !(u < 0) && o - u * u <= a
        }, e.prototype.intersectsTriangle = function(t, i, n) {
            var r = e.TmpVector3[0],
                o = e.TmpVector3[1],
                s = e.TmpVector3[2],
                a = e.TmpVector3[3],
                u = e.TmpVector3[4];
            i.subtractToRef(t, r), n.subtractToRef(t, o), b.CrossToRef(this.direction, o, s);
            var h = b.Dot(r, s);
            if (0 === h) return null;
            var l = 1 / h;
            this.origin.subtractToRef(t, a);
            var c = b.Dot(a, s) * l;
            if (c < 0 || c > 1) return null;
            b.CrossToRef(a, r, u);
            var d = b.Dot(this.direction, u) * l;
            if (d < 0 || c + d > 1) return null;
            var f = b.Dot(o, u) * l;
            return f > this.length ? null : new be(c, d, f)
        }, e.prototype.intersectsPlane = function(e) {
            var t, i = b.Dot(e.normal, this.direction);
            if (Math.abs(i) < 9.99999997475243e-7) return null;
            var n = b.Dot(e.normal, this.origin);
            return (t = (-e.d - n) / i) < 0 ? t < -9.99999997475243e-7 ? null : 0 : t
        }, e.prototype.intersectsMesh = function(t, i) {
            var n = N.Matrix[0];
            return t.getWorldMatrix().invertToRef(n), this._tmpRay ? e.TransformToRef(this, n, this._tmpRay) : this._tmpRay = e.Transform(this, n), t.intersects(this._tmpRay, i)
        }, e.prototype.intersectsMeshes = function(e, t, i) {
            i ? i.length = 0 : i = [];
            for (var n = 0; n < e.length; n++) {
                var r = this.intersectsMesh(e[n], t);
                r.hit && i.push(r)
            }
            return i.sort(this._comparePickingInfo), i
        }, e.prototype._comparePickingInfo = function(e, t) {
            return e.distance < t.distance ? -1 : e.distance > t.distance ? 1 : 0
        }, e.prototype.intersectionSegment = function(t, i, n) {
            var r = this.origin,
                o = N.Vector3[0],
                s = N.Vector3[1],
                a = N.Vector3[2],
                u = N.Vector3[3];
            i.subtractToRef(t, o), this.direction.scaleToRef(e.rayl, a), r.addToRef(a, s), t.subtractToRef(r, u);
            var h, l, c, d, f = b.Dot(o, o),
                p = b.Dot(o, a),
                _ = b.Dot(a, a),
                g = b.Dot(o, u),
                m = b.Dot(a, u),
                v = f * _ - p * p,
                y = v,
                T = v;
            v < e.smallnum ? (l = 0, y = 1, d = m, T = _) : (d = f * m - p * g, (l = p * m - _ * g) < 0 ? (l = 0, d = m, T = _) : l > y && (l = y, d = m + p, T = _)), d < 0 ? (d = 0, -g < 0 ? l = 0 : -g > f ? l = y : (l = -g, y = f)) : d > T && (d = T, -g + p < 0 ? l = 0 : -g + p > f ? l = y : (l = -g + p, y = f)), h = Math.abs(l) < e.smallnum ? 0 : l / y, c = Math.abs(d) < e.smallnum ? 0 : d / T;
            var E = N.Vector3[4];
            a.scaleToRef(c, E);
            var A = N.Vector3[5];
            o.scaleToRef(h, A), A.addInPlace(u);
            var M = N.Vector3[6];
            return A.subtractToRef(E, M), c > 0 && c <= this.length && M.lengthSquared() < n * n ? A.length() : -1
        }, e.prototype.update = function(e, t, i, n, r, o, s) {
            return this.unprojectRayToRef(e, t, i, n, r, o, s), this
        }, e.Zero = function() {
            return new e(b.Zero(), b.Zero())
        }, e.CreateNew = function(t, i, n, r, o, s, a) {
            return e.Zero().update(t, i, n, r, o, s, a)
        }, e.CreateNewFromTo = function(t, i, n) {
            void 0 === n && (n = R.IdentityReadOnly);
            var r = i.subtract(t),
                o = Math.sqrt(r.x * r.x + r.y * r.y + r.z * r.z);
            return r.normalize(), e.Transform(new e(t, r, o), n)
        }, e.Transform = function(t, i) {
            var n = new e(new b(0, 0, 0), new b(0, 0, 0));
            return e.TransformToRef(t, i, n), n
        }, e.TransformToRef = function(e, t, i) {
            b.TransformCoordinatesToRef(e.origin, t, i.origin), b.TransformNormalToRef(e.direction, t, i.direction), i.length = e.length;
            var n = i.direction,
                r = n.length();
            if (0 !== r && 1 !== r) {
                var o = 1 / r;
                n.x *= o, n.y *= o, n.z *= o, i.length *= r
            }
        }, e.prototype.unprojectRayToRef = function(e, t, i, n, r, o, s) {
            var a = N.Matrix[0];
            r.multiplyToRef(o, a), a.multiplyToRef(s, a), a.invert();
            var u = N.Vector3[0];
            u.x = e / i * 2 - 1, u.y = -(t / n * 2 - 1), u.z = -1;
            var h = N.Vector3[1].copyFromFloats(u.x, u.y, 1),
                l = N.Vector3[2],
                c = N.Vector3[3];
            b._UnprojectFromInvertedMatrixToRef(u, a, l), b._UnprojectFromInvertedMatrixToRef(h, a, c), this.origin.copyFrom(l), c.subtractToRef(l, this.direction), this.direction.normalize()
        }, e.TmpVector3 = g.BuildArray(6, b.Zero), e.smallnum = 1e-8, e.rayl = 1e9, e
    }();
    Et.prototype.createPickingRay = function(e, t, i, n, r) {
        void 0 === r && (r = !1);
        var o = Ii.Zero();
        return this.createPickingRayToRef(e, t, i, o, n, r), o
    }, Et.prototype.createPickingRayToRef = function(e, t, i, n, r, o) {
        void 0 === o && (o = !1);
        var s = this.getEngine();
        if (!r) {
            if (!this.activeCamera) throw new Error("Active camera not set");
            r = this.activeCamera
        }
        var a = r.viewport.toGlobal(s.getRenderWidth(), s.getRenderHeight());
        return e = e / s.getHardwareScalingLevel() - a.x, t = t / s.getHardwareScalingLevel() - (s.getRenderHeight() - a.y - a.height), n.update(e, t, a.width, a.height, i || R.IdentityReadOnly, o ? R.IdentityReadOnly : r.getViewMatrix(), r.getProjectionMatrix()), this
    }, Et.prototype.createPickingRayInCameraSpace = function(e, t, i) {
        var n = Ii.Zero();
        return this.createPickingRayInCameraSpaceToRef(e, t, n, i), n
    }, Et.prototype.createPickingRayInCameraSpaceToRef = function(e, t, i, n) {
        if (!Ke) return this;
        var r = this.getEngine();
        if (!n) {
            if (!this.activeCamera) throw new Error("Active camera not set");
            n = this.activeCamera
        }
        var o = n.viewport.toGlobal(r.getRenderWidth(), r.getRenderHeight()),
            s = R.Identity();
        return e = e / r.getHardwareScalingLevel() - o.x, t = t / r.getHardwareScalingLevel() - (r.getRenderHeight() - o.y - o.height), i.update(e, t, o.width, o.height, s, s, n.getProjectionMatrix()), this
    }, Et.prototype._internalPick = function(e, t, i, n) {
        if (!Ke) return null;
        for (var r = null, o = 0; o < this.meshes.length; o++) {
            var s = this.meshes[o];
            if (t) {
                if (!t(s)) continue
            } else if (!s.isEnabled() || !s.isVisible || !s.isPickable) continue;
            var a = e(s.getWorldMatrix()),
                u = s.intersects(a, i, n);
            if (u && u.hit && ((i || null == r || !(u.distance >= r.distance)) && (r = u, i))) break
        }
        return r || new Ke
    }, Et.prototype._internalMultiPick = function(e, t, i) {
        if (!Ke) return null;
        for (var n = new Array, r = 0; r < this.meshes.length; r++) {
            var o = this.meshes[r];
            if (t) {
                if (!t(o)) continue
            } else if (!o.isEnabled() || !o.isVisible || !o.isPickable) continue;
            var s = e(o.getWorldMatrix()),
                a = o.intersects(s, !1, i);
            a && a.hit && n.push(a)
        }
        return n
    }, Et.prototype.pick = function(e, t, i, n, r, o) {
        var s = this;
        if (!Ke) return null;
        var a = this._internalPick((function(i) {
            return s._tempPickingRay || (s._tempPickingRay = Ii.Zero()), s.createPickingRayToRef(e, t, i, s._tempPickingRay, r || null), s._tempPickingRay
        }), i, n, o);
        return a && (a.ray = this.createPickingRay(e, t, R.Identity(), r || null)), a
    }, Et.prototype.pickWithRay = function(e, t, i, n) {
        var r = this,
            o = this._internalPick((function(t) {
                return r._pickWithRayInverseMatrix || (r._pickWithRayInverseMatrix = R.Identity()), t.invertToRef(r._pickWithRayInverseMatrix), r._cachedRayForTransform || (r._cachedRayForTransform = Ii.Zero()), Ii.TransformToRef(e, r._pickWithRayInverseMatrix, r._cachedRayForTransform), r._cachedRayForTransform
            }), t, i, n);
        return o && (o.ray = e), o
    }, Et.prototype.multiPick = function(e, t, i, n, r) {
        var o = this;
        return this._internalMultiPick((function(i) {
            return o.createPickingRay(e, t, i, n || null)
        }), i, r)
    }, Et.prototype.multiPickWithRay = function(e, t, i) {
        var n = this;
        return this._internalMultiPick((function(t) {
            return n._pickWithRayInverseMatrix || (n._pickWithRayInverseMatrix = R.Identity()), t.invertToRef(n._pickWithRayInverseMatrix), n._cachedRayForTransform || (n._cachedRayForTransform = Ii.Zero()), Ii.TransformToRef(e, n._pickWithRayInverseMatrix, n._cachedRayForTransform), n._cachedRayForTransform
        }), t, i)
    }, $e.prototype.getForwardRay = function(e, t, i) {
        void 0 === e && (e = 100), t || (t = this.getWorldMatrix()), i || (i = this.position);
        var n = this._scene.useRightHandedSystem ? new b(0, 0, -1) : new b(0, 0, 1),
            r = b.TransformNormal(n, t),
            o = b.Normalize(r);
        return new Ii(i, o, e)
    };
    var Ci = function(e) {
            function t(t, i) {
                var n = e.call(this, t, i) || this;
                return n._normalMatrix = new R, n.allowShaderHotSwapping = !0, n._storeEffectOnSubMeshes = !0, n
            }
            return r(t, e), t.prototype.getEffect = function() {
                return this._activeEffect
            }, t.prototype.isReady = function(e, t) {
                return !!e && (!e.subMeshes || 0 === e.subMeshes.length || this.isReadyForSubMesh(e, e.subMeshes[0], t))
            }, t.prototype.bindOnlyWorldMatrix = function(e) {
                this._activeEffect.setMatrix("world", e)
            }, t.prototype.bindOnlyNormalMatrix = function(e) {
                this._activeEffect.setMatrix("normalMatrix", e)
            }, t.prototype.bind = function(e, t) {
                t && this.bindForSubMesh(e, t, t.subMeshes[0])
            }, t.prototype._afterBind = function(t, i) {
                void 0 === i && (i = null), e.prototype._afterBind.call(this, t), this.getScene()._cachedEffect = i
            }, t.prototype._mustRebind = function(e, t, i) {
                return void 0 === i && (i = 1), e.isCachedMaterialInvalid(this, t, i)
            }, t
        }(De),
        Si = function() {
            function e() {}
            return Object.defineProperty(e, "DiffuseTextureEnabled", {
                get: function() {
                    return this._DiffuseTextureEnabled
                },
                set: function(e) {
                    this._DiffuseTextureEnabled !== e && (this._DiffuseTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "AmbientTextureEnabled", {
                get: function() {
                    return this._AmbientTextureEnabled
                },
                set: function(e) {
                    this._AmbientTextureEnabled !== e && (this._AmbientTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "OpacityTextureEnabled", {
                get: function() {
                    return this._OpacityTextureEnabled
                },
                set: function(e) {
                    this._OpacityTextureEnabled !== e && (this._OpacityTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ReflectionTextureEnabled", {
                get: function() {
                    return this._ReflectionTextureEnabled
                },
                set: function(e) {
                    this._ReflectionTextureEnabled !== e && (this._ReflectionTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "EmissiveTextureEnabled", {
                get: function() {
                    return this._EmissiveTextureEnabled
                },
                set: function(e) {
                    this._EmissiveTextureEnabled !== e && (this._EmissiveTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "SpecularTextureEnabled", {
                get: function() {
                    return this._SpecularTextureEnabled
                },
                set: function(e) {
                    this._SpecularTextureEnabled !== e && (this._SpecularTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "BumpTextureEnabled", {
                get: function() {
                    return this._BumpTextureEnabled
                },
                set: function(e) {
                    this._BumpTextureEnabled !== e && (this._BumpTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "LightmapTextureEnabled", {
                get: function() {
                    return this._LightmapTextureEnabled
                },
                set: function(e) {
                    this._LightmapTextureEnabled !== e && (this._LightmapTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "RefractionTextureEnabled", {
                get: function() {
                    return this._RefractionTextureEnabled
                },
                set: function(e) {
                    this._RefractionTextureEnabled !== e && (this._RefractionTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ColorGradingTextureEnabled", {
                get: function() {
                    return this._ColorGradingTextureEnabled
                },
                set: function(e) {
                    this._ColorGradingTextureEnabled !== e && (this._ColorGradingTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "FresnelEnabled", {
                get: function() {
                    return this._FresnelEnabled
                },
                set: function(e) {
                    this._FresnelEnabled !== e && (this._FresnelEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_FresnelDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ClearCoatTextureEnabled", {
                get: function() {
                    return this._ClearCoatTextureEnabled
                },
                set: function(e) {
                    this._ClearCoatTextureEnabled !== e && (this._ClearCoatTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ClearCoatBumpTextureEnabled", {
                get: function() {
                    return this._ClearCoatBumpTextureEnabled
                },
                set: function(e) {
                    this._ClearCoatBumpTextureEnabled !== e && (this._ClearCoatBumpTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ClearCoatTintTextureEnabled", {
                get: function() {
                    return this._ClearCoatTintTextureEnabled
                },
                set: function(e) {
                    this._ClearCoatTintTextureEnabled !== e && (this._ClearCoatTintTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "SheenTextureEnabled", {
                get: function() {
                    return this._SheenTextureEnabled
                },
                set: function(e) {
                    this._SheenTextureEnabled !== e && (this._SheenTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "AnisotropicTextureEnabled", {
                get: function() {
                    return this._AnisotropicTextureEnabled
                },
                set: function(e) {
                    this._AnisotropicTextureEnabled !== e && (this._AnisotropicTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ThicknessTextureEnabled", {
                get: function() {
                    return this._ThicknessTextureEnabled
                },
                set: function(e) {
                    this._ThicknessTextureEnabled !== e && (this._ThicknessTextureEnabled = e, ze.MarkAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag))
                },
                enumerable: !0,
                configurable: !0
            }), e._DiffuseTextureEnabled = !0, e._AmbientTextureEnabled = !0, e._OpacityTextureEnabled = !0, e._ReflectionTextureEnabled = !0, e._EmissiveTextureEnabled = !0, e._SpecularTextureEnabled = !0, e._BumpTextureEnabled = !0, e._LightmapTextureEnabled = !0, e._RefractionTextureEnabled = !0, e._ColorGradingTextureEnabled = !0, e._FresnelEnabled = !0, e._ClearCoatTextureEnabled = !0, e._ClearCoatBumpTextureEnabled = !0, e._ClearCoatTintTextureEnabled = !0, e._SheenTextureEnabled = !0, e._AnisotropicTextureEnabled = !0, e._ThicknessTextureEnabled = !0, e
        }(),
        Oi = "uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif";
    ie.IncludesShadersStore.defaultFragmentDeclaration = Oi;
    var Di = "layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nfloat visibility;\nvec4 vDiffuseColor;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};\n";
    ie.IncludesShadersStore.defaultUboDeclaration = Di;
    var wi = "const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}";
    ie.IncludesShadersStore.helperFunctions = wi;
    var Li = "#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif";
    ie.IncludesShadersStore.lightFragmentDeclaration = Li;
    var Fi = "#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif";
    ie.IncludesShadersStore.lightUboDeclaration = Fi;
    var Ni = "\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";
    ie.IncludesShadersStore.lightsFragmentFunctions = Ni;
    var Ui = "#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#endif\n#endif\n";
    ie.IncludesShadersStore.shadowsFragmentFunctions = Ui;
    var Bi = "#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif";
    ie.IncludesShadersStore.fresnelFunction = Bi;
    var ki = "#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\n#endif\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);\n\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);\n#endif\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vec3(reflectionMatrix*vec4(vPositionUVW,0));\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}";
    ie.IncludesShadersStore.reflectionFunction = ki;
    var Vi = "#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif";
    ie.IncludesShadersStore.imageProcessingDeclaration = Vi;
    var Gi = "#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}";
    ie.IncludesShadersStore.imageProcessingFunctions = Gi;
    var zi = "#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv,sampler2D textureSampler,float scale)\n{\nvec3 map=texture2D(textureSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nreturn perturbNormal(cotangentFrame,uv,bumpSampler,vBumpInfos.y);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nreturn cotangent_frame(normal,p,uv,vTangentSpaceParams);\n}\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif";
    ie.IncludesShadersStore.bumpFragmentFunctions = zi;
    var Wi = "#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif";
    ie.IncludesShadersStore.clipPlaneFragmentDeclaration = Wi;
    var Xi = "#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif";
    ie.IncludesShadersStore.logDepthDeclaration = Xi;
    var Hi = "#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif";
    ie.IncludesShadersStore.fogFragmentDeclaration = Hi;
    var ji = "#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif";
    ie.IncludesShadersStore.clipPlaneFragment = ji;
    var Yi = "vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif";
    ie.IncludesShadersStore.bumpFragment = Yi;
    var Ki = "#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif";
    ie.IncludesShadersStore.depthPrePass = Ki;
    var qi = "#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);\n#endif\n\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\n\npreInfo.roughness=sheenIntensity;\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef CLEARCOAT\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\n\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w*info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w*info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif";
    ie.IncludesShadersStore.lightFragment = qi;
    var Zi = "#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif";
    ie.IncludesShadersStore.logDepthFragment = Zi;
    var Qi = "#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif";
    ie.IncludesShadersStore.fogFragment = Qi;
    var Ji = "#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n";
    ie.ShadersStore.defaultPixelShader = Ji;
    var $i = "\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n";
    ie.IncludesShadersStore.defaultVertexDeclaration = $i;
    var en = "#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif";
    ie.IncludesShadersStore.bonesDeclaration = en;
    var tn = "#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif";
    ie.IncludesShadersStore.instancesDeclaration = tn;
    var nn = "#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n";
    ie.IncludesShadersStore.bumpVertexDeclaration = nn;
    var rn = "#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif";
    ie.IncludesShadersStore.clipPlaneVertexDeclaration = rn;
    ie.IncludesShadersStore.fogVertexDeclaration = "#ifdef FOG\nvarying vec3 vFogDistance;\n#endif";
    ie.IncludesShadersStore.morphTargetsVertexGlobalDeclaration = "#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif";
    var on = "#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif";
    ie.IncludesShadersStore.morphTargetsVertexDeclaration = on;
    var sn = "#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif";
    ie.IncludesShadersStore.morphTargetsVertex = sn;
    var an = "#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif";
    ie.IncludesShadersStore.instancesVertex = an;
    var un = "#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif";
    ie.IncludesShadersStore.bonesVertex = un;
    var hn = "#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif";
    ie.IncludesShadersStore.bumpVertex = hn;
    var ln = "#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif";
    ie.IncludesShadersStore.clipPlaneVertex = ln;
    var cn = "#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif";
    ie.IncludesShadersStore.fogVertex = cn;
    var dn = "#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif";
    ie.IncludesShadersStore.shadowsVertex = dn;
    ie.IncludesShadersStore.pointCloudVertex = "#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif";
    var fn = "#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif";
    ie.IncludesShadersStore.logDepthVertex = fn;
    var pn = "#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#endif\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";
    ie.ShadersStore.defaultVertexShader = pn;
    var _n = function(e) {
            function t() {
                var t = e.call(this) || this;
                return t.MAINUV1 = !1, t.MAINUV2 = !1, t.DIFFUSE = !1, t.DIFFUSEDIRECTUV = 0, t.AMBIENT = !1, t.AMBIENTDIRECTUV = 0, t.OPACITY = !1, t.OPACITYDIRECTUV = 0, t.OPACITYRGB = !1, t.REFLECTION = !1, t.EMISSIVE = !1, t.EMISSIVEDIRECTUV = 0, t.SPECULAR = !1, t.SPECULARDIRECTUV = 0, t.BUMP = !1, t.BUMPDIRECTUV = 0, t.PARALLAX = !1, t.PARALLAXOCCLUSION = !1, t.SPECULAROVERALPHA = !1, t.CLIPPLANE = !1, t.CLIPPLANE2 = !1, t.CLIPPLANE3 = !1, t.CLIPPLANE4 = !1, t.ALPHATEST = !1, t.DEPTHPREPASS = !1, t.ALPHAFROMDIFFUSE = !1, t.POINTSIZE = !1, t.FOG = !1, t.SPECULARTERM = !1, t.DIFFUSEFRESNEL = !1, t.OPACITYFRESNEL = !1, t.REFLECTIONFRESNEL = !1, t.REFRACTIONFRESNEL = !1, t.EMISSIVEFRESNEL = !1, t.FRESNEL = !1, t.NORMAL = !1, t.UV1 = !1, t.UV2 = !1, t.VERTEXCOLOR = !1, t.VERTEXALPHA = !1, t.NUM_BONE_INFLUENCERS = 0, t.BonesPerMesh = 0, t.BONETEXTURE = !1, t.INSTANCES = !1, t.GLOSSINESS = !1, t.ROUGHNESS = !1, t.EMISSIVEASILLUMINATION = !1, t.LINKEMISSIVEWITHDIFFUSE = !1, t.REFLECTIONFRESNELFROMSPECULAR = !1, t.LIGHTMAP = !1, t.LIGHTMAPDIRECTUV = 0, t.OBJECTSPACE_NORMALMAP = !1, t.USELIGHTMAPASSHADOWMAP = !1, t.REFLECTIONMAP_3D = !1, t.REFLECTIONMAP_SPHERICAL = !1, t.REFLECTIONMAP_PLANAR = !1, t.REFLECTIONMAP_CUBIC = !1, t.USE_LOCAL_REFLECTIONMAP_CUBIC = !1, t.REFLECTIONMAP_PROJECTION = !1, t.REFLECTIONMAP_SKYBOX = !1, t.REFLECTIONMAP_SKYBOX_TRANSFORMED = !1, t.REFLECTIONMAP_EXPLICIT = !1, t.REFLECTIONMAP_EQUIRECTANGULAR = !1, t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED = !1, t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED = !1, t.INVERTCUBICMAP = !1, t.LOGARITHMICDEPTH = !1, t.REFRACTION = !1, t.REFRACTIONMAP_3D = !1, t.REFLECTIONOVERALPHA = !1, t.TWOSIDEDLIGHTING = !1, t.SHADOWFLOAT = !1, t.MORPHTARGETS = !1, t.MORPHTARGETS_NORMAL = !1, t.MORPHTARGETS_TANGENT = !1, t.NUM_MORPH_INFLUENCERS = 0, t.NONUNIFORMSCALING = !1, t.PREMULTIPLYALPHA = !1, t.IMAGEPROCESSING = !1, t.VIGNETTE = !1, t.VIGNETTEBLENDMODEMULTIPLY = !1, t.VIGNETTEBLENDMODEOPAQUE = !1, t.TONEMAPPING = !1, t.TONEMAPPING_ACES = !1, t.CONTRAST = !1, t.COLORCURVES = !1, t.COLORGRADING = !1, t.COLORGRADING3D = !1, t.SAMPLER3DGREENDEPTH = !1, t.SAMPLER3DBGRMAP = !1, t.IMAGEPROCESSINGPOSTPROCESS = !1, t.MULTIVIEW = !1, t.IS_REFLECTION_LINEAR = !1, t.IS_REFRACTION_LINEAR = !1, t.EXPOSURE = !1, t.rebuild(), t
            }
            return r(t, e), t.prototype.setReflectionMode = function(e) {
                for (var t = 0, i = ["REFLECTIONMAP_CUBIC", "REFLECTIONMAP_EXPLICIT", "REFLECTIONMAP_PLANAR", "REFLECTIONMAP_PROJECTION", "REFLECTIONMAP_PROJECTION", "REFLECTIONMAP_SKYBOX", "REFLECTIONMAP_SPHERICAL", "REFLECTIONMAP_EQUIRECTANGULAR", "REFLECTIONMAP_EQUIRECTANGULAR_FIXED", "REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"]; t < i.length; t++) {
                    var n = i[t];
                    this[n] = n === e
                }
            }, t
        }(tt),
        gn = function(e) {
            function t(i, n) {
                var r = e.call(this, i, n) || this;
                return r._diffuseTexture = null, r._ambientTexture = null, r._opacityTexture = null, r._reflectionTexture = null, r._emissiveTexture = null, r._specularTexture = null, r._bumpTexture = null, r._lightmapTexture = null, r._refractionTexture = null, r.ambientColor = new v(0, 0, 0), r.diffuseColor = new v(1, 1, 1), r.specularColor = new v(1, 1, 1), r.emissiveColor = new v(0, 0, 0), r.specularPower = 64, r._useAlphaFromDiffuseTexture = !1, r._useEmissiveAsIllumination = !1, r._linkEmissiveWithDiffuse = !1, r._useSpecularOverAlpha = !1, r._useReflectionOverAlpha = !1, r._disableLighting = !1, r._useObjectSpaceNormalMap = !1, r._useParallax = !1, r._useParallaxOcclusion = !1, r.parallaxScaleBias = .05, r._roughness = 0, r.indexOfRefraction = .98, r.invertRefractionY = !0, r.alphaCutOff = .4, r._useLightmapAsShadowmap = !1, r._useReflectionFresnelFromSpecular = !1, r._useGlossinessFromSpecularMapAlpha = !1, r._maxSimultaneousLights = 4, r._invertNormalMapX = !1, r._invertNormalMapY = !1, r._twoSidedLighting = !1, r._renderTargets = new We(16), r._worldViewProjectionMatrix = R.Zero(), r._globalAmbientColor = new v(0, 0, 0), r._attachImageProcessingConfiguration(null), r.getRenderTargetTextures = function() {
                    return r._renderTargets.reset(), t.ReflectionTextureEnabled && r._reflectionTexture && r._reflectionTexture.isRenderTarget && r._renderTargets.push(r._reflectionTexture), t.RefractionTextureEnabled && r._refractionTexture && r._refractionTexture.isRenderTarget && r._renderTargets.push(r._refractionTexture), r._renderTargets
                }, r
            }
            return r(t, e), Object.defineProperty(t.prototype, "imageProcessingConfiguration", {
                get: function() {
                    return this._imageProcessingConfiguration
                },
                set: function(e) {
                    this._attachImageProcessingConfiguration(e), this._markAllSubMeshesAsTexturesDirty()
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._attachImageProcessingConfiguration = function(e) {
                var t = this;
                e !== this._imageProcessingConfiguration && (this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), this._imageProcessingConfiguration = e || this.getScene().imageProcessingConfiguration, this._imageProcessingConfiguration && (this._imageProcessingObserver = this._imageProcessingConfiguration.onUpdateParameters.add((function() {
                    t._markAllSubMeshesAsImageProcessingDirty()
                }))))
            }, Object.defineProperty(t.prototype, "cameraColorCurvesEnabled", {
                get: function() {
                    return this.imageProcessingConfiguration.colorCurvesEnabled
                },
                set: function(e) {
                    this.imageProcessingConfiguration.colorCurvesEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cameraColorGradingEnabled", {
                get: function() {
                    return this.imageProcessingConfiguration.colorGradingEnabled
                },
                set: function(e) {
                    this.imageProcessingConfiguration.colorGradingEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cameraToneMappingEnabled", {
                get: function() {
                    return this._imageProcessingConfiguration.toneMappingEnabled
                },
                set: function(e) {
                    this._imageProcessingConfiguration.toneMappingEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cameraExposure", {
                get: function() {
                    return this._imageProcessingConfiguration.exposure
                },
                set: function(e) {
                    this._imageProcessingConfiguration.exposure = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cameraContrast", {
                get: function() {
                    return this._imageProcessingConfiguration.contrast
                },
                set: function(e) {
                    this._imageProcessingConfiguration.contrast = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cameraColorGradingTexture", {
                get: function() {
                    return this._imageProcessingConfiguration.colorGradingTexture
                },
                set: function(e) {
                    this._imageProcessingConfiguration.colorGradingTexture = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cameraColorCurves", {
                get: function() {
                    return this._imageProcessingConfiguration.colorCurves
                },
                set: function(e) {
                    this._imageProcessingConfiguration.colorCurves = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "hasRenderTargetTextures", {
                get: function() {
                    return !!(t.ReflectionTextureEnabled && this._reflectionTexture && this._reflectionTexture.isRenderTarget) || !!(t.RefractionTextureEnabled && this._refractionTexture && this._refractionTexture.isRenderTarget)
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getClassName = function() {
                return "StandardMaterial"
            }, Object.defineProperty(t.prototype, "useLogarithmicDepth", {
                get: function() {
                    return this._useLogarithmicDepth
                },
                set: function(e) {
                    this._useLogarithmicDepth = e && this.getScene().getEngine().getCaps().fragmentDepthSupported, this._markAllSubMeshesAsMiscDirty()
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.needAlphaBlending = function() {
                return this.alpha < 1 || null != this._opacityTexture || this._shouldUseAlphaFromDiffuseTexture() || this._opacityFresnelParameters && this._opacityFresnelParameters.isEnabled
            }, t.prototype.needAlphaTesting = function() {
                return null != this._diffuseTexture && this._diffuseTexture.hasAlpha
            }, t.prototype._shouldUseAlphaFromDiffuseTexture = function() {
                return null != this._diffuseTexture && this._diffuseTexture.hasAlpha && this._useAlphaFromDiffuseTexture
            }, t.prototype.getAlphaTestTexture = function() {
                return this._diffuseTexture
            }, t.prototype.isReadyForSubMesh = function(e, i, n) {
                if (void 0 === n && (n = !1), i.effect && this.isFrozen && this._wasPreviouslyReady) return !0;
                i._materialDefines || (i._materialDefines = new _n);
                var r = this.getScene(),
                    o = i._materialDefines;
                if (!this.checkReadyOnEveryCall && i.effect && o._renderId === r.getRenderId()) return !0;
                var s = r.getEngine();
                if (o._needNormals = xi.PrepareDefinesForLights(r, e, o, !0, this._maxSimultaneousLights, this._disableLighting), xi.PrepareDefinesForMultiview(r, o), o._areTexturesDirty) {
                    if (o._needUVs = !1, o.MAINUV1 = !1, o.MAINUV2 = !1, r.texturesEnabled) {
                        if (this._diffuseTexture && t.DiffuseTextureEnabled) {
                            if (!this._diffuseTexture.isReadyOrNotBlocking()) return !1;
                            xi.PrepareDefinesForMergedUV(this._diffuseTexture, o, "DIFFUSE")
                        } else o.DIFFUSE = !1;
                        if (this._ambientTexture && t.AmbientTextureEnabled) {
                            if (!this._ambientTexture.isReadyOrNotBlocking()) return !1;
                            xi.PrepareDefinesForMergedUV(this._ambientTexture, o, "AMBIENT")
                        } else o.AMBIENT = !1;
                        if (this._opacityTexture && t.OpacityTextureEnabled) {
                            if (!this._opacityTexture.isReadyOrNotBlocking()) return !1;
                            xi.PrepareDefinesForMergedUV(this._opacityTexture, o, "OPACITY"), o.OPACITYRGB = this._opacityTexture.getAlphaFromRGB
                        } else o.OPACITY = !1;
                        if (this._reflectionTexture && t.ReflectionTextureEnabled) {
                            if (!this._reflectionTexture.isReadyOrNotBlocking()) return !1;
                            switch (o._needNormals = !0, o.REFLECTION = !0, o.ROUGHNESS = this._roughness > 0, o.REFLECTIONOVERALPHA = this._useReflectionOverAlpha, o.INVERTCUBICMAP = this._reflectionTexture.coordinatesMode === Ri.INVCUBIC_MODE, o.REFLECTIONMAP_3D = this._reflectionTexture.isCube, this._reflectionTexture.coordinatesMode) {
                                case Ri.EXPLICIT_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_EXPLICIT");
                                    break;
                                case Ri.PLANAR_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_PLANAR");
                                    break;
                                case Ri.PROJECTION_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_PROJECTION");
                                    break;
                                case Ri.SKYBOX_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_SKYBOX"), o.REFLECTIONMAP_SKYBOX_TRANSFORMED = !this._reflectionTexture.getReflectionTextureMatrix().isIdentity();
                                    break;
                                case Ri.SPHERICAL_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_SPHERICAL");
                                    break;
                                case Ri.EQUIRECTANGULAR_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");
                                    break;
                                case Ri.FIXED_EQUIRECTANGULAR_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");
                                    break;
                                case Ri.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:
                                    o.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");
                                    break;
                                case Ri.CUBIC_MODE:
                                case Ri.INVCUBIC_MODE:
                                default:
                                    o.setReflectionMode("REFLECTIONMAP_CUBIC")
                            }
                            o.USE_LOCAL_REFLECTIONMAP_CUBIC = !!this._reflectionTexture.boundingBoxSize
                        } else o.REFLECTION = !1;
                        if (this._emissiveTexture && t.EmissiveTextureEnabled) {
                            if (!this._emissiveTexture.isReadyOrNotBlocking()) return !1;
                            xi.PrepareDefinesForMergedUV(this._emissiveTexture, o, "EMISSIVE")
                        } else o.EMISSIVE = !1;
                        if (this._lightmapTexture && t.LightmapTextureEnabled) {
                            if (!this._lightmapTexture.isReadyOrNotBlocking()) return !1;
                            xi.PrepareDefinesForMergedUV(this._lightmapTexture, o, "LIGHTMAP"), o.USELIGHTMAPASSHADOWMAP = this._useLightmapAsShadowmap
                        } else o.LIGHTMAP = !1;
                        if (this._specularTexture && t.SpecularTextureEnabled) {
                            if (!this._specularTexture.isReadyOrNotBlocking()) return !1;
                            xi.PrepareDefinesForMergedUV(this._specularTexture, o, "SPECULAR"), o.GLOSSINESS = this._useGlossinessFromSpecularMapAlpha
                        } else o.SPECULAR = !1;
                        if (r.getEngine().getCaps().standardDerivatives && this._bumpTexture && t.BumpTextureEnabled) {
                            if (!this._bumpTexture.isReady()) return !1;
                            xi.PrepareDefinesForMergedUV(this._bumpTexture, o, "BUMP"), o.PARALLAX = this._useParallax, o.PARALLAXOCCLUSION = this._useParallaxOcclusion, o.OBJECTSPACE_NORMALMAP = this._useObjectSpaceNormalMap
                        } else o.BUMP = !1;
                        if (this._refractionTexture && t.RefractionTextureEnabled) {
                            if (!this._refractionTexture.isReadyOrNotBlocking()) return !1;
                            o._needUVs = !0, o.REFRACTION = !0, o.REFRACTIONMAP_3D = this._refractionTexture.isCube
                        } else o.REFRACTION = !1;
                        o.TWOSIDEDLIGHTING = !this._backFaceCulling && this._twoSidedLighting
                    } else o.DIFFUSE = !1, o.AMBIENT = !1, o.OPACITY = !1, o.REFLECTION = !1, o.EMISSIVE = !1, o.LIGHTMAP = !1, o.BUMP = !1, o.REFRACTION = !1;
                    o.ALPHAFROMDIFFUSE = this._shouldUseAlphaFromDiffuseTexture(), o.EMISSIVEASILLUMINATION = this._useEmissiveAsIllumination, o.LINKEMISSIVEWITHDIFFUSE = this._linkEmissiveWithDiffuse, o.SPECULAROVERALPHA = this._useSpecularOverAlpha, o.PREMULTIPLYALPHA = this.alphaMode === k.ALPHA_PREMULTIPLIED || this.alphaMode === k.ALPHA_PREMULTIPLIED_PORTERDUFF
                }
                if (o._areImageProcessingDirty && this._imageProcessingConfiguration) {
                    if (!this._imageProcessingConfiguration.isReady()) return !1;
                    this._imageProcessingConfiguration.prepareDefines(o), o.IS_REFLECTION_LINEAR = null != this.reflectionTexture && !this.reflectionTexture.gammaSpace, o.IS_REFRACTION_LINEAR = null != this.refractionTexture && !this.refractionTexture.gammaSpace
                }
                if (o._areFresnelDirty && (t.FresnelEnabled ? (this._diffuseFresnelParameters || this._opacityFresnelParameters || this._emissiveFresnelParameters || this._refractionFresnelParameters || this._reflectionFresnelParameters) && (o.DIFFUSEFRESNEL = this._diffuseFresnelParameters && this._diffuseFresnelParameters.isEnabled, o.OPACITYFRESNEL = this._opacityFresnelParameters && this._opacityFresnelParameters.isEnabled, o.REFLECTIONFRESNEL = this._reflectionFresnelParameters && this._reflectionFresnelParameters.isEnabled, o.REFLECTIONFRESNELFROMSPECULAR = this._useReflectionFresnelFromSpecular, o.REFRACTIONFRESNEL = this._refractionFresnelParameters && this._refractionFresnelParameters.isEnabled, o.EMISSIVEFRESNEL = this._emissiveFresnelParameters && this._emissiveFresnelParameters.isEnabled, o._needNormals = !0, o.FRESNEL = !0) : o.FRESNEL = !1), xi.PrepareDefinesForMisc(e, r, this._useLogarithmicDepth, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e), o), xi.PrepareDefinesForAttributes(e, o, !0, !0, !0), xi.PrepareDefinesForFrameBoundValues(r, s, o, n), o.isDirty) {
                    o.markAsProcessed();
                    var a = new te;
                    o.REFLECTION && a.addFallback(0, "REFLECTION"), o.SPECULAR && a.addFallback(0, "SPECULAR"), o.BUMP && a.addFallback(0, "BUMP"), o.PARALLAX && a.addFallback(1, "PARALLAX"), o.PARALLAXOCCLUSION && a.addFallback(0, "PARALLAXOCCLUSION"), o.SPECULAROVERALPHA && a.addFallback(0, "SPECULAROVERALPHA"), o.FOG && a.addFallback(1, "FOG"), o.POINTSIZE && a.addFallback(0, "POINTSIZE"), o.LOGARITHMICDEPTH && a.addFallback(0, "LOGARITHMICDEPTH"), xi.HandleFallbacksForShadows(o, a, this._maxSimultaneousLights), o.SPECULARTERM && a.addFallback(0, "SPECULARTERM"), o.DIFFUSEFRESNEL && a.addFallback(1, "DIFFUSEFRESNEL"), o.OPACITYFRESNEL && a.addFallback(2, "OPACITYFRESNEL"), o.REFLECTIONFRESNEL && a.addFallback(3, "REFLECTIONFRESNEL"), o.EMISSIVEFRESNEL && a.addFallback(4, "EMISSIVEFRESNEL"), o.FRESNEL && a.addFallback(4, "FRESNEL"), o.MULTIVIEW && a.addFallback(0, "MULTIVIEW");
                    var u = [Te.PositionKind];
                    o.NORMAL && u.push(Te.NormalKind), o.UV1 && u.push(Te.UVKind), o.UV2 && u.push(Te.UV2Kind), o.VERTEXCOLOR && u.push(Te.ColorKind), xi.PrepareAttributesForBones(u, e, o, a), xi.PrepareAttributesForInstances(u, o), xi.PrepareAttributesForMorphTargets(u, e, o);
                    var h = "default",
                        l = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vAmbientColor", "vDiffuseColor", "vSpecularColor", "vEmissiveColor", "visibility", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "vAmbientInfos", "vOpacityInfos", "vReflectionInfos", "vEmissiveInfos", "vSpecularInfos", "vBumpInfos", "vLightmapInfos", "vRefractionInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "diffuseMatrix", "ambientMatrix", "opacityMatrix", "reflectionMatrix", "emissiveMatrix", "specularMatrix", "bumpMatrix", "normalMatrix", "lightmapMatrix", "refractionMatrix", "diffuseLeftColor", "diffuseRightColor", "opacityParts", "reflectionLeftColor", "reflectionRightColor", "emissiveLeftColor", "emissiveRightColor", "refractionLeftColor", "refractionRightColor", "vReflectionPosition", "vReflectionSize", "logarithmicDepthConstant", "vTangentSpaceParams", "alphaCutOff", "boneTextureWidth"],
                        c = ["diffuseSampler", "ambientSampler", "opacitySampler", "reflectionCubeSampler", "reflection2DSampler", "emissiveSampler", "specularSampler", "bumpSampler", "lightmapSampler", "refractionCubeSampler", "refraction2DSampler", "boneSampler"],
                        d = ["Material", "Scene"];
                    nt && (nt.PrepareUniforms(l, o), nt.PrepareSamplers(c, o)), xi.PrepareUniformsAndSamplersList({
                        uniformsNames: l,
                        uniformBuffersNames: d,
                        samplers: c,
                        defines: o,
                        maxSimultaneousLights: this._maxSimultaneousLights
                    }), this.customShaderNameResolve && (h = this.customShaderNameResolve(h, l, d, c, o));
                    var f = o.toString(),
                        p = i.effect,
                        _ = r.getEngine().createEffect(h, {
                            attributes: u,
                            uniformsNames: l,
                            uniformBuffersNames: d,
                            samplers: c,
                            defines: f,
                            fallbacks: a,
                            onCompiled: this.onCompiled,
                            onError: this.onError,
                            indexParameters: {
                                maxSimultaneousLights: this._maxSimultaneousLights,
                                maxSimultaneousMorphTargets: o.NUM_MORPH_INFLUENCERS
                            }
                        }, s);
                    _ && (this.allowShaderHotSwapping && p && !_.isReady() ? (_ = p, o.markAsUnprocessed()) : (r.resetCachedMaterial(), i.setEffect(_, o), this.buildUniformLayout()))
                }
                return !(!i.effect || !i.effect.isReady()) && (o._renderId = r.getRenderId(), this._wasPreviouslyReady = !0, !0)
            }, t.prototype.buildUniformLayout = function() {
                var e = this._uniformBuffer;
                e.addUniform("diffuseLeftColor", 4), e.addUniform("diffuseRightColor", 4), e.addUniform("opacityParts", 4), e.addUniform("reflectionLeftColor", 4), e.addUniform("reflectionRightColor", 4), e.addUniform("refractionLeftColor", 4), e.addUniform("refractionRightColor", 4), e.addUniform("emissiveLeftColor", 4), e.addUniform("emissiveRightColor", 4), e.addUniform("vDiffuseInfos", 2), e.addUniform("vAmbientInfos", 2), e.addUniform("vOpacityInfos", 2), e.addUniform("vReflectionInfos", 2), e.addUniform("vReflectionPosition", 3), e.addUniform("vReflectionSize", 3), e.addUniform("vEmissiveInfos", 2), e.addUniform("vLightmapInfos", 2), e.addUniform("vSpecularInfos", 2), e.addUniform("vBumpInfos", 3), e.addUniform("diffuseMatrix", 16), e.addUniform("ambientMatrix", 16), e.addUniform("opacityMatrix", 16), e.addUniform("reflectionMatrix", 16), e.addUniform("emissiveMatrix", 16), e.addUniform("lightmapMatrix", 16), e.addUniform("specularMatrix", 16), e.addUniform("bumpMatrix", 16), e.addUniform("vTangentSpaceParams", 2), e.addUniform("pointSize", 1), e.addUniform("refractionMatrix", 16), e.addUniform("vRefractionInfos", 4), e.addUniform("vSpecularColor", 4), e.addUniform("vEmissiveColor", 3), e.addUniform("visibility", 1), e.addUniform("vDiffuseColor", 4), e.create()
            }, t.prototype.unbind = function() {
                if (this._activeEffect) {
                    var t = !1;
                    this._reflectionTexture && this._reflectionTexture.isRenderTarget && (this._activeEffect.setTexture("reflection2DSampler", null), t = !0), this._refractionTexture && this._refractionTexture.isRenderTarget && (this._activeEffect.setTexture("refraction2DSampler", null), t = !0), t && this._markAllSubMeshesAsTexturesDirty()
                }
                e.prototype.unbind.call(this)
            }, t.prototype.bindForSubMesh = function(e, i, n) {
                var r = this.getScene(),
                    o = n._materialDefines;
                if (o) {
                    var s = n.effect;
                    if (s) {
                        this._activeEffect = s, o.INSTANCES || this.bindOnlyWorldMatrix(e), o.OBJECTSPACE_NORMALMAP && (e.toNormalMatrix(this._normalMatrix), this.bindOnlyNormalMatrix(this._normalMatrix));
                        var a = this._mustRebind(r, s, i.visibility);
                        xi.BindBonesParameters(i, s);
                        var u = this._uniformBuffer;
                        if (a) {
                            if (u.bindToEffect(s, "Material"), this.bindViewProjection(s), !u.useUbo || !this.isFrozen || !u.isSync) {
                                if (t.FresnelEnabled && o.FRESNEL && (this.diffuseFresnelParameters && this.diffuseFresnelParameters.isEnabled && (u.updateColor4("diffuseLeftColor", this.diffuseFresnelParameters.leftColor, this.diffuseFresnelParameters.power), u.updateColor4("diffuseRightColor", this.diffuseFresnelParameters.rightColor, this.diffuseFresnelParameters.bias)), this.opacityFresnelParameters && this.opacityFresnelParameters.isEnabled && u.updateColor4("opacityParts", new v(this.opacityFresnelParameters.leftColor.toLuminance(), this.opacityFresnelParameters.rightColor.toLuminance(), this.opacityFresnelParameters.bias), this.opacityFresnelParameters.power), this.reflectionFresnelParameters && this.reflectionFresnelParameters.isEnabled && (u.updateColor4("reflectionLeftColor", this.reflectionFresnelParameters.leftColor, this.reflectionFresnelParameters.power), u.updateColor4("reflectionRightColor", this.reflectionFresnelParameters.rightColor, this.reflectionFresnelParameters.bias)), this.refractionFresnelParameters && this.refractionFresnelParameters.isEnabled && (u.updateColor4("refractionLeftColor", this.refractionFresnelParameters.leftColor, this.refractionFresnelParameters.power), u.updateColor4("refractionRightColor", this.refractionFresnelParameters.rightColor, this.refractionFresnelParameters.bias)), this.emissiveFresnelParameters && this.emissiveFresnelParameters.isEnabled && (u.updateColor4("emissiveLeftColor", this.emissiveFresnelParameters.leftColor, this.emissiveFresnelParameters.power), u.updateColor4("emissiveRightColor", this.emissiveFresnelParameters.rightColor, this.emissiveFresnelParameters.bias))), r.texturesEnabled) {
                                    if (this._diffuseTexture && t.DiffuseTextureEnabled && (u.updateFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level), xi.BindTextureMatrix(this._diffuseTexture, u, "diffuse"), this._diffuseTexture.hasAlpha && s.setFloat("alphaCutOff", this.alphaCutOff)), this._ambientTexture && t.AmbientTextureEnabled && (u.updateFloat2("vAmbientInfos", this._ambientTexture.coordinatesIndex, this._ambientTexture.level), xi.BindTextureMatrix(this._ambientTexture, u, "ambient")), this._opacityTexture && t.OpacityTextureEnabled && (u.updateFloat2("vOpacityInfos", this._opacityTexture.coordinatesIndex, this._opacityTexture.level), xi.BindTextureMatrix(this._opacityTexture, u, "opacity")), this._reflectionTexture && t.ReflectionTextureEnabled && (u.updateFloat2("vReflectionInfos", this._reflectionTexture.level, this.roughness), u.updateMatrix("reflectionMatrix", this._reflectionTexture.getReflectionTextureMatrix()), this._reflectionTexture.boundingBoxSize)) {
                                        var h = this._reflectionTexture;
                                        u.updateVector3("vReflectionPosition", h.boundingBoxPosition), u.updateVector3("vReflectionSize", h.boundingBoxSize)
                                    }
                                    if (this._emissiveTexture && t.EmissiveTextureEnabled && (u.updateFloat2("vEmissiveInfos", this._emissiveTexture.coordinatesIndex, this._emissiveTexture.level), xi.BindTextureMatrix(this._emissiveTexture, u, "emissive")), this._lightmapTexture && t.LightmapTextureEnabled && (u.updateFloat2("vLightmapInfos", this._lightmapTexture.coordinatesIndex, this._lightmapTexture.level), xi.BindTextureMatrix(this._lightmapTexture, u, "lightmap")), this._specularTexture && t.SpecularTextureEnabled && (u.updateFloat2("vSpecularInfos", this._specularTexture.coordinatesIndex, this._specularTexture.level), xi.BindTextureMatrix(this._specularTexture, u, "specular")), this._bumpTexture && r.getEngine().getCaps().standardDerivatives && t.BumpTextureEnabled && (u.updateFloat3("vBumpInfos", this._bumpTexture.coordinatesIndex, 1 / this._bumpTexture.level, this.parallaxScaleBias), xi.BindTextureMatrix(this._bumpTexture, u, "bump"), r._mirroredCameraPosition ? u.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? 1 : -1, this._invertNormalMapY ? 1 : -1) : u.updateFloat2("vTangentSpaceParams", this._invertNormalMapX ? -1 : 1, this._invertNormalMapY ? -1 : 1)), this._refractionTexture && t.RefractionTextureEnabled) {
                                        var l = 1;
                                        this._refractionTexture.isCube || (u.updateMatrix("refractionMatrix", this._refractionTexture.getReflectionTextureMatrix()), this._refractionTexture.depth && (l = this._refractionTexture.depth)), u.updateFloat4("vRefractionInfos", this._refractionTexture.level, this.indexOfRefraction, l, this.invertRefractionY ? -1 : 1)
                                    }
                                }
                                this.pointsCloud && u.updateFloat("pointSize", this.pointSize), o.SPECULARTERM && u.updateColor4("vSpecularColor", this.specularColor, this.specularPower), u.updateColor3("vEmissiveColor", t.EmissiveTextureEnabled ? this.emissiveColor : v.BlackReadOnly), u.updateFloat("visibility", i.visibility), u.updateColor4("vDiffuseColor", this.diffuseColor, this.alpha)
                            }
                            if (r.texturesEnabled && (this._diffuseTexture && t.DiffuseTextureEnabled && s.setTexture("diffuseSampler", this._diffuseTexture), this._ambientTexture && t.AmbientTextureEnabled && s.setTexture("ambientSampler", this._ambientTexture), this._opacityTexture && t.OpacityTextureEnabled && s.setTexture("opacitySampler", this._opacityTexture), this._reflectionTexture && t.ReflectionTextureEnabled && (this._reflectionTexture.isCube ? s.setTexture("reflectionCubeSampler", this._reflectionTexture) : s.setTexture("reflection2DSampler", this._reflectionTexture)), this._emissiveTexture && t.EmissiveTextureEnabled && s.setTexture("emissiveSampler", this._emissiveTexture), this._lightmapTexture && t.LightmapTextureEnabled && s.setTexture("lightmapSampler", this._lightmapTexture), this._specularTexture && t.SpecularTextureEnabled && s.setTexture("specularSampler", this._specularTexture), this._bumpTexture && r.getEngine().getCaps().standardDerivatives && t.BumpTextureEnabled && s.setTexture("bumpSampler", this._bumpTexture), this._refractionTexture && t.RefractionTextureEnabled)) {
                                l = 1;
                                this._refractionTexture.isCube ? s.setTexture("refractionCubeSampler", this._refractionTexture) : s.setTexture("refraction2DSampler", this._refractionTexture)
                            }
                            xi.BindClipPlane(s, r), r.ambientColor.multiplyToRef(this.ambientColor, this._globalAmbientColor), xi.BindEyePosition(s, r), s.setColor3("vAmbientColor", this._globalAmbientColor)
                        }!a && this.isFrozen || (r.lightsEnabled && !this._disableLighting && xi.BindLights(r, i, s, o, this._maxSimultaneousLights), (r.fogEnabled && i.applyFog && r.fogMode !== Et.FOGMODE_NONE || this._reflectionTexture || this._refractionTexture) && this.bindView(s), xi.BindFogParameters(r, i, s), o.NUM_MORPH_INFLUENCERS && xi.BindMorphTargetParameters(i, s), xi.BindLogDepth(o, s, r), this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(this._activeEffect)), u.update(), this._afterBind(i, this._activeEffect)
                    }
                }
            }, t.prototype.getAnimatables = function() {
                var e = [];
                return this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0 && e.push(this._diffuseTexture), this._ambientTexture && this._ambientTexture.animations && this._ambientTexture.animations.length > 0 && e.push(this._ambientTexture), this._opacityTexture && this._opacityTexture.animations && this._opacityTexture.animations.length > 0 && e.push(this._opacityTexture), this._reflectionTexture && this._reflectionTexture.animations && this._reflectionTexture.animations.length > 0 && e.push(this._reflectionTexture), this._emissiveTexture && this._emissiveTexture.animations && this._emissiveTexture.animations.length > 0 && e.push(this._emissiveTexture), this._specularTexture && this._specularTexture.animations && this._specularTexture.animations.length > 0 && e.push(this._specularTexture), this._bumpTexture && this._bumpTexture.animations && this._bumpTexture.animations.length > 0 && e.push(this._bumpTexture), this._lightmapTexture && this._lightmapTexture.animations && this._lightmapTexture.animations.length > 0 && e.push(this._lightmapTexture), this._refractionTexture && this._refractionTexture.animations && this._refractionTexture.animations.length > 0 && e.push(this._refractionTexture), e
            }, t.prototype.getActiveTextures = function() {
                var t = e.prototype.getActiveTextures.call(this);
                return this._diffuseTexture && t.push(this._diffuseTexture), this._ambientTexture && t.push(this._ambientTexture), this._opacityTexture && t.push(this._opacityTexture), this._reflectionTexture && t.push(this._reflectionTexture), this._emissiveTexture && t.push(this._emissiveTexture), this._specularTexture && t.push(this._specularTexture), this._bumpTexture && t.push(this._bumpTexture), this._lightmapTexture && t.push(this._lightmapTexture), this._refractionTexture && t.push(this._refractionTexture), t
            }, t.prototype.hasTexture = function(t) {
                return !!e.prototype.hasTexture.call(this, t) || (this._diffuseTexture === t || (this._ambientTexture === t || (this._opacityTexture === t || (this._reflectionTexture === t || (this._emissiveTexture === t || (this._specularTexture === t || (this._bumpTexture === t || (this._lightmapTexture === t || this._refractionTexture === t))))))))
            }, t.prototype.dispose = function(t, i) {
                i && (this._diffuseTexture && this._diffuseTexture.dispose(), this._ambientTexture && this._ambientTexture.dispose(), this._opacityTexture && this._opacityTexture.dispose(), this._reflectionTexture && this._reflectionTexture.dispose(), this._emissiveTexture && this._emissiveTexture.dispose(), this._specularTexture && this._specularTexture.dispose(), this._bumpTexture && this._bumpTexture.dispose(), this._lightmapTexture && this._lightmapTexture.dispose(), this._refractionTexture && this._refractionTexture.dispose()), this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), e.prototype.dispose.call(this, t, i)
            }, t.prototype.clone = function(e) {
                var i = this,
                    n = me.Clone((function() {
                        return new t(e, i.getScene())
                    }), this);
                return n.name = e, n.id = e, n
            }, t.prototype.serialize = function() {
                return me.Serialize(this)
            }, t.Parse = function(e, i, n) {
                return me.Parse((function() {
                    return new t(e.name, i)
                }), e, i, n)
            }, Object.defineProperty(t, "DiffuseTextureEnabled", {
                get: function() {
                    return Si.DiffuseTextureEnabled
                },
                set: function(e) {
                    Si.DiffuseTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "AmbientTextureEnabled", {
                get: function() {
                    return Si.AmbientTextureEnabled
                },
                set: function(e) {
                    Si.AmbientTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "OpacityTextureEnabled", {
                get: function() {
                    return Si.OpacityTextureEnabled
                },
                set: function(e) {
                    Si.OpacityTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "ReflectionTextureEnabled", {
                get: function() {
                    return Si.ReflectionTextureEnabled
                },
                set: function(e) {
                    Si.ReflectionTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "EmissiveTextureEnabled", {
                get: function() {
                    return Si.EmissiveTextureEnabled
                },
                set: function(e) {
                    Si.EmissiveTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "SpecularTextureEnabled", {
                get: function() {
                    return Si.SpecularTextureEnabled
                },
                set: function(e) {
                    Si.SpecularTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "BumpTextureEnabled", {
                get: function() {
                    return Si.BumpTextureEnabled
                },
                set: function(e) {
                    Si.BumpTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "LightmapTextureEnabled", {
                get: function() {
                    return Si.LightmapTextureEnabled
                },
                set: function(e) {
                    Si.LightmapTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "RefractionTextureEnabled", {
                get: function() {
                    return Si.RefractionTextureEnabled
                },
                set: function(e) {
                    Si.RefractionTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "ColorGradingTextureEnabled", {
                get: function() {
                    return Si.ColorGradingTextureEnabled
                },
                set: function(e) {
                    Si.ColorGradingTextureEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t, "FresnelEnabled", {
                get: function() {
                    return Si.FresnelEnabled
                },
                set: function(e) {
                    Si.FresnelEnabled = e
                },
                enumerable: !0,
                configurable: !0
            }), s([de("diffuseTexture")], t.prototype, "_diffuseTexture", void 0), s([le("_markAllSubMeshesAsTexturesAndMiscDirty")], t.prototype, "diffuseTexture", void 0), s([de("ambientTexture")], t.prototype, "_ambientTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "ambientTexture", void 0), s([de("opacityTexture")], t.prototype, "_opacityTexture", void 0), s([le("_markAllSubMeshesAsTexturesAndMiscDirty")], t.prototype, "opacityTexture", void 0), s([de("reflectionTexture")], t.prototype, "_reflectionTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "reflectionTexture", void 0), s([de("emissiveTexture")], t.prototype, "_emissiveTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "emissiveTexture", void 0), s([de("specularTexture")], t.prototype, "_specularTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "specularTexture", void 0), s([de("bumpTexture")], t.prototype, "_bumpTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "bumpTexture", void 0), s([de("lightmapTexture")], t.prototype, "_lightmapTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "lightmapTexture", void 0), s([de("refractionTexture")], t.prototype, "_refractionTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "refractionTexture", void 0), s([fe("ambient")], t.prototype, "ambientColor", void 0), s([fe("diffuse")], t.prototype, "diffuseColor", void 0), s([fe("specular")], t.prototype, "specularColor", void 0), s([fe("emissive")], t.prototype, "emissiveColor", void 0), s([ce()], t.prototype, "specularPower", void 0), s([ce("useAlphaFromDiffuseTexture")], t.prototype, "_useAlphaFromDiffuseTexture", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useAlphaFromDiffuseTexture", void 0), s([ce("useEmissiveAsIllumination")], t.prototype, "_useEmissiveAsIllumination", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useEmissiveAsIllumination", void 0), s([ce("linkEmissiveWithDiffuse")], t.prototype, "_linkEmissiveWithDiffuse", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "linkEmissiveWithDiffuse", void 0), s([ce("useSpecularOverAlpha")], t.prototype, "_useSpecularOverAlpha", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useSpecularOverAlpha", void 0), s([ce("useReflectionOverAlpha")], t.prototype, "_useReflectionOverAlpha", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useReflectionOverAlpha", void 0), s([ce("disableLighting")], t.prototype, "_disableLighting", void 0), s([le("_markAllSubMeshesAsLightsDirty")], t.prototype, "disableLighting", void 0), s([ce("useObjectSpaceNormalMap")], t.prototype, "_useObjectSpaceNormalMap", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useObjectSpaceNormalMap", void 0), s([ce("useParallax")], t.prototype, "_useParallax", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useParallax", void 0), s([ce("useParallaxOcclusion")], t.prototype, "_useParallaxOcclusion", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useParallaxOcclusion", void 0), s([ce()], t.prototype, "parallaxScaleBias", void 0), s([ce("roughness")], t.prototype, "_roughness", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "roughness", void 0), s([ce()], t.prototype, "indexOfRefraction", void 0), s([ce()], t.prototype, "invertRefractionY", void 0), s([ce()], t.prototype, "alphaCutOff", void 0), s([ce("useLightmapAsShadowmap")], t.prototype, "_useLightmapAsShadowmap", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useLightmapAsShadowmap", void 0), s([pe("diffuseFresnelParameters")], t.prototype, "_diffuseFresnelParameters", void 0), s([le("_markAllSubMeshesAsFresnelDirty")], t.prototype, "diffuseFresnelParameters", void 0), s([pe("opacityFresnelParameters")], t.prototype, "_opacityFresnelParameters", void 0), s([le("_markAllSubMeshesAsFresnelAndMiscDirty")], t.prototype, "opacityFresnelParameters", void 0), s([pe("reflectionFresnelParameters")], t.prototype, "_reflectionFresnelParameters", void 0), s([le("_markAllSubMeshesAsFresnelDirty")], t.prototype, "reflectionFresnelParameters", void 0), s([pe("refractionFresnelParameters")], t.prototype, "_refractionFresnelParameters", void 0), s([le("_markAllSubMeshesAsFresnelDirty")], t.prototype, "refractionFresnelParameters", void 0), s([pe("emissiveFresnelParameters")], t.prototype, "_emissiveFresnelParameters", void 0), s([le("_markAllSubMeshesAsFresnelDirty")], t.prototype, "emissiveFresnelParameters", void 0), s([ce("useReflectionFresnelFromSpecular")], t.prototype, "_useReflectionFresnelFromSpecular", void 0), s([le("_markAllSubMeshesAsFresnelDirty")], t.prototype, "useReflectionFresnelFromSpecular", void 0), s([ce("useGlossinessFromSpecularMapAlpha")], t.prototype, "_useGlossinessFromSpecularMapAlpha", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "useGlossinessFromSpecularMapAlpha", void 0), s([ce("maxSimultaneousLights")], t.prototype, "_maxSimultaneousLights", void 0), s([le("_markAllSubMeshesAsLightsDirty")], t.prototype, "maxSimultaneousLights", void 0), s([ce("invertNormalMapX")], t.prototype, "_invertNormalMapX", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "invertNormalMapX", void 0), s([ce("invertNormalMapY")], t.prototype, "_invertNormalMapY", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "invertNormalMapY", void 0), s([ce("twoSidedLighting")], t.prototype, "_twoSidedLighting", void 0), s([le("_markAllSubMeshesAsTexturesDirty")], t.prototype, "twoSidedLighting", void 0), s([ce()], t.prototype, "useLogarithmicDepth", null), t
        }(Ci);
    G.RegisteredTypes["BABYLON.StandardMaterial"] = gn, Et.DefaultMaterialFactory = function(e) {
        return new gn("default material", e)
    };
    ! function() {
        function e(e) {
            this.SMOOTHING = .75, this.FFT_SIZE = 512, this.BARGRAPHAMPLITUDE = 256, this.DEBUGCANVASPOS = {
                x: 20,
                y: 20
            }, this.DEBUGCANVASSIZE = {
                width: 320,
                height: 200
            }, this._scene = e, this._audioEngine = ze.audioEngine, this._audioEngine.canUseWebAudio && this._audioEngine.audioContext && (this._webAudioAnalyser = this._audioEngine.audioContext.createAnalyser(), this._webAudioAnalyser.minDecibels = -140, this._webAudioAnalyser.maxDecibels = 0, this._byteFreqs = new Uint8Array(this._webAudioAnalyser.frequencyBinCount), this._byteTime = new Uint8Array(this._webAudioAnalyser.frequencyBinCount), this._floatFreqs = new Float32Array(this._webAudioAnalyser.frequencyBinCount))
        }
        e.prototype.getFrequencyBinCount = function() {
            return this._audioEngine.canUseWebAudio ? this._webAudioAnalyser.frequencyBinCount : 0
        }, e.prototype.getByteFrequencyData = function() {
            return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING, this._webAudioAnalyser.fftSize = this.FFT_SIZE, this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)), this._byteFreqs
        }, e.prototype.getByteTimeDomainData = function() {
            return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING, this._webAudioAnalyser.fftSize = this.FFT_SIZE, this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)), this._byteTime
        }, e.prototype.getFloatFrequencyData = function() {
            return this._audioEngine.canUseWebAudio && (this._webAudioAnalyser.smoothingTimeConstant = this.SMOOTHING, this._webAudioAnalyser.fftSize = this.FFT_SIZE, this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)), this._floatFreqs
        }, e.prototype.drawDebugCanvas = function() {
            var e = this;
            if (this._audioEngine.canUseWebAudio && (this._debugCanvas || (this._debugCanvas = document.createElement("canvas"), this._debugCanvas.width = this.DEBUGCANVASSIZE.width, this._debugCanvas.height = this.DEBUGCANVASSIZE.height, this._debugCanvas.style.position = "absolute", this._debugCanvas.style.top = this.DEBUGCANVASPOS.y + "px", this._debugCanvas.style.left = this.DEBUGCANVASPOS.x + "px", this._debugCanvasContext = this._debugCanvas.getContext("2d"), document.body.appendChild(this._debugCanvas), this._registerFunc = function() {
                    e.drawDebugCanvas()
                }, this._scene.registerBeforeRender(this._registerFunc)), this._registerFunc && this._debugCanvasContext)) {
                var t = this.getByteFrequencyData();
                this._debugCanvasContext.fillStyle = "rgb(0, 0, 0)", this._debugCanvasContext.fillRect(0, 0, this.DEBUGCANVASSIZE.width, this.DEBUGCANVASSIZE.height);
                for (var i = 0; i < this.getFrequencyBinCount(); i++) {
                    var n = t[i] / this.BARGRAPHAMPLITUDE,
                        r = this.DEBUGCANVASSIZE.height * n,
                        o = this.DEBUGCANVASSIZE.height - r - 1,
                        s = this.DEBUGCANVASSIZE.width / this.getFrequencyBinCount(),
                        a = i / this.getFrequencyBinCount() * 360;
                    this._debugCanvasContext.fillStyle = "hsl(" + a + ", 100%, 50%)", this._debugCanvasContext.fillRect(i * s, o, s, r)
                }
            }
        }, e.prototype.stopDebugCanvas = function() {
            this._debugCanvas && (this._registerFunc && (this._scene.unregisterBeforeRender(this._registerFunc), this._registerFunc = null), document.body.removeChild(this._debugCanvas), this._debugCanvas = null, this._debugCanvasContext = null)
        }, e.prototype.connectAudioNodes = function(e, t) {
            this._audioEngine.canUseWebAudio && (e.connect(this._webAudioAnalyser), this._webAudioAnalyser.connect(t))
        }, e.prototype.dispose = function() {
            this._audioEngine.canUseWebAudio && this._webAudioAnalyser.disconnect()
        }
    }();
    ze.AudioEngineFactory = function(e) {
        return new mn(e)
    };
    var mn = function() {
            function e(e) {
                var t = this;
                void 0 === e && (e = null), this._audioContext = null, this._audioContextInitialized = !1, this._muteButton = null, this.canUseWebAudio = !1, this.WarnedWebAudioUnsupported = !1, this.isMP3supported = !1, this.isOGGsupported = !1, this.unlocked = !0, this.useCustomUnlockedButton = !1, this.onAudioUnlockedObservable = new l, this.onAudioLockedObservable = new l, this._tryToRun = !1, this._onResize = function() {
                    t._moveButtonToTopLeft()
                }, void 0 === window.AudioContext && void 0 === window.webkitAudioContext || (window.AudioContext = window.AudioContext || window.webkitAudioContext, this.canUseWebAudio = !0);
                var i = document.createElement("audio");
                this._hostElement = e;
                try {
                    i && i.canPlayType && i.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/, "") && (this.isMP3supported = !0)
                } catch (e) {}
                try {
                    i && i.canPlayType && i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, "") && (this.isOGGsupported = !0)
                } catch (e) {}
            }
            return Object.defineProperty(e.prototype, "audioContext", {
                get: function() {
                    return this._audioContextInitialized ? this.unlocked || this._muteButton || this._displayMuteButton() : this._initializeAudioContext(), this._audioContext
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.lock = function() {
                this._triggerSuspendedState()
            }, e.prototype.unlock = function() {
                this._triggerRunningState()
            }, e.prototype._resumeAudioContext = function() {
                var e;
                return this._audioContext.resume && (e = this._audioContext.resume()), e || Promise.resolve()
            }, e.prototype._initializeAudioContext = function() {
                try {
                    this.canUseWebAudio && (this._audioContext = new AudioContext, this.masterGain = this._audioContext.createGain(), this.masterGain.gain.value = 1, this.masterGain.connect(this._audioContext.destination), this._audioContextInitialized = !0, "running" === this._audioContext.state && this._triggerRunningState())
                } catch (e) {
                    this.canUseWebAudio = !1, V.Error("Web Audio: " + e.message)
                }
            }, e.prototype._triggerRunningState = function() {
                var e = this;
                this._tryToRun || (this._tryToRun = !0, this._resumeAudioContext().then((function() {
                    e._tryToRun = !1, e._muteButton && e._hideMuteButton()
                })).catch((function() {
                    e._tryToRun = !1, e.unlocked = !1
                })), this.unlocked = !0, this.onAudioUnlockedObservable.notifyObservers(this))
            }, e.prototype._triggerSuspendedState = function() {
                this.unlocked = !1, this.onAudioLockedObservable.notifyObservers(this), this._displayMuteButton()
            }, e.prototype._displayMuteButton = function() {
                var e = this;
                if (!this.useCustomUnlockedButton && !this._muteButton) {
                    this._muteButton = document.createElement("BUTTON"), this._muteButton.className = "babylonUnmuteIcon", this._muteButton.id = "babylonUnmuteIconBtn", this._muteButton.title = "Unmute";
                    var t = document.createElement("style");
                    t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")), document.getElementsByTagName("head")[0].appendChild(t), document.body.appendChild(this._muteButton), this._moveButtonToTopLeft(), this._muteButton.addEventListener("touchend", (function() {
                        e._triggerRunningState()
                    }), !0), this._muteButton.addEventListener("click", (function() {
                        e._triggerRunningState()
                    }), !0), window.addEventListener("resize", this._onResize)
                }
            }, e.prototype._moveButtonToTopLeft = function() {
                this._hostElement && this._muteButton && (this._muteButton.style.top = this._hostElement.offsetTop + 20 + "px", this._muteButton.style.left = this._hostElement.offsetLeft + 20 + "px")
            }, e.prototype._hideMuteButton = function() {
                this._muteButton && (document.body.removeChild(this._muteButton), this._muteButton = null)
            }, e.prototype.dispose = function() {
                this.canUseWebAudio && this._audioContextInitialized && (this._connectedAnalyser && this._audioContext && (this._connectedAnalyser.stopDebugCanvas(), this._connectedAnalyser.dispose(), this.masterGain.disconnect(), this.masterGain.connect(this._audioContext.destination), this._connectedAnalyser = null), this.masterGain.gain.value = 1), this.WarnedWebAudioUnsupported = !1, this._hideMuteButton(), window.removeEventListener("resize", this._onResize), this.onAudioUnlockedObservable.clear(), this.onAudioLockedObservable.clear()
            }, e.prototype.getGlobalVolume = function() {
                return this.canUseWebAudio && this._audioContextInitialized ? this.masterGain.gain.value : -1
            }, e.prototype.setGlobalVolume = function(e) {
                this.canUseWebAudio && this._audioContextInitialized && (this.masterGain.gain.value = e)
            }, e.prototype.connectToAnalyser = function(e) {
                this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(), this.canUseWebAudio && this._audioContextInitialized && this._audioContext && (this._connectedAnalyser = e, this.masterGain.disconnect(), this._connectedAnalyser.connectAudioNodes(this.masterGain, this._audioContext.destination))
            }, e
        }(),
        vn = function() {
            function e(t, i, n, r, o) {
                var s = this;
                if (void 0 === r && (r = null), this.autoplay = !1, this.loop = !1, this.useCustomAttenuation = !1, this.isPlaying = !1, this.isPaused = !1, this.spatialSound = !1, this.refDistance = 1, this.rolloffFactor = 1, this.maxDistance = 100, this.distanceModel = "linear", this.onEndedObservable = new l, this._panningModel = "equalpower", this._playbackRate = 1, this._streaming = !1, this._startTime = 0, this._startOffset = 0, this._position = b.Zero(), this._positionInEmitterSpace = !1, this._localDirection = new b(1, 0, 0), this._volume = 1, this._isReadyToPlay = !1, this._isDirectional = !1, this._coneInnerAngle = 360, this._coneOuterAngle = 360, this._coneOuterGain = 0, this._isOutputConnected = !1, this._urlType = "Unknown", this.name = t, this._scene = n, e._SceneComponentInitialization(n), this._readyToPlayCallback = r, this._customAttenuationFunction = function(e, t, i, n, r) {
                        return t < i ? e * (1 - t / i) : 0
                    }, o && (this.autoplay = o.autoplay || !1, this.loop = o.loop || !1, void 0 !== o.volume && (this._volume = o.volume), this.spatialSound = o.spatialSound || !1, this.maxDistance = o.maxDistance || 100, this.useCustomAttenuation = o.useCustomAttenuation || !1, this.rolloffFactor = o.rolloffFactor || 1, this.refDistance = o.refDistance || 1, this.distanceModel = o.distanceModel || "linear", this._playbackRate = o.playbackRate || 1, this._streaming = o.streaming || !1), ze.audioEngine.canUseWebAudio && ze.audioEngine.audioContext) {
                    this._soundGain = ze.audioEngine.audioContext.createGain(), this._soundGain.gain.value = this._volume, this._inputAudioNode = this._soundGain, this._outputAudioNode = this._soundGain, this.spatialSound && this._createSpatialParameters(), this._scene.mainSoundTrack.AddSound(this);
                    var a = !0;
                    if (i) try {
                        "string" == typeof i ? this._urlType = "String" : i instanceof ArrayBuffer ? this._urlType = "ArrayBuffer" : i instanceof MediaStream ? this._urlType = "MediaStream" : Array.isArray(i) && (this._urlType = "Array");
                        var u = [],
                            h = !1;
                        switch (this._urlType) {
                            case "MediaStream":
                                this._streaming = !0, this._isReadyToPlay = !0, this._streamingSource = ze.audioEngine.audioContext.createMediaStreamSource(i), this.autoplay && this.play(), this._readyToPlayCallback && this._readyToPlayCallback();
                                break;
                            case "ArrayBuffer":
                                i.byteLength > 0 && (h = !0, this._soundLoaded(i));
                                break;
                            case "String":
                                u.push(i);
                            case "Array":
                                0 === u.length && (u = i);
                                for (var c = 0; c < u.length; c++) {
                                    var d = u[c];
                                    if (-1 !== d.indexOf(".mp3", d.length - 4) && ze.audioEngine.isMP3supported && (h = !0), -1 !== d.indexOf(".ogg", d.length - 4) && ze.audioEngine.isOGGsupported && (h = !0), -1 !== d.indexOf(".wav", d.length - 4) && (h = !0), -1 !== d.indexOf("blob:") && (h = !0), h) {
                                        this._streaming ? (this._htmlAudioElement = new Audio(d), this._htmlAudioElement.controls = !1, this._htmlAudioElement.loop = this.loop, K.SetCorsBehavior(d, this._htmlAudioElement), this._htmlAudioElement.preload = "auto", this._htmlAudioElement.addEventListener("canplaythrough", (function() {
                                            s._isReadyToPlay = !0, s.autoplay && s.play(), s._readyToPlayCallback && s._readyToPlayCallback()
                                        })), document.body.appendChild(this._htmlAudioElement), this._htmlAudioElement.load()) : this._scene._loadFile(d, (function(e) {
                                            s._soundLoaded(e)
                                        }), void 0, !0, !0, (function(e) {
                                            e && V.Error("XHR " + e.status + " error on: " + d + "."), V.Error("Sound creation aborted."), s._scene.mainSoundTrack.RemoveSound(s)
                                        }));
                                        break
                                    }
                                }
                                break;
                            default:
                                a = !1
                        }
                        a ? h || (this._isReadyToPlay = !0, this._readyToPlayCallback && window.setTimeout((function() {
                            s._readyToPlayCallback && s._readyToPlayCallback()
                        }), 1e3)) : V.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")
                    } catch (e) {
                        V.Error("Unexpected error. Sound creation aborted."), this._scene.mainSoundTrack.RemoveSound(this)
                    }
                } else this._scene.mainSoundTrack.AddSound(this), ze.audioEngine.WarnedWebAudioUnsupported || (V.Error("Web Audio is not supported by your browser."), ze.audioEngine.WarnedWebAudioUnsupported = !0), this._readyToPlayCallback && window.setTimeout((function() {
                    s._readyToPlayCallback && s._readyToPlayCallback()
                }), 1e3)
            }
            return e.prototype.dispose = function() {
                ze.audioEngine.canUseWebAudio && (this.isPlaying && this.stop(), this._isReadyToPlay = !1, -1 === this.soundTrackId ? this._scene.mainSoundTrack.RemoveSound(this) : this._scene.soundTracks && this._scene.soundTracks[this.soundTrackId].RemoveSound(this), this._soundGain && (this._soundGain.disconnect(), this._soundGain = null), this._soundPanner && (this._soundPanner.disconnect(), this._soundPanner = null), this._soundSource && (this._soundSource.disconnect(), this._soundSource = null), this._audioBuffer = null, this._htmlAudioElement && (this._htmlAudioElement.pause(), this._htmlAudioElement.src = "", document.body.removeChild(this._htmlAudioElement)), this._streamingSource && this._streamingSource.disconnect(), this._connectedTransformNode && this._registerFunc && (this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc), this._connectedTransformNode = null))
            }, e.prototype.isReady = function() {
                return this._isReadyToPlay
            }, e.prototype._soundLoaded = function(e) {
                var t = this;
                ze.audioEngine.audioContext && ze.audioEngine.audioContext.decodeAudioData(e, (function(e) {
                    t._audioBuffer = e, t._isReadyToPlay = !0, t.autoplay && t.play(), t._readyToPlayCallback && t._readyToPlayCallback()
                }), (function(e) {
                    V.Error("Error while decoding audio data for: " + t.name + " / Error: " + e)
                }))
            }, e.prototype.setAudioBuffer = function(e) {
                ze.audioEngine.canUseWebAudio && (this._audioBuffer = e, this._isReadyToPlay = !0)
            }, e.prototype.updateOptions = function(e) {
                e && (this.loop = e.loop || this.loop, this.maxDistance = e.maxDistance || this.maxDistance, this.useCustomAttenuation = e.useCustomAttenuation || this.useCustomAttenuation, this.rolloffFactor = e.rolloffFactor || this.rolloffFactor, this.refDistance = e.refDistance || this.refDistance, this.distanceModel = e.distanceModel || this.distanceModel, this._playbackRate = e.playbackRate || this._playbackRate, this._updateSpatialParameters(), this.isPlaying && (this._streaming && this._htmlAudioElement ? this._htmlAudioElement.playbackRate = this._playbackRate : this._soundSource && (this._soundSource.playbackRate.value = this._playbackRate)))
            }, e.prototype._createSpatialParameters = function() {
                ze.audioEngine.canUseWebAudio && ze.audioEngine.audioContext && (this._scene.headphone && (this._panningModel = "HRTF"), this._soundPanner = ze.audioEngine.audioContext.createPanner(), this._updateSpatialParameters(), this._soundPanner.connect(this._outputAudioNode), this._inputAudioNode = this._soundPanner)
            }, e.prototype._updateSpatialParameters = function() {
                this.spatialSound && this._soundPanner && (this.useCustomAttenuation ? (this._soundPanner.distanceModel = "linear", this._soundPanner.maxDistance = Number.MAX_VALUE, this._soundPanner.refDistance = 1, this._soundPanner.rolloffFactor = 1, this._soundPanner.panningModel = this._panningModel) : (this._soundPanner.distanceModel = this.distanceModel, this._soundPanner.maxDistance = this.maxDistance, this._soundPanner.refDistance = this.refDistance, this._soundPanner.rolloffFactor = this.rolloffFactor, this._soundPanner.panningModel = this._panningModel))
            }, e.prototype.switchPanningModelToHRTF = function() {
                this._panningModel = "HRTF", this._switchPanningModel()
            }, e.prototype.switchPanningModelToEqualPower = function() {
                this._panningModel = "equalpower", this._switchPanningModel()
            }, e.prototype._switchPanningModel = function() {
                ze.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.panningModel = this._panningModel)
            }, e.prototype.connectToSoundTrackAudioNode = function(e) {
                ze.audioEngine.canUseWebAudio && (this._isOutputConnected && this._outputAudioNode.disconnect(), this._outputAudioNode.connect(e), this._isOutputConnected = !0)
            }, e.prototype.setDirectionalCone = function(e, t, i) {
                t < e ? V.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.") : (this._coneInnerAngle = e, this._coneOuterAngle = t, this._coneOuterGain = i, this._isDirectional = !0, this.isPlaying && this.loop && (this.stop(), this.play()))
            }, Object.defineProperty(e.prototype, "directionalConeInnerAngle", {
                get: function() {
                    return this._coneInnerAngle
                },
                set: function(e) {
                    if (e != this._coneInnerAngle) {
                        if (this._coneOuterAngle < e) return void V.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");
                        this._coneInnerAngle = e, ze.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.coneInnerAngle = this._coneInnerAngle)
                    }
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "directionalConeOuterAngle", {
                get: function() {
                    return this._coneOuterAngle
                },
                set: function(e) {
                    if (e != this._coneOuterAngle) {
                        if (e < this._coneInnerAngle) return void V.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");
                        this._coneOuterAngle = e, ze.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && (this._soundPanner.coneOuterAngle = this._coneOuterAngle)
                    }
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.setPosition = function(e) {
                this._position = e, ze.audioEngine.canUseWebAudio && this.spatialSound && this._soundPanner && !isNaN(this._position.x) && !isNaN(this._position.y) && !isNaN(this._position.z) && this._soundPanner.setPosition(this._position.x, this._position.y, this._position.z)
            }, e.prototype.setLocalDirectionToMesh = function(e) {
                this._localDirection = e, ze.audioEngine.canUseWebAudio && this._connectedTransformNode && this.isPlaying && this._updateDirection()
            }, e.prototype._updateDirection = function() {
                if (this._connectedTransformNode && this._soundPanner) {
                    var e = this._connectedTransformNode.getWorldMatrix(),
                        t = b.TransformNormal(this._localDirection, e);
                    t.normalize(), this._soundPanner.setOrientation(t.x, t.y, t.z)
                }
            }, e.prototype.updateDistanceFromListener = function() {
                if (ze.audioEngine.canUseWebAudio && this._connectedTransformNode && this.useCustomAttenuation && this._soundGain && this._scene.activeCamera) {
                    var e = this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);
                    this._soundGain.gain.value = this._customAttenuationFunction(this._volume, e, this.maxDistance, this.refDistance, this.rolloffFactor)
                }
            }, e.prototype.setAttenuationFunction = function(e) {
                this._customAttenuationFunction = e
            }, e.prototype.play = function(e, t) {
                var i = this;
                if (this._isReadyToPlay && this._scene.audioEnabled && ze.audioEngine.audioContext) try {
                    this._startOffset < 0 && (e = -this._startOffset, this._startOffset = 0);
                    var n = e ? ze.audioEngine.audioContext.currentTime + e : ze.audioEngine.audioContext.currentTime;
                    if (this._soundSource && this._streamingSource || this.spatialSound && this._soundPanner && (isNaN(this._position.x) || isNaN(this._position.y) || isNaN(this._position.z) || this._soundPanner.setPosition(this._position.x, this._position.y, this._position.z), this._isDirectional && (this._soundPanner.coneInnerAngle = this._coneInnerAngle, this._soundPanner.coneOuterAngle = this._coneOuterAngle, this._soundPanner.coneOuterGain = this._coneOuterGain, this._connectedTransformNode ? this._updateDirection() : this._soundPanner.setOrientation(this._localDirection.x, this._localDirection.y, this._localDirection.z))), this._streaming) {
                        if (this._streamingSource || (this._streamingSource = ze.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement), this._htmlAudioElement.onended = function() {
                                i._onended()
                            }, this._htmlAudioElement.playbackRate = this._playbackRate), this._streamingSource.disconnect(), this._streamingSource.connect(this._inputAudioNode), this._htmlAudioElement)(r = function() {
                            if (ze.audioEngine.unlocked) {
                                var e = i._htmlAudioElement.play();
                                void 0 !== e && e.catch((function(e) {
                                    ze.audioEngine.lock(), (i.loop || i.autoplay) && ze.audioEngine.onAudioUnlockedObservable.addOnce((function() {
                                        r()
                                    }))
                                }))
                            } else(i.loop || i.autoplay) && ze.audioEngine.onAudioUnlockedObservable.addOnce((function() {
                                r()
                            }))
                        })()
                    } else {
                        var r = function() {
                            ze.audioEngine.audioContext && (i._soundSource = ze.audioEngine.audioContext.createBufferSource(), i._soundSource.buffer = i._audioBuffer, i._soundSource.connect(i._inputAudioNode), i._soundSource.loop = i.loop, i._soundSource.playbackRate.value = i._playbackRate, i._soundSource.onended = function() {
                                i._onended()
                            }, n = e ? ze.audioEngine.audioContext.currentTime + e : ze.audioEngine.audioContext.currentTime, i._soundSource.start(n, i.isPaused ? i._startOffset % i._soundSource.buffer.duration : t || 0))
                        };
                        "suspended" === ze.audioEngine.audioContext.state ? setTimeout((function() {
                            "suspended" === ze.audioEngine.audioContext.state ? (ze.audioEngine.lock(), (i.loop || i.autoplay) && ze.audioEngine.onAudioUnlockedObservable.addOnce((function() {
                                r()
                            }))) : r()
                        }), 500) : r()
                    }
                    this._startTime = n, this.isPlaying = !0, this.isPaused = !1
                } catch (e) {
                    V.Error("Error while trying to play audio: " + this.name + ", " + e.message)
                }
            }, e.prototype._onended = function() {
                this.isPlaying = !1, this.onended && this.onended(), this.onEndedObservable.notifyObservers(this)
            }, e.prototype.stop = function(e) {
                var t = this;
                if (this.isPlaying)
                    if (this._streaming) this._htmlAudioElement ? (this._htmlAudioElement.pause(), this._htmlAudioElement.currentTime > 0 && (this._htmlAudioElement.currentTime = 0)) : this._streamingSource.disconnect(), this.isPlaying = !1;
                    else if (ze.audioEngine.audioContext && this._soundSource) {
                    var i = e ? ze.audioEngine.audioContext.currentTime + e : ze.audioEngine.audioContext.currentTime;
                    this._soundSource.stop(i), this._soundSource.onended = function() {
                        t.isPlaying = !1
                    }, this.isPaused || (this._startOffset = 0)
                }
            }, e.prototype.pause = function() {
                this.isPlaying && (this.isPaused = !0, this._streaming ? this._htmlAudioElement ? this._htmlAudioElement.pause() : this._streamingSource.disconnect() : ze.audioEngine.audioContext && (this.stop(0), this._startOffset += ze.audioEngine.audioContext.currentTime - this._startTime))
            }, e.prototype.setVolume = function(e, t) {
                ze.audioEngine.canUseWebAudio && this._soundGain && (t && ze.audioEngine.audioContext ? (this._soundGain.gain.cancelScheduledValues(ze.audioEngine.audioContext.currentTime), this._soundGain.gain.setValueAtTime(this._soundGain.gain.value, ze.audioEngine.audioContext.currentTime), this._soundGain.gain.linearRampToValueAtTime(e, ze.audioEngine.audioContext.currentTime + t)) : this._soundGain.gain.value = e), this._volume = e
            }, e.prototype.setPlaybackRate = function(e) {
                this._playbackRate = e, this.isPlaying && (this._streaming && this._htmlAudioElement ? this._htmlAudioElement.playbackRate = this._playbackRate : this._soundSource && (this._soundSource.playbackRate.value = this._playbackRate))
            }, e.prototype.getVolume = function() {
                return this._volume
            }, e.prototype.attachToMesh = function(e) {
                var t = this;
                this._connectedTransformNode && this._registerFunc && (this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc), this._registerFunc = null), this._connectedTransformNode = e, this.spatialSound || (this.spatialSound = !0, this._createSpatialParameters(), this.isPlaying && this.loop && (this.stop(), this.play())), this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode), this._registerFunc = function(e) {
                    return t._onRegisterAfterWorldMatrixUpdate(e)
                }, this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)
            }, e.prototype.detachFromMesh = function() {
                this._connectedTransformNode && this._registerFunc && (this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc), this._registerFunc = null, this._connectedTransformNode = null)
            }, e.prototype._onRegisterAfterWorldMatrixUpdate = function(e) {
                if (e.getBoundingInfo) {
                    var t = e;
                    if (this._positionInEmitterSpace) t.worldMatrixFromCache.invertToRef(N.Matrix[0]), this.setPosition(N.Matrix[0].getTranslation());
                    else {
                        var i = t.getBoundingInfo();
                        this.setPosition(i.boundingSphere.centerWorld)
                    }
                    ze.audioEngine.canUseWebAudio && this._isDirectional && this.isPlaying && this._updateDirection()
                }
            }, e.prototype.clone = function() {
                var t = this;
                if (this._streaming) return null;
                var i = function() {
                        t._isReadyToPlay ? (r._audioBuffer = t.getAudioBuffer(), r._isReadyToPlay = !0, r.autoplay && r.play()) : window.setTimeout(i, 300)
                    },
                    n = {
                        autoplay: this.autoplay,
                        loop: this.loop,
                        volume: this._volume,
                        spatialSound: this.spatialSound,
                        maxDistance: this.maxDistance,
                        useCustomAttenuation: this.useCustomAttenuation,
                        rolloffFactor: this.rolloffFactor,
                        refDistance: this.refDistance,
                        distanceModel: this.distanceModel
                    },
                    r = new e(this.name + "_cloned", new ArrayBuffer(0), this._scene, null, n);
                return this.useCustomAttenuation && r.setAttenuationFunction(this._customAttenuationFunction), r.setPosition(this._position), r.setPlaybackRate(this._playbackRate), i(), r
            }, e.prototype.getAudioBuffer = function() {
                return this._audioBuffer
            }, e.prototype.serialize = function() {
                var e = {
                    name: this.name,
                    url: this.name,
                    autoplay: this.autoplay,
                    loop: this.loop,
                    volume: this._volume,
                    spatialSound: this.spatialSound,
                    maxDistance: this.maxDistance,
                    rolloffFactor: this.rolloffFactor,
                    refDistance: this.refDistance,
                    distanceModel: this.distanceModel,
                    playbackRate: this._playbackRate,
                    panningModel: this._panningModel,
                    soundTrackId: this.soundTrackId
                };
                return this.spatialSound && (this._connectedTransformNode && (e.connectedMeshId = this._connectedTransformNode.id), e.position = this._position.asArray(), e.refDistance = this.refDistance, e.distanceModel = this.distanceModel, e.isDirectional = this._isDirectional, e.localDirectionToMesh = this._localDirection.asArray(), e.coneInnerAngle = this._coneInnerAngle, e.coneOuterAngle = this._coneOuterAngle, e.coneOuterGain = this._coneOuterGain), e
            }, e.Parse = function(t, i, n, r) {
                var o, s = t.name;
                o = t.url ? n + t.url : n + s;
                var a, u = {
                    autoplay: t.autoplay,
                    loop: t.loop,
                    volume: t.volume,
                    spatialSound: t.spatialSound,
                    maxDistance: t.maxDistance,
                    rolloffFactor: t.rolloffFactor,
                    refDistance: t.refDistance,
                    distanceModel: t.distanceModel,
                    playbackRate: t.playbackRate
                };
                if (r) {
                    var h = function() {
                        r._isReadyToPlay ? (a._audioBuffer = r.getAudioBuffer(), a._isReadyToPlay = !0, a.autoplay && a.play()) : window.setTimeout(h, 300)
                    };
                    a = new e(s, new ArrayBuffer(0), i, null, u), h()
                } else a = new e(s, o, i, (function() {
                    i._removePendingData(a)
                }), u), i._addPendingData(a);
                if (t.position) {
                    var l = b.FromArray(t.position);
                    a.setPosition(l)
                }
                if (t.isDirectional && (a.setDirectionalCone(t.coneInnerAngle || 360, t.coneOuterAngle || 360, t.coneOuterGain || 0), t.localDirectionToMesh)) {
                    var c = b.FromArray(t.localDirectionToMesh);
                    a.setLocalDirectionToMesh(c)
                }
                if (t.connectedMeshId) {
                    var d = i.getMeshByID(t.connectedMeshId);
                    d && a.attachToMesh(d)
                }
                return a
            }, e._SceneComponentInitialization = function(e) {
                throw X.WarnImport("AudioSceneComponent")
            }, e
        }(),
        yn = function() {
            function e(e, t) {
                void 0 === t && (t = {}), this.id = -1, this._isMainTrack = !1, this._isInitialized = !1, this._scene = e, this.soundCollection = new Array, this._options = t, !this._isMainTrack && this._scene.soundTracks && (this._scene.soundTracks.push(this), this.id = this._scene.soundTracks.length - 1)
            }
            return e.prototype._initializeSoundTrackAudioGraph = function() {
                ze.audioEngine.canUseWebAudio && ze.audioEngine.audioContext && (this._outputAudioNode = ze.audioEngine.audioContext.createGain(), this._outputAudioNode.connect(ze.audioEngine.masterGain), this._options && (this._options.volume && (this._outputAudioNode.gain.value = this._options.volume), this._options.mainTrack && (this._isMainTrack = this._options.mainTrack)), this._isInitialized = !0)
            }, e.prototype.dispose = function() {
                if (ze.audioEngine && ze.audioEngine.canUseWebAudio) {
                    for (this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(); this.soundCollection.length;) this.soundCollection[0].dispose();
                    this._outputAudioNode && this._outputAudioNode.disconnect(), this._outputAudioNode = null
                }
            }, e.prototype.AddSound = function(e) {
                this._isInitialized || this._initializeSoundTrackAudioGraph(), ze.audioEngine.canUseWebAudio && this._outputAudioNode && e.connectToSoundTrackAudioNode(this._outputAudioNode), e.soundTrackId && (-1 === e.soundTrackId ? this._scene.mainSoundTrack.RemoveSound(e) : this._scene.soundTracks && this._scene.soundTracks[e.soundTrackId].RemoveSound(e)), this.soundCollection.push(e), e.soundTrackId = this.id
            }, e.prototype.RemoveSound = function(e) {
                var t = this.soundCollection.indexOf(e); - 1 !== t && this.soundCollection.splice(t, 1)
            }, e.prototype.setVolume = function(e) {
                ze.audioEngine.canUseWebAudio && this._outputAudioNode && (this._outputAudioNode.gain.value = e)
            }, e.prototype.switchPanningModelToHRTF = function() {
                if (ze.audioEngine.canUseWebAudio)
                    for (var e = 0; e < this.soundCollection.length; e++) this.soundCollection[e].switchPanningModelToHRTF()
            }, e.prototype.switchPanningModelToEqualPower = function() {
                if (ze.audioEngine.canUseWebAudio)
                    for (var e = 0; e < this.soundCollection.length; e++) this.soundCollection[e].switchPanningModelToEqualPower()
            }, e.prototype.connectToAnalyser = function(e) {
                this._connectedAnalyser && this._connectedAnalyser.stopDebugCanvas(), this._connectedAnalyser = e, ze.audioEngine.canUseWebAudio && this._outputAudioNode && (this._outputAudioNode.disconnect(), this._connectedAnalyser.connectAudioNodes(this._outputAudioNode, ze.audioEngine.masterGain))
            }, e
        }();
    et.AddParser(lt.NAME_AUDIO, (function(e, t, i, n) {
        var r, o = [];
        if (i.sounds = i.sounds || [], void 0 !== e.sounds && null !== e.sounds)
            for (var s = 0, a = e.sounds.length; s < a; s++) {
                var u = e.sounds[s];
                ze.audioEngine.canUseWebAudio ? (u.url || (u.url = u.name), o[u.url] ? i.sounds.push(vn.Parse(u, t, n, o[u.url])) : (r = vn.Parse(u, t, n), o[u.url] = r, i.sounds.push(r))) : i.sounds.push(new vn(u.name, null, t))
            }
        o = []
    })), Object.defineProperty(Et.prototype, "mainSoundTrack", {
        get: function() {
            var e = this._getComponent(lt.NAME_AUDIO);
            return e || (e = new Tn(this), this._addComponent(e)), this._mainSoundTrack || (this._mainSoundTrack = new yn(this, {
                mainTrack: !0
            })), this._mainSoundTrack
        },
        enumerable: !0,
        configurable: !0
    }), Et.prototype.getSoundByName = function(e) {
        var t;
        for (t = 0; t < this.mainSoundTrack.soundCollection.length; t++)
            if (this.mainSoundTrack.soundCollection[t].name === e) return this.mainSoundTrack.soundCollection[t];
        if (this.soundTracks)
            for (var i = 0; i < this.soundTracks.length; i++)
                for (t = 0; t < this.soundTracks[i].soundCollection.length; t++)
                    if (this.soundTracks[i].soundCollection[t].name === e) return this.soundTracks[i].soundCollection[t];
        return null
    }, Object.defineProperty(Et.prototype, "audioEnabled", {
        get: function() {
            var e = this._getComponent(lt.NAME_AUDIO);
            return e || (e = new Tn(this), this._addComponent(e)), e.audioEnabled
        },
        set: function(e) {
            var t = this._getComponent(lt.NAME_AUDIO);
            t || (t = new Tn(this), this._addComponent(t)), e ? t.enableAudio() : t.disableAudio()
        },
        enumerable: !0,
        configurable: !0
    }), Object.defineProperty(Et.prototype, "headphone", {
        get: function() {
            var e = this._getComponent(lt.NAME_AUDIO);
            return e || (e = new Tn(this), this._addComponent(e)), e.headphone
        },
        set: function(e) {
            var t = this._getComponent(lt.NAME_AUDIO);
            t || (t = new Tn(this), this._addComponent(t)), e ? t.switchAudioModeForHeadphones() : t.switchAudioModeForNormalSpeakers()
        },
        enumerable: !0,
        configurable: !0
    });
    var Tn = function() {
        function e(e) {
            this.name = lt.NAME_AUDIO, this._audioEnabled = !0, this._headphone = !1, this.scene = e, e.soundTracks = new Array, e.sounds = new Array
        }
        return Object.defineProperty(e.prototype, "audioEnabled", {
            get: function() {
                return this._audioEnabled
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "headphone", {
            get: function() {
                return this._headphone
            },
            enumerable: !0,
            configurable: !0
        }), e.prototype.register = function() {
            this.scene._afterRenderStage.registerStep(lt.STEP_AFTERRENDER_AUDIO, this, this._afterRender)
        }, e.prototype.rebuild = function() {}, e.prototype.serialize = function(e) {
            if (e.sounds = [], this.scene.soundTracks)
                for (var t = 0; t < this.scene.soundTracks.length; t++)
                    for (var i = this.scene.soundTracks[t], n = 0; n < i.soundCollection.length; n++) e.sounds.push(i.soundCollection[n].serialize())
        }, e.prototype.addFromContainer = function(e) {
            var t = this;
            e.sounds && e.sounds.forEach((function(e) {
                e.play(), e.autoplay = !0, t.scene.mainSoundTrack.AddSound(e)
            }))
        }, e.prototype.removeFromContainer = function(e, t) {
            var i = this;
            void 0 === t && (t = !1), e.sounds && e.sounds.forEach((function(e) {
                e.stop(), e.autoplay = !1, i.scene.mainSoundTrack.RemoveSound(e), t && e.dispose()
            }))
        }, e.prototype.dispose = function() {
            var e = this.scene;
            if (e._mainSoundTrack && e.mainSoundTrack.dispose(), e.soundTracks)
                for (var t = 0; t < e.soundTracks.length; t++) e.soundTracks[t].dispose()
        }, e.prototype.disableAudio = function() {
            var e, t = this.scene;
            for (this._audioEnabled = !1, e = 0; e < t.mainSoundTrack.soundCollection.length; e++) t.mainSoundTrack.soundCollection[e].pause();
            if (t.soundTracks)
                for (e = 0; e < t.soundTracks.length; e++)
                    for (var i = 0; i < t.soundTracks[e].soundCollection.length; i++) t.soundTracks[e].soundCollection[i].pause()
        }, e.prototype.enableAudio = function() {
            var e, t = this.scene;
            for (this._audioEnabled = !0, e = 0; e < t.mainSoundTrack.soundCollection.length; e++) t.mainSoundTrack.soundCollection[e].isPaused && t.mainSoundTrack.soundCollection[e].play();
            if (t.soundTracks)
                for (e = 0; e < t.soundTracks.length; e++)
                    for (var i = 0; i < t.soundTracks[e].soundCollection.length; i++) t.soundTracks[e].soundCollection[i].isPaused && t.soundTracks[e].soundCollection[i].play()
        }, e.prototype.switchAudioModeForHeadphones = function() {
            var e = this.scene;
            if (this._headphone = !0, e.mainSoundTrack.switchPanningModelToHRTF(), e.soundTracks)
                for (var t = 0; t < e.soundTracks.length; t++) e.soundTracks[t].switchPanningModelToHRTF()
        }, e.prototype.switchAudioModeForNormalSpeakers = function() {
            var e = this.scene;
            if (this._headphone = !1, e.mainSoundTrack.switchPanningModelToEqualPower(), e.soundTracks)
                for (var t = 0; t < e.soundTracks.length; t++) e.soundTracks[t].switchPanningModelToEqualPower()
        }, e.prototype._afterRender = function() {
            var e = this.scene;
            if (this._audioEnabled && e._mainSoundTrack && e.soundTracks && (0 !== e._mainSoundTrack.soundCollection.length || 1 !== e.soundTracks.length)) {
                var t, i = ze.audioEngine;
                if ((t = e.activeCameras.length > 0 ? e.activeCameras[0] : e.activeCamera) && i.audioContext) {
                    i.audioContext.listener.setPosition(t.position.x, t.position.y, t.position.z), t.rigCameras && t.rigCameras.length > 0 && (t = t.rigCameras[0]);
                    var n, r = R.Invert(t.getViewMatrix()),
                        o = b.TransformNormal(new b(0, 0, -1), r);
                    for (o.normalize(), isNaN(o.x) || isNaN(o.y) || isNaN(o.z) || i.audioContext.listener.setOrientation(o.x, o.y, o.z, 0, 1, 0), n = 0; n < e.mainSoundTrack.soundCollection.length; n++) {
                        var s = e.mainSoundTrack.soundCollection[n];
                        s.useCustomAttenuation && s.updateDistanceFromListener()
                    }
                    if (e.soundTracks)
                        for (n = 0; n < e.soundTracks.length; n++)
                            for (var a = 0; a < e.soundTracks[n].soundCollection.length; a++)(s = e.soundTracks[n].soundCollection[a]).useCustomAttenuation && s.updateDistanceFromListener()
                }
            }
        }, e
    }();
    vn._SceneComponentInitialization = function(e) {
        var t = e._getComponent(lt.NAME_AUDIO);
        t || (t = new Tn(e), e._addComponent(t))
    };
    ! function() {
        function e(e, t, i) {
            var n = this;
            if (this.loop = !1, this._coneInnerAngle = 360, this._coneOuterAngle = 360, this._volume = 1, this.isPlaying = !1, this.isPaused = !1, this._sounds = [], this._weights = [], t.length !== i.length) throw new Error("Sounds length does not equal weights length");
            this.loop = e, this._weights = i;
            for (var r = 0, o = 0, s = i; o < s.length; o++) {
                r += s[o]
            }
            for (var a = r > 0 ? 1 / r : 0, u = 0; u < this._weights.length; u++) this._weights[u] *= a;
            this._sounds = t;
            for (var h = 0, l = this._sounds; h < l.length; h++) {
                l[h].onEndedObservable.add((function() {
                    n._onended()
                }))
            }
        }
        Object.defineProperty(e.prototype, "directionalConeInnerAngle", {
            get: function() {
                return this._coneInnerAngle
            },
            set: function(e) {
                if (e !== this._coneInnerAngle) {
                    if (this._coneOuterAngle < e) return void V.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");
                    this._coneInnerAngle = e;
                    for (var t = 0, i = this._sounds; t < i.length; t++) {
                        i[t].directionalConeInnerAngle = e
                    }
                }
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "directionalConeOuterAngle", {
            get: function() {
                return this._coneOuterAngle
            },
            set: function(e) {
                if (e !== this._coneOuterAngle) {
                    if (e < this._coneInnerAngle) return void V.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");
                    this._coneOuterAngle = e;
                    for (var t = 0, i = this._sounds; t < i.length; t++) {
                        i[t].directionalConeOuterAngle = e
                    }
                }
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "volume", {
            get: function() {
                return this._volume
            },
            set: function(e) {
                if (e !== this._volume)
                    for (var t = 0, i = this._sounds; t < i.length; t++) {
                        i[t].setVolume(e)
                    }
            },
            enumerable: !0,
            configurable: !0
        }), e.prototype._onended = function() {
            void 0 !== this._currentIndex && (this._sounds[this._currentIndex].autoplay = !1), this.loop && this.isPlaying ? this.play() : this.isPlaying = !1
        }, e.prototype.pause = function() {
            this.isPaused = !0, void 0 !== this._currentIndex && this._sounds[this._currentIndex].pause()
        }, e.prototype.stop = function() {
            this.isPlaying = !1, void 0 !== this._currentIndex && this._sounds[this._currentIndex].stop()
        }, e.prototype.play = function(e) {
            if (!this.isPaused) {
                this.stop();
                for (var t = Math.random(), i = 0, n = 0; n < this._weights.length; n++)
                    if (t <= (i += this._weights[n])) {
                        this._currentIndex = n;
                        break
                    }
            }
            var r = this._sounds[this._currentIndex];
            r.isReady() ? r.play(0, this.isPaused ? void 0 : e) : r.autoplay = !0, this.isPlaying = !0, this.isPaused = !1
        }
    }();
    var bn = function() {
        function e(e, t, i) {
            var n = this;
            void 0 === t && (t = ""), void 0 === i && (i = "black"), this._renderingCanvas = e, this._loadingText = t, this._loadingDivBackgroundColor = i, this._resizeLoadingUI = function() {
                var e = n._renderingCanvas.getBoundingClientRect(),
                    t = window.getComputedStyle(n._renderingCanvas).position;
                n._loadingDiv && (n._loadingDiv.style.position = "fixed" === t ? "fixed" : "absolute", n._loadingDiv.style.left = e.left + "px", n._loadingDiv.style.top = e.top + "px", n._loadingDiv.style.width = e.width + "px", n._loadingDiv.style.height = e.height + "px")
            }
        }
        return e.prototype.displayLoadingUI = function() {
            if (!this._loadingDiv) {
                this._loadingDiv = document.createElement("div"), this._loadingDiv.id = "babylonjsLoadingDiv", this._loadingDiv.style.opacity = "0", this._loadingDiv.style.transition = "opacity 1.5s ease", this._loadingDiv.style.pointerEvents = "none", this._loadingTextDiv = document.createElement("div"), this._loadingTextDiv.style.position = "absolute", this._loadingTextDiv.style.left = "0", this._loadingTextDiv.style.top = "50%", this._loadingTextDiv.style.marginTop = "80px", this._loadingTextDiv.style.width = "100%", this._loadingTextDiv.style.height = "20px", this._loadingTextDiv.style.fontFamily = "Arial", this._loadingTextDiv.style.fontSize = "14px", this._loadingTextDiv.style.color = "white", this._loadingTextDiv.style.textAlign = "center", this._loadingTextDiv.innerHTML = "Loading", this._loadingDiv.appendChild(this._loadingTextDiv), this._loadingTextDiv.innerHTML = this._loadingText;
                var t = document.createElement("style");
                t.type = "text/css";
                t.innerHTML = "@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }", document.getElementsByTagName("head")[0].appendChild(t);
                var i = new Image;
                e.DefaultLogoUrl ? i.src = e.DefaultLogoUrl : i.src = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+", i.style.position = "absolute", i.style.left = "50%", i.style.top = "50%", i.style.width = "10vw", i.style.height = "10vw", i.style.marginLeft = "-5vw", i.style.marginTop = "-5vw";
                var n = new Image;
                e.DefaultSpinnerUrl ? n.src = e.DefaultSpinnerUrl : n.src = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==", n.style.position = "absolute", n.style.left = "50%", n.style.top = "50%", n.style.width = "18vw", n.style.height = "18vw", n.style.marginLeft = "-9vw", n.style.marginTop = "-9vw", n.style.animation = "spin1 0.75s infinite linear", n.style.webkitAnimation = "spin1 0.75s infinite linear", n.style.transformOrigin = "50% 50%", n.style.webkitTransformOrigin = "50% 50%", this._loadingDiv.appendChild(i), this._loadingDiv.appendChild(n), this._resizeLoadingUI(), window.addEventListener("resize", this._resizeLoadingUI), this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor, document.body.appendChild(this._loadingDiv), this._loadingDiv.style.opacity = "1"
            }
        }, e.prototype.hideLoadingUI = function() {
            var e = this;
            if (this._loadingDiv) {
                this._loadingDiv.style.opacity = "0", this._loadingDiv.addEventListener("transitionend", (function() {
                    e._loadingDiv && (e._loadingDiv.parentElement && e._loadingDiv.parentElement.removeChild(e._loadingDiv), window.removeEventListener("resize", e._resizeLoadingUI), e._loadingDiv = null)
                }))
            }
        }, Object.defineProperty(e.prototype, "loadingUIText", {
            get: function() {
                return this._loadingText
            },
            set: function(e) {
                this._loadingText = e, this._loadingTextDiv && (this._loadingTextDiv.innerHTML = this._loadingText)
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(e.prototype, "loadingUIBackgroundColor", {
            get: function() {
                return this._loadingDivBackgroundColor
            },
            set: function(e) {
                this._loadingDivBackgroundColor = e, this._loadingDiv && (this._loadingDiv.style.backgroundColor = this._loadingDivBackgroundColor)
            },
            enumerable: !0,
            configurable: !0
        }), e.DefaultLogoUrl = "", e.DefaultSpinnerUrl = "", e
    }();
    ze.DefaultLoadingScreenFactory = function(e) {
        return new bn(e)
    };
    var En = function() {
            function e(e, t, i) {
                this.lengthComputable = e, this.loaded = t, this.total = i
            }
            return e.FromProgressEvent = function(t) {
                return new e(t.lengthComputable, t.loaded, t.total)
            }, e
        }(),
        An = function() {
            function e() {}
            return Object.defineProperty(e, "ForceFullSceneLoadingForIncremental", {
                get: function() {
                    return Ot.ForceFullSceneLoadingForIncremental
                },
                set: function(e) {
                    Ot.ForceFullSceneLoadingForIncremental = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "ShowLoadingScreen", {
                get: function() {
                    return Ot.ShowLoadingScreen
                },
                set: function(e) {
                    Ot.ShowLoadingScreen = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "loggingLevel", {
                get: function() {
                    return Ot.loggingLevel
                },
                set: function(e) {
                    Ot.loggingLevel = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "CleanBoneMatrixWeights", {
                get: function() {
                    return Ot.CleanBoneMatrixWeights
                },
                set: function(e) {
                    Ot.CleanBoneMatrixWeights = e
                },
                enumerable: !0,
                configurable: !0
            }), e._getDefaultPlugin = function() {
                return e._registeredPlugins[".babylon"]
            }, e._getPluginForExtension = function(t) {
                var i = e._registeredPlugins[t];
                return i || (V.Warn("Unable to find a plugin to load " + t + " files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"), e._getDefaultPlugin())
            }, e._getPluginForDirectLoad = function(t) {
                for (var i in e._registeredPlugins) {
                    var n = e._registeredPlugins[i].plugin;
                    if (n.canDirectLoad && n.canDirectLoad(t)) return e._registeredPlugins[i]
                }
                return e._getDefaultPlugin()
            }, e._getPluginForFilename = function(t) {
                var i = t.indexOf("?"); - 1 !== i && (t = t.substring(0, i));
                var n = t.lastIndexOf("."),
                    r = t.substring(n, t.length).toLowerCase();
                return e._getPluginForExtension(r)
            }, e._getDirectLoad = function(e) {
                return "data:" === e.substr(0, 5) ? e.substr(5) : null
            }, e._loadData = function(t, i, n, r, o, s, a) {
                var u, h = e._getDirectLoad(t.name),
                    l = a ? e._getPluginForExtension(a) : h ? e._getPluginForDirectLoad(t.name) : e._getPluginForFilename(t.name);
                if (!(u = l.plugin.createPlugin ? l.plugin.createPlugin() : l.plugin)) throw "The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";
                var c, d = l.isBinary;
                e.OnPluginActivatedObservable.notifyObservers(u);
                var f = function(e, t) {
                        i.isDisposed ? o("Scene has been disposed") : (i.offlineProvider = c, n(u, e, t))
                    },
                    p = null,
                    _ = !1,
                    g = u.onDisposeObservable;
                g && g.add((function() {
                    _ = !0, p && (p.abort(), p = null), s()
                }));
                var m = function() {
                    _ || (p = K.LoadFile(t.url, f, r ? function(e) {
                        r(En.FromProgressEvent(e))
                    } : void 0, c, d, (function(e, t) {
                        o("Failed to load scene." + (t ? " " + t.message : ""), t)
                    })))
                };
                if (h) return f(h), u;
                var v = t.file || B.FilesToLoad[t.name.toLowerCase()];
                if (-1 === t.rootUrl.indexOf("file:") || -1 !== t.rootUrl.indexOf("file:") && !v) {
                    var y = i.getEngine(),
                        T = y.enableOfflineSupport;
                    if (T) {
                        for (var b = !1, E = 0, A = i.disableOfflineSupportExceptionRules; E < A.length; E++) {
                            if (A[E].test(t.url)) {
                                b = !0;
                                break
                            }
                        }
                        T = !b
                    }
                    T && ze.OfflineProviderFactory ? c = ze.OfflineProviderFactory(t.url, m, y.disableManifestCheck) : m()
                } else v ? p = K.ReadFile(v, f, r, d) : o("Unable to find file named " + t.name);
                return u
            }, e._getFileInfo = function(e, t) {
                var i, n, r = null;
                if (t)
                    if (t.name) {
                        var o = t;
                        i = e + o.name, n = o.name, r = o
                    } else {
                        var s = t;
                        if ("/" === s.substr(0, 1)) return K.Error("Wrong sceneFilename parameter"), null;
                        i = e + s, n = s
                    }
                else i = e, n = K.GetFilename(e), e = K.GetFolderPath(e);
                return {
                    url: i,
                    rootUrl: e,
                    name: n,
                    file: r
                }
            }, e.GetPluginForExtension = function(t) {
                return e._getPluginForExtension(t).plugin
            }, e.IsPluginForExtensionAvailable = function(t) {
                return !!e._registeredPlugins[t]
            }, e.RegisterPlugin = function(t) {
                if ("string" == typeof t.extensions) {
                    var i = t.extensions;
                    e._registeredPlugins[i.toLowerCase()] = {
                        plugin: t,
                        isBinary: !1
                    }
                } else {
                    var n = t.extensions;
                    Object.keys(n).forEach((function(i) {
                        e._registeredPlugins[i.toLowerCase()] = {
                            plugin: t,
                            isBinary: n[i].isBinary
                        }
                    }))
                }
            }, e.ImportMesh = function(t, i, n, r, o, s, a, u) {
                if (void 0 === n && (n = ""), void 0 === r && (r = ve.LastCreatedScene), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === u && (u = null), !r) return V.Error("No scene available to import mesh to"), null;
                var h = e._getFileInfo(i, n);
                if (!h) return null;
                var l = {};
                r._addPendingData(l);
                var c = function() {
                        r._removePendingData(l)
                    },
                    d = function(e, t) {
                        var i = "Unable to import meshes from " + h.url + ": " + e;
                        a ? a(r, i, t) : V.Error(i), c()
                    },
                    f = s ? function(e) {
                        try {
                            s(e)
                        } catch (e) {
                            d("Error in onProgress callback", e)
                        }
                    } : void 0,
                    p = function(e, t, i, n) {
                        if (r.importedMeshesFiles.push(h.url), o) try {
                            o(e, t, i, n)
                        } catch (e) {
                            d("Error in onSuccess callback", e)
                        }
                        r._removePendingData(l)
                    };
                return e._loadData(h, r, (function(e, i, n) {
                    if (e.rewriteRootURL && (h.rootUrl = e.rewriteRootURL(h.rootUrl, n)), e.importMesh) {
                        var o = e,
                            s = new Array,
                            a = new Array,
                            u = new Array;
                        if (!o.importMesh(t, r, i, h.rootUrl, s, a, u, d)) return;
                        r.loadingPluginName = e.name, p(s, a, u, [])
                    } else {
                        e.importMeshAsync(t, r, i, h.rootUrl, f, h.name).then((function(t) {
                            r.loadingPluginName = e.name, p(t.meshes, t.particleSystems, t.skeletons, t.animationGroups)
                        })).catch((function(e) {
                            d(e.message, e)
                        }))
                    }
                }), f, d, c, u)
            }, e.ImportMeshAsync = function(t, i, n, r, o, s) {
                return void 0 === n && (n = ""), void 0 === r && (r = ve.LastCreatedScene), void 0 === o && (o = null), void 0 === s && (s = null), new Promise((function(a, u) {
                    e.ImportMesh(t, i, n, r, (function(e, t, i, n) {
                        a({
                            meshes: e,
                            particleSystems: t,
                            skeletons: i,
                            animationGroups: n
                        })
                    }), o, (function(e, t, i) {
                        u(i || new Error(t))
                    }), s)
                }))
            }, e.Load = function(t, i, n, r, o, s, a) {
                return void 0 === i && (i = ""), void 0 === n && (n = ve.LastCreatedEngine), void 0 === r && (r = null), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), n ? e.Append(t, i, new Et(n), r, o, s, a) : (K.Error("No engine available"), null)
            }, e.LoadAsync = function(t, i, n, r, o) {
                return void 0 === i && (i = ""), void 0 === n && (n = ve.LastCreatedEngine), void 0 === r && (r = null), void 0 === o && (o = null), new Promise((function(s, a) {
                    e.Load(t, i, n, (function(e) {
                        s(e)
                    }), r, (function(e, t, i) {
                        a(i || new Error(t))
                    }), o)
                }))
            }, e.Append = function(t, i, n, r, o, s, a) {
                if (void 0 === i && (i = ""), void 0 === n && (n = ve.LastCreatedScene), void 0 === r && (r = null), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), !n) return V.Error("No scene available to append to"), null;
                var u = e._getFileInfo(t, i);
                if (!u) return null;
                e.ShowLoadingScreen && n.getEngine().displayLoadingUI();
                var h = {};
                n._addPendingData(h);
                var l = function() {
                        n._removePendingData(h), n.getEngine().hideLoadingUI()
                    },
                    c = function(e, t) {
                        var i = "Unable to load from " + u.url + (e ? ": " + e : "");
                        s ? s(n, i, t) : V.Error(i), l()
                    },
                    d = o ? function(e) {
                        try {
                            o(e)
                        } catch (e) {
                            c("Error in onProgress callback", e)
                        }
                    } : void 0,
                    f = function() {
                        if (r) try {
                            r(n)
                        } catch (e) {
                            c("Error in onSuccess callback", e)
                        }
                        n._removePendingData(h)
                    };
                return e._loadData(u, n, (function(t, i) {
                    if (t.load) {
                        if (!t.load(n, i, u.rootUrl, c)) return;
                        n.loadingPluginName = t.name, f()
                    } else {
                        t.loadAsync(n, i, u.rootUrl, d, u.name).then((function() {
                            n.loadingPluginName = t.name, f()
                        })).catch((function(e) {
                            c(e.message, e)
                        }))
                    }
                    e.ShowLoadingScreen && n.executeWhenReady((function() {
                        n.getEngine().hideLoadingUI()
                    }))
                }), d, c, l, a)
            }, e.AppendAsync = function(t, i, n, r, o) {
                return void 0 === i && (i = ""), void 0 === n && (n = ve.LastCreatedScene), void 0 === r && (r = null), void 0 === o && (o = null), new Promise((function(s, a) {
                    e.Append(t, i, n, (function(e) {
                        s(e)
                    }), r, (function(e, t, i) {
                        a(i || new Error(t))
                    }), o)
                }))
            }, e.LoadAssetContainer = function(t, i, n, r, o, s, a) {
                if (void 0 === i && (i = ""), void 0 === n && (n = ve.LastCreatedScene), void 0 === r && (r = null), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), !n) return V.Error("No scene available to load asset container to"), null;
                var u = e._getFileInfo(t, i);
                if (!u) return null;
                var h = {};
                n._addPendingData(h);
                var l = function() {
                        n._removePendingData(h)
                    },
                    c = function(e, t) {
                        var i = "Unable to load assets from " + u.url + (e ? ": " + e : "");
                        s ? s(n, i, t) : V.Error(i), l()
                    },
                    d = o ? function(e) {
                        try {
                            o(e)
                        } catch (e) {
                            c("Error in onProgress callback", e)
                        }
                    } : void 0,
                    f = function(e) {
                        if (r) try {
                            r(e)
                        } catch (e) {
                            c("Error in onSuccess callback", e)
                        }
                        n._removePendingData(h)
                    };
                return e._loadData(u, n, (function(t, i) {
                    if (t.loadAssetContainer) {
                        var r = t.loadAssetContainer(n, i, u.rootUrl, c);
                        if (!r) return;
                        n.loadingPluginName = t.name, f(r)
                    } else if (t.loadAssetContainerAsync) {
                        t.loadAssetContainerAsync(n, i, u.rootUrl, d, u.name).then((function(e) {
                            n.loadingPluginName = t.name, f(e)
                        })).catch((function(e) {
                            c(e.message, e)
                        }))
                    } else c("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");
                    e.ShowLoadingScreen && n.executeWhenReady((function() {
                        n.getEngine().hideLoadingUI()
                    }))
                }), d, c, l, a)
            }, e.LoadAssetContainerAsync = function(t, i, n, r, o) {
                return void 0 === i && (i = ""), void 0 === n && (n = ve.LastCreatedScene), void 0 === r && (r = null), void 0 === o && (o = null), new Promise((function(s, a) {
                    e.LoadAssetContainer(t, i, n, (function(e) {
                        s(e)
                    }), r, (function(e, t, i) {
                        a(i || new Error(t))
                    }), o)
                }))
            }, e.NO_LOGGING = k.SCENELOADER_NO_LOGGING, e.MINIMAL_LOGGING = k.SCENELOADER_MINIMAL_LOGGING, e.SUMMARY_LOGGING = k.SCENELOADER_SUMMARY_LOGGING, e.DETAILED_LOGGING = k.SCENELOADER_DETAILED_LOGGING, e.OnPluginActivatedObservable = new l, e._registeredPlugins = {}, e
        }();
    ze.prototype._createDepthStencilCubeTexture = function(e, t) {
        var i = new Le(this, Le.DATASOURCE_UNKNOWN);
        if (i.isCube = !0, 1 === this.webGLVersion) return V.Error("Depth cube texture is not supported by WebGL 1."), i;
        var n = o({
                bilinearFiltering: !1,
                comparisonFunction: 0,
                generateStencil: !1
            }, t),
            r = this._gl;
        this._bindTextureDirectly(r.TEXTURE_CUBE_MAP, i, !0), this._setupDepthStencilTexture(i, e, n.generateStencil, n.bilinearFiltering, n.comparisonFunction);
        for (var s = 0; s < 6; s++) n.generateStencil ? r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X + s, 0, r.DEPTH24_STENCIL8, e, e, 0, r.DEPTH_STENCIL, r.UNSIGNED_INT_24_8, null) : r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X + s, 0, r.DEPTH_COMPONENT24, e, e, 0, r.DEPTH_COMPONENT, r.UNSIGNED_INT, null);
        return this._bindTextureDirectly(r.TEXTURE_CUBE_MAP, null), i
    }, ze.prototype._partialLoadFile = function(e, t, i, n, r) {
        void 0 === r && (r = null);
        this._loadFile(e, (function(e) {
            i[t] = e, i._internalCount++, 6 === i._internalCount && n(i)
        }), void 0, void 0, !0, (function(e, t) {
            r && e && r(e.status + " " + e.statusText, t)
        }))
    }, ze.prototype._cascadeLoadFiles = function(e, t, i, n) {
        void 0 === n && (n = null);
        var r = [];
        r._internalCount = 0;
        for (var o = 0; o < 6; o++) this._partialLoadFile(i[o], o, r, t, n)
    }, ze.prototype._cascadeLoadImgs = function(e, t, i, n) {
        void 0 === n && (n = null);
        var r = [];
        r._internalCount = 0;
        for (var o = 0; o < 6; o++) this._partialLoadImg(i[o], o, r, e, t, n)
    }, ze.prototype._partialLoadImg = function(e, t, i, n, r, o) {
        var s;
        void 0 === o && (o = null);
        s = K.LoadImage(e, (function() {
            i[t] = s, i._internalCount++, n && n._removePendingData(s), 6 === i._internalCount && r(i)
        }), (function(e, t) {
            n && n._removePendingData(s), o && o(e, t)
        }), n ? n.offlineProvider : null), n && n._addPendingData(s)
    }, ze.prototype.createCubeTexture = function(e, t, i, n, r, o, s, a, u, h, l, c, d) {
        var f = this;
        void 0 === r && (r = null), void 0 === o && (o = null), void 0 === a && (a = null), void 0 === u && (u = !1), void 0 === h && (h = 0), void 0 === l && (l = 0), void 0 === c && (c = null), void 0 === d && (d = []);
        var p = this._gl,
            _ = c || new Le(this, Le.DATASOURCE_CUBE);
        _.isCube = !0, _.url = e, _.generateMipMaps = !n, _._lodGenerationScale = h, _._lodGenerationOffset = l, this._doNotHandleContextLost || (_._extension = a, _._files = i);
        for (var g = e.lastIndexOf("."), m = a || (g > -1 ? e.substring(g).toLowerCase() : ""), v = null, y = 0, T = ze._TextureLoaders; y < T.length; y++) {
            var b = T[y];
            if (-1 === d.indexOf(b) && b.canLoad(m, this._textureFormatInUse, c, !1, !1)) {
                v = b;
                break
            }
        }
        if (v) {
            e = v.transformUrl(e, this._textureFormatInUse);
            var E = function(e) {
                f._bindTextureDirectly(p.TEXTURE_CUBE_MAP, _, !0), v.loadCubeData(e, _, u, r, o)
            };
            i && 6 === i.length ? v.supportCascades ? this._cascadeLoadFiles(t, E, i, o) : o ? o("Textures type does not support cascades.") : V.Warn("Texture loader does not support cascades.") : this._loadFile(e, E, void 0, void 0, !0, (function(e, a) {
                if (v) {
                    var c = v.getFallbackTextureUrl(_.url, f._textureFormatInUse);
                    if (V.Warn(v.constructor.name + " failed when trying to load " + _.url + ", falling back to the next supported loader"), c) return d.push(v), void f.createCubeTexture(c, t, i, n, r, o, s, m, u, h, l, _, d)
                }
                o && e && o(e.status + " " + e.statusText, a)
            }))
        } else {
            if (!i) throw new Error("Cannot load cubemap because files were not defined");
            this._cascadeLoadImgs(t, (function(e) {
                var t = f.needPOTTextures ? K.GetExponentOfTwo(e[0].width, f._caps.maxCubemapTextureSize) : e[0].width,
                    i = t;
                if (f._prepareWorkingCanvas(), f._workingCanvas && f._workingContext) {
                    f._workingCanvas.width = t, f._workingCanvas.height = i;
                    var o = [p.TEXTURE_CUBE_MAP_POSITIVE_X, p.TEXTURE_CUBE_MAP_POSITIVE_Y, p.TEXTURE_CUBE_MAP_POSITIVE_Z, p.TEXTURE_CUBE_MAP_NEGATIVE_X, p.TEXTURE_CUBE_MAP_NEGATIVE_Y, p.TEXTURE_CUBE_MAP_NEGATIVE_Z];
                    f._bindTextureDirectly(p.TEXTURE_CUBE_MAP, _, !0), f._unpackFlipY(!1);
                    for (var a = s ? f._getInternalFormat(s) : f._gl.RGBA, u = 0; u < o.length; u++) e[u].width !== t || e[u].height !== i ? (f._workingContext.drawImage(e[u], 0, 0, e[u].width, e[u].height, 0, 0, t, i), p.texImage2D(o[u], 0, a, a, p.UNSIGNED_BYTE, f._workingCanvas)) : p.texImage2D(o[u], 0, a, a, p.UNSIGNED_BYTE, e[u]);
                    n || p.generateMipmap(p.TEXTURE_CUBE_MAP), f._setCubeMapTextureParams(!n), _.width = t, _.height = i, _.isReady = !0, s && (_.format = s), _.onLoadedObservable.notifyObservers(_), _.onLoadedObservable.clear(), r && r()
                }
            }), i, o)
        }
        return this._internalTexturesCache.push(_), _
    };
    var Mn = function(e) {
        function t(t, i, n, r, o, s, a, u, h, l, c, d, f) {
            void 0 === n && (n = null), void 0 === r && (r = !1), void 0 === o && (o = null), void 0 === s && (s = null), void 0 === a && (a = null), void 0 === u && (u = k.TEXTUREFORMAT_RGBA), void 0 === h && (h = !1), void 0 === l && (l = null), void 0 === c && (c = !1), void 0 === d && (d = .8), void 0 === f && (f = 0);
            var p = e.call(this, i) || this;
            if (p.boundingBoxPosition = b.Zero(), p._rotationY = 0, p._prefiltered = !1, p.name = t, p.url = t, p._noMipmap = r, p.hasAlpha = !1, p._format = u, p.isCube = !0, p._textureMatrix = R.Identity(), p._createPolynomials = c, p.coordinatesMode = Ri.CUBIC_MODE, !t && !o) return p;
            var _ = t.lastIndexOf("."),
                g = l || (_ > -1 ? t.substring(_).toLowerCase() : ""),
                m = ".dds" === g,
                v = ".env" === g;
            if (v ? (p.gammaSpace = !1, p._prefiltered = !1) : (p._prefiltered = h, h && (p.gammaSpace = !1)), p._texture = p._getFromCache(t, r), !o && (v || m || n || (n = ["_px.jpg", "_py.jpg", "_pz.jpg", "_nx.jpg", "_ny.jpg", "_nz.jpg"]), o = [], n))
                for (var y = 0; y < n.length; y++) o.push(t + n[y]);
            return p._files = o, p._texture ? s && (p._texture.isReady ? K.SetImmediate((function() {
                return s()
            })) : p._texture.onLoadedObservable.add(s)) : i.useDelayedTextureLoading ? p.delayLoadState = k.DELAYLOADSTATE_NOTLOADED : p._texture = h ? i.getEngine().createPrefilteredCubeTexture(t, i, d, f, s, a, u, l, p._createPolynomials) : i.getEngine().createCubeTexture(t, i, o, r, s, a, p._format, l, !1, d, f), p
        }
        var i;
        return r(t, e), Object.defineProperty(t.prototype, "boundingBoxSize", {
            get: function() {
                return this._boundingBoxSize
            },
            set: function(e) {
                if (!this._boundingBoxSize || !this._boundingBoxSize.equals(e)) {
                    this._boundingBoxSize = e;
                    var t = this.getScene();
                    t && t.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag)
                }
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(t.prototype, "rotationY", {
            get: function() {
                return this._rotationY
            },
            set: function(e) {
                this._rotationY = e, this.setReflectionTextureMatrix(R.RotationY(this._rotationY))
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(t.prototype, "noMipmap", {
            get: function() {
                return this._noMipmap
            },
            enumerable: !0,
            configurable: !0
        }), t.CreateFromImages = function(e, i, n) {
            var r = "";
            return e.forEach((function(e) {
                return r += e
            })), new t(r, i, null, n, e)
        }, t.CreateFromPrefilteredData = function(e, i, n, r) {
            return void 0 === n && (n = null), void 0 === r && (r = !0), new t(e, i, null, !1, null, null, null, void 0, !0, n, r)
        }, Object.defineProperty(t.prototype, "isPrefiltered", {
            get: function() {
                return this._prefiltered
            },
            enumerable: !0,
            configurable: !0
        }), t.prototype.getClassName = function() {
            return "CubeTexture"
        }, t.prototype.updateURL = function(e, t, i) {
            this.url && (this.releaseInternalTexture(), this.getScene().markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag)), this.url = e, this.delayLoadState = k.DELAYLOADSTATE_NOTLOADED, this._prefiltered = !1, i && (this._delayedOnLoad = i), this.delayLoad(t)
        }, t.prototype.delayLoad = function(e) {
            if (this.delayLoadState === k.DELAYLOADSTATE_NOTLOADED) {
                var t = this.getScene();
                t && (this.delayLoadState = k.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap), this._texture || (this._prefiltered ? this._texture = t.getEngine().createPrefilteredCubeTexture(this.url, t, this.lodGenerationScale, this.lodGenerationOffset, this._delayedOnLoad, void 0, this._format, void 0, this._createPolynomials) : this._texture = t.getEngine().createCubeTexture(this.url, t, this._files, this._noMipmap, this._delayedOnLoad, null, this._format, e)))
            }
        }, t.prototype.getReflectionTextureMatrix = function() {
            return this._textureMatrix
        }, t.prototype.setReflectionTextureMatrix = function(e) {
            var t = this;
            e.updateFlag !== this._textureMatrix.updateFlag && (e.isIdentity() !== this._textureMatrix.isIdentity() && this.getScene().markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag, (function(e) {
                return -1 !== e.getActiveTextures().indexOf(t)
            })), this._textureMatrix = e)
        }, t.Parse = function(e, i, n) {
            var r = me.Parse((function() {
                var r = !1;
                return e.prefiltered && (r = e.prefiltered), new t(n + e.name, i, e.extensions, !1, null, null, null, void 0, r)
            }), e, i);
            if (e.boundingBoxPosition && (r.boundingBoxPosition = b.FromArray(e.boundingBoxPosition)), e.boundingBoxSize && (r.boundingBoxSize = b.FromArray(e.boundingBoxSize)), e.animations)
                for (var o = 0; o < e.animations.length; o++) {
                    var s = e.animations[o],
                        a = G.GetClass("BABYLON.Animation");
                    a && r.animations.push(a.Parse(s))
                }
            return r
        }, t.prototype.clone = function() {
            var e = this,
                i = this.getScene(),
                n = 0,
                r = me.Clone((function() {
                    if (!i) return e;
                    var r = new t(e.url, i, e._extensions, e._noMipmap, e._files);
                    return n = r.uniqueId, r
                }), this);
            return r.uniqueId = n, r
        }, s([ce("rotationY")], t.prototype, "rotationY", null), s([(i = "textureMatrix", he(12, i))], t.prototype, "_textureMatrix", void 0), t
    }(Mi);
    Ri._CubeTextureParser = Mn.Parse, G.RegisteredTypes["BABYLON.CubeTexture"] = Mn;
    var Rn = function() {
            function e() {}
            return e.ConvertPanoramaToCubemap = function(e, t, i, n) {
                if (!e) throw "ConvertPanoramaToCubemap: input cannot be null";
                if (e.length != t * i * 3) throw "ConvertPanoramaToCubemap: input size is wrong";
                return {
                    front: this.CreateCubemapTexture(n, this.FACE_FRONT, e, t, i),
                    back: this.CreateCubemapTexture(n, this.FACE_BACK, e, t, i),
                    left: this.CreateCubemapTexture(n, this.FACE_LEFT, e, t, i),
                    right: this.CreateCubemapTexture(n, this.FACE_RIGHT, e, t, i),
                    up: this.CreateCubemapTexture(n, this.FACE_UP, e, t, i),
                    down: this.CreateCubemapTexture(n, this.FACE_DOWN, e, t, i),
                    size: n,
                    type: k.TEXTURETYPE_FLOAT,
                    format: k.TEXTUREFORMAT_RGB,
                    gammaSpace: !1
                }
            }, e.CreateCubemapTexture = function(e, t, i, n, r) {
                for (var o = new ArrayBuffer(e * e * 4 * 3), s = new Float32Array(o), a = t[1].subtract(t[0]).scale(1 / e), u = t[3].subtract(t[2]).scale(1 / e), h = 1 / e, l = 0, c = 0; c < e; c++) {
                    for (var d = t[0], f = t[2], p = 0; p < e; p++) {
                        var _ = f.subtract(d).scale(l).add(d);
                        _.normalize();
                        var g = this.CalcProjectionSpherical(_, i, n, r);
                        s[c * e * 3 + 3 * p + 0] = g.r, s[c * e * 3 + 3 * p + 1] = g.g, s[c * e * 3 + 3 * p + 2] = g.b, d = d.add(a), f = f.add(u)
                    }
                    l += h
                }
                return s
            }, e.CalcProjectionSpherical = function(e, t, i, n) {
                for (var r = Math.atan2(e.z, e.x), o = Math.acos(e.y); r < -Math.PI;) r += 2 * Math.PI;
                for (; r > Math.PI;) r -= 2 * Math.PI;
                var s = r / Math.PI,
                    a = o / Math.PI;
                s = .5 * s + .5;
                var u = Math.round(s * i);
                u < 0 ? u = 0 : u >= i && (u = i - 1);
                var h = Math.round(a * n);
                h < 0 ? h = 0 : h >= n && (h = n - 1);
                var l = n - h - 1;
                return {
                    r: t[l * i * 3 + 3 * u + 0],
                    g: t[l * i * 3 + 3 * u + 1],
                    b: t[l * i * 3 + 3 * u + 2]
                }
            }, e.FACE_FRONT = [new b(-1, -1, -1), new b(1, -1, -1), new b(-1, 1, -1), new b(1, 1, -1)], e.FACE_BACK = [new b(1, -1, 1), new b(-1, -1, 1), new b(1, 1, 1), new b(-1, 1, 1)], e.FACE_RIGHT = [new b(1, -1, -1), new b(1, -1, 1), new b(1, 1, -1), new b(1, 1, 1)], e.FACE_LEFT = [new b(-1, -1, 1), new b(-1, -1, -1), new b(-1, 1, 1), new b(-1, 1, -1)], e.FACE_DOWN = [new b(-1, 1, -1), new b(1, 1, -1), new b(-1, 1, 1), new b(1, 1, 1)], e.FACE_UP = [new b(-1, -1, 1), new b(1, -1, 1), new b(-1, -1, -1), new b(1, -1, -1)], e
        }(),
        xn = function() {
            function e() {}
            return e.Ldexp = function(e, t) {
                return t > 1023 ? e * Math.pow(2, 1023) * Math.pow(2, t - 1023) : t < -1074 ? e * Math.pow(2, -1074) * Math.pow(2, t + 1074) : e * Math.pow(2, t)
            }, e.Rgbe2float = function(e, t, i, n, r, o) {
                r > 0 ? (r = this.Ldexp(1, r - 136), e[o + 0] = t * r, e[o + 1] = i * r, e[o + 2] = n * r) : (e[o + 0] = 0, e[o + 1] = 0, e[o + 2] = 0)
            }, e.readStringLine = function(e, t) {
                for (var i = "", n = "", r = t; r < e.length - t && "\n" != (n = String.fromCharCode(e[r])); r++) i += n;
                return i
            }, e.RGBE_ReadHeader = function(e) {
                var t, i, n = this.readStringLine(e, 0);
                if ("#" != n[0] || "?" != n[1]) throw "Bad HDR Format.";
                var r = !1,
                    o = !1,
                    s = 0;
                do {
                    s += n.length + 1, "FORMAT=32-bit_rle_rgbe" == (n = this.readStringLine(e, s)) ? o = !0 : 0 == n.length && (r = !0)
                } while (!r);
                if (!o) throw "HDR Bad header format, unsupported FORMAT";
                s += n.length + 1, n = this.readStringLine(e, s);
                var a = /^\-Y (.*) \+X (.*)$/g.exec(n);
                if (!a || a.length < 3) throw "HDR Bad header format, no size";
                if (i = parseInt(a[2]), t = parseInt(a[1]), i < 8 || i > 32767) throw "HDR Bad header format, unsupported size";
                return {
                    height: t,
                    width: i,
                    dataPosition: s += n.length + 1
                }
            }, e.GetCubeMapTextureData = function(e, t) {
                var i = new Uint8Array(e),
                    n = this.RGBE_ReadHeader(i),
                    r = this.RGBE_ReadPixels_RLE(i, n);
                return Rn.ConvertPanoramaToCubemap(r, n.width, n.height, t)
            }, e.RGBE_ReadPixels = function(e, t) {
                return this.RGBE_ReadPixels_RLE(e, t)
            }, e.RGBE_ReadPixels_RLE = function(e, t) {
                for (var i, n, r, o, s, a = t.height, u = t.width, h = t.dataPosition, l = 0, c = 0, d = 0, f = new ArrayBuffer(4 * u), p = new Uint8Array(f), _ = new ArrayBuffer(t.width * t.height * 4 * 3), g = new Float32Array(_); a > 0;) {
                    if (i = e[h++], n = e[h++], r = e[h++], o = e[h++], 2 != i || 2 != n || 128 & r) throw "HDR Bad header format, not RLE";
                    if ((r << 8 | o) != u) throw "HDR Bad header format, wrong scan line width";
                    for (l = 0, d = 0; d < 4; d++)
                        for (c = (d + 1) * u; l < c;)
                            if (i = e[h++], n = e[h++], i > 128) {
                                if (0 == (s = i - 128) || s > c - l) throw "HDR Bad Format, bad scanline data (run)";
                                for (; s-- > 0;) p[l++] = n
                            } else {
                                if (0 == (s = i) || s > c - l) throw "HDR Bad Format, bad scanline data (non-run)";
                                if (p[l++] = n, --s > 0)
                                    for (var m = 0; m < s; m++) p[l++] = e[h++]
                            }
                    for (d = 0; d < u; d++) i = p[d], n = p[d + u], r = p[d + 2 * u], o = p[d + 3 * u], this.Rgbe2float(g, i, n, r, o, (t.height - a) * u * 3 + 3 * d);
                    a--
                }
                return g
            }, e
        }();
    ze.prototype.updateRawTexture = function(e, t, i, n, r, o) {
        if (void 0 === r && (r = null), void 0 === o && (o = ze.TEXTURETYPE_UNSIGNED_INT), e) {
            var s = this._getRGBABufferInternalSizedFormat(o, i),
                a = this._getInternalFormat(i),
                u = this._getWebGLTextureType(o);
            this._bindTextureDirectly(this._gl.TEXTURE_2D, e, !0), this._unpackFlipY(void 0 === n || !!n), this._doNotHandleContextLost || (e._bufferView = t, e.format = i, e.type = o, e.invertY = n, e._compression = r), e.width % 4 != 0 && this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT, 1), r && t ? this._gl.compressedTexImage2D(this._gl.TEXTURE_2D, 0, this.getCaps().s3tc[r], e.width, e.height, 0, t) : this._gl.texImage2D(this._gl.TEXTURE_2D, 0, s, e.width, e.height, 0, a, u, t), e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(this._gl.TEXTURE_2D, null), e.isReady = !0
        }
    }, ze.prototype.createRawTexture = function(e, t, i, n, r, o, s, a, u) {
        void 0 === a && (a = null), void 0 === u && (u = ze.TEXTURETYPE_UNSIGNED_INT);
        var h = new Le(this, Le.DATASOURCE_RAW);
        h.baseWidth = t, h.baseHeight = i, h.width = t, h.height = i, h.format = n, h.generateMipMaps = r, h.samplingMode = s, h.invertY = o, h._compression = a, h.type = u, this._doNotHandleContextLost || (h._bufferView = e), this.updateRawTexture(h, e, n, o, a, u), this._bindTextureDirectly(this._gl.TEXTURE_2D, h, !0);
        var l = this._getSamplingParameters(s, r);
        return this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MAG_FILTER, l.mag), this._gl.texParameteri(this._gl.TEXTURE_2D, this._gl.TEXTURE_MIN_FILTER, l.min), r && this._gl.generateMipmap(this._gl.TEXTURE_2D), this._bindTextureDirectly(this._gl.TEXTURE_2D, null), this._internalTexturesCache.push(h), h
    }, ze.prototype.createRawCubeTexture = function(e, t, i, n, r, o, s, a) {
        void 0 === a && (a = null);
        var u = this._gl,
            h = new Le(this, Le.DATASOURCE_CUBERAW);
        h.isCube = !0, h.format = i, h.type = n, this._doNotHandleContextLost || (h._bufferViewArray = e);
        var l = this._getWebGLTextureType(n),
            c = this._getInternalFormat(i);
        c === u.RGB && (c = u.RGBA), l !== u.FLOAT || this._caps.textureFloatLinearFiltering ? l !== this._gl.HALF_FLOAT_OES || this._caps.textureHalfFloatLinearFiltering ? l !== u.FLOAT || this._caps.textureFloatRender ? l !== u.HALF_FLOAT || this._caps.colorBufferFloat || (r = !1, V.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")) : (r = !1, V.Warn("Render to float textures is not supported. Mipmap generation forced to false.")) : (r = !1, s = ze.TEXTURE_NEAREST_SAMPLINGMODE, V.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")) : (r = !1, s = ze.TEXTURE_NEAREST_SAMPLINGMODE, V.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));
        var d = t,
            f = d;
        h.width = d, h.height = f, !this.needPOTTextures || K.IsExponentOfTwo(h.width) && K.IsExponentOfTwo(h.height) || (r = !1), e && this.updateRawCubeTexture(h, e, i, n, o, a), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, h, !0), e && r && this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);
        var p = this._getSamplingParameters(s, r);
        return u.texParameteri(u.TEXTURE_CUBE_MAP, u.TEXTURE_MAG_FILTER, p.mag), u.texParameteri(u.TEXTURE_CUBE_MAP, u.TEXTURE_MIN_FILTER, p.min), u.texParameteri(u.TEXTURE_CUBE_MAP, u.TEXTURE_WRAP_S, u.CLAMP_TO_EDGE), u.texParameteri(u.TEXTURE_CUBE_MAP, u.TEXTURE_WRAP_T, u.CLAMP_TO_EDGE), this._bindTextureDirectly(u.TEXTURE_CUBE_MAP, null), h.generateMipMaps = r, h
    }, ze.prototype.updateRawCubeTexture = function(e, t, i, n, r, o, s) {
        void 0 === o && (o = null), void 0 === s && (s = 0), e._bufferViewArray = t, e.format = i, e.type = n, e.invertY = r, e._compression = o;
        var a = this._gl,
            u = this._getWebGLTextureType(n),
            h = this._getInternalFormat(i),
            l = this._getRGBABufferInternalSizedFormat(n),
            c = !1;
        h === a.RGB && (h = a.RGBA, c = !0), this._bindTextureDirectly(a.TEXTURE_CUBE_MAP, e, !0), this._unpackFlipY(void 0 === r || !!r), e.width % 4 != 0 && a.pixelStorei(a.UNPACK_ALIGNMENT, 1);
        for (var d = 0; d < 6; d++) {
            var f = t[d];
            o ? a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X + d, s, this.getCaps().s3tc[o], e.width, e.height, 0, f) : (c && (f = this._convertRGBtoRGBATextureData(f, e.width, e.height, n)), a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X + d, s, l, e.width, e.height, 0, h, u, f))
        }(!this.needPOTTextures || K.IsExponentOfTwo(e.width) && K.IsExponentOfTwo(e.height)) && e.generateMipMaps && 0 === s && this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP), this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP, null), e.isReady = !0
    }, ze.prototype.createRawCubeTextureFromUrl = function(e, t, i, n, r, o, s, a, u, h, l, c) {
        var d = this;
        void 0 === u && (u = null), void 0 === h && (h = null), void 0 === l && (l = ze.TEXTURE_TRILINEAR_SAMPLINGMODE), void 0 === c && (c = !1);
        var f = this._gl,
            p = this.createRawCubeTexture(null, i, n, r, !o, c, l);
        t._addPendingData(p), p.url = e, this._internalTexturesCache.push(p);
        return this._loadFile(e, (function(e) {
            ! function(e) {
                var i = p.width,
                    o = s(e);
                if (o) {
                    if (a) {
                        var h = d._getWebGLTextureType(r),
                            l = d._getInternalFormat(n),
                            _ = d._getRGBABufferInternalSizedFormat(r),
                            g = !1;
                        l === f.RGB && (l = f.RGBA, g = !0), d._bindTextureDirectly(f.TEXTURE_CUBE_MAP, p, !0), d._unpackFlipY(!1);
                        for (var m = a(o), v = 0; v < m.length; v++)
                            for (var y = i >> v, T = 0; T < 6; T++) {
                                var b = m[v][T];
                                g && (b = d._convertRGBtoRGBATextureData(b, y, y, r)), f.texImage2D(T, v, _, y, y, 0, l, h, b)
                            }
                        d._bindTextureDirectly(f.TEXTURE_CUBE_MAP, null)
                    } else d.updateRawCubeTexture(p, o, n, r, c);
                    p.isReady = !0, t._removePendingData(p), u && u()
                }
            }(e)
        }), void 0, t.offlineProvider, !0, (function(e, i) {
            t._removePendingData(p), h && e && h(e.status + " " + e.statusText, i)
        })), p
    }, ze.prototype.createRawTexture3D = function(e, t, i, n, r, o, s, a, u, h) {
        void 0 === u && (u = null), void 0 === h && (h = ze.TEXTURETYPE_UNSIGNED_INT);
        var l = new Le(this, Le.DATASOURCE_RAW3D);
        l.baseWidth = t, l.baseHeight = i, l.baseDepth = n, l.width = t, l.height = i, l.depth = n, l.format = r, l.type = h, l.generateMipMaps = o, l.samplingMode = a, l.is3D = !0, this._doNotHandleContextLost || (l._bufferView = e), this.updateRawTexture3D(l, e, r, s, u, h), this._bindTextureDirectly(this._gl.TEXTURE_3D, l, !0);
        var c = this._getSamplingParameters(a, o);
        return this._gl.texParameteri(this._gl.TEXTURE_3D, this._gl.TEXTURE_MAG_FILTER, c.mag), this._gl.texParameteri(this._gl.TEXTURE_3D, this._gl.TEXTURE_MIN_FILTER, c.min), o && this._gl.generateMipmap(this._gl.TEXTURE_3D), this._bindTextureDirectly(this._gl.TEXTURE_3D, null), this._internalTexturesCache.push(l), l
    }, ze.prototype.updateRawTexture3D = function(e, t, i, n, r, o) {
        void 0 === r && (r = null), void 0 === o && (o = ze.TEXTURETYPE_UNSIGNED_INT);
        var s = this._getWebGLTextureType(o),
            a = this._getInternalFormat(i),
            u = this._getRGBABufferInternalSizedFormat(o, i);
        this._bindTextureDirectly(this._gl.TEXTURE_3D, e, !0), this._unpackFlipY(void 0 === n || !!n), this._doNotHandleContextLost || (e._bufferView = t, e.format = i, e.invertY = n, e._compression = r), e.width % 4 != 0 && this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT, 1), r && t ? this._gl.compressedTexImage3D(this._gl.TEXTURE_3D, 0, this.getCaps().s3tc[r], e.width, e.height, e.depth, 0, t) : this._gl.texImage3D(this._gl.TEXTURE_3D, 0, u, e.width, e.height, e.depth, 0, a, s, t), e.generateMipMaps && this._gl.generateMipmap(this._gl.TEXTURE_3D), this._bindTextureDirectly(this._gl.TEXTURE_3D, null), e.isReady = !0
    };
    var Pn = function(e) {
        function t(t, i, n, r, o, s, a, u, h) {
            void 0 === r && (r = !1), void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = !1), void 0 === u && (u = null), void 0 === h && (h = null);
            var l = e.call(this, i) || this;
            return l._generateHarmonics = !0, l._onLoad = null, l._onError = null, l.coordinatesMode = Ri.CUBIC_MODE, l._isBlocking = !0, l._rotationY = 0, l.boundingBoxPosition = b.Zero(), t ? (l.name = t, l.url = t, l.hasAlpha = !1, l.isCube = !0, l._textureMatrix = R.Identity(), l._onLoad = u, l._onError = h, l.gammaSpace = s, l._noMipmap = r, l._size = n, l._texture = l._getFromCache(t, l._noMipmap), l._texture ? u && (l._texture.isReady ? K.SetImmediate((function() {
                return u()
            })) : l._texture.onLoadedObservable.add(u)) : i.useDelayedTextureLoading ? l.delayLoadState = ze.DELAYLOADSTATE_NOTLOADED : l.loadTexture(), l) : l
        }
        return r(t, e), Object.defineProperty(t.prototype, "isBlocking", {
            get: function() {
                return this._isBlocking
            },
            set: function(e) {
                this._isBlocking = e
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(t.prototype, "rotationY", {
            get: function() {
                return this._rotationY
            },
            set: function(e) {
                this._rotationY = e, this.setReflectionTextureMatrix(R.RotationY(this._rotationY))
            },
            enumerable: !0,
            configurable: !0
        }), Object.defineProperty(t.prototype, "boundingBoxSize", {
            get: function() {
                return this._boundingBoxSize
            },
            set: function(e) {
                if (!this._boundingBoxSize || !this._boundingBoxSize.equals(e)) {
                    this._boundingBoxSize = e;
                    var t = this.getScene();
                    t && t.markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag)
                }
            },
            enumerable: !0,
            configurable: !0
        }), t.prototype.getClassName = function() {
            return "HDRCubeTexture"
        }, t.prototype.loadTexture = function() {
            var e = this,
                i = this.getScene();
            i && (this._texture = i.getEngine().createRawCubeTextureFromUrl(this.url, i, this._size, ze.TEXTUREFORMAT_RGB, i.getEngine().getCaps().textureFloat ? ze.TEXTURETYPE_FLOAT : ze.TEXTURETYPE_UNSIGNED_INT, this._noMipmap, (function(i) {
                e.lodGenerationOffset = 0, e.lodGenerationScale = .8;
                var n = e.getScene();
                if (!n) return null;
                var r = xn.GetCubeMapTextureData(i, e._size);
                if (e._generateHarmonics) {
                    var o = Ai.ConvertCubeMapToSphericalPolynomial(r);
                    e.sphericalPolynomial = o
                }
                for (var s = [], a = null, u = 0; u < 6; u++) {
                    if (!n.getEngine().getCaps().textureFloat) {
                        var h = new ArrayBuffer(e._size * e._size * 3);
                        a = new Uint8Array(h)
                    }
                    var l = r[t._facesMapping[u]];
                    if (e.gammaSpace || a)
                        for (var c = 0; c < e._size * e._size; c++)
                            if (e.gammaSpace && (l[3 * c + 0] = Math.pow(l[3 * c + 0], 1 / 2.2), l[3 * c + 1] = Math.pow(l[3 * c + 1], 1 / 2.2), l[3 * c + 2] = Math.pow(l[3 * c + 2], 1 / 2.2)), a) {
                                var d = Math.max(255 * l[3 * c + 0], 0),
                                    f = Math.max(255 * l[3 * c + 1], 0),
                                    p = Math.max(255 * l[3 * c + 2], 0),
                                    _ = Math.max(Math.max(d, f), p);
                                if (_ > 255) {
                                    var g = 255 / _;
                                    d *= g, f *= g, p *= g
                                }
                                a[3 * c + 0] = d, a[3 * c + 1] = f, a[3 * c + 2] = p
                            }
                    a ? s.push(a) : s.push(l)
                }
                return s
            }), null, this._onLoad, this._onError))
        }, t.prototype.clone = function() {
            var e = this.getScene();
            if (!e) return this;
            var i = new t(this.url, e, this._size, this._noMipmap, this._generateHarmonics, this.gammaSpace);
            return i.level = this.level, i.wrapU = this.wrapU, i.wrapV = this.wrapV, i.coordinatesIndex = this.coordinatesIndex, i.coordinatesMode = this.coordinatesMode, i
        }, t.prototype.delayLoad = function() {
            this.delayLoadState === ze.DELAYLOADSTATE_NOTLOADED && (this.delayLoadState = ze.DELAYLOADSTATE_LOADED, this._texture = this._getFromCache(this.url, this._noMipmap), this._texture || this.loadTexture())
        }, t.prototype.getReflectionTextureMatrix = function() {
            return this._textureMatrix
        }, t.prototype.setReflectionTextureMatrix = function(e) {
            var t = this;
            this._textureMatrix = e, e.updateFlag !== this._textureMatrix.updateFlag && e.isIdentity() !== this._textureMatrix.isIdentity() && this.getScene().markAllMaterialsAsDirty(k.MATERIAL_TextureDirtyFlag, (function(e) {
                return -1 !== e.getActiveTextures().indexOf(t)
            }))
        }, t.Parse = function(e, i, n) {
            var r = null;
            return e.name && !e.isRenderTarget && ((r = new t(n + e.name, i, e.size, e.noMipmap, e.generateHarmonics, e.useInGammaSpace)).name = e.name, r.hasAlpha = e.hasAlpha, r.level = e.level, r.coordinatesMode = e.coordinatesMode, r.isBlocking = e.isBlocking), r && (e.boundingBoxPosition && (r.boundingBoxPosition = b.FromArray(e.boundingBoxPosition)), e.boundingBoxSize && (r.boundingBoxSize = b.FromArray(e.boundingBoxSize)), e.rotationY && (r.rotationY = e.rotationY)), r
        }, t.prototype.serialize = function() {
            if (!this.name) return null;
            var e = {};
            return e.name = this.name, e.hasAlpha = this.hasAlpha, e.isCube = !0, e.level = this.level, e.size = this._size, e.coordinatesMode = this.coordinatesMode, e.useInGammaSpace = this.gammaSpace, e.generateHarmonics = this._generateHarmonics, e.customType = "BABYLON.HDRCubeTexture", e.noMipmap = this._noMipmap, e.isBlocking = this._isBlocking, e.rotationY = this._rotationY, e
        }, t._facesMapping = ["right", "left", "up", "down", "front", "back"], t
    }(Mi);
    G.RegisteredTypes["BABYLON.HDRCubeTexture"] = Pn;
    var In, Cn = function(e) {
        function t(t, i, n, r, o, s, a) {
            void 0 === r && (r = !1), void 0 === o && (o = !0), void 0 === s && (s = null), void 0 === a && (a = null);
            var u = e.call(this, i) || this;
            if (u._onLoad = null, u._onError = null, u.coordinatesMode = Ri.CUBIC_MODE, !t) throw new Error("Image url is not set");
            return u.name = t, u.url = t, u._size = n, u._noMipmap = r, u.gammaSpace = o, u._onLoad = s, u._onError = a, u.hasAlpha = !1, u.isCube = !0, u._texture = u._getFromCache(t, u._noMipmap), u._texture ? s && (u._texture.isReady ? K.SetImmediate((function() {
                return s()
            })) : u._texture.onLoadedObservable.add(s)) : i.useDelayedTextureLoading ? u.delayLoadState = ze.DELAYLOADSTATE_NOTLOADED : u.loadImage(u.loadTexture.bind(u), u._onError), u
        }
        return r(t, e), t.prototype.loadImage = function(e, t) {
            var i = this,
                n = document.createElement("canvas"),
                r = new Image;
            r.addEventListener("load", (function() {
                i._width = r.width, i._height = r.height, n.width = i._width, n.height = i._height;
                var t = n.getContext("2d");
                t.drawImage(r, 0, 0);
                var o = t.getImageData(0, 0, r.width, r.height);
                i._buffer = o.data.buffer, n.remove(), e()
            })), r.addEventListener("error", (function(e) {
                t && t(i.getClassName() + " could not be loaded", e)
            })), r.src = this.url
        }, t.prototype.loadTexture = function() {
            var e = this,
                i = this.getScene();
            i && (this._texture = i.getEngine().createRawCubeTextureFromUrl(this.url, i, this._size, ze.TEXTUREFORMAT_RGB, i.getEngine().getCaps().textureFloat ? ze.TEXTURETYPE_FLOAT : ze.TEXTURETYPE_UNSIGNED_INTEGER, this._noMipmap, (function() {
                for (var i = e.getFloat32ArrayFromArrayBuffer(e._buffer), n = Rn.ConvertPanoramaToCubemap(i, e._width, e._height, e._size), r = [], o = 0; o < 6; o++) {
                    var s = n[t._FacesMapping[o]];
                    r.push(s)
                }
                return r
            }), null, this._onLoad, this._onError))
        }, t.prototype.getFloat32ArrayFromArrayBuffer = function(e) {
            for (var t = new DataView(e), i = new Float32Array(3 * e.byteLength / 4), n = 0, r = 0; r < e.byteLength; r++)(r + 1) % 4 != 0 && (i[n++] = t.getUint8(r) / 255);
            return i
        }, t.prototype.getClassName = function() {
            return "EquiRectangularCubeTexture"
        }, t.prototype.clone = function() {
            var e = this.getScene();
            if (!e) return this;
            var i = new t(this.url, e, this._size, this._noMipmap, this.gammaSpace);
            return i.level = this.level, i.wrapU = this.wrapU, i.wrapV = this.wrapV, i.coordinatesIndex = this.coordinatesIndex, i.coordinatesMode = this.coordinatesMode, i
        }, t._FacesMapping = ["right", "left", "up", "down", "front", "back"], t
    }(Mi);
    ! function(e) {
        e[e.INIT = 0] = "INIT", e[e.RUNNING = 1] = "RUNNING", e[e.DONE = 2] = "DONE", e[e.ERROR = 3] = "ERROR"
    }(In || (In = {}));
    var Sn = function() {
            function e(e) {
                this.name = e, this._isCompleted = !1, this._taskState = In.INIT
            }
            return Object.defineProperty(e.prototype, "isCompleted", {
                get: function() {
                    return this._isCompleted
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "taskState", {
                get: function() {
                    return this._taskState
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "errorObject", {
                get: function() {
                    return this._errorObject
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._setErrorObject = function(e, t) {
                this._errorObject || (this._errorObject = {
                    message: e,
                    exception: t
                })
            }, e.prototype.run = function(e, t, i) {
                var n = this;
                this._taskState = In.RUNNING, this.runTask(e, (function() {
                    n.onDoneCallback(t, i)
                }), (function(e, t) {
                    n.onErrorCallback(i, e, t)
                }))
            }, e.prototype.runTask = function(e, t, i) {
                throw new Error("runTask is not implemented")
            }, e.prototype.reset = function() {
                this._taskState = In.INIT
            }, e.prototype.onErrorCallback = function(e, t, i) {
                this._taskState = In.ERROR, this._errorObject = {
                    message: t,
                    exception: i
                }, this.onError && this.onError(this, t, i), e()
            }, e.prototype.onDoneCallback = function(e, t) {
                try {
                    this._taskState = In.DONE, this._isCompleted = !0, this.onSuccess && this.onSuccess(this), e()
                } catch (e) {
                    this.onErrorCallback(t, "Task is done, error executing success callback(s)", e)
                }
            }, e
        }(),
        On = function(e, t, i) {
            this.remainingCount = e, this.totalCount = t, this.task = i
        },
        Dn = function(e) {
            function t(t, i, n, r) {
                var o = e.call(this, t) || this;
                return o.name = t, o.meshesNames = i, o.rootUrl = n, o.sceneFilename = r, o
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                var n = this;
                An.ImportMesh(this.meshesNames, this.rootUrl, this.sceneFilename, e, (function(e, i, r, o) {
                    n.loadedMeshes = e, n.loadedParticleSystems = i, n.loadedSkeletons = r, n.loadedAnimationGroups = o, t()
                }), null, (function(e, t, n) {
                    i(t, n)
                }))
            }, t
        }(Sn),
        wn = function(e) {
            function t(t, i) {
                var n = e.call(this, t) || this;
                return n.name = t, n.url = i, n
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                var n = this;
                e._loadFile(this.url, (function(e) {
                    n.text = e, t()
                }), void 0, !1, !1, (function(e, t) {
                    e && i(e.status + " " + e.statusText, t)
                }))
            }, t
        }(Sn),
        Ln = function(e) {
            function t(t, i) {
                var n = e.call(this, t) || this;
                return n.name = t, n.url = i, n
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                var n = this;
                e._loadFile(this.url, (function(e) {
                    n.data = e, t()
                }), void 0, !0, !0, (function(e, t) {
                    e && i(e.status + " " + e.statusText, t)
                }))
            }, t
        }(Sn),
        Fn = function(e) {
            function t(t, i) {
                var n = e.call(this, t) || this;
                return n.name = t, n.url = i, n
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                var n = this,
                    r = new Image;
                K.SetCorsBehavior(this.url, r), r.onload = function() {
                    n.image = r, t()
                }, r.onerror = function(e) {
                    i("Error loading image", e)
                }, r.src = this.url
            }, t
        }(Sn),
        Nn = function(e) {
            function t(t, i, n, r, o) {
                void 0 === o && (o = Ri.TRILINEAR_SAMPLINGMODE);
                var s = e.call(this, t) || this;
                return s.name = t, s.url = i, s.noMipmap = n, s.invertY = r, s.samplingMode = o, s
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                this.texture = new Ri(this.url, e, this.noMipmap, this.invertY, this.samplingMode, (function() {
                    t()
                }), (function(e, t) {
                    i(e, t)
                }))
            }, t
        }(Sn),
        Un = function(e) {
            function t(t, i, n, r, o) {
                var s = e.call(this, t) || this;
                return s.name = t, s.url = i, s.extensions = n, s.noMipmap = r, s.files = o, s
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                this.texture = new Mn(this.url, e, this.extensions, this.noMipmap, this.files, (function() {
                    t()
                }), (function(e, t) {
                    i(e, t)
                }))
            }, t
        }(Sn),
        Bn = function(e) {
            function t(t, i, n, r, o, s, a) {
                void 0 === r && (r = !1), void 0 === o && (o = !0), void 0 === s && (s = !1), void 0 === a && (a = !1);
                var u = e.call(this, t) || this;
                return u.name = t, u.url = i, u.size = n, u.noMipmap = r, u.generateHarmonics = o, u.gammaSpace = s, u.reserved = a, u
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                this.texture = new Pn(this.url, e, this.size, this.noMipmap, this.generateHarmonics, this.gammaSpace, this.reserved, (function() {
                    t()
                }), (function(e, t) {
                    i(e, t)
                }))
            }, t
        }(Sn),
        kn = function(e) {
            function t(t, i, n, r, o) {
                void 0 === r && (r = !1), void 0 === o && (o = !0);
                var s = e.call(this, t) || this;
                return s.name = t, s.url = i, s.size = n, s.noMipmap = r, s.gammaSpace = o, s
            }
            return r(t, e), t.prototype.runTask = function(e, t, i) {
                this.texture = new Cn(this.url, e, this.size, this.noMipmap, this.gammaSpace, (function() {
                    t()
                }), (function(e, t) {
                    i(e, t)
                }))
            }, t
        }(Sn),
        Vn = function() {
            function e(e) {
                this._isLoading = !1, this._tasks = new Array, this._waitingTasksCount = 0, this._totalTasksCount = 0, this.onTaskSuccessObservable = new l, this.onTaskErrorObservable = new l, this.onTasksDoneObservable = new l, this.onProgressObservable = new l, this.useDefaultLoadingScreen = !0, this._scene = e
            }
            return e.prototype.addMeshTask = function(e, t, i, n) {
                var r = new Dn(e, t, i, n);
                return this._tasks.push(r), r
            }, e.prototype.addTextFileTask = function(e, t) {
                var i = new wn(e, t);
                return this._tasks.push(i), i
            }, e.prototype.addBinaryFileTask = function(e, t) {
                var i = new Ln(e, t);
                return this._tasks.push(i), i
            }, e.prototype.addImageTask = function(e, t) {
                var i = new Fn(e, t);
                return this._tasks.push(i), i
            }, e.prototype.addTextureTask = function(e, t, i, n, r) {
                void 0 === r && (r = Ri.TRILINEAR_SAMPLINGMODE);
                var o = new Nn(e, t, i, n, r);
                return this._tasks.push(o), o
            }, e.prototype.addCubeTextureTask = function(e, t, i, n, r) {
                var o = new Un(e, t, i, n, r);
                return this._tasks.push(o), o
            }, e.prototype.addHDRCubeTextureTask = function(e, t, i, n, r, o, s) {
                void 0 === n && (n = !1), void 0 === r && (r = !0), void 0 === o && (o = !1), void 0 === s && (s = !1);
                var a = new Bn(e, t, i, n, r, o, s);
                return this._tasks.push(a), a
            }, e.prototype.addEquiRectangularCubeTextureAssetTask = function(e, t, i, n, r) {
                void 0 === n && (n = !1), void 0 === r && (r = !0);
                var o = new kn(e, t, i, n, r);
                return this._tasks.push(o), o
            }, e.prototype.removeTask = function(e) {
                var t = this._tasks.indexOf(e);
                t > -1 && this._tasks.splice(t, 1)
            }, e.prototype._decreaseWaitingTasksCount = function(e) {
                this._waitingTasksCount--;
                try {
                    this.onProgress && this.onProgress(this._waitingTasksCount, this._totalTasksCount, e), this.onProgressObservable.notifyObservers(new On(this._waitingTasksCount, this._totalTasksCount, e))
                } catch (e) {
                    V.Error("Error running progress callbacks."), console.log(e)
                }
                if (0 === this._waitingTasksCount) {
                    try {
                        this.onFinish && this.onFinish(this._tasks);
                        for (var t = this._tasks.slice(), i = 0, n = t; i < n.length; i++) {
                            if ((e = n[i]).taskState === In.DONE) {
                                var r = this._tasks.indexOf(e);
                                r > -1 && this._tasks.splice(r, 1)
                            }
                        }
                        this.onTasksDoneObservable.notifyObservers(this._tasks)
                    } catch (e) {
                        V.Error("Error running tasks-done callbacks."), console.log(e)
                    }
                    this._isLoading = !1, this._scene.getEngine().hideLoadingUI()
                }
            }, e.prototype._runTask = function(e) {
                var t = this,
                    i = function(i, n) {
                        e._setErrorObject(i, n), t.onTaskError && t.onTaskError(e), t.onTaskErrorObservable.notifyObservers(e), t._decreaseWaitingTasksCount(e)
                    };
                e.run(this._scene, (function() {
                    try {
                        t.onTaskSuccess && t.onTaskSuccess(e), t.onTaskSuccessObservable.notifyObservers(e), t._decreaseWaitingTasksCount(e)
                    } catch (e) {
                        i("Error executing task success callbacks", e)
                    }
                }), i)
            }, e.prototype.reset = function() {
                return this._isLoading = !1, this._tasks = new Array, this
            }, e.prototype.load = function() {
                if (this._isLoading) return this;
                if (this._isLoading = !0, this._waitingTasksCount = this._tasks.length, this._totalTasksCount = this._tasks.length, 0 === this._waitingTasksCount) return this._isLoading = !1, this.onFinish && this.onFinish(this._tasks), this.onTasksDoneObservable.notifyObservers(this._tasks), this;
                this.useDefaultLoadingScreen && this._scene.getEngine().displayLoadingUI();
                for (var e = 0; e < this._tasks.length; e++) {
                    var t = this._tasks[e];
                    t.taskState === In.INIT && this._runTask(t)
                }
                return this
            }, e.prototype.loadAsync = function() {
                var e = this;
                return new Promise((function(t, i) {
                    e.onTasksDoneObservable.addOnce((function(e) {
                        e && e.length ? i(e) : t()
                    }))
                }))
            }, e
        }(),
        Gn = function() {
            function e(e) {
                this.fileList = [], this.assets = [], this.assetsManager = new Vn(e), this.fileList = ["tunnel.jpg", "white.png", "black.png", "Logo.png", "ButtonRound.png", "ButtonRound_Highlight.png", "ButtonSquare.png", "ButtonSquare_Highlight.png", "ArrowOutline.png", "LevelProgress.png", "VsOutline.png", "Window.png", "info_panel.png", "arrow.png", "easy.png", "med.png", "hard.png", "lock.png", "play.png", "pause.png", "restart.png", "home.png", "settings.png", "StarEmpty.png", "StarFull.png", "levels.png", "watch.png", "vol_on.png", "vol_off.png"]
            }
            return e.prototype.StartLoading = function(e) {
                for (var t = this.assetsManager, i = this.assets, n = 0; n < this.fileList.length; ++n) {
                    var r = this.fileList[n],
                        o = void 0,
                        s = r.split(".").pop().toLowerCase();
                    switch (s) {
                        case "png":
                        case "jpg":
                            o = t.addTextureTask(r, "./textures/" + r);
                            break;
                        case "json":
                        case "txt":
                            o = t.addTextFileTask(r, "./data/" + r);
                            break;
                        default:
                            console.log('Error loading asset "' + r + '". Unrecognized file extension "' + s + '"')
                    }
                    o.onSuccess = function(e) {
                        switch (e.constructor) {
                            case Nn:
                                i[e.name] = e.texture;
                                break;
                            case Ln:
                                i[e.name] = e.data;
                                break;
                            case wn:
                                i[e.name] = e.text;
                                break;
                            default:
                                console.log('Error loading asset "' + e.name + '". Unrecognized AssetManager task type.')
                        }
                    }, o.onError = function(e, t, i) {
                        console.log(t, i)
                    }
                }
                t.onProgress = function(e, t, i) {
                    Ua.instance.LoadingProgress((t - e) / t)
                }, t.onFinish = function() {
                    e && e()
                }, t.load()
            }, e
        }(),
        zn = function() {
            function e() {}
            return e.VS = function() {
                return "\n\t\t// Attributes\n\t\tattribute vec3 position;\n\t\tattribute vec3 normal;\n\t\tattribute vec2 uv;\n\t\t\n\t\t// Uniforms\n\t\tuniform mat4 world;\n\t\tuniform mat4 viewProjection;\n\t\tuniform float ZOffset;\n\t\tuniform vec3 CameraOffset;\n\t\t\n\t\t// Normal\n\t\tvarying vec2 UV;\n\t\tvarying float fog;\n\t\tvarying vec3 vcol;\n\t\t\n\t\tvec2 CalcOffset(float zPos)\n\t\t{\n\t\t\tfloat BendFreq = 0.49;\n\t\t\tfloat BendAmp = 50.0;\n\t\t\t// sum up some sine waves to create a wiggly tunnel shape\n\t\t\tfloat z = 0.01 * BendFreq * (zPos + ZOffset);\n\t\t\tvec4 sins = sin(z * vec4(1.0, 1.77, 0.57, 0.31));\n\t\t\tfloat xOffset = (1.0 + sins.z * (sins.x * sins.y)) - (sins.x * sins.z) + sins.w;\n\t\t\tfloat yOffset = (sins.z * sins.y) - (sins.x * sins.w);\n\t\t\treturn BendAmp * vec2(xOffset, yOffset);\n\t\t}\n\n\t\tvoid main(void) \n\t\t{\n\t\t\tvec4 worldP = world * vec4(position, 1.0);\n\t\t\tworldP.xy += CalcOffset(worldP.z) - CameraOffset.xy;\n\n\t\t\tgl_Position = viewProjection * worldP;\n\t\t\n\t\t\t// vec3 L = vec3(0,0,-1);\n\t\t\t// vec3 N = (world * vec4(normal,0)).xyz;\n\t\t\t// lighting = 0.6 + 0.4*dot(N, L);\n\t\t\t// fog = clamp((200.0 - worldP.z)*0.005, 0.0, 1.0);\n\t\t\t\n\t\t\tvec3 N = normalize((world * vec4(normal.xyz,0.0)).xyz);\n\t\t\tvec3 L1 = normalize(vec3(0.5, 1, 0.5));\n\t\t\tvec3 L2 = normalize(vec3(-1, -1, 0.5));\n\t\t\tvec3 light1 = vec3(1,0.8,0.4) * (0.5 + 0.5*dot(N, L1));\n\t\t\tvec3 light2 = vec3(0.4,0.8,0.9) * (0.5 + 0.5*dot(N, L2));\n\t\t\tvec3 ambient = vec3(0.4,0.6,0.6);\n\t\t\tvec3 lighting = light1 + light2;// + ambient;\n\t\t\tvcol = 2.0 * lighting * vec3(0.4,0.5,0.6);\n\n\t\t\tfloat fogStart = 0.0;\n\t\t\tfloat fogEnd = 300.0;\n\t\t\tfog = 1.0 - clamp((worldP.z - fogStart) / (fogEnd - fogStart), 0.0, 1.0);\n\n\t\t\tUV = uv;\n\t\t}"
            }, e.FS = function() {
                return "\n\t\tvarying vec2 UV;\n\t\tvarying vec3 vcol;\n\t\tvarying float fog;\n\n\t\tuniform sampler2D mainTex;\n\t\tuniform vec3 color;\n\n\t\tvoid main(void) {\n\t\t\tvec3 c = texture2D(mainTex, UV).rgb * vcol;\n\t\t\tvec3 col = fog * c * color;\n\t\t\tgl_FragColor = vec4(col,1.0);\n\t\t}"
            }, e.FS_SemiTrans = function() {
                return "\n\t\tvarying vec2 UV;\n\t\tvarying float lighting;\n\t\tvarying float fog;\n\n\t\tuniform sampler2D mainTex;\n\t\tuniform vec3 color;\n\n\t\tvoid main(void) {\n\t\t\tvec3 col = UV.x * fog * color;\n\n\t\t\tgl_FragColor = vec4(col.rgb, col.r);\n\t\t}"
            }, e
        }();
    Ye.CreateRibbon = function(e) {
        var t = e.pathArray,
            i = e.closeArray || !1,
            n = e.closePath || !1,
            r = e.invertUV || !1,
            o = Math.floor(t[0].length / 2),
            s = e.offset || o;
        s = s > o ? o : Math.floor(s);
        var a, u, h, l, c = 0 === e.sideOrientation ? 0 : e.sideOrientation || Ye.DEFAULTSIDE,
            d = e.uvs,
            f = e.colors,
            p = [],
            _ = [],
            g = [],
            m = [],
            v = [],
            y = [],
            T = [],
            b = [],
            E = [],
            A = [];
        if (t.length < 2) {
            var M = [],
                R = [];
            for (h = 0; h < t[0].length - s; h++) M.push(t[0][h]), R.push(t[0][h + s]);
            t = [M, R]
        }
        var x, P, I, C, S, O = 0,
            D = n ? 1 : 0;
        for (a = t[0].length, u = 0; u < t.length; u++) {
            for (T[u] = 0, v[u] = [0], a = a < (P = (x = t[u]).length) ? a : P, l = 0; l < P;) p.push(x[l].x, x[l].y, x[l].z), l > 0 && (I = x[l].subtract(x[l - 1]).length() + T[u], v[u].push(I), T[u] = I), l++;
            n && (l--, p.push(x[0].x, x[0].y, x[0].z), I = x[l].subtract(x[0]).length() + T[u], v[u].push(I), T[u] = I), E[u] = P + D, A[u] = O, O += P + D
        }
        var w, L, F = null,
            N = null;
        for (h = 0; h < a + D; h++) {
            for (b[h] = 0, y[h] = [0], u = 0; u < t.length - 1; u++) C = t[u], S = t[u + 1], h === a ? (F = C[0], N = S[0]) : (F = C[h], N = S[h]), I = N.subtract(F).length() + b[h], y[h].push(I), b[h] = I;
            i && N && F && (C = t[u], S = t[0], h === a && (N = S[0]), I = N.subtract(F).length() + b[h], b[h] = I)
        }
        if (d)
            for (u = 0; u < d.length; u++) m.push(d[u].x, d[u].y);
        else
            for (u = 0; u < t.length; u++)
                for (h = 0; h < a + D; h++) w = 0 != T[u] ? v[u][h] / T[u] : 0, L = 0 != b[h] ? y[h][u] / b[h] : 0, r ? m.push(L, w) : m.push(w, L);
        for (var U = 0, B = E[u = 0] - 1, k = E[u + 1] - 1, V = B < k ? B : k, G = A[1] - A[0], z = i ? E.length : E.length - 1; U <= V && u < z;) _.push(U, U + G, U + 1), _.push(U + G + 1, U + 1, U + G), (U += 1) === V && (++u === E.length - 1 ? (G = A[0] - A[u], B = E[u] - 1, k = E[0] - 1) : (G = A[u + 1] - A[u], B = E[u] - 1, k = E[u + 1] - 1), U = A[u], V = B < k ? B + U : k + U);
        if (Ye.ComputeNormals(p, _, g), n) {
            var W = 0,
                X = 0;
            for (u = 0; u < t.length; u++) W = 3 * A[u], X = u + 1 < t.length ? 3 * (A[u + 1] - 1) : g.length - 3, g[W] = .5 * (g[W] + g[X]), g[W + 1] = .5 * (g[W + 1] + g[X + 1]), g[W + 2] = .5 * (g[W + 2] + g[X + 2]), g[X] = g[W], g[X + 1] = g[W + 1], g[X + 2] = g[W + 2]
        }
        Ye._ComputeSides(c, p, _, g, m, e.frontUVs, e.backUVs);
        var H = null;
        if (f) {
            H = new Float32Array(4 * f.length);
            for (var j = 0; j < f.length; j++) H[4 * j] = f[j].r, H[4 * j + 1] = f[j].g, H[4 * j + 2] = f[j].b, H[4 * j + 3] = f[j].a
        }
        var Y = new Ye,
            K = new Float32Array(p),
            q = new Float32Array(g),
            Z = new Float32Array(m);
        return Y.indices = _, Y.positions = K, Y.normals = q, Y.uvs = Z, H && Y.set(H, Te.ColorKind), n && (Y._idx = A), Y
    }, Vt.CreateRibbon = function(e, t, i, n, r, o, s, a, u) {
        return void 0 === i && (i = !1), void 0 === s && (s = !1), Wn.CreateRibbon(e, {
            pathArray: t,
            closeArray: i,
            closePath: n,
            offset: r,
            updatable: s,
            sideOrientation: a,
            instance: u
        }, o)
    };
    var Wn = function() {
        function e() {}
        return e.CreateRibbon = function(e, t, i) {
            void 0 === i && (i = null);
            var n = t.pathArray,
                r = t.closeArray,
                o = t.closePath,
                s = Vt._GetDefaultSideOrientation(t.sideOrientation),
                a = t.instance,
                u = t.updatable;
            if (a) {
                var h = N.Vector3[0].setAll(Number.MAX_VALUE),
                    l = N.Vector3[1].setAll(-Number.MAX_VALUE),
                    c = a.getVerticesData(Te.PositionKind);
                if (function(e) {
                        for (var t = n[0].length, i = a, r = 0, o = i._originalBuilderSideOrientation === Vt.DOUBLESIDE ? 2 : 1, s = 1; s <= o; ++s)
                            for (var u = 0; u < n.length; ++u) {
                                var c = n[u],
                                    d = c.length;
                                t = t < d ? t : d;
                                for (var f = 0; f < t; ++f) {
                                    var p = c[f];
                                    e[r] = p.x, e[r + 1] = p.y, e[r + 2] = p.z, h.minimizeInPlaceFromFloats(p.x, p.y, p.z), l.maximizeInPlaceFromFloats(p.x, p.y, p.z), r += 3
                                }
                                if (i._creationDataStorage && i._creationDataStorage.closePath) {
                                    p = c[0];
                                    e[r] = p.x, e[r + 1] = p.y, e[r + 2] = p.z, r += 3
                                }
                            }
                    }(c), a._boundingInfo ? a._boundingInfo.reConstruct(h, l, a._worldMatrix) : a._boundingInfo = new Ie(h, l, a._worldMatrix), a.updateVerticesData(Te.PositionKind, c, !1, !1), t.colors) {
                    for (var d = a.getVerticesData(Te.ColorKind), f = 0, p = 0; f < t.colors.length; f++, p += 4) {
                        var _ = t.colors[f];
                        d[p] = _.r, d[p + 1] = _.g, d[p + 2] = _.b, d[p + 3] = _.a
                    }
                    a.updateVerticesData(Te.ColorKind, d, !1, !1)
                }
                if (t.uvs) {
                    for (var g = a.getVerticesData(Te.UVKind), m = 0; m < t.uvs.length; m++) g[2 * m] = t.uvs[m].x, g[2 * m + 1] = t.uvs[m].y;
                    a.updateVerticesData(Te.UVKind, g, !1, !1)
                }
                if (!a.areNormalsFrozen || a.isFacetDataEnabled) {
                    var v = a.getIndices(),
                        y = a.getVerticesData(Te.NormalKind),
                        T = a.isFacetDataEnabled ? a.getFacetDataParameters() : null;
                    if (Ye.ComputeNormals(c, v, y, T), a._creationDataStorage && a._creationDataStorage.closePath)
                        for (var b = 0, E = 0, A = 0; A < n.length; A++) b = 3 * a._creationDataStorage.idx[A], E = A + 1 < n.length ? 3 * (a._creationDataStorage.idx[A + 1] - 1) : y.length - 3, y[b] = .5 * (y[b] + y[E]), y[b + 1] = .5 * (y[b + 1] + y[E + 1]), y[b + 2] = .5 * (y[b + 2] + y[E + 2]), y[E] = y[b], y[E + 1] = y[b + 1], y[E + 2] = y[b + 2];
                    a.areNormalsFrozen || a.updateVerticesData(Te.NormalKind, y, !1, !1)
                }
                return a
            }
            var M = new Vt(e, i);
            M._originalBuilderSideOrientation = s, M._creationDataStorage = new Nt;
            var R = Ye.CreateRibbon(t);
            return o && (M._creationDataStorage.idx = R._idx), M._creationDataStorage.closePath = o, M._creationDataStorage.closeArray = r, R.applyToMesh(M, u), M
        }, e
    }();
    Vt.CreateTube = function(e, t, i, n, r, o, s, a, u, h) {
        var l = {
            path: t,
            radius: i,
            tessellation: n,
            radiusFunction: r,
            arc: 1,
            cap: o,
            updatable: a,
            sideOrientation: u,
            instance: h
        };
        return Xn.CreateTube(e, l, s)
    };
    var Xn = function() {
        function e() {}
        return e.CreateTube = function(e, t, i) {
            void 0 === i && (i = null);
            var n = t.path,
                r = t.instance,
                o = 1;
            void 0 !== t.radius ? o = t.radius : r && (o = r._creationDataStorage.radius);
            var s = t.tessellation || 64,
                a = t.radiusFunction || null,
                u = t.cap || Vt.NO_CAP,
                h = t.invertUV || !1,
                l = t.updatable,
                c = Vt._GetDefaultSideOrientation(t.sideOrientation);
            t.arc = t.arc && (t.arc <= 0 || t.arc > 1) ? 1 : t.arc || 1;
            var d, f, p = function(e, t, i, n, r, o, s, a) {
                for (var u, h, l, c, d = t.getTangents(), f = t.getNormals(), p = t.getDistances(), _ = 2 * Math.PI / r * a, g = o || function() {
                        return n
                    }, m = N.Matrix[0], v = s === Vt.NO_CAP || s === Vt.CAP_END ? 0 : 2, y = 0; y < e.length; y++) {
                    h = g(y, p[y]), u = Array(), l = f[y];
                    for (var T = 0; T < r; T++) R.RotationAxisToRef(d[y], _ * T, m), c = u[T] ? u[T] : b.Zero(), b.TransformCoordinatesToRef(l, m, c), c.scaleInPlace(h).addInPlace(e[y]), u[T] = c;
                    i[v] = u, v++
                }
                var E = function(t, i) {
                    for (var n = Array(), r = 0; r < t; r++) n.push(e[i]);
                    return n
                };
                switch (s) {
                    case Vt.NO_CAP:
                        break;
                    case Vt.CAP_START:
                        i[0] = E(r, 0), i[1] = i[2].slice(0);
                        break;
                    case Vt.CAP_END:
                        i[v] = i[v - 1].slice(0), i[v + 1] = E(r, e.length - 1);
                        break;
                    case Vt.CAP_ALL:
                        i[0] = E(r, 0), i[1] = i[2].slice(0), i[v] = i[v - 1].slice(0), i[v + 1] = E(r, e.length - 1)
                }
                return i
            };
            if (r) {
                var _ = r._creationDataStorage,
                    g = t.arc || _.arc;
                return f = p(n, d = _.path3D.update(n), _.pathArray, o, _.tessellation, a, _.cap, g), r = Wn.CreateRibbon("", {
                    pathArray: f,
                    instance: r
                }), _.path3D = d, _.pathArray = f, _.arc = g, _.radius = o, r
            }
            f = p(n, d = new F(n), new Array, o, s, a, u = u < 0 || u > 3 ? 0 : u, t.arc);
            var m = Wn.CreateRibbon(e, {
                pathArray: f,
                closePath: !0,
                closeArray: !1,
                updatable: l,
                sideOrientation: c,
                invertUV: h,
                frontUVs: t.frontUVs,
                backUVs: t.backUVs
            }, i);
            return m._creationDataStorage.pathArray = f, m._creationDataStorage.path3D = d, m._creationDataStorage.tessellation = s, m._creationDataStorage.cap = u, m._creationDataStorage.arc = t.arc, m._creationDataStorage.radius = o, m
        }, e
    }();
    Ye.CreateBox = function(e) {
        var t, i = [0, 1, 2, 0, 2, 3, 4, 5, 6, 4, 6, 7, 8, 9, 10, 8, 10, 11, 12, 13, 14, 12, 14, 15, 16, 17, 18, 16, 18, 19, 20, 21, 22, 20, 22, 23],
            n = [0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0],
            r = [],
            o = e.width || e.size || 1,
            s = e.height || e.size || 1,
            a = e.depth || e.size || 1,
            u = e.wrap || !1,
            h = void 0 === e.topBaseAt ? 1 : e.topBaseAt,
            l = void 0 === e.bottomBaseAt ? 0 : e.bottomBaseAt,
            c = [2, 0, 3, 1][h = (h + 4) % 4],
            d = [2, 0, 1, 3][l = (l + 4) % 4],
            f = [1, -1, 1, -1, -1, 1, -1, 1, 1, 1, 1, 1, 1, 1, -1, -1, 1, -1, -1, -1, -1, 1, -1, -1, 1, 1, -1, 1, -1, -1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, -1, 1, -1, -1, -1, -1, 1, -1, -1, 1, 1, -1, 1, -1, 1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, -1, -1, -1, -1, -1, -1, 1];
        if (u) {
            i = [2, 3, 0, 2, 0, 1, 4, 5, 6, 4, 6, 7, 9, 10, 11, 9, 11, 8, 12, 14, 15, 12, 13, 14], f = [-1, 1, 1, 1, 1, 1, 1, -1, 1, -1, -1, 1, 1, 1, -1, -1, 1, -1, -1, -1, -1, 1, -1, -1, 1, 1, 1, 1, 1, -1, 1, -1, -1, 1, -1, 1, -1, 1, -1, -1, 1, 1, -1, -1, 1, -1, -1, -1];
            for (var p = [
                    [1, 1, 1],
                    [-1, 1, 1],
                    [-1, 1, -1],
                    [1, 1, -1]
                ], _ = [
                    [-1, -1, 1],
                    [1, -1, 1],
                    [1, -1, -1],
                    [-1, -1, -1]
                ], g = [17, 18, 19, 16], m = [22, 23, 20, 21]; c > 0;) p.unshift(p.pop()), g.unshift(g.pop()), c--;
            for (; d > 0;) _.unshift(_.pop()), m.unshift(m.pop()), d--;
            p = p.flat(), _ = _.flat(), f = f.concat(p).concat(_), i.push(g[0], g[2], g[3], g[0], g[1], g[2]), i.push(m[0], m[2], m[3], m[0], m[1], m[2])
        }
        var v = [o / 2, s / 2, a / 2];
        t = f.reduce((function(e, t, i) {
            return e.concat(t * v[i % 3])
        }), []);
        for (var T = 0 === e.sideOrientation ? 0 : e.sideOrientation || Ye.DEFAULTSIDE, b = e.faceUV || new Array(6), A = e.faceColors, M = [], R = 0; R < 6; R++) void 0 === b[R] && (b[R] = new E(0, 0, 1, 1)), A && void 0 === A[R] && (A[R] = new y(1, 1, 1, 1));
        for (var x = 0; x < 6; x++)
            if (r.push(b[x].z, b[x].w), r.push(b[x].x, b[x].w), r.push(b[x].x, b[x].y), r.push(b[x].z, b[x].y), A)
                for (var P = 0; P < 4; P++) M.push(A[x].r, A[x].g, A[x].b, A[x].a);
        Ye._ComputeSides(T, t, i, n, r, e.frontUVs, e.backUVs);
        var I = new Ye;
        if (I.indices = i, I.positions = t, I.normals = n, I.uvs = r, A) {
            var C = T === Ye.DOUBLESIDE ? M.concat(M) : M;
            I.colors = C
        }
        return I
    }, Vt.CreateBox = function(e, t, i, n, r) {
        void 0 === i && (i = null);
        var o = {
            size: t,
            sideOrientation: r,
            updatable: n
        };
        return Hn.CreateBox(e, o, i)
    };
    var Hn = function() {
        function e() {}
        return e.CreateBox = function(e, t, i) {
            void 0 === i && (i = null);
            var n = new Vt(e, i);
            return t.sideOrientation = Vt._GetDefaultSideOrientation(t.sideOrientation), n._originalBuilderSideOrientation = t.sideOrientation, Ye.CreateBox(t).applyToMesh(n, t.updatable), n
        }, e
    }();
    Ye.CreateCylinder = function(e) {
        var t, i = e.height || 2,
            n = 0 === e.diameterTop ? 0 : e.diameterTop || e.diameter || 1,
            r = 0 === e.diameterBottom ? 0 : e.diameterBottom || e.diameter || 1,
            o = e.tessellation || 24,
            s = e.subdivisions || 1,
            a = !!e.hasRings,
            u = !!e.enclose,
            h = e.arc && (e.arc <= 0 || e.arc > 1) ? 1 : e.arc || 1,
            l = 0 === e.sideOrientation ? 0 : e.sideOrientation || Ye.DEFAULTSIDE,
            c = e.faceUV || new Array(3),
            d = e.faceColors,
            f = 2 + (1 + (1 !== h && u ? 2 : 0)) * (a ? s : 1);
        for (t = 0; t < f; t++) d && void 0 === d[t] && (d[t] = new y(1, 1, 1, 1));
        for (t = 0; t < f; t++) c && void 0 === c[t] && (c[t] = new E(0, 0, 1, 1));
        var p, _, g, m, v, A, M = new Array,
            R = new Array,
            x = new Array,
            P = new Array,
            I = new Array,
            C = 2 * Math.PI * h / o,
            O = (r - n) / 2 / i,
            D = b.Zero(),
            w = b.Zero(),
            L = b.Zero(),
            F = b.Zero(),
            N = b.Zero(),
            U = S.Y,
            B = 1,
            k = 1,
            V = 0,
            G = 0;
        for (m = 0; m <= s; m++)
            for (g = ((_ = m / s) * (n - r) + r) / 2, B = a && 0 !== m && m !== s ? 2 : 1, A = 0; A < B; A++) {
                for (a && (k += A), u && (k += 2 * A), v = 0; v <= o; v++) p = v * C, D.x = Math.cos(-p) * g, D.y = -i / 2 + _ * i, D.z = Math.sin(-p) * g, 0 === n && m === s ? (w.x = x[x.length - 3 * (o + 1)], w.y = x[x.length - 3 * (o + 1) + 1], w.z = x[x.length - 3 * (o + 1) + 2]) : (w.x = D.x, w.z = D.z, w.y = Math.sqrt(w.x * w.x + w.z * w.z) * O, w.normalize()), 0 === v && (L.copyFrom(D), F.copyFrom(w)), R.push(D.x, D.y, D.z), x.push(w.x, w.y, w.z), G = a ? V !== k ? c[k].y : c[k].w : c[k].y + (c[k].w - c[k].y) * _, P.push(c[k].x + (c[k].z - c[k].x) * v / o, G), d && I.push(d[k].r, d[k].g, d[k].b, d[k].a);
                1 !== h && u && (R.push(D.x, D.y, D.z), R.push(0, D.y, 0), R.push(0, D.y, 0), R.push(L.x, L.y, L.z), b.CrossToRef(U, w, N), N.normalize(), x.push(N.x, N.y, N.z, N.x, N.y, N.z), b.CrossToRef(F, U, N), N.normalize(), x.push(N.x, N.y, N.z, N.x, N.y, N.z), G = a ? V !== k ? c[k + 1].y : c[k + 1].w : c[k + 1].y + (c[k + 1].w - c[k + 1].y) * _, P.push(c[k + 1].x, G), P.push(c[k + 1].z, G), G = a ? V !== k ? c[k + 2].y : c[k + 2].w : c[k + 2].y + (c[k + 2].w - c[k + 2].y) * _, P.push(c[k + 2].x, G), P.push(c[k + 2].z, G), d && (I.push(d[k + 1].r, d[k + 1].g, d[k + 1].b, d[k + 1].a), I.push(d[k + 1].r, d[k + 1].g, d[k + 1].b, d[k + 1].a), I.push(d[k + 2].r, d[k + 2].g, d[k + 2].b, d[k + 2].a), I.push(d[k + 2].r, d[k + 2].g, d[k + 2].b, d[k + 2].a))), V !== k && (V = k)
            }
        var z = 1 !== h && u ? o + 4 : o;
        for (m = 0, k = 0; k < s; k++) {
            var W = 0,
                X = 0,
                H = 0,
                j = 0;
            for (v = 0; v < o; v++) W = m * (z + 1) + v, X = (m + 1) * (z + 1) + v, H = m * (z + 1) + (v + 1), j = (m + 1) * (z + 1) + (v + 1), M.push(W, X, H), M.push(j, H, X);
            1 !== h && u && (M.push(W + 2, X + 2, H + 2), M.push(j + 2, H + 2, X + 2), M.push(W + 4, X + 4, H + 4), M.push(j + 4, H + 4, X + 4)), m = a ? m + 2 : m + 1
        }
        var Y = function(e) {
            var t = e ? n / 2 : r / 2;
            if (0 !== t) {
                var s, a, u, l = e ? c[f - 1] : c[0],
                    p = null;
                d && (p = e ? d[f - 1] : d[0]);
                var _ = R.length / 3,
                    g = e ? i / 2 : -i / 2,
                    m = new b(0, g, 0);
                R.push(m.x, m.y, m.z), x.push(0, e ? 1 : -1, 0), P.push(l.x + .5 * (l.z - l.x), l.y + .5 * (l.w - l.y)), p && I.push(p.r, p.g, p.b, p.a);
                var v = new T(.5, .5);
                for (u = 0; u <= o; u++) {
                    s = 2 * Math.PI * u * h / o;
                    var y = Math.cos(-s),
                        E = Math.sin(-s);
                    a = new b(y * t, g, E * t);
                    var A = new T(y * v.x + .5, E * v.y + .5);
                    R.push(a.x, a.y, a.z), x.push(0, e ? 1 : -1, 0), P.push(l.x + (l.z - l.x) * A.x, l.y + (l.w - l.y) * A.y), p && I.push(p.r, p.g, p.b, p.a)
                }
                for (u = 0; u < o; u++) e ? (M.push(_), M.push(_ + (u + 2)), M.push(_ + (u + 1))) : (M.push(_), M.push(_ + (u + 1)), M.push(_ + (u + 2)))
            }
        };
        Y(!1), Y(!0), Ye._ComputeSides(l, R, M, x, P, e.frontUVs, e.backUVs);
        var K = new Ye;
        return K.indices = M, K.positions = R, K.normals = x, K.uvs = P, d && (K.colors = I), K
    }, Vt.CreateCylinder = function(e, t, i, n, r, o, s, a, u) {
        void 0 !== s && s instanceof Et || (void 0 !== s && (u = a || Vt.DEFAULTSIDE, a = s), s = o, o = 1);
        var h = {
            height: t,
            diameterTop: i,
            diameterBottom: n,
            tessellation: r,
            subdivisions: o,
            sideOrientation: u,
            updatable: a
        };
        return jn.CreateCylinder(e, h, s)
    };
    var jn = function() {
        function e() {}
        return e.CreateCylinder = function(e, t, i) {
            var n = new Vt(e, i);
            return t.sideOrientation = Vt._GetDefaultSideOrientation(t.sideOrientation), n._originalBuilderSideOrientation = t.sideOrientation, Ye.CreateCylinder(t).applyToMesh(n, t.updatable), n
        }, e
    }();
    Ye.CreateTorus = function(e) {
        for (var t = [], i = [], n = [], r = [], o = e.diameter || 1, s = e.thickness || .5, a = e.tessellation || 16, u = 0 === e.sideOrientation ? 0 : e.sideOrientation || Ye.DEFAULTSIDE, h = a + 1, l = 0; l <= a; l++)
            for (var c = l / a, d = l * Math.PI * 2 / a - Math.PI / 2, f = R.Translation(o / 2, 0, 0).multiply(R.RotationY(d)), p = 0; p <= a; p++) {
                var _ = 1 - p / a,
                    g = p * Math.PI * 2 / a + Math.PI,
                    m = Math.cos(g),
                    v = Math.sin(g),
                    y = new b(m, v, 0),
                    E = y.scale(s / 2),
                    A = new T(c, _);
                E = b.TransformCoordinates(E, f), y = b.TransformNormal(y, f), i.push(E.x, E.y, E.z), n.push(y.x, y.y, y.z), r.push(A.x, A.y);
                var M = (l + 1) % h,
                    x = (p + 1) % h;
                t.push(l * h + p), t.push(l * h + x), t.push(M * h + p), t.push(l * h + x), t.push(M * h + x), t.push(M * h + p)
            }
        Ye._ComputeSides(u, i, t, n, r, e.frontUVs, e.backUVs);
        var P = new Ye;
        return P.indices = t, P.positions = i, P.normals = n, P.uvs = r, P
    }, Vt.CreateTorus = function(e, t, i, n, r, o, s) {
        var a = {
            diameter: t,
            thickness: i,
            tessellation: n,
            sideOrientation: s,
            updatable: o
        };
        return Yn.CreateTorus(e, a, r)
    };
    var Yn = function() {
            function e() {}
            return e.CreateTorus = function(e, t, i) {
                var n = new Vt(e, i);
                return t.sideOrientation = Vt._GetDefaultSideOrientation(t.sideOrientation), n._originalBuilderSideOrientation = t.sideOrientation, Ye.CreateTorus(t).applyToMesh(n, t.updatable), n
            }, e
        }(),
        Kn = function() {
            function e(e) {
                this.nodes = e
            }
            return e.prototype.Evaluate = function(e) {
                if (e < this.nodes[0].x) return this.nodes[0].y;
                for (var t = 1; t < this.nodes.length; ++t) {
                    var i = this.nodes[t];
                    if (e < i.x) {
                        var n = this.nodes[t - 1],
                            r = (i.x - e) / (i.x - n.x);
                        return i.y + r * (n.y - i.y)
                    }
                }
                return this.nodes[this.nodes.length - 1].y
            }, e
        }(),
        qn = function() {
            function e(e, t, i, n, r, o) {
                this.node = e, this.speed = t, this.amp = i, this.curve = n, this.lockToPosition = o, this.startPos = e.position;
                var s = this.node.computeWorldMatrix();
                this.moveDir = b.TransformNormal(r, s), this.tPos = 0
            }
            return e.prototype.Update = function(e) {
                var t = this.node.getAbsolutePosition().z;
                this.lockToPosition ? this.tPos = this.speed * t * -.01 : this.tPos += this.speed * e, this.tPos = this.tPos - Math.floor(this.tPos);
                var i = this.curve.Evaluate(this.tPos),
                    n = this.moveDir.scale(this.amp * i);
                this.node.position = this.startPos.add(n)
            }, e
        }(),
        Zn = function() {
            function e(e, t, i, n) {
                this.node = e, this.speed = t, this.amp = i, this.curve = n, this.startRot = e.rotation.z, this.tPos = 0
            }
            return e.prototype.Update = function(e) {
                var t = this.node.getAbsolutePosition().z;
                this.tPos = this.speed * t * -.01, this.tPos = this.tPos - Math.floor(this.tPos);
                var i = this.amp * this.curve.Evaluate(this.tPos) * (Math.PI / 180);
                this.node.rotation = new b(0, 0, this.startRot + i)
            }, e
        }(),
        Qn = function() {
            function e(e, t) {
                this.node = e, this.speed = t
            }
            return e.prototype.Update = function(e) {
                this.node.addRotation(0, 0, this.speed * e * (Math.PI / 180))
            }, e
        }();

    function Jn(e, t, i) {
        for (var n = [], r = [], o = [], s = 0; s < 6; ++s) {
            for (var a = s * (2 * Math.PI / 6), u = (s + .5) * (2 * Math.PI / 6), h = 0; h < 3; ++h) n.push(0);
            n.push(t * Math.sin(u)), n.push(t * Math.cos(u)), n.push(0), n.push(t * Math.sin(a)), n.push(t * Math.cos(a)), n.push(0);
            for (h = 0; h < 2; ++h) r.push(0);
            for (h = 0; h < 4; ++h) r.push(1);
            o.push(3 * s + 0), o.push(3 * s + 1), o.push(3 * s + 2)
        }
        var l = new Vt("portal", Ua.instance.scene),
            c = new Ye;
        return c.positions = n, c.indices = o, c.uvs = r, c.applyToMesh(l), l.position = new b(0, 0, i), l.material = Ua.instance.portalMat, l.parent = e, l
    }

    function $n(e, t) {
        return e.material = Ua.instance.obstacleMat, e.setBoundingInfo(new Ie(new b(-1e4, -1e4, -1e4), new b(1e4, 1e4, 1e4))), e.layer = "obstacle", e.parent = t, e
    }

    function er(e, t, i, n) {
        new b(0, 0, 0), new b(0, 0, 2);
        var r = Yn.CreateTorus("loop", {
            tessellation: 20,
            thickness: 3,
            diameter: 12
        }, Ua.instance.scene);
        return r.rotation = new b(Math.PI / 2, 0, 0), r.position = new b(0, t, i), r.rotateAround(b.Zero(), b.Forward(), (n + 22.5) * (Math.PI / 180)), $n(r, e)
    }

    function tr(e, t, i, n) {
        new b(0, 0, 0), new b(0, 0, 2);
        var r = jn.CreateCylinder("tri", {
            height: 4,
            tessellation: 3,
            diameter: 12
        }, Ua.instance.scene);
        return r.rotation = new b(Math.PI / 2, 0, 0), r.position = new b(t, 0, i), r.scaling = new b(1.4, 1, 1), r.rotateAround(b.Zero(), b.Forward(), (n + 22.5) * (Math.PI / 180)), $n(r, e)
    }

    function ir(e, t, i) {
        return tr(e, -8, t, i)
    }

    function nr(e, t, i) {
        return tr(e, 12, t, i)
    }

    function rr(e, t, i, n, r, o, s, a) {
        var u = Hn.CreateBox("pillar", {
            width: t,
            height: i,
            depth: n
        }, Ua.instance.scene);
        return u.position = new b(r, o, s), u.rotateAround(b.Zero(), b.Forward(), (a + 22.5) * (Math.PI / 180)), $n(u, e)
    }

    function or(e, t, i, n) {
        return rr(e, 4, 32, 4, 0, t, i, n)
    }

    function sr(e, t, i) {
        return or(e, 0, t, i)
    }

    function ar(e, t, i) {
        return or(e, 12, t, i)
    }

    function ur(e, t, i) {
        return rr(e, 4, 4, 4, 0, -7.5, t, i)
    }

    function hr(e, t, i, n) {
        return rr(e, 16, 32, 4, 8 + i, 0, t, n)
    }

    function lr(e) {
        return function() {
            var t = e += 1831565813;
            return t = Math.imul(t ^ t >>> 15, 1 | t), (((t ^= t + Math.imul(t ^ t >>> 7, 61 | t)) ^ t >>> 14) >>> 0) / 4294967296
        }
    }
    var cr = function() {
            function e(t) {
                e.SetSeed(t)
            }
            return e.SetSeed = function(t) {
                e.value = lr(t)
            }, e.Range = function(t, i) {
                return Math.floor(t + e.value() * (i - t))
            }, e.value = lr(1234), e
        }(),
        dr = function() {},
        fr = function() {
            function e() {
                var t = this.constructor.segments;
                this.length = t * e.segmentLength, this.root = function(e) {
                    for (var t = [], i = 0; i <= 10; ++i) t.push(new b(0, 0, 5 * i));
                    var n = Xn.CreateTube("tunnel", {
                        path: t,
                        tessellation: 8,
                        radius: 10,
                        sideOrientation: Vt.DOUBLESIDE
                    }, Ua.instance.scene);
                    for (n.material = Ua.instance.tunnelMat, n.position = new b(0, 0, 0), n.isPickable = !1, n.setBoundingInfo(new Ie(new b(-1e4, -1e4, -1e4), new b(1e4, 1e4, 1e4))), i = 1; i < e; ++i) {
                        var r = Xn.CreateTube("tunnel", {
                            path: t,
                            tessellation: 8,
                            radius: 10,
                            sideOrientation: Vt.DOUBLESIDE
                        }, Ua.instance.scene);
                        r.material = Ua.instance.tunnelMat, r.position = new b(0, 0, 50 * i), r.isPickable = !1, r.setBoundingInfo(new Ie(new b(-1e4, -1e4, -1e4), new b(1e4, 1e4, 1e4))), r.parent = n
                    }
                    return n
                }(t), this.isFinalBlock = !1
            }
            return e.prototype.Update = function(e) {}, e.CreateBlock = function(e, t) {
                var i = new dr;
                return i.segmentCount = t, i.Instantiate = function() {
                    return new e
                }, i
            }, e.segmentLength = 50, e.segments = 1, e
        }(),
        pr = function() {
            function e() {
                this.firstBlock = null, this.lastBlock = null, this.blocks = [], this.blockCount = 0
            }
            return e.prototype.Reset = function() {
                this.blockCount = 0
            }, e.prototype.Initialise = function() {
                this.sectionLength = Math.min(this.sectionLength, 9), null != this.firstBlock && this.sectionLength++, null != this.lastBlock && this.sectionLength++
            }, e.prototype.PickAllBlocks = function(e, t) {
                var i = 0,
                    n = [];
                this.blockList = [];
                var r = this.blocks.length,
                    o = Math.min(r, 4);
                cr.SetSeed(e);
                for (var s = 0; s < o; ++s) {
                    for (var a = cr.Range(0, r); n.includes(a);) a = cr.Range(0, r);
                    n.push(a)
                }
                cr.SetSeed(t);
                for (var u = 0; u < this.sectionLength; ++u) {
                    var h = n[cr.Range(0, n.length)];
                    i += this.blocks[h].segmentCount * fr.segmentLength, this.blockList.push(h)
                }
                return i
            }, e.prototype.InitNode = function(e) {
                e.computeWorldMatrix();
                for (var t = 0, i = e.getChildTransformNodes(!0); t < i.length; t++) {
                    var n = i[t];
                    this.InitNode(n)
                }
            }, e.prototype.GenerateBlock = function(e) {
                var t;
                t = 0 == this.blocks.length || 0 == this.blockCount && null != this.firstBlock ? this.firstBlock : this.blockCount == this.sectionLength - 1 && null != this.lastBlock ? this.lastBlock : this.blocks[this.blockList[this.blockCount]], this.blockCount++;
                var i = t.Instantiate();
                return i.root.position = new b(0, 0, e), i.root.rotation = new b(0, 0, cr.Range(0, 8) * (Math.PI / 4)), this.InitNode(i.root), i
            }, e.prototype.IsSectionCompleted = function() {
                return this.blockCount >= this.sectionLength
            }, e
        }(),
        _r = function() {
            this.sections = []
        },
        gr = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }();

    function mr() {
        return new Kn([new T(0, 0), new T(.05, .03), new T(.15, .2), new T(.35, .8), new T(.45, .97), new T(.5, 1), new T(.55, .97), new T(.65, .8), new T(.85, .2), new T(.95, .03), new T(1, 0)])
    }
    var vr = function(e) {
        function t() {
            return e.call(this) || this
        }
        return gr(t, e), t.segments = 1, t
    }(fr);

    function yr() {
        return fr.CreateBlock(vr, vr.segments)
    }
    var Tr = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.portals = [], t.speeds = [];
            for (var i = 0; i < 3; ++i) t.portals[i] = Jn(t.root, 12, 50), t.speeds[i] = 30 * Math.PI / 180 * (.5 + .5 * cr.value()), i % 2 == 1 && (t.speeds[i] *= -1);
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0; t < this.portals.length; ++t) this.portals[t].addRotation(0, 0, this.speeds[t] * e)
        }, t.segments = 1, t
    }(fr);

    function br() {
        return fr.CreateBlock(Tr, Tr.segments)
    }
    var Er = function(e) {
        function t() {
            var t = e.call(this) || this;
            return sr(t.root, 25, 0), sr(t.root, 100, 90), t
        }
        return gr(t, e), t.segments = 3, t
    }(fr);

    function Ar() {
        return fr.CreateBlock(Er, Er.segments)
    }
    var Mr = function(e) {
        function t() {
            var t = e.call(this) || this;
            return sr(t.root, 20, 0), sr(t.root, 60, 90), sr(t.root, 100, 45), sr(t.root, 140, -45), t
        }
        return gr(t, e), t.segments = 3, t
    }(fr);

    function Rr() {
        return fr.CreateBlock(Mr, Mr.segments)
    }
    var xr = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(0, 0), new T(.25, 1), new T(.5, 1), new T(.75, 0)]), n = 0; n < 4; ++n) {
                var r = or(t.root, 22, 50, 90 * n);
                t.movers.push(new qn(r, 1, -6, i, b.Up(), !0))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function Pr() {
        return fr.CreateBlock(xr, xr.segments)
    }! function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(0, .5), new T(.25, -.5), new T(.5, -.5), new T(.75, .5)]), n = 0; n < 4; ++n) {
                var r = or(t.root, 22, 50, 90 * n);
                t.movers.push(new qn(r, 1, -6, i, b.Right(), !1))
            }
            return t
        }
        gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2
    }(fr);
    var Ir = function(e) {
            function t() {
                for (var t = e.call(this) || this, i = 0; i < 6; ++i) sr(t.root, 20 + 20 * i, 30 * i);
                return t
            }
            return gr(t, e), t.segments = 3, t
        }(fr),
        Cr = function(e) {
            function t() {
                for (var t = e.call(this) || this, i = 0; i < 6; ++i) sr(t.root, 20 + 20 * i, -30 * i);
                return t
            }
            return gr(t, e), t.segments = 3, t
        }(fr);

    function Sr() {
        return fr.CreateBlock(Ir, Ir.segments)
    }

    function Or() {
        return fr.CreateBlock(Cr, Cr.segments)
    }
    var Dr = function(e) {
        function t() {
            for (var t = e.call(this) || this, i = [0, 40, -60, 80, -135, 100], n = 0; n < 6; ++n) {
                var r = 20 + 20 * n;
                rr(t.root, 2, 32, 4, 0, 0, r, i[n]), er(t.root, 0, r, 0).scaling = new b(.5, .5, .5)
            }
            return t
        }
        return gr(t, e), t.segments = 3, t
    }(fr);

    function wr() {
        return fr.CreateBlock(Dr, Dr.segments)
    }! function(e) {
        function t() {
            for (var t = e.call(this) || this, i = 0; i < 4; ++i) ur(t.root, 50, 90 * i);
            return t
        }
        gr(t, e), t.segments = 2
    }(fr);
    var Lr = function(e) {
        function t() {
            for (var t = e.call(this) || this, i = 0; i < 4; ++i) ur(t.root, 50, 90 * i);
            for (i = 0; i < 4; ++i) ur(t.root, 100, 45 + 90 * i);
            return t
        }
        return gr(t, e), t.segments = 3, t
    }(fr);

    function Fr() {
        return fr.CreateBlock(Lr, Lr.segments)
    }
    var Nr = function(e) {
        function t() {
            for (var t = e.call(this) || this, i = 0; i < 4; ++i) ur(t.root, 25, 90 * i);
            for (i = 0; i < 4; ++i) ur(t.root, 75, 45 + 90 * i);
            for (i = 0; i < 4; ++i) ur(t.root, 125, 90 * i);
            return t
        }
        return gr(t, e), t.segments = 3, t
    }(fr);

    function Ur() {
        return fr.CreateBlock(Nr, Nr.segments)
    }
    var Br = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.rotators = [];
            for (var i = 0; i < 3; ++i) {
                var n = new je("rot", t.root.getScene());
                n.parent = t.root;
                var r = ur(n, 25 * (i + 1), 45 * i);
                t.rotators.push(new Qn(n, 100)), t.rotators.push(new Qn(r, -400))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function kr() {
        return fr.CreateBlock(Br, Br.segments)
    }
    var Vr = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.rotators = [];
            for (var i = 0; i < 5; ++i) {
                var n = new je("rot", t.root.getScene());
                n.parent = t.root;
                var r = ur(n, 25 * (i + 1), 45 * i);
                t.rotators.push(new Qn(n, -100)), t.rotators.push(new Qn(r, 400))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 3, t
    }(fr);

    function Gr() {
        return fr.CreateBlock(Vr, Vr.segments)
    }
    var zr = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.rotators = [];
            for (var i = 0; i < 3; ++i) {
                var n = new je("rot", t.root.getScene()),
                    r = new je("rot2", t.root.getScene());
                n.parent = t.root, r.parent = n, er(r, 6, 25 * (i + 1), 90 * i).scaling = new b(.5, .5, .5), t.rotators.push(new Qn(n, 50)), t.rotators.push(new Qn(r, -200))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function Wr() {
        return fr.CreateBlock(zr, zr.segments)
    }
    var Xr = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("loops", t.root.getScene());
            return i.parent = t.root, er(i, 7, 50, 0), er(i, 7, 50, 180), t.rotator = new Qn(i, -40), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 2, t
    }(fr);

    function Hr() {
        return fr.CreateBlock(Xr, Xr.segments)
    }
    var jr = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("loops", t.root.getScene());
            return i.parent = t.root, er(i, 7, 50, 0), er(i, 7, 50, 120), er(i, 7, 50, 240), t.rotator = new Qn(i, 40), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 2, t
    }(fr);

    function Yr() {
        return fr.CreateBlock(jr, jr.segments)
    }
    var Kr = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.rotators = [];
            for (var i = new Kn([new T(0, 0), new T(.15, 1), new T(.45, 1), new T(.6, 0)]), n = 0; n < 2; ++n) {
                var r = new je("node", t.root.getScene());
                r.position = new b(0, 0, 50 + 70 * n), r.parent = t.root, er(r, 0, 0, 0).scaling = new b(.5, .5, .5), rr(r, 2, 32, 4, 0, 0, 0, 50 * n - 10), rr(r, 2, 32, 4, 0, 0, 0, 50 * n + 10), t.rotators.push(new Zn(r, .75, 90, i))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 3, t
    }(fr);

    function qr() {
        return fr.CreateBlock(Kr, Kr.segments)
    }
    var Zr = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.rotators = [];
            var i = new Kn([new T(0, 1), new T(.15, 0), new T(.55, 0), new T(.7, 1)]),
                n = new je("node", t.root.getScene()),
                r = new je("node", t.root.getScene());
            n.parent = t.root, r.parent = t.root, n.position = new b(0, 0, 50), r.position = new b(0, 0, 50), er(t.root, 0, 50, 0).scaling = new b(.5, .5, .5);
            for (var o = 0; o < 5; ++o) rr(n, 2, 32, 4, 0, 0, 15 * o, 5), rr(r, 2, 32, 4, 0, 0, 15 * o, -5);
            return t.rotators.push(new Zn(n, .75, 45, i)), t.rotators.push(new Zn(r, .75, -45, i)), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 3, t
    }(fr);

    function Qr() {
        return fr.CreateBlock(Zr, Zr.segments)
    }
    var Jr = function(e) {
        function t() {
            var t = e.call(this) || this;
            return hr(t.root, 25, 2, 0), hr(t.root, 75, 2, 180), t
        }
        return gr(t, e), t.segments = 2, t
    }(fr);

    function $r() {
        return fr.CreateBlock(Jr, Jr.segments)
    }
    var eo = function(e) {
        function t() {
            var t = e.call(this) || this;
            return hr(t.root, 25, 2, 0), hr(t.root, 100, 2, 180), t
        }
        return gr(t, e), t.segments = 3, t
    }(fr);

    function to() {
        return fr.CreateBlock(eo, eo.segments)
    }
    var io = function(e) {
        function t() {
            var t = e.call(this) || this;
            return hr(t.root, 50, 4, 0), hr(t.root, 50, 4, 180), t
        }
        return gr(t, e), t.segments = 2, t
    }(fr);

    function no() {
        return fr.CreateBlock(io, io.segments)
    }
    var ro = function(e) {
        function t() {
            var t = e.call(this) || this;
            return hr(t.root, 36, 4, 0), hr(t.root, 36, 4, 180), hr(t.root, 43, 4, 0), hr(t.root, 43, 4, 180), hr(t.root, 50, 4, 0), hr(t.root, 50, 4, 180), hr(t.root, 57, 4, 0), hr(t.root, 57, 4, 180), hr(t.root, 64, 4, 0), hr(t.root, 64, 4, 180), t
        }
        return gr(t, e), t.segments = 2, t
    }(fr);

    function oo() {
        return fr.CreateBlock(ro, ro.segments)
    }
    var so = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.slabs = [];
            var i = hr(t.root, 50, 4, 0),
                n = hr(t.root, 50, 4, 180),
                r = new Kn([new T(0, 0), new T(.1, 1), new T(.48, 1), new T(.9, 0)]);
            return t.slabs[0] = new qn(i, 1, -4, r, b.Right(), !0), t.slabs[1] = new qn(n, 1, -4, r, b.Right(), !0), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.slabs; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function ao() {
        return fr.CreateBlock(so, so.segments)
    }
    var uo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = [hr(t.root, 36, 4, 0), hr(t.root, 36, 4, 180), hr(t.root, 43, 4, 0), hr(t.root, 43, 4, 180), hr(t.root, 50, 4, 0), hr(t.root, 50, 4, 180), hr(t.root, 57, 4, 0), hr(t.root, 57, 4, 180), hr(t.root, 64, 4, 0), hr(t.root, 64, 4, 180)],
                n = new Kn([new T(0, 0), new T(.1, 1), new T(.48, 1), new T(.9, 0)]);
            t.slabs = [];
            for (var r = 0, o = i; r < o.length; r++) {
                var s = o[r];
                t.slabs.push(new qn(s, 1.2, -4, n, b.Right(), !0))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.slabs; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function ho() {
        return fr.CreateBlock(uo, uo.segments)
    }
    var lo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = rr(t.root, 4, 32, 16, 0, 0, 50, 0),
                n = new Kn([new T(0, 0), new T(.2, .45), new T(.25, .5), new T(.3, .45), new T(.7, -.45), new T(.75, -.5), new T(.8, -.45), new T(1, 0)]);
            return t.mover = new qn(i, 1.6, -12, n, b.Right(), !0), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            this.mover.Update(e)
        }, t.segments = 2, t
    }(fr);

    function co() {
        return fr.CreateBlock(lo, lo.segments)
    }
    var fo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = hr(t.root, 50, 2, 0),
                n = new Kn([new T(0, 0), new T(.05, 0), new T(.15, 1), new T(.7, 1), new T(.8, 0)]);
            return t.mover = new qn(i, .5, -20, n, b.Right(), !0), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            this.mover.Update(e)
        }, t.segments = 2, t
    }(fr);

    function po() {
        return fr.CreateBlock(fo, fo.segments)
    }
    var _o = function(e) {
        function t() {
            var t = e.call(this) || this;
            return ir(t.root, 25, 0), ir(t.root, 75, 180), t
        }
        return gr(t, e), t.segments = 2, t
    }(fr);

    function go() {
        return fr.CreateBlock(_o, _o.segments)
    }
    var mo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("rotator", t.root.getScene());
            return i.parent = t.root, ir(i, 25, 0), ir(i, 25, 180), ir(i, 75, 90), ir(i, 75, 270), t.rotator = new Qn(i, -30), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 2, t
    }(fr);

    function vo() {
        return fr.CreateBlock(mo, mo.segments)
    }
    var yo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("rotator", t.root.getScene());
            return i.parent = t.root, ir(i, 50, 0), ir(i, 50, 120), ir(i, 50, 240), t.rotator = new Qn(i, 30), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 2, t
    }(fr);

    function To() {
        return fr.CreateBlock(yo, yo.segments)
    }
    var bo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("rotator", t.root.getScene()),
                n = new je("rotator", t.root.getScene());
            return i.parent = t.root, n.parent = t.root, ir(i, 25, 0), ir(i, 25, 180), ir(n, 75, 90), ir(n, 75, 270), t.rotators = [], t.rotators.push(new Qn(i, 30)), t.rotators.push(new Qn(n, -30)), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function Eo() {
        return fr.CreateBlock(bo, bo.segments)
    }
    var Ao = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("rotator", t.root.getScene());
            i.parent = t.root, i.position.z = 50, ir(i, 0, 0), ir(i, 0, 120), ir(i, 0, 240);
            var n = mr();
            return t.rotator = new Zn(i, .75, 90, n), t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 2, t
    }(fr);

    function Mo() {
        return fr.CreateBlock(Ao, Ao.segments)
    }
    var Ro = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = mr();
            t.rotators = [];
            for (var n = 0; n < 2; ++n) {
                var r = new je("rotator", t.root.getScene());
                r.parent = t.root, r.position.z = 50;
                var o = 10 * n - 5;
                ir(r, o, 0), ir(r, o, 120), ir(r, o, 240), t.rotators.push(new Zn(r, .6, 60 * Math.sign(n - .5), i))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function xo() {
        return fr.CreateBlock(Ro, Ro.segments)
    }
    var Po = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = mr();
            t.rotators = [];
            for (var n = 0; n < 2; ++n) {
                var r = new je("rotator", t.root.getScene());
                r.position.z = 25 + 50 * n, r.parent = t.root, ir(r, 0, 0 + 90 * n), ir(r, 0, 180 + 90 * n), t.rotators.push(new Zn(r, .7, 90, i))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.rotators; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function Io() {
        return fr.CreateBlock(Po, Po.segments)
    }
    var Co = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(.15, 0), new T(.5, 1), new T(.75, 1), new T(.9, 0)]), n = 0; n < 4; ++n) {
                var r = ir(t.root, 50, 90 * n);
                t.movers.push(new qn(r, 1, -7, i, b.Right(), !1))
            }
            return t
        }
        return gr(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function So() {
        return fr.CreateBlock(Co, Co.segments)
    }
    var Oo = function(e) {
        function t() {
            for (var t = e.call(this) || this, i = 0, n = [0, 45, 180, 225]; i < n.length; i++)
                for (var r = n[i], o = 0; o < 4; ++o) tr(t.root, -11, 50 + 25 * o, r);
            return t
        }
        return gr(t, e), t.segments = 4, t
    }(fr);

    function Do() {
        return fr.CreateBlock(Oo, Oo.segments)
    }
    var wo = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }(),
        Lo = function(e) {
            function t() {
                return e.call(this) || this
            }
            return wo(t, e), t.segments = 1, t
        }(fr);

    function Fo() {
        return fr.CreateBlock(Lo, Lo.segments)
    }
    var No = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.portals = [], t.speeds = [];
            for (var i = 0; i < 3; ++i) t.portals[i] = Jn(t.root, 20, 50), t.speeds[i] = 30 * Math.PI / 180 * (.5 + .5 * cr.value()), i % 2 == 1 && (t.speeds[i] *= -1);
            return t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            for (var t = 0; t < this.portals.length; ++t) this.portals[t].addRotation(0, 0, this.speeds[t] * e)
        }, t.segments = 1, t
    }(fr);

    function Uo() {
        return fr.CreateBlock(No, No.segments)
    }
    var Bo = function(e) {
        function t() {
            var t = e.call(this) || this;
            return nr(t.root, 31, 90), nr(t.root, 31, -90), t
        }
        return wo(t, e), t.segments = 1, t
    }(fr);

    function ko() {
        return fr.CreateBlock(Bo, Bo.segments)
    }
    var Vo = function(e) {
        function t() {
            var t = e.call(this) || this;
            return nr(t.root, 31, 90), nr(t.root, 7, -90), nr(t.root, 19, 0), nr(t.root, 25, 180), t
        }
        return wo(t, e), t.segments = 1, t
    }(fr);

    function Go() {
        return fr.CreateBlock(Vo, Vo.segments)
    }
    var zo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("node", t.root.getScene());
            i.parent = t.root;
            for (var n = 0; n < 4; ++n) tr(i, 11, 25, 90 * n);
            return t.rotator = new Qn(i, 40), t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 1, t
    }(fr);

    function Wo() {
        return fr.CreateBlock(zo, zo.segments)
    }
    var Xo = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("node", t.root.getScene());
            i.position = new b(0, 0, 25), i.parent = t.root;
            for (var n = new Kn([new T(.25, 0), new T(.4, 1), new T(.7, 1), new T(.85, 0)]), r = 0; r < 4; ++r) tr(i, 11, 0, 90 * r);
            return t.rotator = new Zn(i, .5, 45, n), t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 1, t
    }(fr);

    function Ho() {
        return fr.CreateBlock(Xo, Xo.segments)
    }
    var jo = function(e) {
        function t() {
            var t = e.call(this) || this;
            return tr(t.root, -14, 31, 90), tr(t.root, -14, 7, -90), tr(t.root, -14, 19, 0), tr(t.root, -14, 25, 180), t
        }
        return wo(t, e), t.segments = 1, t
    }(fr);

    function Yo() {
        return fr.CreateBlock(jo, jo.segments)
    }
    var Ko = function(e) {
        function t() {
            for (var t = e.call(this) || this, i = 0; i < 4; ++i) ar(t.root, 25, 90 * i);
            return t
        }
        return wo(t, e), t.segments = 1, t
    }(fr);

    function qo() {
        return fr.CreateBlock(Ko, Ko.segments)
    }
    var Zo = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(0, 0), new T(.5, 1), new T(1, 0)]), n = 0; n < 4; ++n) {
                var r = ar(t.root, 25, 90 * n);
                t.movers.push(new qn(r, 1, -10, i, b.Up(), !1))
            }
            return t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 1, t
    }(fr);

    function Qo() {
        return fr.CreateBlock(Zo, Zo.segments)
    }
    var Jo = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(.03, 0), new T(.1, 1), new T(.65, 1), new T(.72, 0)]), n = 0; n < 4; ++n) {
                var r = rr(t.root, 4, 16, 4, 0, 16, 50, 90 * n),
                    o = rr(t.root, 4, 16, 4, 0, 0, 50, 45 + 90 * n);
                t.movers.push(new qn(r, 1, -16, i, b.Up(), !0)), t.movers.push(new qn(o, 1, 16, i, b.Up(), !0))
            }
            return t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function $o() {
        return fr.CreateBlock(Jo, Jo.segments)
    }
    var es = function(e) {
        function t() {
            var t = e.call(this) || this,
                i = new je("pillars", t.root.getScene());
            i.parent = t.root;
            for (var n = 0; n < 4; ++n) ar(i, 25, 90 * n);
            return t.rotator = new Qn(i, -40), t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            this.rotator.Update(e)
        }, t.segments = 1, t
    }(fr);

    function ts() {
        return fr.CreateBlock(es, es.segments)
    }
    var is = function(e) {
        function t() {
            for (var t = e.call(this) || this, i = 0; i < 4; ++i) {
                rr(t.root, 10, 32, 10, 0, 10, 25, 90 * i).name = "fat_pillar"
            }
            return t
        }
        return wo(t, e), t.segments = 1, t
    }(fr);

    function ns() {
        return fr.CreateBlock(is, is.segments)
    }
    var rs = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(0, 1), new T(.16, .9), new T(.28, .7), new T(.5, 0), new T(.72, .7), new T(.84, .9), new T(1, 1)]), n = 0; n < 4; ++n) {
                var r = rr(t.root, 10, 10, 10, 0, 14, 25, 90 * n);
                t.movers.push(new qn(r, 1.5, 10, i, b.Up(), !1))
            }
            return t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 1, t
    }(fr);

    function os() {
        return fr.CreateBlock(rs, rs.segments)
    }
    var ss = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(0, 1), new T(.16, .9), new T(.28, .7), new T(.5, 0), new T(.72, .7), new T(.84, .9), new T(1, 1)]), n = new Kn([new T(0, 0), new T(.22, .7), new T(.34, .9), new T(.5, 1), new T(.66, .9), new T(.78, .7), new T(1, 0)]), r = 0; r < 4; ++r) {
                var o = rr(t.root, 10, 10, 10, 0, 14, 25, 90 * r),
                    s = rr(t.root, 10, 10, 10, 0, 14, 25, 45 + 90 * r);
                t.movers.push(new qn(o, 1.5, 10, i, b.Up(), !1)), t.movers.push(new qn(s, 1.5, 10, n, b.Up(), !1))
            }
            return t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 1, t
    }(fr);

    function as() {
        return fr.CreateBlock(ss, ss.segments)
    }
    var us = function(e) {
        function t() {
            var t = e.call(this) || this;
            return er(t.root, 11, 25, 0), er(t.root, 11, 25, 180), t
        }
        return wo(t, e), t.segments = 1, t
    }(fr);

    function hs() {
        return fr.CreateBlock(us, us.segments)
    }
    var ls = function(e) {
        function t() {
            var t = e.call(this) || this;
            return er(t.root, 11, 50, 0), er(t.root, 11, 50, 90), er(t.root, 11, 50, 180), er(t.root, 11, 50, -90), t
        }
        return wo(t, e), t.segments = 2, t
    }(fr);

    function cs() {
        return fr.CreateBlock(ls, ls.segments)
    }
    var ds = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(.1, 0), new T(.16, 1), new T(.5, 1), new T(.9, 0)]), n = 0; n < 2; ++n) {
                var r = er(t.root, 11, 25, 180 * n);
                t.movers.push(new qn(r, 1, 6, i, b.Forward(), !0))
            }
            return t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 1, t
    }(fr);

    function fs() {
        return fr.CreateBlock(ds, ds.segments)
    }
    var ps = function(e) {
        function t() {
            var t = e.call(this) || this;
            t.movers = [];
            for (var i = new Kn([new T(.1, 0), new T(.16, 1), new T(.5, 1), new T(.9, 0)]), n = 0; n < 4; ++n) {
                var r = er(t.root, 11, 50, 90 * n);
                t.movers.push(new qn(r, 1, 6, i, b.Forward(), !0))
            }
            return t
        }
        return wo(t, e), t.prototype.Update = function(e) {
            for (var t = 0, i = this.movers; t < i.length; t++) {
                i[t].Update(e)
            }
        }, t.segments = 2, t
    }(fr);

    function _s() {
        return fr.CreateBlock(ps, ps.segments)
    }

    function gs(e, t, i, n) {
        var r = new pr;
        r.sectionLength = e, r.firstBlock = t ? t() : null, r.lastBlock = i ? i() : null;
        for (var o = 0, s = n; o < s.length; o++) {
            var a = s[o];
            r.blocks.push(a())
        }
        return r
    }

    function ms() {
        return gs(4, yr, null, [yr])
    }

    function vs() {
        return gs(5, yr, null, [Ar, to])
    }

    function ys() {
        return gs(5, yr, br, [go, vo, to, no])
    }

    function Ts() {
        return gs(12, yr, null, [$r, oo, ao, ho])
    }

    function bs() {
        return gs(18, yr, br, [Rr, Fr, Pr, kr, Gr, Do, Hr, no, ho, co])
    }

    function Es() {
        return gs(15, yr, null, [ao, Eo, Do, Pr, ho, Rr])
    }

    function As() {
        return gs(15, yr, br, [no, oo, ho, So, vo, Hr, Fr])
    }

    function Ms() {
        return gs(12, yr, null, [$r, Do, to, Rr, ho, Sr, Or])
    }

    function Rs() {
        return gs(18, yr, br, [Rr, Fr, Pr, kr, Gr, Do, Hr, no, ho, co, qr])
    }

    function xs() {
        return gs(18, yr, null, [Rr, Fr, Pr, kr, Gr, Do, Hr, no, ho, co, go, So, To, Mo, xo, wr, Wr, Sr, Qr, Or])
    }

    function Ps() {
        return gs(18, yr, br, [Ur, Gr, Do, Yr, $r, oo, ao, po, vo, Eo, xo, Io, Or, Sr, Wr, qr, Qr])
    }

    function Is() {
        return gs(12, Fo, null, [ko, Go, Yo, qo])
    }

    function Cs() {
        return gs(12, Fo, Uo, [ko, Go, Yo, hs, cs])
    }

    function Ss() {
        return gs(12, Fo, null, [ko, Go, Yo, hs, cs, ns])
    }

    function Os() {
        return gs(12, Fo, Uo, [fs, _s, Yo, qo, ko, Go, ns])
    }

    function Ds() {
        return gs(15, Fo, null, [hs, Go, Qo])
    }

    function ws() {
        return gs(10, null, Uo, [hs, Go, Qo, Wo])
    }

    function Ls() {
        return gs(12, Fo, null, [ko, Go, Yo, hs, cs, ns])
    }

    function Fs() {
        return gs(10, null, Uo, [fs, _s, Yo, qo, ko, Go, os])
    }

    function Ns() {
        return gs(12, Fo, null, [ko, Go, Yo, qo, hs, cs, fs, _s, qo, Qo, $o, ts, Wo, Ho])
    }

    function Us() {
        return gs(12, Fo, null, [ko, Go, Yo, qo, hs, cs, fs, _s, qo, Qo, $o, ts, Wo, Ho, os, ns])
    }

    function Bs() {
        return gs(6, null, Uo, [_s, Qo, $o, ts, Wo, Ho, as, ns])
    }

    function ks(e, t) {
        var i = new _r;
        i.isInside = e;
        for (var n = 0, r = t; n < r.length; n++) {
            var o = r[n];
            i.sections.push(o())
        }
        return i
    }
    var Vs = function() {
            function e() {
                this.TunnelLength = 600, this.levels = [], this.levelSections = [], this.blocks = [], this.zOffset = 0, this.currentZ = 0, this.enableGeneration = !0, this.currentSectionIdx = 0, this.levelCompleted = !1, this.menuSection = gs(1, yr, null, []), this.levels.push(ks(!0, [ms, vs, ys])), this.levels.push(ks(!1, [Is, Cs])), this.levels.push(ks(!0, [ms, Ts, bs])), this.levels.push(ks(!1, [Ss, Os])), this.levels.push(ks(!0, [ms, Es, As])), this.levels.push(ks(!1, [Ds, ws])), this.levels.push(ks(!0, [ms, Ms, Rs])), this.levels.push(ks(!1, [Ls, Fs]));
                for (var e = 0; e < 4; ++e) this.levels.push(ks(!0, [ms, xs, Ps])), this.levels.push(ks(!1, [Ns, Us, Bs]))
            }
            return e.prototype.CalcOffset = function(e) {
                var t = .0049 * (e + this.zOffset),
                    i = Math.sin(t),
                    n = Math.sin(1.77 * t),
                    r = Math.sin(.57 * t),
                    o = Math.sin(.31 * t);
                return new b(1 + r * (i * n) - i * r + o, r * n - i * o, 0).scale(50)
            }, e.prototype.Reset = function() {
                for (var e = 0; e < this.blocks.length; ++e) this.blocks[e].root.dispose();
                this.blocks = [], this.zOffset = 0, this.currentZ = 0, this.currentSectionIdx = 0, this.enableGeneration = !0, this.levelCompleted = !1
            }, e.prototype.RemoveObstacles = function(e) {
                var t, i = [];
                t = this.currentLevel.isInside ? 8 : 12, i.push(new b(0, 0, 0)), i.push(new b(t, 0, 0)), i.push(new b(t, t, 0)), i.push(new b(0, t, 0)), i.push(new b(-t, t, 0)), i.push(new b(-t, 0, 0)), i.push(new b(-t, -t, 0)), i.push(new b(0, -t, 0)), i.push(new b(t, -t, 0));
                for (var n = new b(0, 0, 1), r = 0; r < i.length; ++r)
                    for (var o = new Ii(i[r], n, e), s = Ua.instance.scene.multiPickWithRay(o, null), a = 0; a < s.length; ++a) {
                        var u = s[a];
                        u.hit && "obstacle" == u.pickedMesh.layer && (u.pickedMesh.isVisible = !1, u.pickedMesh.isPickable = !1)
                    }
            }, e.prototype.StartGame = function() {
                this.Reset();
                for (var e = Math.max(0, Ua.instance.currentLevel - 1), t = e; t >= this.levels.length;) t -= this.levels.length - 2;
                var i = 1e4 * e,
                    n = new Date,
                    r = 1577 * n.getMonth() + 239 * n.getDate() + 4527 * e,
                    o = ["#A10C0C", "#AB720D", "#A317BA", "#195E1C", "#A10C0C", "#1A9879", "#BC1766", "#4961FF", "#761AC7"],
                    s = e % o.length,
                    a = v.FromHexString(o[s]);
                Ua.instance.obstacleMat.setVector3("color", new b(a.r, a.g, a.b)), this.currentLevel = this.levels[t], this.levelSections = this.currentLevel.sections;
                for (var u = 0, h = 0; h < this.levelSections.length; ++h) {
                    u += this.levelSections[h].PickAllBlocks(i, r);
                    this.levelSections[h].lastBlock
                }
                this.currentLevelLength = u, this.levelSections[0].Reset(), Ua.instance.gameMode == _a.SplitScreen ? 0 == Ua.instance.cumulativeLevelCount && Ua.instance.ShowInfo("Use A,D and Left,Right to Steer") : 0 == e ? Ua.instance.isMobileBrowser ? Ua.instance.ShowInfo("Touch Left and Right to Steer") : Ua.instance.ShowInfo("Use Arrow Keys to Steer") : Ua.instance.ShowInfo("Level " + (e + 1))
            }, e.prototype.Update = function(e, t) {
                var i = this.blocks,
                    n = (i.length, t * e);
                this.currentZ -= n, this.currentZ = Math.max(0, this.currentZ);
                for (var r = b.Backward(), o = 0; o < i.length; ++o) {
                    (a = i[o]).root.translate(r, n), a.Update(e), a.root.position.z < -a.length && (a.isFinalBlock && (this.levelCompleted = !0), a.root.dispose(), i[o] = i[i.length - 1], i.pop(), o--)
                }
                if (t > 0)
                    for (var s = Ua.instance.state == pa.InMenus; this.enableGeneration && this.currentZ < 600;) {
                        var a = void 0,
                            u = void 0;
                        a = (u = s ? this.menuSection : this.levelSections[this.currentSectionIdx]).GenerateBlock(this.currentZ), i.push(a), this.currentZ += a.length, !s && u.IsSectionCompleted() && (this.currentSectionIdx++, this.currentSectionIdx >= this.levelSections.length ? (this.enableGeneration = !1, a.isFinalBlock = !0) : this.levelSections[this.currentSectionIdx].Reset())
                    }
                this.zOffset += n, this.cameraOffset = this.CalcOffset(0)
            }, e
        }(),
        Gs = i(0);

    function zs(e, t) {
        return new Gs.Howl({
            src: [e],
            loop: t
        })
    }
    var Ws = function() {
            function e() {
                e.instance = this, this.volume = 1, this.music = new Map, this.sfx = new Map, this.music.set("IntroLoop", zs("./audio/IntroLoop.mp3", !0)), this.music.set("GameLoop", zs("./audio/GameLoop.mp3", !0)), this.sfx.set("Explode", zs("./audio/Explosion.mp3", !1)), this.sfx.set("Button", zs("./audio/ButtonPress.mp3", !1)), this.sfx.set("Beep", zs("./audio/Beep.mp3", !1)), this.sfx.set("Pause", zs("./audio/Pause.mp3", !1))
            }
            return e.SetVolume = function(t) {
                e.instance.volume = t, Gs.Howler.volume(t)
            }, e.ToggleAudio = function() {
                0 == e.instance.volume ? e.SetVolume(1) : e.SetVolume(0)
            }, e.IsAudioEnabled = function() {
                return e.instance.volume > 0
            }, e.SetAudioEnabled = function(t) {
                t ? e.SetVolume(1) : e.SetVolume(0)
            }, e.PlayMusic = function(t) {
                var i = e.instance;
                if (i.music.has(t)) {
                    var n = i.music.get(t);
                    i.currentMusic && i.currentMusic.stop(), i.currentMusic = n, i.currentMusic.play()
                } else console.log("No Music Found: " + t)
            }, e.PlaySfx = function(t) {
                var i = e.instance;
                i.sfx.has(t) ? i.sfx.get(t).play() : console.log("No Sfx Found: " + t)
            }, e.PauseMusic = function() {
                var t = e.instance;
                t.currentMusic && t.currentMusic.pause()
            }, e.UnPauseMusic = function() {
                var t = e.instance;
                t.currentMusic && t.currentMusic.play()
            }, e.IsMusicPlaying = function() {
                var t = e.instance;
                return null != t.currentMusic && t.currentMusic.playing()
            }, e
        }(),
        Xs = function() {
            function e() {}
            return e.COPY = 1, e.CUT = 2, e.PASTE = 3, e
        }(),
        Hs = function() {
            function e(e, t) {
                this.type = e, this.event = t
            }
            return e.GetTypeFromCharacter = function(e) {
                switch (e) {
                    case 67:
                        return Xs.COPY;
                    case 86:
                        return Xs.PASTE;
                    case 88:
                        return Xs.CUT;
                    default:
                        return -1
                }
            }, e
        }(),
        js = function(e) {
            function t(t, i, n, r, o, s) {
                void 0 === n && (n = null), void 0 === o && (o = k.TEXTURE_TRILINEAR_SAMPLINGMODE), void 0 === s && (s = k.TEXTUREFORMAT_RGBA);
                var a = e.call(this, null, n, !r, void 0, o, void 0, void 0, void 0, void 0, s) || this;
                a.name = t, a._engine = a.getScene().getEngine(), a.wrapU = Ri.CLAMP_ADDRESSMODE, a.wrapV = Ri.CLAMP_ADDRESSMODE, a._generateMipMaps = r, i.getContext ? (a._canvas = i, a._texture = a._engine.createDynamicTexture(i.width, i.height, r, o)) : (a._canvas = document.createElement("canvas"), i.width || 0 === i.width ? a._texture = a._engine.createDynamicTexture(i.width, i.height, r, o) : a._texture = a._engine.createDynamicTexture(i, i, r, o));
                var u = a.getSize();
                return a._canvas.width = u.width, a._canvas.height = u.height, a._context = a._canvas.getContext("2d"), a
            }
            return r(t, e), t.prototype.getClassName = function() {
                return "DynamicTexture"
            }, Object.defineProperty(t.prototype, "canRescale", {
                get: function() {
                    return !0
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._recreate = function(e) {
                this._canvas.width = e.width, this._canvas.height = e.height, this.releaseInternalTexture(), this._texture = this._engine.createDynamicTexture(e.width, e.height, this._generateMipMaps, this.samplingMode)
            }, t.prototype.scale = function(e) {
                var t = this.getSize();
                t.width *= e, t.height *= e, this._recreate(t)
            }, t.prototype.scaleTo = function(e, t) {
                var i = this.getSize();
                i.width = e, i.height = t, this._recreate(i)
            }, t.prototype.getContext = function() {
                return this._context
            }, t.prototype.clear = function() {
                var e = this.getSize();
                this._context.fillRect(0, 0, e.width, e.height)
            }, t.prototype.update = function(e, t) {
                void 0 === t && (t = !1), this._engine.updateDynamicTexture(this._texture, this._canvas, void 0 === e || e, t, this._format || void 0)
            }, t.prototype.drawText = function(e, t, i, n, r, o, s, a) {
                void 0 === a && (a = !0);
                var u = this.getSize();
                if (o && (this._context.fillStyle = o, this._context.fillRect(0, 0, u.width, u.height)), this._context.font = n, null == t) {
                    var h = this._context.measureText(e);
                    t = (u.width - h.width) / 2
                }
                if (null == i) {
                    var l = parseInt(n.replace(/\D/g, ""));
                    i = u.height / 2 + l / 3.65
                }
                this._context.fillStyle = r, this._context.fillText(e, t, i), a && this.update(s)
            }, t.prototype.clone = function() {
                var e = this.getScene();
                if (!e) return this;
                var i = this.getSize(),
                    n = new t(this.name, i, e, this._generateMipMaps);
                return n.hasAlpha = this.hasAlpha, n.level = this.level, n.wrapU = this.wrapU, n.wrapV = this.wrapV, n
            }, t.prototype.serialize = function() {
                var t = this.getScene();
                t && !t.isReady() && V.Warn("The scene must be ready before serializing the dynamic texture");
                var i = e.prototype.serialize.call(this);
                return i.base64String = this._canvas.toDataURL(), i.invertY = this._invertY, i.samplingMode = this.samplingMode, i
            }, t.prototype._rebuild = function() {
                this.update()
            }, t
        }(Ri),
        Ys = function() {
            function e(e) {
                this.name = lt.NAME_LAYER, this.scene = e, this._engine = e.getEngine(), e.layers = new Array
            }
            return e.prototype.register = function() {
                this.scene._beforeCameraDrawStage.registerStep(lt.STEP_BEFORECAMERADRAW_LAYER, this, this._drawCameraBackground), this.scene._afterCameraDrawStage.registerStep(lt.STEP_AFTERCAMERADRAW_LAYER, this, this._drawCameraForeground), this.scene._beforeRenderTargetDrawStage.registerStep(lt.STEP_BEFORERENDERTARGETDRAW_LAYER, this, this._drawRenderTargetBackground), this.scene._afterRenderTargetDrawStage.registerStep(lt.STEP_AFTERRENDERTARGETDRAW_LAYER, this, this._drawRenderTargetForeground)
            }, e.prototype.rebuild = function() {
                for (var e = 0, t = this.scene.layers; e < t.length; e++) {
                    t[e]._rebuild()
                }
            }, e.prototype.dispose = function() {
                for (var e = this.scene.layers; e.length;) e[0].dispose()
            }, e.prototype._draw = function(e) {
                var t = this.scene.layers;
                if (t.length) {
                    this._engine.setDepthBuffer(!1);
                    for (var i = 0, n = t; i < n.length; i++) {
                        var r = n[i];
                        e(r) && r.render()
                    }
                    this._engine.setDepthBuffer(!0)
                }
            }, e.prototype._drawCameraPredicate = function(e, t, i) {
                return !e.renderOnlyInRenderTargetTextures && e.isBackground === t && 0 != (e.layerMask & i)
            }, e.prototype._drawCameraBackground = function(e) {
                var t = this;
                this._draw((function(i) {
                    return t._drawCameraPredicate(i, !0, e.layerMask)
                }))
            }, e.prototype._drawCameraForeground = function(e) {
                var t = this;
                this._draw((function(i) {
                    return t._drawCameraPredicate(i, !1, e.layerMask)
                }))
            }, e.prototype._drawRenderTargetPredicate = function(e, t, i, n) {
                return e.renderTargetTextures.length > 0 && e.isBackground === t && e.renderTargetTextures.indexOf(n) > -1 && 0 != (e.layerMask & i)
            }, e.prototype._drawRenderTargetBackground = function(e) {
                var t = this;
                this._draw((function(i) {
                    return t._drawRenderTargetPredicate(i, !0, t.scene.activeCamera.layerMask, e)
                }))
            }, e.prototype._drawRenderTargetForeground = function(e) {
                var t = this;
                this._draw((function(i) {
                    return t._drawRenderTargetPredicate(i, !1, t.scene.activeCamera.layerMask, e)
                }))
            }, e
        }(),
        Ks = "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}";
    ie.ShadersStore.layerPixelShader = Ks;
    var qs = "\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}";
    ie.ShadersStore.layerVertexShader = qs;
    var Zs, Qs = function() {
            function e(e, t, i, n, r) {
                this.name = e, this.scale = new T(1, 1), this.offset = new T(0, 0), this.alphaBlendingMode = k.ALPHA_COMBINE, this.layerMask = 268435455, this.renderTargetTextures = [], this.renderOnlyInRenderTargetTextures = !1, this._vertexBuffers = {}, this.onDisposeObservable = new l, this.onBeforeRenderObservable = new l, this.onAfterRenderObservable = new l, this.texture = t ? new Ri(t, i, !0) : null, this.isBackground = void 0 === n || n, this.color = void 0 === r ? new y(1, 1, 1, 1) : r, this._scene = i || ve.LastCreatedScene;
                var o = this._scene._getComponent(lt.NAME_LAYER);
                o || (o = new Ys(this._scene), this._scene._addComponent(o)), this._scene.layers.push(this);
                var s = this._scene.getEngine(),
                    a = [];
                a.push(1, 1), a.push(-1, 1), a.push(-1, -1), a.push(1, -1);
                var u = new Te(s, a, Te.PositionKind, !1, !1, 2);
                this._vertexBuffers[Te.PositionKind] = u, this._createIndexBuffer(), this._effect = s.createEffect("layer", [Te.PositionKind], ["textureMatrix", "color", "scale", "offset"], ["textureSampler"], ""), this._alphaTestEffect = s.createEffect("layer", [Te.PositionKind], ["textureMatrix", "color", "scale", "offset"], ["textureSampler"], "#define ALPHATEST")
            }
            return Object.defineProperty(e.prototype, "onDispose", {
                set: function(e) {
                    this._onDisposeObserver && this.onDisposeObservable.remove(this._onDisposeObserver), this._onDisposeObserver = this.onDisposeObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "onBeforeRender", {
                set: function(e) {
                    this._onBeforeRenderObserver && this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver), this._onBeforeRenderObserver = this.onBeforeRenderObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "onAfterRender", {
                set: function(e) {
                    this._onAfterRenderObserver && this.onAfterRenderObservable.remove(this._onAfterRenderObserver), this._onAfterRenderObserver = this.onAfterRenderObservable.add(e)
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._createIndexBuffer = function() {
                var e = this._scene.getEngine(),
                    t = [];
                t.push(0), t.push(1), t.push(2), t.push(0), t.push(2), t.push(3), this._indexBuffer = e.createIndexBuffer(t)
            }, e.prototype._rebuild = function() {
                var e = this._vertexBuffers[Te.PositionKind];
                e && e._rebuild(), this._createIndexBuffer()
            }, e.prototype.render = function() {
                var e = this.alphaTest ? this._alphaTestEffect : this._effect;
                if (e.isReady() && this.texture && this.texture.isReady()) {
                    var t = this._scene.getEngine();
                    this.onBeforeRenderObservable.notifyObservers(this), t.enableEffect(e), t.setState(!1), e.setTexture("textureSampler", this.texture), e.setMatrix("textureMatrix", this.texture.getTextureMatrix()), e.setFloat4("color", this.color.r, this.color.g, this.color.b, this.color.a), e.setVector2("offset", this.offset), e.setVector2("scale", this.scale), t.bindBuffers(this._vertexBuffers, this._indexBuffer, e), this.alphaTest ? t.drawElementsType(De.TriangleFillMode, 0, 6) : (t.setAlphaMode(this.alphaBlendingMode), t.drawElementsType(De.TriangleFillMode, 0, 6), t.setAlphaMode(k.ALPHA_DISABLE)), this.onAfterRenderObservable.notifyObservers(this)
                }
            }, e.prototype.dispose = function() {
                var e = this._vertexBuffers[Te.PositionKind];
                e && (e.dispose(), this._vertexBuffers[Te.PositionKind] = null), this._indexBuffer && (this._scene.getEngine()._releaseBuffer(this._indexBuffer), this._indexBuffer = null), this.texture && (this.texture.dispose(), this.texture = null), this.renderTargetTextures = [];
                var t = this._scene.layers.indexOf(this);
                this._scene.layers.splice(t, 1), this.onDisposeObservable.notifyObservers(this), this.onDisposeObservable.clear(), this.onAfterRenderObservable.clear(), this.onBeforeRenderObservable.clear()
            }, e
        }(),
        Js = function() {
            function e(t, i, n) {
                void 0 === i && (i = e.UNITMODE_PIXEL), void 0 === n && (n = !0), this.unit = i, this.negativeValueAllowed = n, this._value = 1, this.ignoreAdaptiveScaling = !1, this._value = t, this._originalUnit = i
            }
            return Object.defineProperty(e.prototype, "isPercentage", {
                get: function() {
                    return this.unit === e.UNITMODE_PERCENTAGE
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isPixel", {
                get: function() {
                    return this.unit === e.UNITMODE_PIXEL
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "internalValue", {
                get: function() {
                    return this._value
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getValueInPixel = function(e, t) {
                return this.isPixel ? this.getValue(e) : this.getValue(e) * t
            }, e.prototype.updateInPlace = function(t, i) {
                return void 0 === i && (i = e.UNITMODE_PIXEL), this._value = t, this.unit = i, this
            }, e.prototype.getValue = function(t) {
                if (t && !this.ignoreAdaptiveScaling && this.unit !== e.UNITMODE_PERCENTAGE) {
                    var i = 0,
                        n = 0;
                    if (t.idealWidth && (i = this._value * t.getSize().width / t.idealWidth), t.idealHeight && (n = this._value * t.getSize().height / t.idealHeight), t.useSmallestIdeal && t.idealWidth && t.idealHeight) return window.innerWidth < window.innerHeight ? i : n;
                    if (t.idealWidth) return i;
                    if (t.idealHeight) return n
                }
                return this._value
            }, e.prototype.toString = function(t, i) {
                switch (this.unit) {
                    case e.UNITMODE_PERCENTAGE:
                        var n = 100 * this.getValue(t);
                        return (i ? n.toFixed(i) : n) + "%";
                    case e.UNITMODE_PIXEL:
                        var r = this.getValue(t);
                        return (i ? r.toFixed(i) : r) + "px"
                }
                return this.unit.toString()
            }, e.prototype.fromString = function(t) {
                var i = e._Regex.exec(t.toString());
                if (!i || 0 === i.length) return !1;
                var n = parseFloat(i[1]),
                    r = this._originalUnit;
                if (this.negativeValueAllowed || n < 0 && (n = 0), 4 === i.length) switch (i[3]) {
                    case "px":
                        r = e.UNITMODE_PIXEL;
                        break;
                    case "%":
                        r = e.UNITMODE_PERCENTAGE, n /= 100
                }
                return (n !== this._value || r !== this.unit) && (this._value = n, this.unit = r, !0)
            }, Object.defineProperty(e, "UNITMODE_PERCENTAGE", {
                get: function() {
                    return e._UNITMODE_PERCENTAGE
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "UNITMODE_PIXEL", {
                get: function() {
                    return e._UNITMODE_PIXEL
                },
                enumerable: !0,
                configurable: !0
            }), e._Regex = /(^-?\d*(\.\d+)?)(%|px)?/, e._UNITMODE_PERCENTAGE = 0, e._UNITMODE_PIXEL = 1, e
        }(),
        $s = function(e) {
            function t(t, i) {
                var n = e.call(this, t.x, t.y) || this;
                return n.index = i, n
            }
            return r(t, e), t
        }(T),
        ea = function() {
            function e() {
                this.elements = new Array
            }
            return e.prototype.add = function(e) {
                var t = this,
                    i = new Array;
                return e.forEach((function(e) {
                    if (0 === i.length || !e.equalsWithEpsilon(i[0])) {
                        var n = new $s(e, t.elements.length);
                        i.push(n), t.elements.push(n)
                    }
                })), i
            }, e.prototype.computeBounds = function() {
                var e = new T(this.elements[0].x, this.elements[0].y),
                    t = new T(this.elements[0].x, this.elements[0].y);
                return this.elements.forEach((function(i) {
                    i.x < e.x ? e.x = i.x : i.x > t.x && (t.x = i.x), i.y < e.y ? e.y = i.y : i.y > t.y && (t.y = i.y)
                })), {
                    min: e,
                    max: t,
                    width: t.x - e.x,
                    height: t.y - e.y
                }
            }, e
        }(),
        ta = function() {
            function e() {}
            return e.Rectangle = function(e, t, i, n) {
                return [new T(e, t), new T(i, t), new T(i, n), new T(e, n)]
            }, e.Circle = function(e, t, i, n) {
                void 0 === t && (t = 0), void 0 === i && (i = 0), void 0 === n && (n = 32);
                for (var r = new Array, o = 0, s = 2 * Math.PI / n, a = 0; a < n; a++) r.push(new T(t + Math.cos(o) * e, i + Math.sin(o) * e)), o -= s;
                return r
            }, e.Parse = function(e) {
                var t, i = e.split(/[^-+eE\.\d]+/).map(parseFloat).filter((function(e) {
                        return !isNaN(e)
                    })),
                    n = [];
                for (t = 0; t < (2147483646 & i.length); t += 2) n.push(new T(i[t], i[t + 1]));
                return n
            }, e.StartingAt = function(e, t) {
                return L.StartingAt(e, t)
            }, e
        }(),
        ia = (function() {
            function e(e, t, i, n) {
                var r;
                void 0 === n && (n = earcut), this._points = new ea, this._outlinepoints = new ea, this._holes = new Array, this._epoints = new Array, this._eholes = new Array, this.bjsEarcut = n, this._name = e, this._scene = i || ze.LastCreatedScene, r = t instanceof L ? t.getPoints() : t, this._addToepoint(r), this._points.add(r), this._outlinepoints.add(r), void 0 === this.bjsEarcut && V.Warn("Earcut was not found, the polygon will not be built.")
            }
            e.prototype._addToepoint = function(e) {
                for (var t = 0, i = e; t < i.length; t++) {
                    var n = i[t];
                    this._epoints.push(n.x, n.y)
                }
            }, e.prototype.addHole = function(e) {
                this._points.add(e);
                var t = new ea;
                return t.add(e), this._holes.push(t), this._eholes.push(this._epoints.length / 2), this._addToepoint(e), this
            }, e.prototype.build = function(e, t) {
                void 0 === e && (e = !1), void 0 === t && (t = 0);
                var i = new Vt(this._name, this._scene),
                    n = this.buildVertexData(t);
                return i.setVerticesData(Te.PositionKind, n.positions, e), i.setVerticesData(Te.NormalKind, n.normals, e), i.setVerticesData(Te.UVKind, n.uvs, e), i.setIndices(n.indices), i
            }, e.prototype.buildVertexData = function(e) {
                var t = this;
                void 0 === e && (e = 0);
                var i = new Ye,
                    n = new Array,
                    r = new Array,
                    o = new Array,
                    s = this._points.computeBounds();
                this._points.elements.forEach((function(e) {
                    n.push(0, 1, 0), r.push(e.x, 0, e.y), o.push((e.x - s.min.x) / s.width, (e.y - s.min.y) / s.height)
                }));
                for (var a = new Array, u = this.bjsEarcut(this._epoints, this._eholes, 2), h = 0; h < u.length; h++) a.push(u[h]);
                if (e > 0) {
                    var l = r.length / 3;
                    this._points.elements.forEach((function(t) {
                        n.push(0, -1, 0), r.push(t.x, -e, t.y), o.push(1 - (t.x - s.min.x) / s.width, 1 - (t.y - s.min.y) / s.height)
                    }));
                    var c = a.length;
                    for (h = 0; h < c; h += 3) {
                        var d = a[h + 0],
                            f = a[h + 1],
                            p = a[h + 2];
                        a.push(p + l), a.push(f + l), a.push(d + l)
                    }
                    this.addSide(r, n, o, a, s, this._outlinepoints, e, !1), this._holes.forEach((function(i) {
                        t.addSide(r, n, o, a, s, i, e, !0)
                    }))
                }
                return i.indices = a, i.positions = r, i.normals = n, i.uvs = o, i
            }, e.prototype.addSide = function(e, t, i, n, r, o, s, a) {
                for (var u = e.length / 3, h = 0, l = 0; l < o.elements.length; l++) {
                    var c, d = o.elements[l];
                    c = l + 1 > o.elements.length - 1 ? o.elements[0] : o.elements[l + 1], e.push(d.x, 0, d.y), e.push(d.x, -s, d.y), e.push(c.x, 0, c.y), e.push(c.x, -s, c.y);
                    var f = new b(d.x, 0, d.y),
                        p = new b(c.x, 0, c.y).subtract(f),
                        _ = new b(0, 1, 0),
                        g = b.Cross(p, _);
                    g = g.normalize(), i.push(h / r.width, 0), i.push(h / r.width, 1), h += p.length(), i.push(h / r.width, 0), i.push(h / r.width, 1), a ? (t.push(g.x, g.y, g.z), t.push(g.x, g.y, g.z), t.push(g.x, g.y, g.z), t.push(g.x, g.y, g.z), n.push(u), n.push(u + 2), n.push(u + 1), n.push(u + 1), n.push(u + 2), n.push(u + 3)) : (t.push(-g.x, -g.y, -g.z), t.push(-g.x, -g.y, -g.z), t.push(-g.x, -g.y, -g.z), t.push(-g.x, -g.y, -g.z), n.push(u), n.push(u + 1), n.push(u + 2), n.push(u + 1), n.push(u + 3), n.push(u + 2)), u += 4
                }
            }
        }(), function() {
            function e(e, t, i, n) {
                this.left = e, this.top = t, this.width = i, this.height = n
            }
            return e.prototype.copyFrom = function(e) {
                this.left = e.left, this.top = e.top, this.width = e.width, this.height = e.height
            }, e.prototype.copyFromFloats = function(e, t, i, n) {
                this.left = e, this.top = t, this.width = i, this.height = n
            }, e.CombineToRef = function(e, t, i) {
                var n = Math.min(e.left, t.left),
                    r = Math.min(e.top, t.top),
                    o = Math.max(e.left + e.width, t.left + t.width),
                    s = Math.max(e.top + e.height, t.top + t.height);
                i.left = n, i.top = r, i.width = o - n, i.height = s - r
            }, e.prototype.transformToRef = function(e, t) {
                for (var i = ta.Rectangle(this.left, this.top, this.left + this.width, this.top + this.height), n = new T(Number.MAX_VALUE, Number.MAX_VALUE), r = new T(0, 0), o = 0; o < 4; o++) e.transformCoordinates(i[o].x, i[o].y, i[o]), n.x = Math.floor(Math.min(n.x, i[o].x)), n.y = Math.floor(Math.min(n.y, i[o].y)), r.x = Math.ceil(Math.max(r.x, i[o].x)), r.y = Math.ceil(Math.max(r.y, i[o].y));
                t.left = n.x, t.top = n.y, t.width = r.x - n.x, t.height = r.y - n.y
            }, e.prototype.isEqualsTo = function(e) {
                return this.left === e.left && (this.top === e.top && (this.width === e.width && this.height === e.height))
            }, e.Empty = function() {
                return new e(0, 0, 0, 0)
            }, e
        }()),
        na = function(e) {
            function t(t, i) {
                void 0 === i && (i = 0);
                var n = e.call(this, t.x, t.y) || this;
                return n.buttonIndex = i, n
            }
            return r(t, e), t
        }(T),
        ra = function() {
            function e(e, t, i, n, r, o) {
                this.m = new Float32Array(6), this.fromValues(e, t, i, n, r, o)
            }
            return e.prototype.fromValues = function(e, t, i, n, r, o) {
                return this.m[0] = e, this.m[1] = t, this.m[2] = i, this.m[3] = n, this.m[4] = r, this.m[5] = o, this
            }, e.prototype.determinant = function() {
                return this.m[0] * this.m[3] - this.m[1] * this.m[2]
            }, e.prototype.invertToRef = function(e) {
                var t = this.m[0],
                    i = this.m[1],
                    n = this.m[2],
                    r = this.m[3],
                    o = this.m[4],
                    s = this.m[5],
                    a = this.determinant();
                if (a < 1e-6) return e.m[0] = 0, e.m[1] = 0, e.m[2] = 0, e.m[3] = 0, e.m[4] = 0, e.m[5] = 0, this;
                var u = 1 / a,
                    h = n * s - r * o,
                    l = i * o - t * s;
                return e.m[0] = r * u, e.m[1] = -i * u, e.m[2] = -n * u, e.m[3] = t * u, e.m[4] = h * u, e.m[5] = l * u, this
            }, e.prototype.multiplyToRef = function(e, t) {
                var i = this.m[0],
                    n = this.m[1],
                    r = this.m[2],
                    o = this.m[3],
                    s = this.m[4],
                    a = this.m[5],
                    u = e.m[0],
                    h = e.m[1],
                    l = e.m[2],
                    c = e.m[3],
                    d = e.m[4],
                    f = e.m[5];
                return t.m[0] = i * u + n * l, t.m[1] = i * h + n * c, t.m[2] = r * u + o * l, t.m[3] = r * h + o * c, t.m[4] = s * u + a * l + d, t.m[5] = s * h + a * c + f, this
            }, e.prototype.transformCoordinates = function(e, t, i) {
                return i.x = e * this.m[0] + t * this.m[2] + this.m[4], i.y = e * this.m[1] + t * this.m[3] + this.m[5], this
            }, e.Identity = function() {
                return new e(1, 0, 0, 1, 0, 0)
            }, e.TranslationToRef = function(e, t, i) {
                i.fromValues(1, 0, 0, 1, e, t)
            }, e.ScalingToRef = function(e, t, i) {
                i.fromValues(e, 0, 0, t, 0, 0)
            }, e.RotationToRef = function(e, t) {
                var i = Math.sin(e),
                    n = Math.cos(e);
                t.fromValues(n, i, -i, n, 0, 0)
            }, e.ComposeToRef = function(t, i, n, r, o, s, a) {
                e.TranslationToRef(t, i, e._TempPreTranslationMatrix), e.ScalingToRef(r, o, e._TempScalingMatrix), e.RotationToRef(n, e._TempRotationMatrix), e.TranslationToRef(-t, -i, e._TempPostTranslationMatrix), e._TempPreTranslationMatrix.multiplyToRef(e._TempScalingMatrix, e._TempCompose0), e._TempCompose0.multiplyToRef(e._TempRotationMatrix, e._TempCompose1), s ? (e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix, e._TempCompose2), e._TempCompose2.multiplyToRef(s, a)) : e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix, a)
            }, e._TempPreTranslationMatrix = e.Identity(), e._TempPostTranslationMatrix = e.Identity(), e._TempRotationMatrix = e.Identity(), e._TempScalingMatrix = e.Identity(), e._TempCompose0 = e.Identity(), e._TempCompose1 = e.Identity(), e._TempCompose2 = e.Identity(), e
        }(),
        oa = function() {
            function e(t) {
                this.name = t, this._alpha = 1, this._alphaSet = !1, this._zIndex = 0, this._currentMeasure = ia.Empty(), this._fontFamily = "Arial", this._fontStyle = "", this._fontWeight = "", this._fontSize = new Js(18, Js.UNITMODE_PIXEL, !1), this._width = new Js(1, Js.UNITMODE_PERCENTAGE, !1), this._height = new Js(1, Js.UNITMODE_PERCENTAGE, !1), this._color = "", this._style = null, this._horizontalAlignment = e.HORIZONTAL_ALIGNMENT_CENTER, this._verticalAlignment = e.VERTICAL_ALIGNMENT_CENTER, this._isDirty = !0, this._wasDirty = !1, this._tempParentMeasure = ia.Empty(), this._prevCurrentMeasureTransformedIntoGlobalSpace = ia.Empty(), this._cachedParentMeasure = ia.Empty(), this._paddingLeft = new Js(0), this._paddingRight = new Js(0), this._paddingTop = new Js(0), this._paddingBottom = new Js(0), this._left = new Js(0), this._top = new Js(0), this._scaleX = 1, this._scaleY = 1, this._rotation = 0, this._transformCenterX = .5, this._transformCenterY = .5, this._transformMatrix = ra.Identity(), this._invertTransformMatrix = ra.Identity(), this._transformedPosition = T.Zero(), this._isMatrixDirty = !0, this._isVisible = !0, this._isHighlighted = !1, this._fontSet = !1, this._dummyVector2 = T.Zero(), this._downCount = 0, this._enterCount = -1, this._doNotRender = !1, this._downPointerIds = {}, this._isEnabled = !0, this._disabledColor = "#9a9a9a", this._rebuildLayout = !1, this._isClipped = !1, this.metadata = null, this.isHitTestVisible = !0, this.isPointerBlocker = !1, this.isFocusInvisible = !1, this.clipChildren = !0, this.clipContent = !0, this.useBitmapCache = !1, this._shadowOffsetX = 0, this._shadowOffsetY = 0, this._shadowBlur = 0, this._shadowColor = "black", this.hoverCursor = "", this._linkOffsetX = new Js(0), this._linkOffsetY = new Js(0), this.onPointerMoveObservable = new l, this.onPointerOutObservable = new l, this.onPointerDownObservable = new l, this.onPointerUpObservable = new l, this.onPointerClickObservable = new l, this.onPointerEnterObservable = new l, this.onDirtyObservable = new l, this.onBeforeDrawObservable = new l, this.onAfterDrawObservable = new l, this._tmpMeasureA = new ia(0, 0, 0, 0)
            }
            return Object.defineProperty(e.prototype, "shadowOffsetX", {
                get: function() {
                    return this._shadowOffsetX
                },
                set: function(e) {
                    this._shadowOffsetX !== e && (this._shadowOffsetX = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "shadowOffsetY", {
                get: function() {
                    return this._shadowOffsetY
                },
                set: function(e) {
                    this._shadowOffsetY !== e && (this._shadowOffsetY = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "shadowBlur", {
                get: function() {
                    return this._shadowBlur
                },
                set: function(e) {
                    this._shadowBlur !== e && (this._shadowBlur = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "shadowColor", {
                get: function() {
                    return this._shadowColor
                },
                set: function(e) {
                    this._shadowColor !== e && (this._shadowColor = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "typeName", {
                get: function() {
                    return this._getTypeName()
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.getClassName = function() {
                return this._getTypeName()
            }, Object.defineProperty(e.prototype, "host", {
                get: function() {
                    return this._host
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontOffset", {
                get: function() {
                    return this._fontOffset
                },
                set: function(e) {
                    this._fontOffset = e
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "alpha", {
                get: function() {
                    return this._alpha
                },
                set: function(e) {
                    this._alpha !== e && (this._alphaSet = !0, this._alpha = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isHighlighted", {
                get: function() {
                    return this._isHighlighted
                },
                set: function(e) {
                    this._isHighlighted !== e && (this._isHighlighted = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "scaleX", {
                get: function() {
                    return this._scaleX
                },
                set: function(e) {
                    this._scaleX !== e && (this._scaleX = e, this._markAsDirty(), this._markMatrixAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "scaleY", {
                get: function() {
                    return this._scaleY
                },
                set: function(e) {
                    this._scaleY !== e && (this._scaleY = e, this._markAsDirty(), this._markMatrixAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "rotation", {
                get: function() {
                    return this._rotation
                },
                set: function(e) {
                    this._rotation !== e && (this._rotation = e, this._markAsDirty(), this._markMatrixAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "transformCenterY", {
                get: function() {
                    return this._transformCenterY
                },
                set: function(e) {
                    this._transformCenterY !== e && (this._transformCenterY = e, this._markAsDirty(), this._markMatrixAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "transformCenterX", {
                get: function() {
                    return this._transformCenterX
                },
                set: function(e) {
                    this._transformCenterX !== e && (this._transformCenterX = e, this._markAsDirty(), this._markMatrixAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "horizontalAlignment", {
                get: function() {
                    return this._horizontalAlignment
                },
                set: function(e) {
                    this._horizontalAlignment !== e && (this._horizontalAlignment = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "verticalAlignment", {
                get: function() {
                    return this._verticalAlignment
                },
                set: function(e) {
                    this._verticalAlignment !== e && (this._verticalAlignment = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "width", {
                get: function() {
                    return this._width.toString(this._host)
                },
                set: function(e) {
                    this._width.toString(this._host) !== e && this._width.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "widthInPixels", {
                get: function() {
                    return this._width.getValueInPixel(this._host, this._cachedParentMeasure.width)
                },
                set: function(e) {
                    isNaN(e) || (this.width = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "height", {
                get: function() {
                    return this._height.toString(this._host)
                },
                set: function(e) {
                    this._height.toString(this._host) !== e && this._height.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "heightInPixels", {
                get: function() {
                    return this._height.getValueInPixel(this._host, this._cachedParentMeasure.height)
                },
                set: function(e) {
                    isNaN(e) || (this.height = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontFamily", {
                get: function() {
                    return this._fontSet ? this._fontFamily : ""
                },
                set: function(e) {
                    this._fontFamily !== e && (this._fontFamily = e, this._resetFontCache())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontStyle", {
                get: function() {
                    return this._fontStyle
                },
                set: function(e) {
                    this._fontStyle !== e && (this._fontStyle = e, this._resetFontCache())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontWeight", {
                get: function() {
                    return this._fontWeight
                },
                set: function(e) {
                    this._fontWeight !== e && (this._fontWeight = e, this._resetFontCache())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "style", {
                get: function() {
                    return this._style
                },
                set: function(e) {
                    var t = this;
                    this._style && (this._style.onChangedObservable.remove(this._styleObserver), this._styleObserver = null), this._style = e, this._style && (this._styleObserver = this._style.onChangedObservable.add((function() {
                        t._markAsDirty(), t._resetFontCache()
                    }))), this._markAsDirty(), this._resetFontCache()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "_isFontSizeInPercentage", {
                get: function() {
                    return this._fontSize.isPercentage
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontSizeInPixels", {
                get: function() {
                    var e = this._style ? this._style._fontSize : this._fontSize;
                    return e.isPixel ? e.getValue(this._host) : e.getValueInPixel(this._host, this._tempParentMeasure.height || this._cachedParentMeasure.height)
                },
                set: function(e) {
                    isNaN(e) || (this.fontSize = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontSize", {
                get: function() {
                    return this._fontSize.toString(this._host)
                },
                set: function(e) {
                    this._fontSize.toString(this._host) !== e && this._fontSize.fromString(e) && (this._markAsDirty(), this._resetFontCache())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "color", {
                get: function() {
                    return this._color
                },
                set: function(e) {
                    this._color !== e && (this._color = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "zIndex", {
                get: function() {
                    return this._zIndex
                },
                set: function(e) {
                    this.zIndex !== e && (this._zIndex = e, this.parent && this.parent._reOrderControl(this))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "notRenderable", {
                get: function() {
                    return this._doNotRender
                },
                set: function(e) {
                    this._doNotRender !== e && (this._doNotRender = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isVisible", {
                get: function() {
                    return this._isVisible
                },
                set: function(e) {
                    this._isVisible !== e && (this._isVisible = e, this._markAsDirty(!0))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isDirty", {
                get: function() {
                    return this._isDirty
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "linkedMesh", {
                get: function() {
                    return this._linkedMesh
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingLeft", {
                get: function() {
                    return this._paddingLeft.toString(this._host)
                },
                set: function(e) {
                    this._paddingLeft.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingLeftInPixels", {
                get: function() {
                    return this._paddingLeft.getValueInPixel(this._host, this._cachedParentMeasure.width)
                },
                set: function(e) {
                    isNaN(e) || (this.paddingLeft = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingRight", {
                get: function() {
                    return this._paddingRight.toString(this._host)
                },
                set: function(e) {
                    this._paddingRight.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingRightInPixels", {
                get: function() {
                    return this._paddingRight.getValueInPixel(this._host, this._cachedParentMeasure.width)
                },
                set: function(e) {
                    isNaN(e) || (this.paddingRight = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingTop", {
                get: function() {
                    return this._paddingTop.toString(this._host)
                },
                set: function(e) {
                    this._paddingTop.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingTopInPixels", {
                get: function() {
                    return this._paddingTop.getValueInPixel(this._host, this._cachedParentMeasure.height)
                },
                set: function(e) {
                    isNaN(e) || (this.paddingTop = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingBottom", {
                get: function() {
                    return this._paddingBottom.toString(this._host)
                },
                set: function(e) {
                    this._paddingBottom.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "paddingBottomInPixels", {
                get: function() {
                    return this._paddingBottom.getValueInPixel(this._host, this._cachedParentMeasure.height)
                },
                set: function(e) {
                    isNaN(e) || (this.paddingBottom = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "left", {
                get: function() {
                    return this._left.toString(this._host)
                },
                set: function(e) {
                    this._left.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "leftInPixels", {
                get: function() {
                    return this._left.getValueInPixel(this._host, this._cachedParentMeasure.width)
                },
                set: function(e) {
                    isNaN(e) || (this.left = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "top", {
                get: function() {
                    return this._top.toString(this._host)
                },
                set: function(e) {
                    this._top.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "topInPixels", {
                get: function() {
                    return this._top.getValueInPixel(this._host, this._cachedParentMeasure.height)
                },
                set: function(e) {
                    isNaN(e) || (this.top = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "linkOffsetX", {
                get: function() {
                    return this._linkOffsetX.toString(this._host)
                },
                set: function(e) {
                    this._linkOffsetX.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "linkOffsetXInPixels", {
                get: function() {
                    return this._linkOffsetX.getValueInPixel(this._host, this._cachedParentMeasure.width)
                },
                set: function(e) {
                    isNaN(e) || (this.linkOffsetX = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "linkOffsetY", {
                get: function() {
                    return this._linkOffsetY.toString(this._host)
                },
                set: function(e) {
                    this._linkOffsetY.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "linkOffsetYInPixels", {
                get: function() {
                    return this._linkOffsetY.getValueInPixel(this._host, this._cachedParentMeasure.height)
                },
                set: function(e) {
                    isNaN(e) || (this.linkOffsetY = e + "px")
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "centerX", {
                get: function() {
                    return this._currentMeasure.left + this._currentMeasure.width / 2
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "centerY", {
                get: function() {
                    return this._currentMeasure.top + this._currentMeasure.height / 2
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "isEnabled", {
                get: function() {
                    return this._isEnabled
                },
                set: function(e) {
                    this._isEnabled !== e && (this._isEnabled = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "disabledColor", {
                get: function() {
                    return this._disabledColor
                },
                set: function(e) {
                    this._disabledColor !== e && (this._disabledColor = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype._getTypeName = function() {
                return "Control"
            }, e.prototype.getAscendantOfClass = function(e) {
                return this.parent ? this.parent.getClassName() === e ? this.parent : this.parent.getAscendantOfClass(e) : null
            }, e.prototype._resetFontCache = function() {
                this._fontSet = !0, this._markAsDirty()
            }, e.prototype.isAscendant = function(e) {
                return !!this.parent && (this.parent === e || this.parent.isAscendant(e))
            }, e.prototype.getLocalCoordinates = function(e) {
                var t = T.Zero();
                return this.getLocalCoordinatesToRef(e, t), t
            }, e.prototype.getLocalCoordinatesToRef = function(e, t) {
                return t.x = e.x - this._currentMeasure.left, t.y = e.y - this._currentMeasure.top, this
            }, e.prototype.getParentLocalCoordinates = function(e) {
                var t = T.Zero();
                return t.x = e.x - this._cachedParentMeasure.left, t.y = e.y - this._cachedParentMeasure.top, t
            }, e.prototype.moveToVector3 = function(t, i) {
                if (this._host && this.parent === this._host._rootContainer) {
                    this.horizontalAlignment = e.HORIZONTAL_ALIGNMENT_LEFT, this.verticalAlignment = e.VERTICAL_ALIGNMENT_TOP;
                    var n = this._host._getGlobalViewport(i),
                        r = b.Project(t, R.Identity(), i.getTransformMatrix(), n);
                    this._moveToProjectedPosition(r), r.z < 0 || r.z > 1 ? this.notRenderable = !0 : this.notRenderable = !1
                } else K.Error("Cannot move a control to a vector3 if the control is not at root level")
            }, e.prototype._getDescendants = function(e, t, i) {
                void 0 === t && (t = !1)
            }, e.prototype.getDescendants = function(e, t) {
                var i = new Array;
                return this._getDescendants(i, e, t), i
            }, e.prototype.linkWithMesh = function(t) {
                if (!this._host || this.parent && this.parent !== this._host._rootContainer) t && K.Error("Cannot link a control to a mesh if the control is not at root level");
                else {
                    var i = this._host._linkedControls.indexOf(this);
                    if (-1 !== i) return this._linkedMesh = t, void(t || this._host._linkedControls.splice(i, 1));
                    t && (this.horizontalAlignment = e.HORIZONTAL_ALIGNMENT_LEFT, this.verticalAlignment = e.VERTICAL_ALIGNMENT_TOP, this._linkedMesh = t, this._host._linkedControls.push(this))
                }
            }, e.prototype._moveToProjectedPosition = function(e) {
                var t = this._left.getValue(this._host),
                    i = this._top.getValue(this._host),
                    n = e.x + this._linkOffsetX.getValue(this._host) - this._currentMeasure.width / 2,
                    r = e.y + this._linkOffsetY.getValue(this._host) - this._currentMeasure.height / 2;
                this._left.ignoreAdaptiveScaling && this._top.ignoreAdaptiveScaling && (Math.abs(n - t) < .5 && (n = t), Math.abs(r - i) < .5 && (r = i)), this.left = n + "px", this.top = r + "px", this._left.ignoreAdaptiveScaling = !0, this._top.ignoreAdaptiveScaling = !0, this._markAsDirty()
            }, e.prototype._offsetLeft = function(e) {
                this._isDirty = !0, this._currentMeasure.left += e
            }, e.prototype._offsetTop = function(e) {
                this._isDirty = !0, this._currentMeasure.top += e
            }, e.prototype._markMatrixAsDirty = function() {
                this._isMatrixDirty = !0, this._flagDescendantsAsMatrixDirty()
            }, e.prototype._flagDescendantsAsMatrixDirty = function() {}, e.prototype._intersectsRect = function(e) {
                return this._currentMeasure.transformToRef(this._transformMatrix, this._tmpMeasureA), !(this._tmpMeasureA.left >= e.left + e.width) && (!(this._tmpMeasureA.top >= e.top + e.height) && (!(this._tmpMeasureA.left + this._tmpMeasureA.width <= e.left) && !(this._tmpMeasureA.top + this._tmpMeasureA.height <= e.top)))
            }, e.prototype.invalidateRect = function() {
                if (this._transform(), this.host && this.host.useInvalidateRectOptimization)
                    if (this._currentMeasure.transformToRef(this._transformMatrix, this._tmpMeasureA), ia.CombineToRef(this._tmpMeasureA, this._prevCurrentMeasureTransformedIntoGlobalSpace, this._tmpMeasureA), this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) {
                        var e = this.shadowOffsetX,
                            t = this.shadowOffsetY,
                            i = this.shadowBlur,
                            n = Math.min(Math.min(e, 0) - 2 * i, 0),
                            r = Math.max(Math.max(e, 0) + 2 * i, 0),
                            o = Math.min(Math.min(t, 0) - 2 * i, 0),
                            s = Math.max(Math.max(t, 0) + 2 * i, 0);
                        this.host.invalidateRect(Math.floor(this._tmpMeasureA.left + n), Math.floor(this._tmpMeasureA.top + o), Math.ceil(this._tmpMeasureA.left + this._tmpMeasureA.width + r), Math.ceil(this._tmpMeasureA.top + this._tmpMeasureA.height + s))
                    } else this.host.invalidateRect(Math.floor(this._tmpMeasureA.left), Math.floor(this._tmpMeasureA.top), Math.ceil(this._tmpMeasureA.left + this._tmpMeasureA.width), Math.ceil(this._tmpMeasureA.top + this._tmpMeasureA.height))
            }, e.prototype._markAsDirty = function(e) {
                void 0 === e && (e = !1), (this._isVisible || e) && (this._isDirty = !0, this._host && this._host.markAsDirty())
            }, e.prototype._markAllAsDirty = function() {
                this._markAsDirty(), this._font && this._prepareFont()
            }, e.prototype._link = function(e) {
                this._host = e, this._host && (this.uniqueId = this._host.getScene().getUniqueId())
            }, e.prototype._transform = function(e) {
                if (this._isMatrixDirty || 1 !== this._scaleX || 1 !== this._scaleY || 0 !== this._rotation) {
                    var t = this._currentMeasure.width * this._transformCenterX + this._currentMeasure.left,
                        i = this._currentMeasure.height * this._transformCenterY + this._currentMeasure.top;
                    e && (e.translate(t, i), e.rotate(this._rotation), e.scale(this._scaleX, this._scaleY), e.translate(-t, -i)), (this._isMatrixDirty || this._cachedOffsetX !== t || this._cachedOffsetY !== i) && (this._cachedOffsetX = t, this._cachedOffsetY = i, this._isMatrixDirty = !1, this._flagDescendantsAsMatrixDirty(), ra.ComposeToRef(-t, -i, this._rotation, this._scaleX, this._scaleY, this.parent ? this.parent._transformMatrix : null, this._transformMatrix), this._transformMatrix.invertToRef(this._invertTransformMatrix))
                }
            }, e.prototype._renderHighlight = function(e) {
                this.isHighlighted && (e.save(), e.strokeStyle = "#4affff", e.lineWidth = 2, this._renderHighlightSpecific(e), e.restore())
            }, e.prototype._renderHighlightSpecific = function(e) {
                e.strokeRect(this._currentMeasure.left, this._currentMeasure.top, this._currentMeasure.width, this._currentMeasure.height)
            }, e.prototype._applyStates = function(t) {
                this._isFontSizeInPercentage && (this._fontSet = !0), this._fontSet && (this._prepareFont(), this._fontSet = !1), this._font && (t.font = this._font), this._color && (t.fillStyle = this._color), e.AllowAlphaInheritance ? t.globalAlpha *= this._alpha : this._alphaSet && (t.globalAlpha = this.parent ? this.parent.alpha * this._alpha : this._alpha)
            }, e.prototype._layout = function(e, t) {
                if (!this.isDirty && (!this.isVisible || this.notRenderable)) return !1;
                if (this._isDirty || !this._cachedParentMeasure.isEqualsTo(e)) {
                    this._currentMeasure.transformToRef(this._transformMatrix, this._prevCurrentMeasureTransformedIntoGlobalSpace), t.save(), this._applyStates(t);
                    var i = 0;
                    do {
                        this._rebuildLayout = !1, this._processMeasures(e, t), i++
                    } while (this._rebuildLayout && i < 3);
                    i >= 3 && V.Error("Layout cycle detected in GUI (Control name=" + this.name + ", uniqueId=" + this.uniqueId + ")"), t.restore(), this.invalidateRect(), this._evaluateClippingState(e)
                }
                return this._wasDirty = this._isDirty, this._isDirty = !1, !0
            }, e.prototype._processMeasures = function(e, t) {
                this._currentMeasure.copyFrom(e), this._preMeasure(e, t), this._measure(), this._computeAlignment(e, t), this._currentMeasure.left = 0 | this._currentMeasure.left, this._currentMeasure.top = 0 | this._currentMeasure.top, this._currentMeasure.width = 0 | this._currentMeasure.width, this._currentMeasure.height = 0 | this._currentMeasure.height, this._additionalProcessing(e, t), this._cachedParentMeasure.copyFrom(e), this.onDirtyObservable.hasObservers() && this.onDirtyObservable.notifyObservers(this)
            }, e.prototype._evaluateClippingState = function(e) {
                if (this.parent && this.parent.clipChildren) {
                    if (this._currentMeasure.left > e.left + e.width) return void(this._isClipped = !0);
                    if (this._currentMeasure.left + this._currentMeasure.width < e.left) return void(this._isClipped = !0);
                    if (this._currentMeasure.top > e.top + e.height) return void(this._isClipped = !0);
                    if (this._currentMeasure.top + this._currentMeasure.height < e.top) return void(this._isClipped = !0)
                }
                this._isClipped = !1
            }, e.prototype._measure = function() {
                this._width.isPixel ? this._currentMeasure.width = this._width.getValue(this._host) : this._currentMeasure.width *= this._width.getValue(this._host), this._height.isPixel ? this._currentMeasure.height = this._height.getValue(this._host) : this._currentMeasure.height *= this._height.getValue(this._host)
            }, e.prototype._computeAlignment = function(t, i) {
                var n = this._currentMeasure.width,
                    r = this._currentMeasure.height,
                    o = t.width,
                    s = t.height,
                    a = 0,
                    u = 0;
                switch (this.horizontalAlignment) {
                    case e.HORIZONTAL_ALIGNMENT_LEFT:
                        a = 0;
                        break;
                    case e.HORIZONTAL_ALIGNMENT_RIGHT:
                        a = o - n;
                        break;
                    case e.HORIZONTAL_ALIGNMENT_CENTER:
                        a = (o - n) / 2
                }
                switch (this.verticalAlignment) {
                    case e.VERTICAL_ALIGNMENT_TOP:
                        u = 0;
                        break;
                    case e.VERTICAL_ALIGNMENT_BOTTOM:
                        u = s - r;
                        break;
                    case e.VERTICAL_ALIGNMENT_CENTER:
                        u = (s - r) / 2
                }
                this._paddingLeft.isPixel ? (this._currentMeasure.left += this._paddingLeft.getValue(this._host), this._currentMeasure.width -= this._paddingLeft.getValue(this._host)) : (this._currentMeasure.left += o * this._paddingLeft.getValue(this._host), this._currentMeasure.width -= o * this._paddingLeft.getValue(this._host)), this._paddingRight.isPixel ? this._currentMeasure.width -= this._paddingRight.getValue(this._host) : this._currentMeasure.width -= o * this._paddingRight.getValue(this._host), this._paddingTop.isPixel ? (this._currentMeasure.top += this._paddingTop.getValue(this._host), this._currentMeasure.height -= this._paddingTop.getValue(this._host)) : (this._currentMeasure.top += s * this._paddingTop.getValue(this._host), this._currentMeasure.height -= s * this._paddingTop.getValue(this._host)), this._paddingBottom.isPixel ? this._currentMeasure.height -= this._paddingBottom.getValue(this._host) : this._currentMeasure.height -= s * this._paddingBottom.getValue(this._host), this._left.isPixel ? this._currentMeasure.left += this._left.getValue(this._host) : this._currentMeasure.left += o * this._left.getValue(this._host), this._top.isPixel ? this._currentMeasure.top += this._top.getValue(this._host) : this._currentMeasure.top += s * this._top.getValue(this._host), this._currentMeasure.left += a, this._currentMeasure.top += u
            }, e.prototype._preMeasure = function(e, t) {}, e.prototype._additionalProcessing = function(e, t) {}, e.prototype._clipForChildren = function(e) {}, e.prototype._clip = function(t, i) {
                if (t.beginPath(), e._ClipMeasure.copyFrom(this._currentMeasure), i) {
                    i.transformToRef(this._invertTransformMatrix, this._tmpMeasureA);
                    var n = new ia(0, 0, 0, 0);
                    n.left = Math.max(this._tmpMeasureA.left, this._currentMeasure.left), n.top = Math.max(this._tmpMeasureA.top, this._currentMeasure.top), n.width = Math.min(this._tmpMeasureA.left + this._tmpMeasureA.width, this._currentMeasure.left + this._currentMeasure.width) - n.left, n.height = Math.min(this._tmpMeasureA.top + this._tmpMeasureA.height, this._currentMeasure.top + this._currentMeasure.height) - n.top, e._ClipMeasure.copyFrom(n)
                }
                if (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) {
                    var r = this.shadowOffsetX,
                        o = this.shadowOffsetY,
                        s = this.shadowBlur,
                        a = Math.min(Math.min(r, 0) - 2 * s, 0),
                        u = Math.max(Math.max(r, 0) + 2 * s, 0),
                        h = Math.min(Math.min(o, 0) - 2 * s, 0),
                        l = Math.max(Math.max(o, 0) + 2 * s, 0);
                    t.rect(e._ClipMeasure.left + a, e._ClipMeasure.top + h, e._ClipMeasure.width + u - a, e._ClipMeasure.height + l - h)
                } else t.rect(e._ClipMeasure.left, e._ClipMeasure.top, e._ClipMeasure.width, e._ClipMeasure.height);
                t.clip()
            }, e.prototype._render = function(e, t) {
                return !this.isVisible || this.notRenderable || this._isClipped ? (this._isDirty = !1, !1) : (e.save(), this._applyStates(e), this._transform(e), this.clipContent && this._clip(e, t), this.onBeforeDrawObservable.hasObservers() && this.onBeforeDrawObservable.notifyObservers(this), this.useBitmapCache && !this._wasDirty && this._cacheData ? e.putImageData(this._cacheData, this._currentMeasure.left, this._currentMeasure.top) : this._draw(e, t), this.useBitmapCache && this._wasDirty && (this._cacheData = e.getImageData(this._currentMeasure.left, this._currentMeasure.top, this._currentMeasure.width, this._currentMeasure.height)), this._renderHighlight(e), this.onAfterDrawObservable.hasObservers() && this.onAfterDrawObservable.notifyObservers(this), e.restore(), !0)
            }, e.prototype._draw = function(e, t) {}, e.prototype.contains = function(e, t) {
                return this._invertTransformMatrix.transformCoordinates(e, t, this._transformedPosition), e = this._transformedPosition.x, t = this._transformedPosition.y, !(e < this._currentMeasure.left) && (!(e > this._currentMeasure.left + this._currentMeasure.width) && (!(t < this._currentMeasure.top) && (!(t > this._currentMeasure.top + this._currentMeasure.height) && (this.isPointerBlocker && (this._host._shouldBlockPointer = !0), !0))))
            }, e.prototype._processPicking = function(e, t, i, n, r) {
                return !!this._isEnabled && (!(!this.isHitTestVisible || !this.isVisible || this._doNotRender) && (!!this.contains(e, t) && (this._processObservables(i, e, t, n, r), !0)))
            }, e.prototype._onPointerMove = function(e, t, i) {
                this.onPointerMoveObservable.notifyObservers(t, -1, e, this) && null != this.parent && this.parent._onPointerMove(e, t, i)
            }, e.prototype._onPointerEnter = function(e) {
                return !!this._isEnabled && (!(this._enterCount > 0) && (-1 === this._enterCount && (this._enterCount = 0), this._enterCount++, this.onPointerEnterObservable.notifyObservers(this, -1, e, this) && null != this.parent && this.parent._onPointerEnter(e), !0))
            }, e.prototype._onPointerOut = function(e, t) {
                if (void 0 === t && (t = !1), t || this._isEnabled && e !== this) {
                    this._enterCount = 0;
                    var i = !0;
                    e.isAscendant(this) || (i = this.onPointerOutObservable.notifyObservers(this, -1, e, this)), i && null != this.parent && this.parent._onPointerOut(e, t)
                }
            }, e.prototype._onPointerDown = function(e, t, i, n) {
                return this._onPointerEnter(this), 0 === this._downCount && (this._downCount++, this._downPointerIds[i] = !0, this.onPointerDownObservable.notifyObservers(new na(t, n), -1, e, this) && null != this.parent && this.parent._onPointerDown(e, t, i, n), !0)
            }, e.prototype._onPointerUp = function(e, t, i, n, r) {
                if (this._isEnabled) {
                    this._downCount = 0, delete this._downPointerIds[i];
                    var o = r;
                    r && (this._enterCount > 0 || -1 === this._enterCount) && (o = this.onPointerClickObservable.notifyObservers(new na(t, n), -1, e, this)), this.onPointerUpObservable.notifyObservers(new na(t, n), -1, e, this) && null != this.parent && this.parent._onPointerUp(e, t, i, n, o)
                }
            }, e.prototype._forcePointerUp = function(e) {
                if (void 0 === e && (e = null), null !== e) this._onPointerUp(this, T.Zero(), e, 0, !0);
                else
                    for (var t in this._downPointerIds) this._onPointerUp(this, T.Zero(), +t, 0, !0)
            }, e.prototype._processObservables = function(e, t, i, n, r) {
                if (!this._isEnabled) return !1;
                if (this._dummyVector2.copyFromFloats(t, i), e === dt.POINTERMOVE) {
                    this._onPointerMove(this, this._dummyVector2, n);
                    var o = this._host._lastControlOver[n];
                    return o && o !== this && o._onPointerOut(this), o !== this && this._onPointerEnter(this), this._host._lastControlOver[n] = this, !0
                }
                return e === dt.POINTERDOWN ? (this._onPointerDown(this, this._dummyVector2, n, r), this._host._registerLastControlDown(this, n), this._host._lastPickedControl = this, !0) : e === dt.POINTERUP && (this._host._lastControlDown[n] && this._host._lastControlDown[n]._onPointerUp(this, this._dummyVector2, n, r, !0), delete this._host._lastControlDown[n], !0)
            }, e.prototype._prepareFont = function() {
                (this._font || this._fontSet) && (this._style ? this._font = this._style.fontStyle + " " + this._style.fontWeight + " " + this.fontSizeInPixels + "px " + this._style.fontFamily : this._font = this._fontStyle + " " + this._fontWeight + " " + this.fontSizeInPixels + "px " + this._fontFamily, this._fontOffset = e._GetFontOffset(this._font))
            }, e.prototype.dispose = function() {
                (this.onDirtyObservable.clear(), this.onBeforeDrawObservable.clear(), this.onAfterDrawObservable.clear(), this.onPointerDownObservable.clear(), this.onPointerEnterObservable.clear(), this.onPointerMoveObservable.clear(), this.onPointerOutObservable.clear(), this.onPointerUpObservable.clear(), this.onPointerClickObservable.clear(), this._styleObserver && this._style && (this._style.onChangedObservable.remove(this._styleObserver), this._styleObserver = null), this.parent && (this.parent.removeControl(this), this.parent = null), this._host) && (this._host._linkedControls.indexOf(this) > -1 && this.linkWithMesh(null))
            }, Object.defineProperty(e, "HORIZONTAL_ALIGNMENT_LEFT", {
                get: function() {
                    return e._HORIZONTAL_ALIGNMENT_LEFT
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "HORIZONTAL_ALIGNMENT_RIGHT", {
                get: function() {
                    return e._HORIZONTAL_ALIGNMENT_RIGHT
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "HORIZONTAL_ALIGNMENT_CENTER", {
                get: function() {
                    return e._HORIZONTAL_ALIGNMENT_CENTER
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "VERTICAL_ALIGNMENT_TOP", {
                get: function() {
                    return e._VERTICAL_ALIGNMENT_TOP
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "VERTICAL_ALIGNMENT_BOTTOM", {
                get: function() {
                    return e._VERTICAL_ALIGNMENT_BOTTOM
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e, "VERTICAL_ALIGNMENT_CENTER", {
                get: function() {
                    return e._VERTICAL_ALIGNMENT_CENTER
                },
                enumerable: !0,
                configurable: !0
            }), e._GetFontOffset = function(t) {
                if (e._FontHeightSizes[t]) return e._FontHeightSizes[t];
                var i = document.createElement("span");
                i.innerHTML = "Hg", i.style.font = t;
                var n = document.createElement("div");
                n.style.display = "inline-block", n.style.width = "1px", n.style.height = "0px", n.style.verticalAlign = "bottom";
                var r = document.createElement("div");
                r.appendChild(i), r.appendChild(n), document.body.appendChild(r);
                var o = 0,
                    s = 0;
                try {
                    s = n.getBoundingClientRect().top - i.getBoundingClientRect().top, n.style.verticalAlign = "baseline", o = n.getBoundingClientRect().top - i.getBoundingClientRect().top
                } finally {
                    document.body.removeChild(r)
                }
                var a = {
                    ascent: o,
                    height: s,
                    descent: s - o
                };
                return e._FontHeightSizes[t] = a, a
            }, e.drawEllipse = function(e, t, i, n, r) {
                r.translate(e, t), r.scale(i, n), r.beginPath(), r.arc(0, 0, 1, 0, 2 * Math.PI), r.closePath(), r.scale(1 / i, 1 / n), r.translate(-e, -t)
            }, e.AllowAlphaInheritance = !1, e._ClipMeasure = new ia(0, 0, 0, 0), e._HORIZONTAL_ALIGNMENT_LEFT = 0, e._HORIZONTAL_ALIGNMENT_RIGHT = 1, e._HORIZONTAL_ALIGNMENT_CENTER = 2, e._VERTICAL_ALIGNMENT_TOP = 0, e._VERTICAL_ALIGNMENT_BOTTOM = 1, e._VERTICAL_ALIGNMENT_CENTER = 2, e._FontHeightSizes = {}, e.AddHeader = function() {}, e
        }(),
        sa = function(e) {
            function t(t) {
                var i = e.call(this, t) || this;
                return i.name = t, i._children = new Array, i._measureForChildren = ia.Empty(), i._background = "", i._adaptWidthToChildren = !1, i._adaptHeightToChildren = !1, i
            }
            return r(t, e), Object.defineProperty(t.prototype, "adaptHeightToChildren", {
                get: function() {
                    return this._adaptHeightToChildren
                },
                set: function(e) {
                    this._adaptHeightToChildren !== e && (this._adaptHeightToChildren = e, e && (this.height = "100%"), this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "adaptWidthToChildren", {
                get: function() {
                    return this._adaptWidthToChildren
                },
                set: function(e) {
                    this._adaptWidthToChildren !== e && (this._adaptWidthToChildren = e, e && (this.width = "100%"), this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "background", {
                get: function() {
                    return this._background
                },
                set: function(e) {
                    this._background !== e && (this._background = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "children", {
                get: function() {
                    return this._children
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._getTypeName = function() {
                return "Container"
            }, t.prototype._flagDescendantsAsMatrixDirty = function() {
                for (var e = 0, t = this.children; e < t.length; e++) {
                    t[e]._markMatrixAsDirty()
                }
            }, t.prototype.getChildByName = function(e) {
                for (var t = 0, i = this.children; t < i.length; t++) {
                    var n = i[t];
                    if (n.name === e) return n
                }
                return null
            }, t.prototype.getChildByType = function(e, t) {
                for (var i = 0, n = this.children; i < n.length; i++) {
                    var r = n[i];
                    if (r.typeName === t) return r
                }
                return null
            }, t.prototype.containsControl = function(e) {
                return -1 !== this.children.indexOf(e)
            }, t.prototype.addControl = function(e) {
                return e ? -1 !== this._children.indexOf(e) ? this : (e._link(this._host), e._markAllAsDirty(), this._reOrderControl(e), this._markAsDirty(), this) : this
            }, t.prototype.clearControls = function() {
                for (var e = 0, t = this.children.slice(); e < t.length; e++) {
                    var i = t[e];
                    this.removeControl(i)
                }
                return this
            }, t.prototype.removeControl = function(e) {
                var t = this._children.indexOf(e);
                return -1 !== t && (this._children.splice(t, 1), e.parent = null), e.linkWithMesh(null), this._host && this._host._cleanControlAfterRemoval(e), this._markAsDirty(), this
            }, t.prototype._reOrderControl = function(e) {
                this.removeControl(e);
                for (var t = !1, i = 0; i < this._children.length; i++)
                    if (this._children[i].zIndex > e.zIndex) {
                        this._children.splice(i, 0, e), t = !0;
                        break
                    }
                t || this._children.push(e), e.parent = this, this._markAsDirty()
            }, t.prototype._offsetLeft = function(t) {
                e.prototype._offsetLeft.call(this, t);
                for (var i = 0, n = this._children; i < n.length; i++) {
                    n[i]._offsetLeft(t)
                }
            }, t.prototype._offsetTop = function(t) {
                e.prototype._offsetTop.call(this, t);
                for (var i = 0, n = this._children; i < n.length; i++) {
                    n[i]._offsetTop(t)
                }
            }, t.prototype._markAllAsDirty = function() {
                e.prototype._markAllAsDirty.call(this);
                for (var t = 0; t < this._children.length; t++) this._children[t]._markAllAsDirty()
            }, t.prototype._localDraw = function(e) {
                this._background && (e.save(), (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) && (e.shadowColor = this.shadowColor, e.shadowBlur = this.shadowBlur, e.shadowOffsetX = this.shadowOffsetX, e.shadowOffsetY = this.shadowOffsetY), e.fillStyle = this._background, e.fillRect(this._currentMeasure.left, this._currentMeasure.top, this._currentMeasure.width, this._currentMeasure.height), e.restore())
            }, t.prototype._link = function(t) {
                e.prototype._link.call(this, t);
                for (var i = 0, n = this._children; i < n.length; i++) {
                    n[i]._link(t)
                }
            }, t.prototype._beforeLayout = function() {}, t.prototype._processMeasures = function(t, i) {
                !this._isDirty && this._cachedParentMeasure.isEqualsTo(t) || (e.prototype._processMeasures.call(this, t, i), this._evaluateClippingState(t))
            }, t.prototype._layout = function(e, t) {
                if (!this.isDirty && (!this.isVisible || this.notRenderable)) return !1;
                this._isDirty && this._currentMeasure.transformToRef(this._transformMatrix, this._prevCurrentMeasureTransformedIntoGlobalSpace);
                var i = 0;
                t.save(), this._applyStates(t), this._beforeLayout();
                do {
                    var n = -1,
                        r = -1;
                    if (this._rebuildLayout = !1, this._processMeasures(e, t), !this._isClipped) {
                        for (var o = 0, s = this._children; o < s.length; o++) {
                            var a = s[o];
                            a._tempParentMeasure.copyFrom(this._measureForChildren), a._layout(this._measureForChildren, t) && (this.adaptWidthToChildren && a._width.isPixel && (n = Math.max(n, a._currentMeasure.width)), this.adaptHeightToChildren && a._height.isPixel && (r = Math.max(r, a._currentMeasure.height)))
                        }
                        this.adaptWidthToChildren && n >= 0 && this.width !== n + "px" && (this.width = n + "px", this._rebuildLayout = !0), this.adaptHeightToChildren && r >= 0 && this.height !== r + "px" && (this.height = r + "px", this._rebuildLayout = !0), this._postMeasure()
                    }
                    i++
                } while (this._rebuildLayout && i < 3);
                return i >= 3 && V.Error("Layout cycle detected in GUI (Container name=" + this.name + ", uniqueId=" + this.uniqueId + ")"), t.restore(), this._isDirty && (this.invalidateRect(), this._isDirty = !1), !0
            }, t.prototype._postMeasure = function() {}, t.prototype._draw = function(e, t) {
                this._localDraw(e), this.clipChildren && this._clipForChildren(e);
                for (var i = 0, n = this._children; i < n.length; i++) {
                    var r = n[i];
                    t && !r._intersectsRect(t) || r._render(e, t)
                }
            }, t.prototype._getDescendants = function(e, t, i) {
                if (void 0 === t && (t = !1), this.children)
                    for (var n = 0; n < this.children.length; n++) {
                        var r = this.children[n];
                        i && !i(r) || e.push(r), t || r._getDescendants(e, !1, i)
                    }
            }, t.prototype._processPicking = function(t, i, n, r, o) {
                if (!this._isEnabled || !this.isVisible || this.notRenderable) return !1;
                if (!e.prototype.contains.call(this, t, i)) return !1;
                for (var s = this._children.length - 1; s >= 0; s--) {
                    var a = this._children[s];
                    if (a._processPicking(t, i, n, r, o)) return a.hoverCursor && this._host._changeCursor(a.hoverCursor), !0
                }
                return !!this.isHitTestVisible && this._processObservables(n, t, i, r, o)
            }, t.prototype._additionalProcessing = function(t, i) {
                e.prototype._additionalProcessing.call(this, t, i), this._measureForChildren.copyFrom(this._currentMeasure)
            }, t.prototype.dispose = function() {
                e.prototype.dispose.call(this);
                for (var t = this.children.length - 1; t >= 0; t--) this.children[t].dispose()
            }, t
        }(oa),
        aa = function() {
            function e(e) {
                this._fontFamily = "Arial", this._fontStyle = "", this._fontWeight = "", this._fontSize = new Js(18, Js.UNITMODE_PIXEL, !1), this.onChangedObservable = new l, this._host = e
            }
            return Object.defineProperty(e.prototype, "fontSize", {
                get: function() {
                    return this._fontSize.toString(this._host)
                },
                set: function(e) {
                    this._fontSize.toString(this._host) !== e && this._fontSize.fromString(e) && this.onChangedObservable.notifyObservers(this)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontFamily", {
                get: function() {
                    return this._fontFamily
                },
                set: function(e) {
                    this._fontFamily !== e && (this._fontFamily = e, this.onChangedObservable.notifyObservers(this))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontStyle", {
                get: function() {
                    return this._fontStyle
                },
                set: function(e) {
                    this._fontStyle !== e && (this._fontStyle = e, this.onChangedObservable.notifyObservers(this))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(e.prototype, "fontWeight", {
                get: function() {
                    return this._fontWeight
                },
                set: function(e) {
                    this._fontWeight !== e && (this._fontWeight = e, this.onChangedObservable.notifyObservers(this))
                },
                enumerable: !0,
                configurable: !0
            }), e.prototype.dispose = function() {
                this.onChangedObservable.clear()
            }, e
        }(),
        ua = function(e) {
            function t(t, i, n, r, o, s) {
                void 0 === i && (i = 0), void 0 === n && (n = 0), void 0 === o && (o = !1), void 0 === s && (s = Ri.NEAREST_SAMPLINGMODE);
                var a = e.call(this, t, {
                    width: i,
                    height: n
                }, r, o, s, ze.TEXTUREFORMAT_RGBA) || this;
                return a._isDirty = !1, a._rootContainer = new sa("root"), a._lastControlOver = {}, a._lastControlDown = {}, a._capturingControl = {}, a._linkedControls = new Array, a._isFullscreen = !1, a._fullscreenViewport = new P(0, 0, 1, 1), a._idealWidth = 0, a._idealHeight = 0, a._useSmallestIdeal = !1, a._renderAtIdealSize = !1, a._blockNextFocusCheck = !1, a._renderScale = 1, a._cursorChanged = !1, a._clipboardData = "", a.onClipboardObservable = new l, a.onControlPickedObservable = new l, a.onBeginLayoutObservable = new l, a.onEndLayoutObservable = new l, a.onBeginRenderObservable = new l, a.onEndRenderObservable = new l, a.premulAlpha = !1, a._useInvalidateRectOptimization = !0, a._invalidatedRectangle = null, a._clearMeasure = new ia(0, 0, 0, 0), a.onClipboardCopy = function(e) {
                    var t = e,
                        i = new Hs(Xs.COPY, t);
                    a.onClipboardObservable.notifyObservers(i), t.preventDefault()
                }, a.onClipboardCut = function(e) {
                    var t = e,
                        i = new Hs(Xs.CUT, t);
                    a.onClipboardObservable.notifyObservers(i), t.preventDefault()
                }, a.onClipboardPaste = function(e) {
                    var t = e,
                        i = new Hs(Xs.PASTE, t);
                    a.onClipboardObservable.notifyObservers(i), t.preventDefault()
                }, (r = a.getScene()) && a._texture ? (a._rootCanvas = r.getEngine().getRenderingCanvas(), a._renderObserver = r.onBeforeCameraRenderObservable.add((function(e) {
                    return a._checkUpdate(e)
                })), a._preKeyboardObserver = r.onPreKeyboardObservable.add((function(e) {
                    a._focusedControl && (e.type === mt.KEYDOWN && a._focusedControl.processKeyboard(e.event), e.skipOnPointerObservable = !0)
                })), a._rootContainer._link(a), a.hasAlpha = !0, i && n || (a._resizeObserver = r.getEngine().onResizeObservable.add((function() {
                    return a._onResize()
                })), a._onResize()), a._texture.isReady = !0, a) : a
            }
            return r(t, e), Object.defineProperty(t.prototype, "renderScale", {
                get: function() {
                    return this._renderScale
                },
                set: function(e) {
                    e !== this._renderScale && (this._renderScale = e, this._onResize())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "background", {
                get: function() {
                    return this._background
                },
                set: function(e) {
                    this._background !== e && (this._background = e, this.markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "idealWidth", {
                get: function() {
                    return this._idealWidth
                },
                set: function(e) {
                    this._idealWidth !== e && (this._idealWidth = e, this.markAsDirty(), this._rootContainer._markAllAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "idealHeight", {
                get: function() {
                    return this._idealHeight
                },
                set: function(e) {
                    this._idealHeight !== e && (this._idealHeight = e, this.markAsDirty(), this._rootContainer._markAllAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "useSmallestIdeal", {
                get: function() {
                    return this._useSmallestIdeal
                },
                set: function(e) {
                    this._useSmallestIdeal !== e && (this._useSmallestIdeal = e, this.markAsDirty(), this._rootContainer._markAllAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "renderAtIdealSize", {
                get: function() {
                    return this._renderAtIdealSize
                },
                set: function(e) {
                    this._renderAtIdealSize !== e && (this._renderAtIdealSize = e, this._onResize())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "layer", {
                get: function() {
                    return this._layerToDispose
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "rootContainer", {
                get: function() {
                    return this._rootContainer
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getChildren = function() {
                return [this._rootContainer]
            }, t.prototype.getDescendants = function(e, t) {
                return this._rootContainer.getDescendants(e, t)
            }, Object.defineProperty(t.prototype, "focusedControl", {
                get: function() {
                    return this._focusedControl
                },
                set: function(e) {
                    this._focusedControl != e && (this._focusedControl && this._focusedControl.onBlur(), e && e.onFocus(), this._focusedControl = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "isForeground", {
                get: function() {
                    return !this.layer || !this.layer.isBackground
                },
                set: function(e) {
                    this.layer && this.layer.isBackground !== !e && (this.layer.isBackground = !e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "clipboardData", {
                get: function() {
                    return this._clipboardData
                },
                set: function(e) {
                    this._clipboardData = e
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.getClassName = function() {
                return "AdvancedDynamicTexture"
            }, t.prototype.executeOnAllControls = function(e, t) {
                t || (t = this._rootContainer), e(t);
                for (var i = 0, n = t.children; i < n.length; i++) {
                    var r = n[i];
                    r.children ? this.executeOnAllControls(e, r) : e(r)
                }
            }, Object.defineProperty(t.prototype, "useInvalidateRectOptimization", {
                get: function() {
                    return this._useInvalidateRectOptimization
                },
                set: function(e) {
                    this._useInvalidateRectOptimization = e
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.invalidateRect = function(e, t, i, n) {
                if (this._useInvalidateRectOptimization)
                    if (this._invalidatedRectangle) {
                        var r = Math.ceil(Math.max(this._invalidatedRectangle.left + this._invalidatedRectangle.width - 1, i)),
                            o = Math.ceil(Math.max(this._invalidatedRectangle.top + this._invalidatedRectangle.height - 1, n));
                        this._invalidatedRectangle.left = Math.floor(Math.min(this._invalidatedRectangle.left, e)), this._invalidatedRectangle.top = Math.floor(Math.min(this._invalidatedRectangle.top, t)), this._invalidatedRectangle.width = r - this._invalidatedRectangle.left + 1, this._invalidatedRectangle.height = o - this._invalidatedRectangle.top + 1
                    } else this._invalidatedRectangle = new ia(e, t, i - e + 1, n - t + 1)
            }, t.prototype.markAsDirty = function() {
                this._isDirty = !0
            }, t.prototype.createStyle = function() {
                return new aa(this)
            }, t.prototype.addControl = function(e) {
                return this._rootContainer.addControl(e), this
            }, t.prototype.removeControl = function(e) {
                return this._rootContainer.removeControl(e), this
            }, t.prototype.dispose = function() {
                var t = this.getScene();
                t && (this._rootCanvas = null, t.onBeforeCameraRenderObservable.remove(this._renderObserver), this._resizeObserver && t.getEngine().onResizeObservable.remove(this._resizeObserver), this._pointerMoveObserver && t.onPrePointerObservable.remove(this._pointerMoveObserver), this._pointerObserver && t.onPointerObservable.remove(this._pointerObserver), this._preKeyboardObserver && t.onPreKeyboardObservable.remove(this._preKeyboardObserver), this._canvasPointerOutObserver && t.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver), this._layerToDispose && (this._layerToDispose.texture = null, this._layerToDispose.dispose(), this._layerToDispose = null), this._rootContainer.dispose(), this.onClipboardObservable.clear(), this.onControlPickedObservable.clear(), this.onBeginRenderObservable.clear(), this.onEndRenderObservable.clear(), this.onBeginLayoutObservable.clear(), this.onEndLayoutObservable.clear(), e.prototype.dispose.call(this))
            }, t.prototype._onResize = function() {
                var e = this.getScene();
                if (e) {
                    var t = e.getEngine(),
                        i = this.getSize(),
                        n = t.getRenderWidth() * this._renderScale,
                        r = t.getRenderHeight() * this._renderScale;
                    this._renderAtIdealSize && (this._idealWidth ? (r = r * this._idealWidth / n, n = this._idealWidth) : this._idealHeight && (n = n * this._idealHeight / r, r = this._idealHeight)), i.width === n && i.height === r || (this.scaleTo(n, r), this.markAsDirty(), (this._idealWidth || this._idealHeight) && this._rootContainer._markAllAsDirty()), this.invalidateRect(0, 0, i.width - 1, i.height - 1)
                }
            }, t.prototype._getGlobalViewport = function(e) {
                var t = e.getEngine();
                return this._fullscreenViewport.toGlobal(t.getRenderWidth(), t.getRenderHeight())
            }, t.prototype.getProjectedPosition = function(e, t) {
                var i = this.getScene();
                if (!i) return T.Zero();
                var n = this._getGlobalViewport(i),
                    r = b.Project(e, t, i.getTransformMatrix(), n);
                return r.scaleInPlace(this.renderScale), new T(r.x, r.y)
            }, t.prototype._checkUpdate = function(e) {
                if (!this._layerToDispose || 0 != (e.layerMask & this._layerToDispose.layerMask)) {
                    if (this._isFullscreen && this._linkedControls.length) {
                        var t = this.getScene();
                        if (!t) return;
                        for (var i = this._getGlobalViewport(t), n = 0, r = this._linkedControls; n < r.length; n++) {
                            var o = r[n];
                            if (o.isVisible) {
                                var s = o._linkedMesh;
                                if (s && !s.isDisposed()) {
                                    var a = s.getBoundingInfo ? s.getBoundingInfo().boundingSphere.center : s.getAbsolutePosition(),
                                        u = b.Project(a, s.getWorldMatrix(), t.getTransformMatrix(), i);
                                    u.z < 0 || u.z > 1 ? o.notRenderable = !0 : (o.notRenderable = !1, u.scaleInPlace(this.renderScale), o._moveToProjectedPosition(u))
                                } else K.SetImmediate((function() {
                                    o.linkWithMesh(null)
                                }))
                            }
                        }
                    }(this._isDirty || this._rootContainer.isDirty) && (this._isDirty = !1, this._render(), this.update(!0, this.premulAlpha))
                }
            }, t.prototype._render = function() {
                var e = this.getSize(),
                    t = e.width,
                    i = e.height,
                    n = this.getContext();
                n.font = "18px Arial", n.strokeStyle = "white", this.onBeginLayoutObservable.notifyObservers(this);
                var r = new ia(0, 0, t, i);
                this._rootContainer._layout(r, n), this.onEndLayoutObservable.notifyObservers(this), this._isDirty = !1, this._invalidatedRectangle ? this._clearMeasure.copyFrom(this._invalidatedRectangle) : this._clearMeasure.copyFromFloats(0, 0, t, i), n.clearRect(this._clearMeasure.left, this._clearMeasure.top, this._clearMeasure.width, this._clearMeasure.height), this._background && (n.save(), n.fillStyle = this._background, n.fillRect(this._clearMeasure.left, this._clearMeasure.top, this._clearMeasure.width, this._clearMeasure.height), n.restore()), this.onBeginRenderObservable.notifyObservers(this), this._rootContainer._render(n, this._invalidatedRectangle), this.onEndRenderObservable.notifyObservers(this), this._invalidatedRectangle = null
            }, t.prototype._changeCursor = function(e) {
                this._rootCanvas && (this._rootCanvas.style.cursor = e, this._cursorChanged = !0)
            }, t.prototype._registerLastControlDown = function(e, t) {
                this._lastControlDown[t] = e, this.onControlPickedObservable.notifyObservers(e)
            }, t.prototype._doPicking = function(e, t, i, n, r) {
                var o = this.getScene();
                if (o) {
                    var s = o.getEngine(),
                        a = this.getSize();
                    if (this._isFullscreen) {
                        var u = (o.cameraToUseForPointers || o.activeCamera).viewport;
                        e *= a.width / (s.getRenderWidth() * u.width), t *= a.height / (s.getRenderHeight() * u.height)
                    }
                    this._capturingControl[n] ? this._capturingControl[n]._processObservables(i, e, t, n, r) : (this._cursorChanged = !1, this._rootContainer._processPicking(e, t, i, n, r) || (this._changeCursor(""), i === dt.POINTERMOVE && this._lastControlOver[n] && (this._lastControlOver[n]._onPointerOut(this._lastControlOver[n]), delete this._lastControlOver[n])), this._cursorChanged || this._changeCursor(""), this._manageFocus())
                }
            }, t.prototype._cleanControlAfterRemovalFromList = function(e, t) {
                for (var i in e) {
                    if (e.hasOwnProperty(i)) e[i] === t && delete e[i]
                }
            }, t.prototype._cleanControlAfterRemoval = function(e) {
                this._cleanControlAfterRemovalFromList(this._lastControlDown, e), this._cleanControlAfterRemovalFromList(this._lastControlOver, e)
            }, t.prototype.attach = function() {
                var e = this,
                    t = this.getScene();
                if (t) {
                    var i = new P(0, 0, 0, 0);
                    this._pointerMoveObserver = t.onPrePointerObservable.add((function(n, r) {
                        if (!t.isPointerCaptured(n.event.pointerId) && (n.type === dt.POINTERMOVE || n.type === dt.POINTERUP || n.type === dt.POINTERDOWN) && t) {
                            var o = t.cameraToUseForPointers || t.activeCamera,
                                s = t.getEngine();
                            o ? o.viewport.toGlobalToRef(s.getRenderWidth(), s.getRenderHeight(), i) : (i.x = 0, i.y = 0, i.width = s.getRenderWidth(), i.height = s.getRenderHeight());
                            var a = t.pointerX / s.getHardwareScalingLevel() - i.x,
                                u = t.pointerY / s.getHardwareScalingLevel() - (s.getRenderHeight() - i.y - i.height);
                            e._shouldBlockPointer = !1, e._doPicking(a, u, n.type, n.event.pointerId || 0, n.event.button), e._shouldBlockPointer && (n.skipOnPointerObservable = e._shouldBlockPointer)
                        }
                    })), this._attachToOnPointerOut(t)
                }
            }, t.prototype.registerClipboardEvents = function() {
                self.addEventListener("copy", this.onClipboardCopy, !1), self.addEventListener("cut", this.onClipboardCut, !1), self.addEventListener("paste", this.onClipboardPaste, !1)
            }, t.prototype.unRegisterClipboardEvents = function() {
                self.removeEventListener("copy", this.onClipboardCopy), self.removeEventListener("cut", this.onClipboardCut), self.removeEventListener("paste", this.onClipboardPaste)
            }, t.prototype.attachToMesh = function(e, t) {
                var i = this;
                void 0 === t && (t = !0);
                var n = this.getScene();
                n && (this._pointerObserver = n.onPointerObservable.add((function(t, n) {
                    if (t.type === dt.POINTERMOVE || t.type === dt.POINTERUP || t.type === dt.POINTERDOWN) {
                        var r = t.event.pointerId || 0;
                        if (t.pickInfo && t.pickInfo.hit && t.pickInfo.pickedMesh === e) {
                            var o = t.pickInfo.getTextureCoordinates();
                            if (o) {
                                var s = i.getSize();
                                i._doPicking(o.x * s.width, (1 - o.y) * s.height, t.type, r, t.event.button)
                            }
                        } else if (t.type === dt.POINTERUP) {
                            if (i._lastControlDown[r] && i._lastControlDown[r]._forcePointerUp(r), delete i._lastControlDown[r], i.focusedControl) {
                                var a = i.focusedControl.keepsFocusWith(),
                                    u = !0;
                                if (a)
                                    for (var h = 0, l = a; h < l.length; h++) {
                                        var c = l[h];
                                        if (i !== c._host) {
                                            var d = c._host;
                                            if (d._lastControlOver[r] && d._lastControlOver[r].isAscendant(c)) {
                                                u = !1;
                                                break
                                            }
                                        }
                                    }
                                u && (i.focusedControl = null)
                            }
                        } else t.type === dt.POINTERMOVE && (i._lastControlOver[r] && i._lastControlOver[r]._onPointerOut(i._lastControlOver[r], !0), delete i._lastControlOver[r])
                    }
                })), e.enablePointerMoveEvents = t, this._attachToOnPointerOut(n))
            }, t.prototype.moveFocusToControl = function(e) {
                this.focusedControl = e, this._lastPickedControl = e, this._blockNextFocusCheck = !0
            }, t.prototype._manageFocus = function() {
                if (this._blockNextFocusCheck) return this._blockNextFocusCheck = !1, void(this._lastPickedControl = this._focusedControl);
                if (this._focusedControl && this._focusedControl !== this._lastPickedControl) {
                    if (this._lastPickedControl.isFocusInvisible) return;
                    this.focusedControl = null
                }
            }, t.prototype._attachToOnPointerOut = function(e) {
                var t = this;
                this._canvasPointerOutObserver = e.getEngine().onCanvasPointerOutObservable.add((function(e) {
                    t._lastControlOver[e.pointerId] && t._lastControlOver[e.pointerId]._onPointerOut(t._lastControlOver[e.pointerId]), delete t._lastControlOver[e.pointerId], t._lastControlDown[e.pointerId] && t._lastControlDown[e.pointerId] !== t._capturingControl[e.pointerId] && (t._lastControlDown[e.pointerId]._forcePointerUp(), delete t._lastControlDown[e.pointerId])
                }))
            }, t.CreateForMesh = function(e, i, n, r, o) {
                void 0 === i && (i = 1024), void 0 === n && (n = 1024), void 0 === r && (r = !0), void 0 === o && (o = !1);
                var s = new t(e.name + " AdvancedDynamicTexture", i, n, e.getScene(), !0, Ri.TRILINEAR_SAMPLINGMODE),
                    a = new gn("AdvancedDynamicTextureMaterial", e.getScene());
                return a.backFaceCulling = !1, a.diffuseColor = v.Black(), a.specularColor = v.Black(), o ? (a.diffuseTexture = s, a.emissiveTexture = s, s.hasAlpha = !0) : (a.emissiveTexture = s, a.opacityTexture = s), e.material = a, s.attachToMesh(e, r), s
            }, t.CreateFullscreenUI = function(e, i, n, r) {
                void 0 === i && (i = !0), void 0 === n && (n = null), void 0 === r && (r = Ri.BILINEAR_SAMPLINGMODE);
                var o = new t(e, 0, 0, n, !1, r),
                    s = new Qs(e + "_layer", null, n, !i);
                return s.texture = o, o._layerToDispose = s, o._isFullscreen = !0, o.attach(), o
            }, t
        }(js),
        ha = function(e) {
            function t(t) {
                var i = e.call(this, t) || this;
                return i.name = t, i._thickness = 1, i._cornerRadius = 0, i
            }
            return r(t, e), Object.defineProperty(t.prototype, "thickness", {
                get: function() {
                    return this._thickness
                },
                set: function(e) {
                    this._thickness !== e && (this._thickness = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cornerRadius", {
                get: function() {
                    return this._cornerRadius
                },
                set: function(e) {
                    e < 0 && (e = 0), this._cornerRadius !== e && (this._cornerRadius = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._getTypeName = function() {
                return "Rectangle"
            }, t.prototype._localDraw = function(e) {
                e.save(), (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) && (e.shadowColor = this.shadowColor, e.shadowBlur = this.shadowBlur, e.shadowOffsetX = this.shadowOffsetX, e.shadowOffsetY = this.shadowOffsetY), this._background && (e.fillStyle = this._background, this._cornerRadius ? (this._drawRoundedRect(e, this._thickness / 2), e.fill()) : e.fillRect(this._currentMeasure.left, this._currentMeasure.top, this._currentMeasure.width, this._currentMeasure.height)), this._thickness && ((this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) && (e.shadowBlur = 0, e.shadowOffsetX = 0, e.shadowOffsetY = 0), this.color && (e.strokeStyle = this.color), e.lineWidth = this._thickness, this._cornerRadius ? (this._drawRoundedRect(e, this._thickness / 2), e.stroke()) : e.strokeRect(this._currentMeasure.left + this._thickness / 2, this._currentMeasure.top + this._thickness / 2, this._currentMeasure.width - this._thickness, this._currentMeasure.height - this._thickness)), e.restore()
            }, t.prototype._additionalProcessing = function(t, i) {
                e.prototype._additionalProcessing.call(this, t, i), this._measureForChildren.width -= 2 * this._thickness, this._measureForChildren.height -= 2 * this._thickness, this._measureForChildren.left += this._thickness, this._measureForChildren.top += this._thickness
            }, t.prototype._drawRoundedRect = function(e, t) {
                void 0 === t && (t = 0);
                var i = this._currentMeasure.left + t,
                    n = this._currentMeasure.top + t,
                    r = this._currentMeasure.width - 2 * t,
                    o = this._currentMeasure.height - 2 * t,
                    s = Math.min(o / 2 - 2, Math.min(r / 2 - 2, this._cornerRadius));
                e.beginPath(), e.moveTo(i + s, n), e.lineTo(i + r - s, n), e.quadraticCurveTo(i + r, n, i + r, n + s), e.lineTo(i + r, n + o - s), e.quadraticCurveTo(i + r, n + o, i + r - s, n + o), e.lineTo(i + s, n + o), e.quadraticCurveTo(i, n + o, i, n + o - s), e.lineTo(i, n + s), e.quadraticCurveTo(i, n, i + s, n), e.closePath()
            }, t.prototype._clipForChildren = function(e) {
                this._cornerRadius && (this._drawRoundedRect(e, this._thickness), e.clip())
            }, t
        }(sa);
    ! function(e) {
        e[e.Linear = 0] = "Linear", e[e.EaseIn = 1] = "EaseIn", e[e.EaseOut = 2] = "EaseOut", e[e.EaseInOut = 3] = "EaseInOut", e[e.EaseInBack = 4] = "EaseInBack", e[e.EaseOutBack = 5] = "EaseOutBack", e[e.Kick = 6] = "Kick"
    }(Zs || (Zs = {}));
    var la, ca = function() {
            function e(e, t, i, n) {
                this.startVal = e, this.endVal = t, this.duration = i, this.delay = 0, this.setter = n, this.ease = Zs.Linear, this.tVal = 0, this.isComplete = !1, n(e)
            }
            return e.prototype.Update = function(e) {
                if (this.delay > 0) this.delay -= e;
                else {
                    this.tVal = Math.min(1, Math.max(0, this.tVal + e / this.duration)), this.isComplete = this.tVal >= 1;
                    var t = this.CalcEase(this.tVal),
                        i = this.startVal * (1 - t) + this.endVal * t;
                    this.setter(i)
                }
            }, e.prototype.OnCompleted = function(e) {
                return this.callback = e, this
            }, e.prototype.Delay = function(e) {
                return this.delay = e, this
            }, e.prototype.Ease = function(e) {
                return this.ease = e, this
            }, e.prototype.CalcEase = function(e) {
                switch (this.ease) {
                    case Zs.Linear:
                        return e;
                    case Zs.EaseIn:
                        return e * e * e;
                    case Zs.EaseOut:
                        return 1 - (e = 1 - e) * e * e;
                    case Zs.EaseInOut:
                        return 3 * e * e - 2 * e * e * e;
                    case Zs.EaseInBack:
                        return e * e * (2.7 * e - 1.7);
                    case Zs.EaseOutBack:
                        return (e -= 1) * e * (2.7 * e + 1.7) + 1;
                    case Zs.Kick:
                        return e < .3 ? 1 - (e = 1 - e / .3) * e * e : 1 - (3 * (e = (e - .3) / .7) * e - 2 * e * e * e)
                }
            }, e
        }(),
        da = function() {
            function e() {
                e.instance = this, this.tweens = []
            }
            return e.AddTween = function(e, t, i, n) {
                var r = new ca(e, t, i, n);
                return this.instance.tweens.push(r), r
            }, e.RemoveTween = function(t) {
                for (var i = e.instance.tweens, n = 0; n < i.length; ++n)
                    if (i[n] == t) return i[n] = i[i.length - 1], void i.pop()
            }, e.prototype.UpdateTweens = function(e) {
                for (var t = this.tweens, i = 0; i < t.length; ++i) {
                    var n = t[i];
                    n.Update(e), n.isComplete && (null != n.callback && n.callback(), t[i] = t[t.length - 1], t.pop(), i--)
                }
            }, e
        }(),
        fa = function(e) {
            function t(i, n) {
                void 0 === n && (n = null);
                var r = e.call(this, i) || this;
                return r.name = i, r._loaded = !1, r._stretch = t.STRETCH_FILL, r._autoScale = !1, r._sourceLeft = 0, r._sourceTop = 0, r._sourceWidth = 0, r._sourceHeight = 0, r._cellWidth = 0, r._cellHeight = 0, r._cellId = -1, r._populateNinePatchSlicesFromImage = !1, r.onImageLoadedObservable = new l, r.source = n, r
            }
            return r(t, e), Object.defineProperty(t.prototype, "isLoaded", {
                get: function() {
                    return this._loaded
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "populateNinePatchSlicesFromImage", {
                get: function() {
                    return this._populateNinePatchSlicesFromImage
                },
                set: function(e) {
                    this._populateNinePatchSlicesFromImage !== e && (this._populateNinePatchSlicesFromImage = e, this._populateNinePatchSlicesFromImage && this._loaded && this._extractNinePatchSliceDataFromImage())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "detectPointerOnOpaqueOnly", {
                get: function() {
                    return this._detectPointerOnOpaqueOnly
                },
                set: function(e) {
                    this._detectPointerOnOpaqueOnly !== e && (this._detectPointerOnOpaqueOnly = e)
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sliceLeft", {
                get: function() {
                    return this._sliceLeft
                },
                set: function(e) {
                    this._sliceLeft !== e && (this._sliceLeft = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sliceRight", {
                get: function() {
                    return this._sliceRight
                },
                set: function(e) {
                    this._sliceRight !== e && (this._sliceRight = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sliceTop", {
                get: function() {
                    return this._sliceTop
                },
                set: function(e) {
                    this._sliceTop !== e && (this._sliceTop = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sliceBottom", {
                get: function() {
                    return this._sliceBottom
                },
                set: function(e) {
                    this._sliceBottom !== e && (this._sliceBottom = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sourceLeft", {
                get: function() {
                    return this._sourceLeft
                },
                set: function(e) {
                    this._sourceLeft !== e && (this._sourceLeft = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sourceTop", {
                get: function() {
                    return this._sourceTop
                },
                set: function(e) {
                    this._sourceTop !== e && (this._sourceTop = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sourceWidth", {
                get: function() {
                    return this._sourceWidth
                },
                set: function(e) {
                    this._sourceWidth !== e && (this._sourceWidth = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "sourceHeight", {
                get: function() {
                    return this._sourceHeight
                },
                set: function(e) {
                    this._sourceHeight !== e && (this._sourceHeight = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "autoScale", {
                get: function() {
                    return this._autoScale
                },
                set: function(e) {
                    this._autoScale !== e && (this._autoScale = e, e && this._loaded && this.synchronizeSizeWithContent())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "stretch", {
                get: function() {
                    return this._stretch
                },
                set: function(e) {
                    this._stretch !== e && (this._stretch = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "domImage", {
                get: function() {
                    return this._domImage
                },
                set: function(e) {
                    var t = this;
                    this._domImage = e, this._loaded = !1, this._domImage.width ? this._onImageLoaded() : this._domImage.onload = function() {
                        t._onImageLoaded()
                    }
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._onImageLoaded = function() {
                this._imageWidth = this._domImage.width, this._imageHeight = this._domImage.height, this._loaded = !0, this._populateNinePatchSlicesFromImage && this._extractNinePatchSliceDataFromImage(), this._autoScale && this.synchronizeSizeWithContent(), this.onImageLoadedObservable.notifyObservers(this), this._markAsDirty()
            }, t.prototype._extractNinePatchSliceDataFromImage = function() {
                t._WorkingCanvas || (t._WorkingCanvas = document.createElement("canvas"));
                var e = t._WorkingCanvas,
                    i = e.getContext("2d"),
                    n = this._domImage.width,
                    r = this._domImage.height;
                e.width = n, e.height = r, i.drawImage(this._domImage, 0, 0, n, r);
                var o = i.getImageData(0, 0, n, r);
                this._sliceLeft = -1, this._sliceRight = -1;
                for (var s = 0; s < n; s++) {
                    if ((u = o.data[4 * s + 3]) > 127 && -1 === this._sliceLeft) this._sliceLeft = s;
                    else if (u < 127 && this._sliceLeft > -1) {
                        this._sliceRight = s;
                        break
                    }
                }
                this._sliceTop = -1, this._sliceBottom = -1;
                for (var a = 0; a < r; a++) {
                    var u;
                    if ((u = o.data[a * n * 4 + 3]) > 127 && -1 === this._sliceTop) this._sliceTop = a;
                    else if (u < 127 && this._sliceTop > -1) {
                        this._sliceBottom = a;
                        break
                    }
                }
            }, Object.defineProperty(t.prototype, "source", {
                set: function(e) {
                    var t = this;
                    this._source !== e && (this._loaded = !1, this._source = e, this._domImage = document.createElement("img"), this._domImage.onload = function() {
                        t._onImageLoaded()
                    }, e && (K.SetCorsBehavior(e, this._domImage), this._domImage.src = e))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cellWidth", {
                get: function() {
                    return this._cellWidth
                },
                set: function(e) {
                    this._cellWidth !== e && (this._cellWidth = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cellHeight", {
                get: function() {
                    return this._cellHeight
                },
                set: function(e) {
                    this._cellHeight !== e && (this._cellHeight = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "cellId", {
                get: function() {
                    return this._cellId
                },
                set: function(e) {
                    this._cellId !== e && (this._cellId = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype.contains = function(i, n) {
                if (!e.prototype.contains.call(this, i, n)) return !1;
                if (!this._detectPointerOnOpaqueOnly || !t._WorkingCanvas) return !0;
                var r = t._WorkingCanvas.getContext("2d"),
                    o = 0 | this._currentMeasure.width,
                    s = 0 | this._currentMeasure.height;
                return r.getImageData(0, 0, o, s).data[4 * ((i = i - this._currentMeasure.left | 0) + (n = n - this._currentMeasure.top | 0) * this._currentMeasure.width) + 3] > 0
            }, t.prototype._getTypeName = function() {
                return "Image"
            }, t.prototype.synchronizeSizeWithContent = function() {
                this._loaded && (this.width = this._domImage.width + "px", this.height = this._domImage.height + "px")
            }, t.prototype._processMeasures = function(i, n) {
                if (this._loaded) switch (this._stretch) {
                    case t.STRETCH_NONE:
                    case t.STRETCH_FILL:
                    case t.STRETCH_UNIFORM:
                    case t.STRETCH_NINE_PATCH:
                        break;
                    case t.STRETCH_EXTEND:
                        this._autoScale && this.synchronizeSizeWithContent(), this.parent && this.parent.parent && (this.parent.adaptWidthToChildren = !0, this.parent.adaptHeightToChildren = !0)
                }
                e.prototype._processMeasures.call(this, i, n)
            }, t.prototype._prepareWorkingCanvasForOpaqueDetection = function() {
                if (this._detectPointerOnOpaqueOnly) {
                    t._WorkingCanvas || (t._WorkingCanvas = document.createElement("canvas"));
                    var e = t._WorkingCanvas,
                        i = this._currentMeasure.width,
                        n = this._currentMeasure.height,
                        r = e.getContext("2d");
                    e.width = i, e.height = n, r.clearRect(0, 0, i, n)
                }
            }, t.prototype._drawImage = function(e, i, n, r, o, s, a, u, h) {
                0 != r && 0 != o ? (e.drawImage(this._domImage, i, n, r, o, s, a, u, h), this._detectPointerOnOpaqueOnly && (e = t._WorkingCanvas.getContext("2d")).drawImage(this._domImage, i, n, r, o, s - this._currentMeasure.left, a - this._currentMeasure.top, u, h)) : console.log("====== IMAGE SIZE WAS 0 ======")
            }, t.prototype._draw = function(e) {
                var i, n, r, o;
                if (e.save(), (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) && (e.shadowColor = this.shadowColor, e.shadowBlur = this.shadowBlur, e.shadowOffsetX = this.shadowOffsetX, e.shadowOffsetY = this.shadowOffsetY), -1 == this.cellId) i = this._sourceLeft, n = this._sourceTop, r = this._sourceWidth ? this._sourceWidth : this._imageWidth, o = this._sourceHeight ? this._sourceHeight : this._imageHeight;
                else {
                    var s = this._domImage.naturalWidth / this.cellWidth,
                        a = this.cellId / s >> 0,
                        u = this.cellId % s;
                    i = this.cellWidth * u, n = this.cellHeight * a, r = this.cellWidth, o = this.cellHeight
                }
                if (this._prepareWorkingCanvasForOpaqueDetection(), this._applyStates(e), this._loaded) switch (this._stretch) {
                    case t.STRETCH_NONE:
                    case t.STRETCH_FILL:
                        this._drawImage(e, i, n, r, o, this._currentMeasure.left, this._currentMeasure.top, this._currentMeasure.width, this._currentMeasure.height);
                        break;
                    case t.STRETCH_UNIFORM:
                        var h = this._currentMeasure.width / r,
                            l = this._currentMeasure.height / o,
                            c = Math.min(h, l),
                            d = (this._currentMeasure.width - r * c) / 2,
                            f = (this._currentMeasure.height - o * c) / 2;
                        this._drawImage(e, i, n, r, o, this._currentMeasure.left + d, this._currentMeasure.top + f, r * c, o * c);
                        break;
                    case t.STRETCH_EXTEND:
                        this._drawImage(e, i, n, r, o, this._currentMeasure.left, this._currentMeasure.top, this._currentMeasure.width, this._currentMeasure.height);
                        break;
                    case t.STRETCH_NINE_PATCH:
                        this._renderNinePatch(e)
                }
                e.restore()
            }, t.prototype._renderCornerPatch = function(e, t, i, n, r, o, s) {
                this._drawImage(e, t, i, n, r, this._currentMeasure.left + o, this._currentMeasure.top + s, n, r)
            }, t.prototype._renderNinePatch = function(e) {
                var t = this._imageHeight,
                    i = this._sliceLeft,
                    n = this._sliceTop,
                    r = this._imageHeight - this._sliceBottom,
                    o = this._imageWidth - this._sliceRight,
                    s = 0,
                    a = 0;
                this._populateNinePatchSlicesFromImage && (s = 1, a = 1, t -= 2, i -= 1, n -= 1, r -= 1, o -= 1);
                var u = this._sliceRight - this._sliceLeft + 1,
                    h = this._currentMeasure.width - o - this.sliceLeft + 1,
                    l = this._currentMeasure.height - t + this._sliceBottom;
                this._renderCornerPatch(e, s, a, i, n, 0, 0), this._renderCornerPatch(e, s, this._sliceBottom, i, t - this._sliceBottom, 0, l), this._renderCornerPatch(e, this._sliceRight, a, o, n, this._currentMeasure.width - o, 0), this._renderCornerPatch(e, this._sliceRight, this._sliceBottom, o, t - this._sliceBottom, this._currentMeasure.width - o, l), this._drawImage(e, this._sliceLeft, this._sliceTop, u, this._sliceBottom - this._sliceTop + 1, this._currentMeasure.left + i, this._currentMeasure.top + n, h, l - n + 1), this._drawImage(e, s, this._sliceTop, i, this._sliceBottom - this._sliceTop, this._currentMeasure.left, this._currentMeasure.top + n, i, l - n), this._drawImage(e, this._sliceRight, this._sliceTop, i, this._sliceBottom - this._sliceTop, this._currentMeasure.left + this._currentMeasure.width - o, this._currentMeasure.top + n, i, l - n), this._drawImage(e, this._sliceLeft, a, u, n, this._currentMeasure.left + i, this._currentMeasure.top, h, n), this._drawImage(e, this._sliceLeft, this._sliceBottom, u, r, this._currentMeasure.left + i, this._currentMeasure.top + l, h, r)
            }, t.prototype.dispose = function() {
                e.prototype.dispose.call(this), this.onImageLoadedObservable.clear()
            }, t._WorkingCanvas = null, t.STRETCH_NONE = 0, t.STRETCH_FILL = 1, t.STRETCH_UNIFORM = 2, t.STRETCH_EXTEND = 3, t.STRETCH_NINE_PATCH = 4, t
        }(oa);
    ! function(e) {
        e[e.Clip = 0] = "Clip", e[e.WordWrap = 1] = "WordWrap", e[e.Ellipsis = 2] = "Ellipsis"
    }(la || (la = {}));
    var pa, _a, ga, ma = function(e) {
            function t(t, i) {
                void 0 === i && (i = "");
                var n = e.call(this, t) || this;
                return n.name = t, n._text = "", n._textWrapping = la.Clip, n._textHorizontalAlignment = oa.HORIZONTAL_ALIGNMENT_CENTER, n._textVerticalAlignment = oa.VERTICAL_ALIGNMENT_CENTER, n._resizeToFit = !1, n._lineSpacing = new Js(0), n._outlineWidth = 0, n._outlineColor = "white", n.onTextChangedObservable = new l, n.onLinesReadyObservable = new l, n.text = i, n
            }
            return r(t, e), Object.defineProperty(t.prototype, "lines", {
                get: function() {
                    return this._lines
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "resizeToFit", {
                get: function() {
                    return this._resizeToFit
                },
                set: function(e) {
                    this._resizeToFit !== e && (this._resizeToFit = e, this._resizeToFit && (this._width.ignoreAdaptiveScaling = !0, this._height.ignoreAdaptiveScaling = !0), this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "textWrapping", {
                get: function() {
                    return this._textWrapping
                },
                set: function(e) {
                    this._textWrapping !== e && (this._textWrapping = +e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "text", {
                get: function() {
                    return this._text
                },
                set: function(e) {
                    this._text !== e && (this._text = e, this._markAsDirty(), this.onTextChangedObservable.notifyObservers(this))
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "textHorizontalAlignment", {
                get: function() {
                    return this._textHorizontalAlignment
                },
                set: function(e) {
                    this._textHorizontalAlignment !== e && (this._textHorizontalAlignment = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "textVerticalAlignment", {
                get: function() {
                    return this._textVerticalAlignment
                },
                set: function(e) {
                    this._textVerticalAlignment !== e && (this._textVerticalAlignment = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "lineSpacing", {
                get: function() {
                    return this._lineSpacing.toString(this._host)
                },
                set: function(e) {
                    this._lineSpacing.fromString(e) && this._markAsDirty()
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "outlineWidth", {
                get: function() {
                    return this._outlineWidth
                },
                set: function(e) {
                    this._outlineWidth !== e && (this._outlineWidth = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "outlineColor", {
                get: function() {
                    return this._outlineColor
                },
                set: function(e) {
                    this._outlineColor !== e && (this._outlineColor = e, this._markAsDirty())
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._getTypeName = function() {
                return "TextBlock"
            }, t.prototype._processMeasures = function(t, i) {
                this._fontOffset || (this._fontOffset = oa._GetFontOffset(i.font)), e.prototype._processMeasures.call(this, t, i), this._lines = this._breakLines(this._currentMeasure.width, i), this.onLinesReadyObservable.notifyObservers(this);
                for (var n = 0, r = 0; r < this._lines.length; r++) {
                    var o = this._lines[r];
                    o.width > n && (n = o.width)
                }
                if (this._resizeToFit) {
                    if (this._textWrapping === la.Clip) {
                        var s = this.paddingLeftInPixels + this.paddingRightInPixels + n;
                        s !== this._width.internalValue && (this._width.updateInPlace(s, Js.UNITMODE_PIXEL), this._rebuildLayout = !0)
                    }
                    var a = this.paddingTopInPixels + this.paddingBottomInPixels + this._fontOffset.height * this._lines.length;
                    a !== this._height.internalValue && (this._height.updateInPlace(a, Js.UNITMODE_PIXEL), this._rebuildLayout = !0)
                }
            }, t.prototype._drawText = function(e, t, i, n) {
                var r = this._currentMeasure.width,
                    o = 0;
                switch (this._textHorizontalAlignment) {
                    case oa.HORIZONTAL_ALIGNMENT_LEFT:
                        o = 0;
                        break;
                    case oa.HORIZONTAL_ALIGNMENT_RIGHT:
                        o = r - t;
                        break;
                    case oa.HORIZONTAL_ALIGNMENT_CENTER:
                        o = (r - t) / 2
                }(this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) && (n.shadowColor = this.shadowColor, n.shadowBlur = this.shadowBlur, n.shadowOffsetX = this.shadowOffsetX, n.shadowOffsetY = this.shadowOffsetY), this.outlineWidth && n.strokeText(e, this._currentMeasure.left + o, i), n.fillText(e, this._currentMeasure.left + o, i)
            }, t.prototype._draw = function(e) {
                e.save(), this._applyStates(e), this._renderLines(e), e.restore()
            }, t.prototype._applyStates = function(t) {
                e.prototype._applyStates.call(this, t), this.outlineWidth && (t.lineWidth = this.outlineWidth, t.strokeStyle = this.outlineColor)
            }, t.prototype._breakLines = function(e, t) {
                var i = [],
                    n = this.text.split("\n");
                if (this._textWrapping === la.Ellipsis)
                    for (var r = 0, o = n; r < o.length; r++) {
                        var s = o[r];
                        i.push(this._parseLineEllipsis(s, e, t))
                    } else if (this._textWrapping === la.WordWrap)
                        for (var a = 0, u = n; a < u.length; a++) {
                            s = u[a];
                            i.push.apply(i, this._parseLineWordWrap(s, e, t))
                        } else
                            for (var h = 0, l = n; h < l.length; h++) {
                                s = l[h];
                                i.push(this._parseLine(s, t))
                            }
                return i
            }, t.prototype._parseLine = function(e, t) {
                return void 0 === e && (e = ""), {
                    text: e,
                    width: t.measureText(e).width
                }
            }, t.prototype._parseLineEllipsis = function(e, t, i) {
                void 0 === e && (e = "");
                var n = i.measureText(e).width;
                for (n > t && (e += "…"); e.length > 2 && n > t;) e = e.slice(0, -2) + "…", n = i.measureText(e).width;
                return {
                    text: e,
                    width: n
                }
            }, t.prototype._parseLineWordWrap = function(e, t, i) {
                void 0 === e && (e = "");
                for (var n = [], r = e.split(" "), o = 0, s = 0; s < r.length; s++) {
                    var a = s > 0 ? e + " " + r[s] : r[0],
                        u = i.measureText(a).width;
                    u > t && s > 0 ? (n.push({
                        text: e,
                        width: o
                    }), e = r[s], o = i.measureText(e).width) : (o = u, e = a)
                }
                return n.push({
                    text: e,
                    width: o
                }), n
            }, t.prototype._renderLines = function(e) {
                var t = this._currentMeasure.height,
                    i = 0;
                switch (this._textVerticalAlignment) {
                    case oa.VERTICAL_ALIGNMENT_TOP:
                        i = this._fontOffset.ascent;
                        break;
                    case oa.VERTICAL_ALIGNMENT_BOTTOM:
                        i = t - this._fontOffset.height * (this._lines.length - 1) - this._fontOffset.descent;
                        break;
                    case oa.VERTICAL_ALIGNMENT_CENTER:
                        i = this._fontOffset.ascent + (t - this._fontOffset.height * this._lines.length) / 2
                }
                i += this._currentMeasure.top;
                for (var n = 0; n < this._lines.length; n++) {
                    var r = this._lines[n];
                    0 !== n && 0 !== this._lineSpacing.internalValue && (this._lineSpacing.isPixel ? i += this._lineSpacing.getValue(this._host) : i += this._lineSpacing.getValue(this._host) * this._height.getValueInPixel(this._host, this._cachedParentMeasure.height)), this._drawText(r.text, r.width, i, e), i += this._fontOffset.height
                }
            }, t.prototype.computeExpectedHeight = function() {
                if (this.text && this.widthInPixels) {
                    var e = document.createElement("canvas").getContext("2d");
                    if (e) {
                        this._applyStates(e), this._fontOffset || (this._fontOffset = oa._GetFontOffset(e.font));
                        var t = this._lines ? this._lines : this._breakLines(this.widthInPixels - this.paddingLeftInPixels - this.paddingRightInPixels, e);
                        return this.paddingTopInPixels + this.paddingBottomInPixels + this._fontOffset.height * t.length
                    }
                }
                return 0
            }, t.prototype.dispose = function() {
                e.prototype.dispose.call(this), this.onTextChangedObservable.clear()
            }, t
        }(oa),
        va = function(e) {
            function t(t) {
                var i = e.call(this, t) || this;
                i.name = t, i.thickness = 1, i.isPointerBlocker = !0;
                var n = null;
                return i.pointerEnterAnimation = function() {
                    n = i.alpha, i.alpha -= .1
                }, i.pointerOutAnimation = function() {
                    null !== n && (i.alpha = n)
                }, i.pointerDownAnimation = function() {
                    i.scaleX -= .05, i.scaleY -= .05
                }, i.pointerUpAnimation = function() {
                    i.scaleX += .05, i.scaleY += .05
                }, i
            }
            return r(t, e), Object.defineProperty(t.prototype, "image", {
                get: function() {
                    return this._image
                },
                enumerable: !0,
                configurable: !0
            }), Object.defineProperty(t.prototype, "textBlock", {
                get: function() {
                    return this._textBlock
                },
                enumerable: !0,
                configurable: !0
            }), t.prototype._getTypeName = function() {
                return "Button"
            }, t.prototype._processPicking = function(t, i, n, r, o) {
                return !(!(this._isEnabled && this.isHitTestVisible && this.isVisible) || this.notRenderable) && (!!e.prototype.contains.call(this, t, i) && (this._processObservables(n, t, i, r, o), !0))
            }, t.prototype._onPointerEnter = function(t) {
                return !!e.prototype._onPointerEnter.call(this, t) && (this.pointerEnterAnimation && this.pointerEnterAnimation(), !0)
            }, t.prototype._onPointerOut = function(t, i) {
                void 0 === i && (i = !1), this.pointerOutAnimation && this.pointerOutAnimation(), e.prototype._onPointerOut.call(this, t, i)
            }, t.prototype._onPointerDown = function(t, i, n, r) {
                return !!e.prototype._onPointerDown.call(this, t, i, n, r) && (this.pointerDownAnimation && this.pointerDownAnimation(), !0)
            }, t.prototype._onPointerUp = function(t, i, n, r, o) {
                this.pointerUpAnimation && this.pointerUpAnimation(), e.prototype._onPointerUp.call(this, t, i, n, r, o)
            }, t.CreateImageButton = function(e, i, n) {
                var r = new t(e),
                    o = new ma(e + "_button", i);
                o.textWrapping = !0, o.textHorizontalAlignment = oa.HORIZONTAL_ALIGNMENT_CENTER, o.paddingLeft = "20%", r.addControl(o);
                var s = new fa(e + "_icon", n);
                return s.width = "20%", s.stretch = fa.STRETCH_UNIFORM, s.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, r.addControl(s), r._image = s, r._textBlock = o, r
            }, t.CreateImageOnlyButton = function(e, i) {
                var n = new t(e),
                    r = new fa(e + "_icon", i);
                return r.stretch = fa.STRETCH_FILL, r.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, n.addControl(r), n._image = r, n
            }, t.CreateSimpleButton = function(e, i) {
                var n = new t(e),
                    r = new ma(e + "_button", i);
                return r.textWrapping = !0, r.textHorizontalAlignment = oa.HORIZONTAL_ALIGNMENT_CENTER, n.addControl(r), n._textBlock = r, n
            }, t.CreateImageWithCenterTextButton = function(e, i, n) {
                var r = new t(e),
                    o = new fa(e + "_icon", n);
                o.stretch = fa.STRETCH_FILL, r.addControl(o);
                var s = new ma(e + "_button", i);
                return s.textWrapping = !0, s.textHorizontalAlignment = oa.HORIZONTAL_ALIGNMENT_CENTER, r.addControl(s), r._image = o, r._textBlock = s, r
            }, t
        }(ha),
        ya = function() {
            function e(e) {
                this.name = e;
                var t = new sa("menu");
                this.menu = t
            }
            return e.prototype.Resize = function(e, t) {
                this.menu.widthInPixels = e, this.menu.heightInPixels = t
            }, e.prototype.ClearFocus = function() {
                this.selected && this.selected.TR_onUnselected && this.selected.TR_onUnselected(), this.selected = null
            }, e.prototype.MoveFocus = function(e) {
                null != e && (this.selected && this.selected.TR_onUnselected && this.selected.TR_onUnselected(), this.selected = e, this.selected && this.selected.TR_onSelected && this.selected.TR_onSelected())
            }, e.prototype.OnPointerLeaveControl = function(e) {
                this.selected != e && e.TR_onUnselected && e.TR_onUnselected()
            }, e.prototype.WhileOpen = function(e) {}, e.prototype.MoveLeft = function() {
                this.selected && this.MoveFocus(this.selected.TR_moveLeft)
            }, e.prototype.MoveRight = function() {
                this.selected && this.MoveFocus(this.selected.TR_moveRight)
            }, e.prototype.MoveUp = function() {
                this.selected && this.MoveFocus(this.selected.TR_moveUp)
            }, e.prototype.MoveDown = function() {
                this.selected && this.MoveFocus(this.selected.TR_moveDown)
            }, e.prototype.OnAboutToShow = function() {
                this.MoveFocus(this.initialFocus)
            }, e.prototype.OnSubmit = function() {
                this.selected && this.selected.TR_onClicked && this.selected.TR_onClicked()
            }, e.prototype.OnBack = function() {
                Da.CloseMenu(this.name)
            }, e.prototype.CreateLabel = function(e, t) {
                var i = new ma("label", e);
                return i.color = "white", i.fontFamily = "Arial Black", i.fontSize = t, i.resizeToFit = !0, i
            }, e.prototype.CreateRoundButton = function(e, t) {
                var i = new sa("button_round");
                i.widthInPixels = 120, i.heightInPixels = 120;
                var n = va.CreateSimpleButton("button", "");
                n.widthInPixels = 120, n.heightInPixels = 120, n.thickness = 0;
                var r = new fa("buttonImage", "./textures/ButtonRound.png");
                r.widthInPixels = 120, r.heightInPixels = 120, r.TR_normal = "./textures/ButtonRound.png", r.TR_highlight = "./textures/ButtonRound_Highlight.png";
                var o = new fa("icon", "./textures/" + e);
                o.widthInPixels = 80, o.heightInPixels = 80, i.TR_onClicked = t, i.TR_onSelected = function() {
                    r.source = r.TR_highlight
                }, i.TR_onUnselected = function() {
                    r.source = r.TR_normal
                };
                var s = this;
                return n.onPointerClickObservable.add(i.TR_onClicked), n.onPointerEnterObservable.add(i.TR_onSelected), n.onPointerOutObservable.add((function() {
                    s.OnPointerLeaveControl(i)
                })), i.addControl(r), i.addControl(o), i.addControl(n), i
            }, e.prototype.CreateRectButton = function(e, t, i, n, r) {
                var o = new sa("button_square");
                o.widthInPixels = i, o.heightInPixels = n;
                var s = va.CreateSimpleButton("button", "");
                s.widthInPixels = i, s.heightInPixels = n, s.thickness = 0, s.zIndex = 1;
                var a = new fa("buttonImage", "./textures/ButtonSquare.png");
                if (a.widthInPixels = i, a.heightInPixels = n, a.stretch = fa.STRETCH_NINE_PATCH, a.sliceLeft = 20, a.sliceRight = 34, a.sliceTop = 22, a.sliceBottom = 82, a.zIndex = -1, a.TR_normal = "./textures/ButtonSquare.png", a.TR_highlight = "./textures/ButtonSquare_Highlight.png", o.addControl(a), "" != e) {
                    var u = new fa("icon", "./textures/" + e);
                    u.widthInPixels = 80, u.heightInPixels = 80, o.addControl(u)
                }
                if ("" != t) {
                    var h = this.CreateLabel(t, 20);
                    o.addControl(h)
                }
                o.TR_onClicked = r, o.TR_onSelected = function() {
                    a.source = a.TR_highlight
                }, o.TR_onUnselected = function() {
                    a.source = a.TR_normal
                };
                var l = this;
                return s.onPointerClickObservable.add(o.TR_onClicked), s.onPointerEnterObservable.add(o.TR_onSelected), s.onPointerOutObservable.add((function() {
                    l.OnPointerLeaveControl(o)
                })), o.addControl(s), o
            }, e.prototype.CreateSquareButton = function(e, t) {
                return this.CreateRectButton(e, "", 140, 140, t)
            }, e.prototype.CreateButtonPanel = function(e, t) {
                var i = new sa("panel");
                i.widthInPixels = e, i.heightInPixels = t;
                var n = new fa("panelImage", "./textures/ButtonSquare.png");
                return n.widthInPixels = e, n.heightInPixels = t, n.stretch = fa.STRETCH_NINE_PATCH, n.sliceLeft = 20, n.sliceRight = 34, n.sliceTop = 22, n.sliceBottom = 82, i.addControl(n), i
            }, e.prototype.CreateWindowPanel = function(e, t) {
                var i = new sa("panel");
                i.widthInPixels = e, i.heightInPixels = t;
                var n = new fa("panelImage", "./textures/Window.png");
                return n.widthInPixels = e, n.heightInPixels = t, n.stretch = fa.STRETCH_NINE_PATCH, n.sliceLeft = 52, n.sliceRight = 64, n.sliceTop = 100, n.sliceBottom = 110, i.addControl(n), i
            }, e
        }(),
        Ta = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }(),
        ba = function(e) {
            function t() {
                var t = e.call(this, "MainMenu") || this,
                    i = t.menu,
                    n = t,
                    r = new fa("logo", "./textures/Logo.png");
                r.widthInPixels = 434, r.heightInPixels = 302, r.topInPixels = -67, i.addControl(r);
                var o = Ua.instance.isMobileBrowser,
                    s = null,
                    a = null;
                o ? s = t.CreateMainButton("ArrowOutline.png", "PLAY", 0, (function() {
                    Ua.instance.OnPlayButtonPressed()
                })) : (s = t.CreateMainButton("ArrowOutline.png", "CLASSIC MODE", -140, (function() {
                    Ua.instance.OnPlayButtonPressed()
                })), a = t.CreateMainButton("VsOutline.png", "2 PLAYERS", 140, (function() {
                    Ua.instance.On2PlayerButtonPressed()
                })));
                var u = t.CreateRoundButton("settings.png", (function() {
                    Ua.instance.OnShowSettings()
                }));
                u.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, u.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, i.addControl(u);
                var h = t.CreateRoundButton("levels.png", (function() {
                    Ws.PlaySfx("Button"), Da.OpenMenu("LevelSelectMenu")
                }));
                h.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, h.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, h.topInPixels = 120, i.addControl(h);
                var l = t.CreateRoundButton("easy.png", (function() {
                    Ws.PlaySfx("Button"), Ua.instance.SetDifficulty((Ua.instance.GetDifficulty() + 1) % 3), n.UpdateDifficultyIcon()
                }));
                return l.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, l.verticalAlignment = oa.VERTICAL_ALIGNMENT_BOTTOM, l.topInPixels = -50, t.difficultyButton = l, t.UpdateDifficultyIcon(), i.addControl(l), s.TR_moveLeft = l, o || (s.TR_moveRight = a, a.TR_moveLeft = s), l.TR_moveRight = s, h.TR_moveRight = s, u.TR_moveRight = s, l.TR_moveUp = h, h.TR_moveUp = u, h.TR_moveDown = l, u.TR_moveDown = h, t.initialFocus = s, t
            }
            return Ta(t, e), t.prototype.OnBack = function() {}, t.prototype.CreateMainButton = function(e, t, i, n) {
                var r = this.CreateSquareButton(e, n);
                r.verticalAlignment = oa.VERTICAL_ALIGNMENT_BOTTOM, r.topInPixels = -50, r.leftInPixels = i;
                var o = this.CreateLabel(t, 20);
                return o.verticalAlignment = oa.VERTICAL_ALIGNMENT_BOTTOM, o.topInPixels = -30, o.leftInPixels = i, this.menu.addControl(r), this.menu.addControl(o), r
            }, t.prototype.UpdateDifficultyIcon = function() {
                var e = this.difficultyButton.getChildByName("icon"),
                    t = Ua.instance.GetDifficulty();
                t == Ua.instance.DifficultyEasy ? e.source = "./textures/easy.png" : t == Ua.instance.DifficultyMed && (e.source = "./textures/med.png"), t == Ua.instance.DifficultyHard && (e.source = "./textures/hard.png")
            }, t
        }(ya),
        Ea = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }(),
        Aa = function(e) {
            function t() {
                var t = e.call(this, "SettingsMenu") || this,
                    i = t.menu,
                    n = t,
                    r = t.CreateRoundButton("arrow.png", (function() {
                        Ws.PlaySfx("Button"), n.OnBack()
                    }));
                r.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, r.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, i.addControl(r);
                var o = t.CreateLabel("SETTINGS", 50);
                o.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, o.topInPixels = 50, i.addControl(o);
                var s = t.CreateWindowPanel(650, 360);
                s.topInPixels = 38, i.addControl(s);
                var a = t.CreateRectButton("vol_on.png", "AUDIO", 300, 90, (function() {
                        Ws.ToggleAudio(), n.UpdateVolumeIcon(), Ua.instance.saveData.audioEnable = Ws.IsAudioEnabled(), Ua.instance.SaveProgress()
                    })),
                    u = a.getChildByName("label");
                u.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, u.leftInPixels = 45;
                var h = a.getChildByName("icon");
                h.widthInPixels = 50, h.heightInPixels = 50, h.leftInPixels = 50, t.volumeButton = a;
                var l = t.CreateRectButton("", "RESET PROGRESS", 300, 90, (function() {
                    c.isVisible = !0, n.MoveFocus(f)
                }));
                a.topInPixels = -50, l.topInPixels = 50, s.addControl(l), s.addControl(a);
                var c = t.CreateButtonPanel(500, 300);
                c.topInPixels = 50;
                var d = t.CreateLabel("THIS WILL DELETE\nALL SAVED PROGRESS\nCONTINUE?", 30);
                d.topInPixels = -50;
                var f = t.CreateRectButton("", "CANCEL", 200, 80, (function() {
                        c.isVisible = !1, n.MoveFocus(l)
                    })),
                    p = t.CreateRectButton("", "RESET", 200, 80, (function() {
                        Ua.instance.ResetProgress(), c.isVisible = !1, n.MoveFocus(l)
                    }));
                return f.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, f.verticalAlignment = oa.VERTICAL_ALIGNMENT_BOTTOM, p.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_RIGHT, p.verticalAlignment = oa.VERTICAL_ALIGNMENT_BOTTOM, f.leftInPixels = 40, p.leftInPixels = -40, f.topInPixels = -40, p.topInPixels = -40, c.addControl(d), c.addControl(f), c.addControl(p), t.confirmPanel = c, i.addControl(c), c.isVisible = !1, r.TR_moveRight = a, r.TR_moveDown = a, a.TR_moveDown = l, a.TR_moveUp = r, a.TR_moveLeft = r, l.TR_moveUp = a, l.TR_moveLeft = r, f.TR_moveRight = p, p.TR_moveLeft = f, t.initialFocus = a, t
            }
            return Ea(t, e), t.prototype.UpdateVolumeIcon = function() {
                var e = this.volumeButton.getChildByName("icon");
                Ws.IsAudioEnabled() ? e.source = "./textures/vol_on.png" : e.source = "./textures/vol_off.png"
            }, t.prototype.OnAboutToShow = function() {
                this.confirmPanel.isVisible = !1, this.UpdateVolumeIcon(), e.prototype.OnAboutToShow.call(this)
            }, t
        }(ya),
        Ma = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }(),
        Ra = function(e) {
            function t() {
                var t = e.call(this, "RestartMenu") || this,
                    i = t.menu,
                    n = new fa("bg", "./textures/black.png");
                n.widthInPixels = 2e3, n.heightInPixels = 600, n.alpha = .5, i.addControl(n);
                var r = t.CreateLabel("WINNER!", 80),
                    o = t.CreateLabel("WINNER!", 80);
                r.leftInPixels = -300, o.leftInPixels = 300, r.topInPixels = -200, o.topInPixels = -200, i.addControl(r), i.addControl(o), t.player1Text = r, t.player2Text = o;
                var s = t.CreateWindowPanel(650, 320);
                s.topInPixels = 20;
                var a = t.CreateLabel("GAME OVER!", 50);
                a.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, a.topInPixels = 50, s.addControl(a);
                var u = t.CreateLabel("You Travelled: 20m", 30);
                t.distanceText = u, s.addControl(u), i.addControl(s);
                var h = t.CreateRoundButtonLabel("watch.png", "WATCH AD\nTO CONTINUE", (function() {
                        var e = Ua.instance;
                        e.adManager.HideDisplayAd(), e.ContinueWithAdvert()
                    })),
                    l = t.CreateRoundButtonLabel("restart.png", "RESTART", (function() {
                        var e = Ua.instance;
                        e.adManager.HideDisplayAd(), e.adManager.MaybeShowAd((function() {
                            return e.OnStartGamePressed()
                        }))
                    }));
                l.leftInPixels = -180;
                var c = t.CreateRoundButtonLabel("home.png", "MAIN MENU", (function() {
                    var e = Ua.instance;
                    e.adManager.HideDisplayAd(), e.adManager.MaybeShowAd((function() {
                        return e.OnShowMainMenu()
                    }))
                }));
                return c.leftInPixels = 180, t.restartButton = l, t.continueButton = h, t.exitButton = c, i.addControl(h), i.addControl(l), i.addControl(c), t.initialFocus = h, t
            }
            return Ma(t, e), t.prototype.OnBack = function() {}, t.prototype.CreateRoundButtonLabel = function(e, t, i) {
                var n = this.CreateRoundButton(e, i),
                    r = n.getChildByName("buttonImage");
                r.source = "./textures/ButtonRound2.png", r.TR_normal = "./textures/ButtonRound2.png", r.TR_highlight = "./textures/ButtonRound2_Highlight.png", n.widthInPixels = 200, n.heightInPixels = 240, n.verticalAlignment = oa.VERTICAL_ALIGNMENT_BOTTOM, n.topInPixels = -20;
                var o = this.CreateLabel(t, 15);
                return o.topInPixels = 70, n.addControl(o), n
            }, t.prototype.OnAboutToShow = function() {
                var t = Math.ceil(Ua.instance.CumulativeDistance());
                this.distanceText.text = "You Travelled: " + t + "m";
                var i = this.distanceText;
                da.AddTween(0, t, 2, (function(e) {
                    var t = Math.ceil(e);
                    i.text = "You Travelled: " + t + "m"
                })).OnCompleted((function() {
                    da.AddTween(1, 1.4, .5, (function(e) {
                        i.scaleX = i.scaleY = e
                    })).Ease(Zs.Kick)
                }));
                var n, r = Ua.instance.player1.reviveCount < 1,
                    o = Ua.instance.LevelDistance() / Ua.instance.levelManager.currentLevelLength > .6;
                if (o = o || Ua.instance.cumulativeLevelCount > 0, r = r && o, Ua.instance.gameMode == _a.SplitScreen) {
                    r = !1, this.player1Text.isVisible = !0, this.player2Text.isVisible = !0;
                    var s = Ua.instance.winState;
                    s == ga.Player1Won ? (this.player1Text.text = "WINNER!", this.player2Text.text = "LOSER!") : s == ga.Player2Won ? (this.player2Text.text = "WINNER!", this.player1Text.text = "LOSER!") : (this.player1Text.text = "DRAW", this.player2Text.text = "DRAW")
                } else this.player1Text.isVisible = !1, this.player2Text.isVisible = !1;
                r ? (this.continueButton.isVisible = !0, n = this.continueButton, this.restartButton.TR_moveRight = this.continueButton, this.continueButton.TR_moveRight = this.exitButton, this.continueButton.TR_moveLeft = this.restartButton, this.exitButton.TR_moveLeft = this.continueButton) : (this.continueButton.isVisible = !1, n = this.restartButton, this.restartButton.TR_moveRight = this.exitButton, this.exitButton.TR_moveLeft = this.restartButton), this.initialFocus = null, Ua.instance.adManager.ShowDisplayAd();
                var a = r ? 1 : 3,
                    u = this;
                da.AddTween(0, 1, .4, (function(e) {
                    u.continueButton.scaleX = u.continueButton.scaleY = e, u.exitButton.scaleX = u.exitButton.scaleY = e, u.restartButton.scaleX = u.restartButton.scaleY = e;
                    var t = Math.min(1, e);
                    u.continueButton.alpha = t, u.exitButton.alpha = t, u.restartButton.alpha = t
                })).OnCompleted((function() {
                    u.MoveFocus(n)
                })).Delay(a).Ease(Zs.EaseOutBack), e.prototype.OnAboutToShow.call(this), this.ClearFocus()
            }, t
        }(ya),
        xa = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }(),
        Pa = function(e) {
            function t() {
                var i = e.call(this, "HUD") || this,
                    n = i.menu;
                t.instance = i;
                var r = i.CreateRoundButton("pause.png", (function() {
                    Ua.instance.PauseGame()
                }));
                r.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, r.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, r.top = 100, n.addControl(r);
                var o = new ha("progress_bar");
                o.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, o.topInPixels = 20, o.widthInPixels = 400, o.heightInPixels = 4, o.background = "#ffffff", n.addControl(o);
                var s = new ha("pb_end1");
                s.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, s.topInPixels = 14, s.leftInPixels = -200, s.widthInPixels = 4, s.heightInPixels = 16, s.background = "#ffffff";
                var a = new ha("pb_end2");
                a.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, a.topInPixels = 14, a.leftInPixels = 200, a.widthInPixels = 4, a.heightInPixels = 16, a.background = "#ffffff", n.addControl(s), n.addControl(a);
                var u = new fa("progress", "./textures/LevelProgress.png");
                u.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, u.topInPixels = 10, u.widthInPixels = 32, u.heightInPixels = 24, u.leftInPixels = -200, n.addControl(u), i.progressArrow = u;
                var h = i.CreateButtonPanel(200, 100);
                h.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, h.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, i.distanceText = i.CreateLabel("0m", 30), h.addControl(i.distanceText), n.addControl(h);
                var l = i.CreateButtonPanel(200, 100);
                l.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, l.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_RIGHT, i.speedText = i.CreateLabel("0m/s", 30), l.addControl(i.speedText), n.addControl(l);
                var c = i.CreateLabel("3", 100);
                i.countdownText = c, n.addControl(c), c.isVisible = !1;
                var d = new sa("panel");
                d.widthInPixels = 725, d.heightInPixels = 140, d.verticalAlignment = oa.VERTICAL_ALIGNMENT_BOTTOM, d.topInPixels = -80;
                var f = new fa("panelImage", "./textures/info_panel.png");
                f.widthInPixels = 725, f.heightInPixels = 140, d.addControl(f);
                var p = i.CreateLabel("Use Arrow Keys to Steer", 40);
                return p.topInPixels = -20, d.addControl(p), i.infoText = p, i.infoPanel = d, d.isVisible = !1, i.showingMsg = !1, n.addControl(d), i.initialFocus = null, i
            }
            return xa(t, e), t.prototype.WhileOpen = function(e) {
                if (Ua.instance.state == pa.Playing) {
                    this.countdownText.isVisible = !1;
                    var t = Ua.instance.CumulativeDistance().toFixed(1);
                    this.distanceText.text = t + "m";
                    var i = Ua.instance.player1.Speed().toFixed(1);
                    this.speedText.text = i + "m/s";
                    var n = Ua.instance.levelManager.currentLevelLength,
                        r = Ua.instance.LevelDistance() / n;
                    this.progressArrow.leftInPixels = 400 * r - 200
                } else if (Ua.instance.state == pa.Countdown) {
                    var o = Ua.instance.CountdownTimer(),
                        s = Math.ceil(o),
                        a = s - o;
                    this.countdownText.text = s.toFixed(0), this.countdownText.alpha = 1 - a;
                    var u = 1 - a + 1.5 * a;
                    this.countdownText.scaleX = u, this.countdownText.scaleY = u, this.countdownText.isVisible = s > 0 && s <= 3
                }
            }, t.ShowMessage = function(e, i, n) {
                var r = t.instance;
                r.infoText.text = e, r.infoPanel.isVisible = !0, da.RemoveTween(r.infoTween), r.infoPanel.isVisible = !0, r.infoTween = da.AddTween(0, 1, n, (function(e) {
                    r.infoPanel.alpha = e, r.infoPanel.scaleY = e
                })).OnCompleted((function() {
                    r.infoTween = da.AddTween(1, 0, n, (function(e) {
                        r.infoPanel.alpha = e, r.infoPanel.scaleY = e
                    })).Delay(i).OnCompleted((function() {
                        r.infoPanel.isVisible = !1
                    }))
                }))
            }, t
        }(ya),
        Ia = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }(),
        Ca = function(e) {
            function t() {
                var t = e.call(this, "PauseMenu") || this,
                    i = t.menu,
                    n = new fa("bg", "./textures/black.png");
                n.widthInPixels = 2e3, n.heightInPixels = 600, n.alpha = .5, i.addControl(n);
                var r = t.CreateWindowPanel(650, 215);
                t.levelText = t.CreateLabel("LEVEL: 51", 30), t.levelText.topInPixels = -40, r.addControl(t.levelText);
                var o = t.CreateLabel("PAUSED", 60);
                o.topInPixels = 10, r.addControl(o), i.addControl(r);
                var s = t.CreateRoundButton("restart.png", (function() {
                    var e = Ua.instance;
                    e.adManager.MaybeShowAd((function() {
                        return e.OnStartGamePressed()
                    }))
                }));
                s.leftInPixels = -146, s.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP;
                var a = t.CreateRoundButton("play.png", (function() {
                    Ua.instance.ResumeGame()
                }));
                a.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP;
                var u = t.CreateRoundButton("home.png", (function() {
                    var e = Ua.instance;
                    e.adManager.MaybeShowAd((function() {
                        return e.OnShowMainMenu()
                    }))
                }));
                return u.leftInPixels = 146, u.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, i.addControl(s), i.addControl(a), i.addControl(u), s.TR_moveRight = a, a.TR_moveRight = u, a.TR_moveLeft = s, u.TR_moveLeft = a, t.initialFocus = a, t
            }
            return Ia(t, e), t.prototype.OnAboutToShow = function() {
                this.levelText.text = "LEVEL " + Ua.instance.currentLevel, e.prototype.OnAboutToShow.call(this)
            }, t.prototype.OnBack = function() {
                Ua.instance.ResumeGame()
            }, t
        }(ya),
        Sa = function() {
            var e = function(t, i) {
                return (e = Object.setPrototypeOf || {
                        __proto__: []
                    }
                    instanceof Array && function(e, t) {
                        e.__proto__ = t
                    } || function(e, t) {
                        for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i])
                    })(t, i)
            };
            return function(t, i) {
                function n() {
                    this.constructor = t
                }
                e(t, i), t.prototype = null === i ? Object.create(i) : (n.prototype = i.prototype, new n)
            }
        }(),
        Oa = function(e) {
            function t() {
                var t = e.call(this, "LevelSelectMenu") || this,
                    i = t.menu,
                    n = t;
                t.buttonColors = ["#9AE597", "#A6C0FF", "#FFFB7E", "#FF9CFC", "#FF5A5A"], t.pageTransitionInProgress = !1;
                var r = t.CreateRoundButton("arrow.png", (function() {
                    Ws.PlaySfx("Button"), n.OnBack()
                }));
                r.horizontalAlignment = oa.HORIZONTAL_ALIGNMENT_LEFT, r.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, i.addControl(r);
                var o = t.CreateLabel("SELECT LEVEL", 50);
                o.verticalAlignment = oa.VERTICAL_ALIGNMENT_TOP, o.topInPixels = 50, i.addControl(o);
                var s = t.CreateWindowPanel(800, 438);
                s.topInPixels = 62, i.addControl(s);
                var a = t.CreateRectButton("arrow.png", "", 100, 200, (function() {
                    n.PrevPage()
                }));
                a.leftInPixels = -410, a.topInPixels = 100, t.leftButton = a, i.addControl(a);
                var u = t.CreateRectButton("arrow.png", "", 100, 200, (function() {
                    n.NextPage()
                }));
                return u.leftInPixels = 410, u.topInPixels = 100, u.getChildByName("icon").scaleX = -1, t.rightButton = u, i.addControl(u), t.levelGrid = t.CreateLevelGrid(), s.addControl(t.levelGrid), u.TR_moveLeft = t.buttons[4], a.TR_moveRight = t.buttons[0], a.TR_moveLeft = r, r.TR_moveRight = a, r.TR_moveDown = t.buttons[0], t.buttons[0].TR_moveUp = r, t
            }
            return Sa(t, e), t.prototype.OnAboutToShow = function() {
                var i = Math.min(Ua.instance.currentLevel, t.TotalLevels),
                    n = Math.floor((i - 1) / t.LevelsPerPage);
                this.SetPage(n), this.initialFocus = this.GetButton(i), e.prototype.OnAboutToShow.call(this)
            }, t.prototype.SetPage = function(e) {
                var i = Math.ceil(t.TotalLevels / t.LevelsPerPage);
                e = Math.max(0, Math.min(e, i)), this.currentPage = e;
                for (var n = e * t.LevelsPerPage, r = this.buttonColors[Math.min(e, this.buttonColors.length - 1)], o = 0; o < this.buttons.length; ++o) {
                    var s = o + n + 1;
                    this.InitButton(o, s, r)
                }
            }, t.prototype.PrevPage = function() {
                if (!this.pageTransitionInProgress && this.currentPage > 0) {
                    Ws.PlaySfx("Button");
                    var e = this;
                    this.pageTransitionInProgress = !0, da.AddTween(1, 0, .2, (function(t) {
                        e.levelGrid.alpha = t, e.levelGrid.leftInPixels = 50 * (1 - t)
                    })).OnCompleted((function() {
                        e.SetPage(e.currentPage - 1), da.AddTween(0, 1, .2, (function(t) {
                            e.levelGrid.alpha = t, e.levelGrid.leftInPixels = -50 * (1 - t)
                        })).OnCompleted((function() {
                            e.pageTransitionInProgress = !1
                        }))
                    }))
                }
            }, t.prototype.NextPage = function() {
                if (!this.pageTransitionInProgress) {
                    var e = Math.ceil(t.TotalLevels / t.LevelsPerPage);
                    if (this.currentPage < e - 1) {
                        Ws.PlaySfx("Button");
                        var i = this;
                        this.pageTransitionInProgress = !0, da.AddTween(1, 0, .2, (function(e) {
                            i.levelGrid.alpha = e, i.levelGrid.leftInPixels = -50 * (1 - e)
                        })).OnCompleted((function() {
                            i.SetPage(i.currentPage + 1), da.AddTween(0, 1, .2, (function(e) {
                                i.levelGrid.alpha = e, i.levelGrid.leftInPixels = 50 * (1 - e)
                            })).OnCompleted((function() {
                                i.pageTransitionInProgress = !1
                            }))
                        }))
                    }
                }
            }, t.prototype.GetButton = function(e) {
                var i = e - this.currentPage * t.LevelsPerPage - 1;
                return i < 0 || i >= this.buttons.length ? null : this.buttons[i]
            }, t.prototype.InitButton = function(e, i, n) {
                var r = i <= Ua.instance.HighestLevel(),
                    o = this.buttons[e];
                o.isVisible = i <= t.TotalLevels, o.isEnabled = r, o.getChildByName("rect").background = n, o.getChildByName("label").text = i.toFixed(0), o.getChildByName("lock").isVisible = !r;
                var s = o.getChildByName("stars");
                if (s.isVisible = r, o.levelIndex = i, r) {
                    var a = Ua.instance.GetScore(i),
                        u = s.getChildByName("star1"),
                        h = s.getChildByName("star2"),
                        l = s.getChildByName("star3");
                    u.source = a >= 1 ? "./textures/StarFull.png" : "./textures/StarEmpty.png", h.source = a >= 2 ? "./textures/StarFull.png" : "./textures/StarEmpty.png", l.source = a >= 3 ? "./textures/StarFull.png" : "./textures/StarEmpty.png"
                }
            }, t.prototype.CreateLevelGrid = function() {
                var e = new sa("grid");
                e.widthInPixels = 800, e.heightInPixels = 438, this.buttons = [];
                for (var t = 0; t < 3; ++t)
                    for (var i = function(i) {
                            var r = n.CreateLevelButton((function() {
                                var e = r.levelIndex;
                                r.isEnabled && null != e && Ua.instance.StartGameAtLevel(e)
                            }));
                            r.topInPixels = 110 * t - 100, r.leftInPixels = 140 * i - 280, n.buttons.push(r), e.addControl(r)
                        }, n = this, r = 0; r < 5; ++r) i(r);
                for (t = 0; t < 3; ++t)
                    for (r = 0; r < 5; ++r) {
                        var o = 5 * t + r,
                            s = this.buttons[o];
                        t > 0 && (s.TR_moveUp = this.buttons[o - 5]), t < 2 && (s.TR_moveDown = this.buttons[o + 5]), s.TR_moveLeft = r > 0 ? this.buttons[o - 1] : this.leftButton, s.TR_moveRight = r < 4 ? this.buttons[o + 1] : this.rightButton
                    }
                return e
            }, t.prototype.CreateLevelButton = function(e) {
                var t = new sa("lvl_button");
                t.widthInPixels = 120, t.heightInPixels = 120;
                var i = va.CreateSimpleButton("button", "");
                i.widthInPixels = 90, i.heightInPixels = 60, i.thickness = 0;
                var n = new ha("rect");
                n.widthInPixels = 90, n.heightInPixels = 60, n.alpha = .2, n.color = "white", n.background = "#406080", n.thickness = 3;
                var r = this.CreateLabel("0", 30),
                    o = new fa("lock", "./textures/lock.png");
                o.widthInPixels = 80, o.heightInPixels = 80, o.alpha = .9;
                var s = new sa("stars");
                s.widthInPixels = 90, s.heightInPixels = 40, s.topInPixels = 30;
                var a = this.CreateStar("star1", -20, 0),
                    u = this.CreateStar("star2", 0, -5),
                    h = this.CreateStar("star3", 20, 0);
                h.source = "./textures/StarFull.png", s.addControl(a), s.addControl(h), s.addControl(u), t.TR_onClicked = e, t.TR_onSelected = function() {
                    n.alpha = .9
                }, t.TR_onUnselected = function() {
                    n.alpha = .2
                };
                var l = this;
                return i.onPointerClickObservable.add(t.TR_onClicked), i.onPointerEnterObservable.add(t.TR_onSelected), i.onPointerOutObservable.add((function() {
                    l.OnPointerLeaveControl(t)
                })), t.addControl(n), t.addControl(r), t.addControl(o), t.addControl(s), t.addControl(i), t
            }, t.prototype.CreateStar = function(e, t, i) {
                var n = new fa(e, "./textures/StarEmpty.png");
                return n.leftInPixels = t, n.topInPixels = i, n.widthInPixels = 35, n.heightInPixels = 35, n
            }, t.LevelsPerPage = 15, t.TotalLevels = 100, t
        }(ya),
        Da = function() {
            function e(t, i) {
                e.instance = this, this.currentMenu = null, this.menuStack = [], this.allMenus = [], this.screenWidth = 800, this.screenHeight = 600, this.uiTex = ua.CreateFullscreenUI("UI", !0, t), this.uiTex.idealHeight = 600, this.uiTex.useInvalidateRectOptimization = !1, this.fader = new ha("fader"), this.fader.background = "white", this.fader.thickness = 0, this.fader.zIndex = 100, this.uiTex.addControl(this.fader), this.faderActive = !0, this.inTransition = !1, this.allMenus.push(new ba), this.allMenus.push(new Aa), this.allMenus.push(new Ra), this.allMenus.push(new Pa), this.allMenus.push(new Ca), this.allMenus.push(new Oa);
                for (var n = 0, r = this.allMenus; n < r.length; n++) {
                    var o = r[n];
                    this.uiTex.addControl(o.menu), o.menu.isVisible = !1
                }
                this.Resize(i)
            }
            return e.prototype.Resize = function(e) {
                this.screenHeight = 600, this.screenWidth = 600 * e, this.fader.widthInPixels = this.screenWidth, this.fader.heightInPixels = this.screenHeight;
                for (var t = 0; t < this.allMenus.length; ++t) {
                    this.allMenus[t].Resize(this.screenWidth, this.screenHeight)
                }
            }, e.prototype.FaderFadeIn = function(t, i) {
                this.faderActive || (this.faderActive = !0, this.fader.isVisible = !0, da.AddTween(0, 1, t, (function(t) {
                    e.instance.fader.alpha = t
                })).OnCompleted(i))
            }, e.prototype.FaderFadeOut = function(t, i) {
                this.faderActive && da.AddTween(1, 0, t, (function(t) {
                    e.instance.fader.alpha = t
                })).OnCompleted((function() {
                    e.instance.fader.isVisible = !1, e.instance.faderActive = !1, i && i()
                }))
            }, e.prototype.AnimateOut = function(t, i) {
                this.inTransition = !0, da.RemoveTween(this.outTween), this.outTween = da.AddTween(t.menu.alpha, 0, .4, (function(e) {
                    t.menu.alpha = e
                })).OnCompleted((function() {
                    t.menu.isVisible = !1, e.instance.inTransition = !1, i()
                }))
            }, e.prototype.AnimateIn = function(t) {
                this.inTransition = !0, da.RemoveTween(this.inTween), t.menu.isVisible = !0, this.inTween = da.AddTween(0, 1, .4, (function(e) {
                    t.menu.alpha = e
                })).OnCompleted((function() {
                    e.instance.inTransition = !1
                }))
            }, e.prototype.FindMenu = function(e) {
                for (var t = 0, i = this.allMenus; t < i.length; t++) {
                    var n = i[t];
                    if (n.name == e) return n
                }
                return null
            }, e.prototype.ShowTopScreen = function() {
                var e = this.menuStack[this.menuStack.length - 1];
                e.OnAboutToShow(), this.currentMenu = e, this.currentMenu.MoveFocus(this.currentMenu.selected), this.AnimateIn(e)
            }, e.prototype.HideAll = function() {
                this.currentMenu && (this.currentMenu.menu.isVisible = !1), this.currentMenu = null, this.menuStack = [], this.inTransition = !1, da.RemoveTween(this.inTween), da.RemoveTween(this.outTween), this.inTween = null, this.outTween = null
            }, e.OpenMenu = function(t) {
                var i = e.instance;
                if (!i.inTransition) {
                    var n = i.FindMenu(t);
                    null != n ? i.currentMenu ? i.AnimateOut(i.currentMenu, (function() {
                        i.menuStack.push(n), i.ShowTopScreen()
                    })) : (i.menuStack.push(n), i.ShowTopScreen()) : console.log("No menu found with name: " + t)
                }
            }, e.CloseMenu = function(t) {
                var i = e.instance;
                i.currentMenu && i.currentMenu.name == t && i.AnimateOut(i.currentMenu, (function() {
                    i.menuStack.pop(), i.currentMenu = null, i.menuStack.length > 0 && i.ShowTopScreen()
                }))
            }, e.HideAllImmediate = function() {
                e.instance.HideAll()
            }, e.prototype.Update = function(e) {
                !this.inTransition && this.currentMenu && this.currentMenu.WhileOpen(e)
            }, e.prototype.MoveLeft = function() {
                !this.inTransition && this.currentMenu && this.currentMenu.MoveLeft()
            }, e.prototype.MoveRight = function() {
                !this.inTransition && this.currentMenu && this.currentMenu.MoveRight()
            }, e.prototype.MoveUp = function() {
                !this.inTransition && this.currentMenu && this.currentMenu.MoveUp()
            }, e.prototype.MoveDown = function() {
                !this.inTransition && this.currentMenu && this.currentMenu.MoveDown()
            }, e.prototype.OnSubmit = function() {
                !this.inTransition && this.currentMenu && this.currentMenu.OnSubmit()
            }, e.prototype.OnBack = function() {
                !this.inTransition && this.currentMenu && this.currentMenu.OnBack()
            }, e
        }(),
        wa = function() {
            function e() {
                var e = this;
                if (this.sentLoadFinished = !1, this.sentGameStarted = !1, this.shownPrerollAdd = !1, this.wasMusicPlaying = !0, this.rewardedCB = null, this.adCompletedCB = null, this.is_player_playing = !1, this.adPlaying = !1, this.pokiAvailable = !0, this.offlineDebugMode = !1, this.offlineDebugMode) return console.log("Poki Not Available"), void(this.pokiAvailable = !1);
                console.log("Initialising..."), Ua.instance.isMobileBrowser ? (this.displayContainer = document.getElementById("display320x50"), this.displaySize = "320x50") : (this.displayContainer = document.getElementById("display728x90"), this.displaySize = "728x90"), PokiSDK.init().then((function() {
                    console.log("PokiSDK initialized"), PokiSDK.setDebug(!1), e.pokiAvailable = !0
                })).catch((function() {
                    console.log("Adblock enabled"), e.pokiAvailable = !1
                }))
            }
            return e.prototype.OnLoadingStart = function() {
                console.log("Start Loading..."), this.pokiAvailable && PokiSDK.gameLoadingStart()
            }, e.prototype.OnLoadingProgress = function(e) {
                if (this.pokiAvailable) {
                    var t = {};
                    t.percentageDone = e, PokiSDK.gameLoadingProgress(t)
                }
            }, e.prototype.OnLoadingComplete = function() {
                this.pokiAvailable && PokiSDK.gameLoadingFinished()
            }, e.prototype.Update = function() {
                this.pokiAvailable && (Ua.instance.state != pa.Playing || this.is_player_playing ? Ua.instance.state != pa.Playing && this.is_player_playing && (this.is_player_playing = !1, PokiSDK.gameplayStop()) : (this.is_player_playing = !0, PokiSDK.gameplayStart()))
            }, e.prototype.OnAdStarted = function() {
                this.adPlaying = !0, this.wasMusicPlaying = Ws.IsMusicPlaying(), this.wasMusicPlaying && Ws.PauseMusic()
            }, e.prototype.OnAdEnded = function() {
                this.adPlaying = !1, this.wasMusicPlaying && Ws.UnPauseMusic(), null != this.adCompletedCB && (this.adCompletedCB(), this.adCompletedCB = null)
            }, e.prototype.OnRewardedAdCompleted = function(e) {
                e && null != this.rewardedCB && (this.rewardedCB(!0), this.rewardedCB = null), this.OnAdEnded()
            }, e.prototype.MaybeShowAd = function(e) {
                this.pokiAvailable ? this.ShowAdvert(e) : e && e()
            }, e.prototype.ShowAdvert = function(e) {
                if (this.pokiAvailable) {
                    this.adCompletedCB = e, this.OnAdStarted();
                    var t = this;
                    PokiSDK.commercialBreak().then((function() {
                        return t.OnAdEnded()
                    }))
                } else e && e()
            }, e.prototype.ShowDisplayAd = function() {
                this.pokiAvailable && (PokiSDK.displayAd(this.displayContainer, this.displaySize), this.displayContainer.style.display = "block")
            }, e.prototype.HideDisplayAd = function() {
                this.pokiAvailable && (PokiSDK.destroyAd(this.displayContainer), this.displayContainer.style.display = "none")
            }, e.prototype.ShowRewardedAdvert = function(e) {
                if (this.pokiAvailable) {
                    this.rewardedCB = e, this.OnAdStarted();
                    var t = this;
                    PokiSDK.rewardedBreak().then((function(e) {
                        return t.OnRewardedAdCompleted(e)
                    }))
                } else e && e(!0)
            }, e.prototype.OnStartButtonPressed = function() {
                this.shownPrerollAdd || (this.shownPrerollAdd = !0, this.ShowAdvert(null))
            }, e.prototype.OnPowerUp = function() {
                if (this.pokiAvailable) {
                    var e = Math.max(0, Math.min(1, .1 * Ua.instance.cumulativeLevelCount));
                    PokiSDK.happyTime(e)
                }
            }, e
        }(),
        La = document.getElementById("renderCanvas"),
        Fa = function() {
            function e(e) {
                this.speedMultiplier = 1, this.reviveCount = 0, this.shakeAmount = 0;
                var t = new St("camera", new b(0, 0, 0), e);
                t.fov = Math.PI / 180 * 60;
                var i = new je("root", e),
                    n = new je("player", e);
                n.position = new b(0, -8, 0), n.parent = i, this.acceleration = 1, this.root = i, this.player = n, this.camera = t
            }
            return e.prototype.Speed = function() {
                if (this.crashed) return 0;
                var e = this.acceleration * this.speedMultiplier * 60;
                return e += 2 * (2 * cr.value() - 1)
            }, e.prototype.SteerSpeed = function() {
                if (this.crashed) return 0;
                return this.acceleration * this.speedMultiplier * 105
            }, e.prototype.Reset = function() {
                this.crashed = !1, this.crashJustHappened = !1, this.acceleration = .5;
                var e = 1 - Math.exp(-.04 * Ua.instance.currentLevel),
                    t = Ua.instance.GetDifficulty();
                t == Ua.instance.DifficultyEasy ? this.speedMultiplier = 1 + .5 * e : t == Ua.instance.DifficultyMed ? this.speedMultiplier = 1.2 + .5 * e : this.speedMultiplier = 1.4 + .5 * e, this.reviveCount = 0, this.root.rotation = b.Zero()
            }, e.prototype.Revive = function() {
                this.crashed = !1, this.crashJustHappened = !1, this.acceleration = .5, this.reviveCount++
            }, e.prototype.Rotate = function(e) {
                var t = this.SteerSpeed();
                this.root.addRotation(0, 0, e * t * (Math.PI / 180))
            }, e.prototype.OnCrashed = function() {
                this.crashed = !0, this.crashJustHappened = !0, Ws.PlaySfx("Explode"), this.shakeAmount = .5
            }, e.prototype.Update = function(e) {
                if (this.crashJustHappened && (this.crashJustHappened = !1, Ua.instance.OnPlayerCrashed(this)), !this.crashed && Ua.instance.state == pa.Playing) {
                    this.acceleration = Math.min(1, this.acceleration + e / 3);
                    var t = 1.1 * this.Speed() * e,
                        i = this.camera.globalPosition,
                        n = new b(0, 0, 1),
                        r = new Ii(i, n, t + 4),
                        o = Ua.instance.scene.pickWithRay(r);
                    o.hit && void 0 !== o.pickedMesh.layer && "obstacle" == o.pickedMesh.layer && this.OnCrashed()
                }
            }, e
        }();
    ! function(e) {
        e[e.InMenus = 0] = "InMenus", e[e.Playing = 1] = "Playing", e[e.Paused = 2] = "Paused", e[e.Countdown = 3] = "Countdown", e[e.Dead = 4] = "Dead", e[e.TestMode = 5] = "TestMode"
    }(pa || (pa = {})),
    function(e) {
        e[e.Classic = 0] = "Classic", e[e.SplitScreen = 1] = "SplitScreen"
    }(_a || (_a = {})),
    function(e) {
        e[e.NoWinnerYet = 0] = "NoWinnerYet", e[e.Player1Won = 1] = "Player1Won", e[e.Player2Won = 2] = "Player2Won", e[e.ItWasADraw = 3] = "ItWasADraw"
    }(ga || (ga = {}));
    var Na = function() {
            function e() {
                this.maxLevel = 1, this.audioEnable = !0, this.difficulty = 1, this.scores = []
            }
            return e.LoadFromJSON = function(t) {
                for (var i = new e, n = JSON.parse(t), r = 0, o = Object.keys(i); r < o.length; r++) {
                    var s = o[r];
                    n.hasOwnProperty(s) && (i[s] = n[s])
                }
                return i
            }, e
        }(),
        Ua = function() {
            function e() {
                this.DifficultyEasy = 0, this.DifficultyMed = 1, this.DifficultyHard = 2, e.instance = this, this.isMobileBrowser = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent), console.log("Mobile : " + this.isMobileBrowser), this.engine = new ze(La);
                var t = new Et(this.engine);
                this.scene = t, t.clearColor = new y(0, 0, 0, 1), this.adManager = new wa, this.guiScene = new Et(this.engine), this.guiScene.autoClear = !1;
                new St("guiCamera", new b(0, 0, 0), this.guiScene);
                var i = window.localStorage.getItem("SaveData");
                null == i ? (this.saveData = new Na, this.SaveProgress()) : this.saveData = Na.LoadFromJSON(i), this.preloader = new Gn(t), this.tweener = new da, this.soundManager = new Ws, this.menuControl = new Da(this.guiScene, this.engine.getScreenAspectRatio()), this.inputMap = new Map, this.keyDown = new Map, this.player1 = new Fa(t), this.player2 = new Fa(t), ie.ShadersStore.tunnelVertexShader = zn.VS(), ie.ShadersStore.tunnelFragmentShader = zn.FS(), ie.ShadersStore.tunnelSemiTransFragmentShader = zn.FS_SemiTrans(), this.allMaterials = [], this.tunnelMat = this.CreateMaterial("tunnel", "tunnel", "textures/tunnel.jpg", b.One()), this.obstacleMat = this.CreateMaterial("tunnel", "tunnel", "textures/white.png", new b(1, 0, 0)), this.portalMat = this.CreateMaterial("tunnel", "tunnelSemiTrans", "textures/white.png", new b(.8, .3, .05)), this.portalMat.needAlphaBlending = function() {
                    return !0
                }, this.portalMat.alphaMode = 1, this.levelManager = new Vs, this.currentLevel = this.saveData.maxLevel, this.state = pa.InMenus, this.insideTunnel = !0, Ws.SetAudioEnabled(this.saveData.audioEnable);
                var n = this;
                t.actionManager = new fi(t), t.actionManager.registerAction(new ci(fi.OnKeyDownTrigger, (function(e) {
                    n.keyDown.set(e.sourceEvent.key, "keydown" == e.sourceEvent.type), n.inputMap.set(e.sourceEvent.key, "keydown" == e.sourceEvent.type)
                }))), t.actionManager.registerAction(new ci(fi.OnKeyUpTrigger, (function(e) {
                    n.inputMap.delete(e.sourceEvent.key)
                }))), La.addEventListener("keypress", (function(e) {
                    e.preventDefault()
                }), !1), La.addEventListener("keydown", (function(e) {
                    e.preventDefault()
                }), !1), La.addEventListener("keyup", (function(e) {
                    e.preventDefault()
                }), !1), t.onPointerObservable.add((function(e) {
                    if (n.state == pa.Playing) switch (e.type) {
                        case dt.POINTERDOWN:
                            e.event.x / n.engine.getRenderWidth(!0) < .5 ? n.inputMap.set("ArrowLeft", !0) : n.inputMap.set("ArrowRight", !0);
                            break;
                        case dt.POINTERUP:
                            n.inputMap.delete("ArrowLeft"), n.inputMap.delete("ArrowRight")
                    }
                })), this.testBlock ? this.ShowTestBlock() : (this.adManager.OnLoadingStart(), this.preloader.StartLoading(e.OnLoadingComplete))
            }
            return e.prototype.LoadingProgress = function(e) {
                this.adManager.OnLoadingProgress(e)
            }, e.OnLoadingComplete = function() {
                var t = e.instance;
                t.adManager.OnLoadingComplete(), t.OnEnterStateMenus()
            }, e.prototype.ResetProgress = function() {
                this.saveData.maxLevel = 1, this.saveData.scores = [], this.currentLevel = 1, this.SaveProgress()
            }, e.prototype.GetDifficulty = function() {
                return this.saveData.difficulty
            }, e.prototype.SetDifficulty = function(e) {
                this.saveData.difficulty = e, this.SaveProgress()
            }, e.prototype.HighestLevel = function() {
                return this.saveData.maxLevel
            }, e.prototype.SetHighestLevel = function(e) {
                this.saveData.maxLevel = e, this.SaveProgress()
            }, e.prototype.GetScore = function(e) {
                var t = this.saveData.scores[e];
                return null == t ? 0 : t
            }, e.prototype.SetScore = function(e, t) {
                e = Math.min(100, e), this.saveData.scores[e] = t, this.SaveProgress()
            }, e.prototype.SaveProgress = function() {
                var e = JSON.stringify(this.saveData);
                window.localStorage.setItem("SaveData", e)
            }, e.prototype.ShowInfo = function(e) {
                Pa.ShowMessage(e, 2, .2)
            }, e.prototype.ShowTestBlock = function() {
                this.player1.camera.dispose(), this.player2.camera.dispose(), new $t("testCam", 1, 1, 100, new b(0, 0, .5 * this.testBlock.length), this.scene).attachControl(La, !0), this.menuControl.FaderFadeOut(.5, null), this.state = pa.TestMode
            }, e.prototype.Resize = function() {
                this.engine.resize(), this.menuControl.Resize(this.engine.getScreenAspectRatio())
            }, e.prototype.CumulativeDistance = function() {
                return this.previousLevelsDistance + this.levelManager.zOffset
            }, e.prototype.LevelDistance = function() {
                return this.levelManager.zOffset
            }, e.prototype.CountdownTimer = function() {
                return this.countdownTimer
            }, e.prototype.CreateMaterial = function(e, t, i, n) {
                var r = new Pi("shader", this.scene, {
                        vertex: e,
                        fragment: t
                    }, {
                        attributes: ["position", "normal", "uv"],
                        uniforms: ["world", "viewProjection", "ZOffset", "mainTex", "color"]
                    }),
                    o = new Ri(i, this.scene);
                return r.setTexture("mainTex", o), r.setVector3("color", n), this.allMaterials.push(r), r
            }, e.prototype.UpdateCamera = function(e, t) {
                var i = e.player.getAbsolutePosition().clone(),
                    n = i.add(b.Forward().scale(20));
                n = n.add(this.levelManager.CalcOffset(n.z)).subtract(this.levelManager.cameraOffset);
                var r = e.shakeAmount;
                if (r > 0) {
                    i.x += r * (2 * cr.value() - 1), i.y += r * (2 * cr.value() - 1);
                    (r *= 1 - 2 * t) < .001 && (r = 0), e.shakeAmount = r
                }
                e.camera.position = i, e.camera.lockedTarget = n;
                var o = i.normalizeToNew();
                this.insideTunnel ? e.camera.upVector = o.negate() : e.camera.upVector = o
            }, e.prototype.SetPlayerStartingPositions = function() {
                var e;
                this.insideTunnel = this.levelManager.currentLevel.isInside, e = this.insideTunnel ? new b(0, -8, 0) : new b(0, 12, 0), this.player1.player.position = e, this.player2.player.position = e
            }, e.prototype.OnEnterStateMenus = function() {
                La.focus(), Da.OpenMenu("MainMenu"), this.levelManager.Reset(), this.state = pa.InMenus, this.insideTunnel = !0, this.player1.player.position = new b(0, -8, 0), this.player2.player.position = new b(0, -8, 0), this.EnableSplitScreen(!1), this.gameMode = _a.Classic, Ws.PlayMusic("IntroLoop"), this.menuControl.FaderFadeOut(.5, null)
            }, e.prototype.OnEnterStateGame = function() {
                Da.OpenMenu("HUD"), this.player1.Reset(), this.player2.Reset(), this.winState = ga.NoWinnerYet, this.cumulativeLevelCount = 0, this.previousLevelsDistance = 0, this.levelManager.StartGame(), this.SetPlayerStartingPositions(), this.state = pa.Playing, Ws.PlayMusic("GameLoop"), this.menuControl.FaderFadeOut(.4, null)
            }, e.prototype.OnEnterStateDeath = function() {
                Da.OpenMenu("RestartMenu")
            }, e.prototype.OnShowMainMenu = function() {
                Ws.PlaySfx("Button"), Ws.PauseMusic(), Da.HideAllImmediate(), this.state = pa.Paused, this.menuControl.FaderFadeIn(.8, (function() {
                    e.instance.OnEnterStateMenus()
                }))
            }, e.prototype.EnableSplitScreen = function(e) {
                e ? (this.player1.camera.viewport.width = .5, this.player2.camera.viewport.width = .5, this.player2.camera.viewport.x = .5, this.scene.activeCameras = [this.player1.camera, this.player2.camera]) : (this.player1.camera.viewport.width = 1, this.scene.activeCameras = [this.player1.camera])
            }, e.prototype.OnStartGamePressed = function() {
                Ws.PlaySfx("Button"), Ws.PauseMusic();
                var t = this.gameMode == _a.SplitScreen;
                this.EnableSplitScreen(t), Da.HideAllImmediate(), this.state = pa.Paused, this.menuControl.FaderFadeIn(.4, (function() {
                    e.instance.OnEnterStateGame()
                }))
            }, e.prototype.StartGameAtLevel = function(e) {
                this.adManager.OnStartButtonPressed(), this.gameMode = _a.Classic, this.currentLevel = e, this.OnStartGamePressed()
            }, e.prototype.OnPlayButtonPressed = function() {
                this.adManager.OnStartButtonPressed(), this.gameMode = _a.Classic, this.OnStartGamePressed()
            }, e.prototype.On2PlayerButtonPressed = function() {
                this.adManager.OnStartButtonPressed(), this.gameMode = _a.SplitScreen, this.OnStartGamePressed()
            }, e.prototype.OnShowSettings = function() {
                this.adManager.OnStartButtonPressed(), Ws.PlaySfx("Button"), Da.OpenMenu("SettingsMenu")
            }, e.prototype.PauseGame = function() {
                this.state == pa.Playing && (this.state = pa.Paused, Ws.PlaySfx("Pause"), Ws.PauseMusic(), Da.OpenMenu("PauseMenu"))
            }, e.prototype.ResumeGame = function() {
                this.state = pa.Playing, Ws.PlaySfx("Pause"), Ws.UnPauseMusic(), Da.CloseMenu("PauseMenu")
            }, e.prototype.ScrollSpeed = function() {
                return this.state == pa.InMenus ? 20 : this.state == pa.Paused || this.state == pa.Countdown || this.state == pa.Dead ? 0 : this.player1.Speed()
            }, e.prototype.OnPlayerCrashed = function(e) {
                this.gameMode == _a.SplitScreen && (this.player1.crashed && this.player2.crashed ? this.winState = ga.ItWasADraw : e == this.player1 ? this.winState = ga.Player2Won : e == this.player2 && (this.winState = ga.Player1Won)), this.GameOver()
            }, e.prototype.GameOver = function() {
                this.state = pa.Dead, Da.HideAllImmediate(), Ws.PauseMusic(), this.OnEnterStateDeath()
            }, e.prototype.ContinueWithAdvert = function() {
                var e = this;
                this.adManager.ShowRewardedAdvert((function(t) {
                    t && (e.player1.Revive(), Da.HideAllImmediate(), Da.OpenMenu("HUD"), e.state = pa.Countdown, e.countdownTimer = 3.5, e.levelManager.RemoveObstacles(60))
                }))
            }, e.prototype.RecordLevelScore = function() {
                var e = this.GetDifficulty() + 1;
                e > this.GetScore(this.currentLevel) && this.SetScore(this.currentLevel, e)
            }, e.prototype.MoveToNextLevel = function() {
                this.cumulativeLevelCount++, this.RecordLevelScore(), this.adManager.OnPowerUp(), this.previousLevelsDistance += this.levelManager.zOffset, this.currentLevel++, this.gameMode == _a.Classic && this.currentLevel > this.HighestLevel() && this.SetHighestLevel(this.currentLevel), this.levelManager.StartGame(), this.SetPlayerStartingPositions()
            }, e.prototype.UpdateInput = function(e) {
                if (this.state == pa.Playing) {
                    var t = this.insideTunnel ? 1 : -1;
                    this.gameMode == _a.SplitScreen ? (this.inputMap.get("a") && this.player1.Rotate(-e * t), this.inputMap.get("ArrowLeft") && this.player2.Rotate(-e * t), this.inputMap.get("d") && this.player1.Rotate(e * t), this.inputMap.get("ArrowRight") && this.player2.Rotate(e * t)) : ((this.inputMap.get("a") || this.inputMap.get("ArrowLeft")) && this.player1.Rotate(-e * t), (this.inputMap.get("d") || this.inputMap.get("ArrowRight")) && this.player1.Rotate(e * t))
                } else this.state != pa.InMenus && this.state != pa.Paused && this.state != pa.Dead || (this.keyDown.get("ArrowLeft") && this.menuControl.MoveLeft(), this.keyDown.get("ArrowRight") && this.menuControl.MoveRight(), this.keyDown.get("ArrowUp") && this.menuControl.MoveUp(), this.keyDown.get("ArrowDown") && this.menuControl.MoveDown(), (this.keyDown.get("Enter") || this.keyDown.get(" ")) && this.menuControl.OnSubmit(), this.keyDown.get("Backspace") && this.menuControl.OnBack())
            }, e.prototype.Update = function() {
                if (this.adManager.Update(), this.adManager.adPlaying) this.keyDown.clear();
                else {
                    var e = .001 * this.scene.getEngine().getDeltaTime();
                    if (e = Math.min(e, 1 / 30), this.UpdateInput(e), this.tweener.UpdateTweens(e), this.state == pa.TestMode) return this.testBlock.Update(e), void this.keyDown.clear();
                    var t = e;
                    this.state != pa.Paused && this.state != pa.Countdown || (t = 0), this.levelManager.Update(t, this.ScrollSpeed()), this.levelManager.levelCompleted && this.MoveToNextLevel(), this.UpdateCamera(this.player1, e), this.gameMode == _a.SplitScreen && this.UpdateCamera(this.player2, e), this.menuControl.Update(e);
                    for (var i = 0; i < this.allMaterials.length; ++i) this.allMaterials[i].setFloat("ZOffset", this.levelManager.zOffset), this.allMaterials[i].setVector3("CameraOffset", this.levelManager.cameraOffset);
                    if (this.state == pa.Playing || this.state == pa.Paused ? (this.keyDown.get("p") || this.keyDown.get("Escape")) && (this.state == pa.Playing ? this.PauseGame() : this.state == pa.Paused && this.ResumeGame()) : this.state == pa.InMenus && this.keyDown.get("Escape") && this.menuControl.currentMenu && this.menuControl.currentMenu.OnBack(), this.state == pa.Playing) this.player1.Update(e), this.gameMode == _a.SplitScreen && this.player2.Update(e);
                    else if (this.state == pa.Countdown) {
                        var n = Math.ceil(this.countdownTimer);
                        this.countdownTimer -= e, n != Math.ceil(this.countdownTimer) && (this.countdownTimer <= 0 ? (this.state = pa.Playing, Ws.PlayMusic("GameLoop")) : Ws.PlaySfx("Beep"))
                    }
                    this.keyDown.clear()
                }
            }, e.prototype.Render = function() {
                this.scene.render(), this.guiScene.render()
            }, e
        }(),
        Ba = new Ua;
    Ba.engine.runRenderLoop((function() {
        try {
            Ba.Update(), Ba.Render()
        } catch (e) {
            console.log("ERROR::" + e)
        }
    })), window.addEventListener("resize", (function() {
        Ba.Resize()
    }));
    
}]);